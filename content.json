{"pages":[{"title":"404","text":"","path":"404/index.html","date":"03-19","excerpt":""},{"title":"éè‘—åä¸ä¸“ä¸šç¨‹åºå‘˜","text":"ä¸€ä¸ªå¼€æœ—ä¸Šè¿›çš„iOSå¼€å‘å·¥ä½œè€…,å¯¹è‹¹æœè®¾è®¡ç†å¿µçš„è®¤åŒå’Œå¯¹ç¼–ç¨‹çš„å…´è¶£è®©æˆ‘é€‰æ‹©äº†iOSå¼€å‘è¿™ä¸ªè¡Œä¸š,å¯¹å¾…å·¥ä½œæœ‰è´£ä»»,æœ‰æ‹…å½“.ä¿è¯å·¥ä½œåŠæ—¶å¹¶é«˜æ•ˆå®Œæˆ,å¹¶èƒ½ä»è¿‡å¾€çš„ç»å†ä¸­æ€»ç»“ç»éªŒä¸æ–­çš„å®Œå–„è‡ªå·±.é—²æš‡æ—¶å–œæ¬¢ä»cocoachinaå’Œgithubä¸­å¯»æ‰¾ä¸€äº›æœ‰æ„æ€çš„Demoå’Œæ–°æŠ€æœ¯æ¥å……ç”µ,ä¹Ÿå–œæ¬¢çœ‹çœ‹é—²ä¹¦.æ°¸è¿œä¿æŒå¥½å¥‡å¿ƒ. Stay hungry. Stay foolish.","path":"about/index.html","date":"05-14","excerpt":""},{"title":"search","text":"","path":"search/index.html","date":"03-19","excerpt":""},{"title":"categories","text":"","path":"categories/index.html","date":"05-14","excerpt":""},{"title":"tags","text":"","path":"tags/index.html","date":"05-14","excerpt":""}],"posts":[{"title":"ITunes12.7ä»¥åå¯¼å‡ºå•†åº—IPAåŒ…","text":"ç”±äºITunes12.7ä»¥åå–æ¶ˆäº†ä¸‹è½½åº”ç”¨çš„åŠŸèƒ½å¯¼è‡´ä¸èƒ½ä¸‹è½½IPAåŒ…åˆ°æœ¬åœ°.ç½‘ä¸Šä¹Ÿæä¾›äº†é™çº§ITunesçš„æ–¹æ³•æ¥è¾¾åˆ°ä¸‹è½½IPAåŒ…çš„ç›®çš„ï¼Œä½†æ˜¯é™çº§ä¹‹åæˆ‘è¿™è¾¹ITunesä¹Ÿæ˜¯å„ç§æŠ¥é”™,åº”è¯¥æ˜¯è‹¹æœçˆ¸çˆ¸å¯¹ä½ç‰ˆæœ¬çš„ITunesé‡‡å–äº†æŸäº›æªæ–½. é¦–å…ˆæˆ‘ä»¬å…ˆå»mac åº”ç”¨å•†åº— ä¸‹è½½ä¸€ä¸ªApple Configurator,ç„¶åç™»å½•è‡ªå·±çš„Appleè´¦æˆ·,é€‰æ‹©è‡ªå·±çš„è®¾å¤‡,ç‚¹å‡»æ·»åŠ ,é€‰æ‹©åº”ç”¨ï¼ˆè¿™é‡Œåªèƒ½é€‰æ‹©æ‰‹æœºä¸Šå·²ç»æŒ‰ç…§çš„åº”ç”¨ï¼‰,é€‰æ‹©è‡ªå·±éœ€è¦IPAçš„åº”ç”¨.è¿™ä¸ªæ—¶å€™å°±å¼€å§‹ä¸‹è½½åº”ç”¨äº†,åº”ç”¨ä¸‹è½½å®Œä¹‹åä¼šå¼¹å‡ºä¸€ä¸ªå·²ç»å­˜åœ¨åº”ç”¨,è¿™ä¸ªæ—¶å€™ä»€ä¹ˆéƒ½ä¸è¦ç‚¹ ç›´æ¥å»ä¸‹é¢è¿™ä¸ªæ–‡ä»¶å¤¹å°±èƒ½æ‰¾åˆ°IPAåŒ…äº†.~/èµ„æºåº“/Group Containers/K36BKF7T3D.group.com.apple.configurator/Library/Caches/Assets/TemporaryItems/MobileApps/ æœ€åæŠŠIPAåŒ…å¤åˆ¶å‡ºæ¥,ç„¶åç‚¹å‡»å¼¹å‡ºä¸Šçš„åœæ­¢,ä½ å°±å¯ä»¥çœ‹åˆ°ä¸Šé¢æ–‡ä»¶å¤¹çš„IPAåŒ…æ¶ˆå¤±äº†â€¦","path":"2018/05/17/ITunes12-7ä»¥åå¯¼å‡ºå•†åº—IPAåŒ…/","date":"05-17","excerpt":""},{"title":"iOSæ€§èƒ½ä¼˜åŒ–","text":"å¡é¡¿ä¼˜åŒ–é€šå¸¸æ¥è¯´,è®¡ç®—æœºç³»ç»Ÿä¸­ CPUã€GPUã€æ˜¾ç¤ºå™¨æ˜¯ä»¥ä¸Šé¢è¿™ç§æ–¹å¼ååŒå·¥ä½œçš„.CPU è®¡ç®—å¥½æ˜¾ç¤ºå†…å®¹æäº¤åˆ° GPU,GPU æ¸²æŸ“å®Œæˆåå°†æ¸²æŸ“ç»“æœæ”¾å…¥å¸§ç¼“å†²åŒº,éšåè§†é¢‘æ§åˆ¶å™¨ä¼šæŒ‰ç…§ VSync ä¿¡å·é€è¡Œè¯»å–å¸§ç¼“å†²åŒºçš„æ•°æ®,ç»è¿‡å¯èƒ½çš„æ•°æ¨¡è½¬æ¢ä¼ é€’ç»™æ˜¾ç¤ºå™¨æ˜¾ç¤º. iOS ä¿æŒç•Œé¢æµç•…çš„æŠ€å·§ ç¼–è¯‘ä¼˜åŒ–å¢åŠ XCodeæ‰§è¡Œçš„çº¿ç¨‹æ•°XCodeé»˜è®¤ä½¿ç”¨ä¸CPUæ ¸æ•°ç›¸åŒçš„çº¿ç¨‹æ¥è¿›è¡Œç¼–è¯‘, ä½†ç”±äºç¼–è¯‘è¿‡ç¨‹ä¸­çš„IOæ“ä½œå¾€å¾€æ¯”CPUè¿ç®—è¦å¤š, å› æ­¤é€‚å½“çš„æå‡çº¿ç¨‹æ•°å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸ŠåŠ å¿«ç¼–è¯‘é€Ÿåº¦. åœ¨ç»ˆç«¯è¾“å…¥defaults write com.apple.dt.Xcode ShowBuildOperationDuration YESå¼€å¯å¤šçº¿ç¨‹, æ›´æ”¹çº¿ç¨‹æ•°è®¾ç½®defaults write com.apple.Xcode PBXNumberOfParallelBuildSubtasks 5. å°†Debug Information Formatæ”¹ä¸ºDWARFå°†Target-&gt;Build Settingsä¸­, æ‰¾åˆ°Debug Information Formatè¿™ä¸€é¡¹, å°†Debugæ—¶çš„DWARF with dSYM fileæ”¹ä¸ºDWARF. è¿™ä¸€é¡¹è®¾ç½®çš„æ˜¯æ˜¯å¦å°†è°ƒè¯•ä¿¡æ¯åŠ å…¥åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­, æ”¹ä¸ºDWARFå, å¦‚æœç¨‹åºå´©æºƒ, å°†æ— æ³•è¾“å‡ºå´©æºƒä½ç½®å¯¹åº”çš„å‡½æ•°å †æ ˆ, ä½†ç”±äºDebugæ¨¡å¼ä¸‹å¯ä»¥åœ¨XCodeä¸­æŸ¥çœ‹è°ƒè¯•ä¿¡æ¯, æ‰€ä»¥æ”¹ä¸ºDWARFå½±å“å¹¶ä¸å¤§. è¿™ä¸€é¡¹æ›´æ”¹å®Œä¹‹å, å¯ä»¥å¤§å¹…æå‡ç¼–è¯‘é€Ÿåº¦.å°†Debug Information Formatæ”¹ä¸ºDWARFä¹‹å, ä¼šå¯¼è‡´åœ¨Debugçª—å£æ— æ³•æŸ¥çœ‹ç›¸å…³ç±»ç±»å‹çš„æˆå‘˜å˜é‡çš„å€¼. å½“éœ€è¦æŸ¥çœ‹è¿™äº›å€¼æ—¶, å¯ä»¥å°†Debug Information Formatæ”¹å›DWARF with dSYM file, clean(å¿…é¡»)ä¹‹åé‡æ–°ç¼–è¯‘. å°†Build Active Architecture Onlyæ”¹ä¸ºYeså°†Target-&gt;Build Settingsä¸­, æ‰¾åˆ°Build Active Architecture Onlyè¿™ä¸€é¡¹, å°†Debugæ—¶çš„ NO æ”¹ä¸º YES. éœ€è¦æ³¨æ„çš„æ˜¯, æ­¤é€‰é¡¹åœ¨Releaseæ¨¡å¼ä¸‹å¿…é¡»ä¸ºNO, å¦åˆ™å‘å¸ƒçš„ipaåœ¨éƒ¨åˆ†è®¾å¤‡ä¸Šå°†ä¸èƒ½è¿è¡Œ. è¿™ä¸€é¡¹æ›´æ”¹å®Œä¹‹å, å¯ä»¥æ˜¾è‘—æé«˜ç¼–è¯‘é€Ÿåº¦. è®¾è®¡ç¼–è¯‘ä¼˜åŒ–ç­‰çº§ä¸è¦å†é¡¹ç›®ä¸­æˆ–è€…é™æ€åº“ä¸­ä½¿ç”¨-O4, å› ä¸ºè¿™ä¼šè®©Clangé“¾æ¥Link Time Optimizations (LTO)ä½¿å¾—ç¼–è¯‘æ›´æ…¢, é€šå¸¸ä½¿ç”¨-O3. åœ¨è®¾ç½®ç¼–è¯‘ä¼˜åŒ–ä¹‹å, XCodeæ–­ç‚¹å’Œè°ƒè¯•ä¿¡æ¯ä¼šä¸æ­£å¸¸, æ‰€ä»¥ä¸€èˆ¬é™æ€åº“æˆ–è€…å…¶ä»–Targetè¿™æ ·è®¾ç½®. å°†å¸¸ç”¨çš„ä»£ç åŠæ–‡ä»¶æ‰“åŒ…æˆé™æ€åº“æˆ‘ä»¬ç”¨Cocoapodsæ¥ç®¡ç†ç¬¬ä¸‰æ–¹åŒ…, æˆ‘ä»¬å¯ä»¥å°†ç¬¬ä¸‰æ–¹åŒ…æ‰“åŒ…æˆé™æ€åº“, ä¹Ÿå¯ä»¥æå‡ç¼–è¯‘é€Ÿåº¦. ä¹Ÿå¯ä»¥å°†ç¬¬ä¸‰æ–¹åŒ…æ‰“åŒ…æˆäºŒè¿›åˆ¶æ–‡ä»¶, ä½†æ˜¯è¿™æ ·ä¸æ–¹ä¾¿è°ƒè¯•. å¯åŠ¨ä¼˜åŒ–Appæ€»å¯åŠ¨æ—¶é—´ = t1(main()ä¹‹å‰çš„åŠ è½½æ—¶é—´) + t2(main()ä¹‹åçš„åŠ è½½æ—¶é—´).t1 = ç³»ç»Ÿdylib(åŠ¨æ€é“¾æ¥åº“)å’Œè‡ªèº«Appå¯æ‰§è¡Œæ–‡ä»¶çš„åŠ è½½;t2 = mainæ–¹æ³•æ‰§è¡Œä¹‹ååˆ°AppDelegateç±»ä¸­çš„- (BOOL)Application:(UIApplication )Application didFinishLaunchingWithOptions:(NSDictionary )launchOptionsæ–¹æ³•æ‰§è¡Œç»“æŸå‰è¿™æ®µæ—¶é—´, ä¸»è¦æ˜¯æ„å»ºç¬¬ä¸€ä¸ªç•Œé¢, å¹¶å®Œæˆæ¸²æŸ“å±•ç¤º. ä»Šæ—¥å¤´æ¡iOSå®¢æˆ·ç«¯å¯åŠ¨é€Ÿåº¦ä¼˜åŒ– ç˜¦èº«ä¼˜åŒ–èµ„æºç˜¦èº«èµ„æºç˜¦èº«ä¸»è¦æ˜¯å»æ‰æ— ç”¨èµ„æºå’Œå‹ç¼©èµ„æº, èµ„æºåŒ…æ‹¬å›¾ç‰‡, éŸ³è§†é¢‘æ–‡ä»¶, é…ç½®æ–‡ä»¶ä»¥åŠå¤šè¯­è¨€wording. èµ„æºå‹ç¼©ä¸»è¦å¯¹pngè¿›è¡Œæ— æŸå‹ç¼©. ç¼–è¯‘é€‰é¡¹ä¼˜åŒ– Optimization Level ä½¿ç”¨Fastest, Smalllest. è¯¥é€‰é¡¹å¯¹å®‰è£…åŒ…å¤§å°å½±å“å‡ æ— ï¼Œä½†å¯ä»¥æé«˜appçš„æ€§èƒ½ Strip Linked Product è®¾ç½®ä¸ºYES, éœ€è¦æ³¨æ„çš„æ˜¯Strip Linked Productä¹Ÿå—åˆ°Deployment Postprocessingè®¾ç½®é€‰é¡¹çš„å½±å“. åœ¨Build Settingsä¸­, æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ Strip Linked Productæ˜¯åœ¨Deploymentè¿™æ ä¸­çš„, è€ŒDeployment Postprocessingç›¸å½“äºæ˜¯Deploymentçš„æ€»å¼€å…³. è®°å¾—æŠŠDeployment Postprocessingä¹Ÿè®¾ç½®ä¸ºYES. Symbols Hidden by Defaultè®¾ç½®ä¸ºYES Make Strings Read-Only è®¾ç½®ä¸ºYES äºŒè¿›åˆ¶å®‰è£…åŒ…äºŒè¿›åˆ¶åŒ…æ˜¯ç”±å„ç§ä»£ç æ–‡ä»¶, é™æ€åº“ åŠ¨æ€åº“ ç»è¿‡ç¼–è¯‘åç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶. XCodeå¼€å¯ç¼–è¯‘é€‰é¡¹Write Link Map File XCode -&gt; target -&gt; Build Settings -&gt; æœmap -&gt; æŠŠWrite Link Map Fileé€‰é¡¹è®¾ä¸ºyes, å¹¶æŒ‡å®šå¥½linkMapçš„å­˜å‚¨ä½ç½®. ç¼–è¯‘ååˆ°ç¼–è¯‘ç›®å½•é‡Œæ‰¾åˆ°è¯¥txtæ–‡ä»¶, æ–‡ä»¶åå’Œè·¯å¾„å°±æ˜¯ä¸Šè¿°çš„Path to Link Map File.~/Library/Developer/Xcode/DerivedData/XXX-eumsvrzbvgfofvbfsoqokmjprvuh/Build/Intermediates/XXX.build/Debug-iphoneos/XXX.build/. è¿™ä¸ªLinkMapé‡Œå±•ç¤ºäº†æ•´ä¸ªå¯æ‰§è¡Œæ–‡ä»¶çš„å…¨è²Œ, åˆ—å‡ºäº†ç¼–è¯‘åçš„æ¯ä¸€ä¸ª.oç›®æ ‡æ–‡ä»¶çš„ä¿¡æ¯(åŒ…æ‹¬é™æ€é“¾æ¥åº“.aé‡Œçš„), ä»¥åŠæ¯ä¸€ä¸ªç›®æ ‡æ–‡ä»¶çš„ä»£ç æ®µ, æ•°æ®æ®µå­˜å‚¨è¯¦æƒ…. åˆ°https://github.com/huanxsd/LinkMapä¸‹è½½è¿™ä¸ªmacå·¥ç¨‹, ç„¶åè¿è¡Œ, å¯¹æ–‡ä»¶è¿›è¡Œåˆ†æ. é€šè¿‡å¯¹ä¸Šé¢çš„æ–‡ä»¶è¿›è¡Œåˆ†æ, å°±çŸ¥é“æ¯ä¸ªç±»åœ¨æœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­å æ®çš„å¤§å°. ç„¶åæœ‰é’ˆå¯¹æ€§çš„è¿›è¡Œä¼˜åŒ–å°±å¯ä»¥äº†. åˆ é™¤ä¸€äº›æ— ç”¨æ–‡ä»¶æŸ¥æ‰¾æ— ç”¨selector, æ— ç”¨OCç±», æ‰«æé‡å¤ä»£ç .","path":"2018/05/15/iOSæ€§èƒ½ä¼˜åŒ–/","date":"05-15","excerpt":""},{"title":"å¿«é€Ÿå®šä½ç›®æ ‡æ§åˆ¶å™¨","text":"æ¥æ‰‹ä¸€ä¸ªè€é¡¹ç›®æˆ–é¡¹ç›®ç›®å½•ç»“æ„å¤æ‚çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¦ä¿®æ”¹æŸä¸ªæ§åˆ¶å™¨çš„ç•Œé¢/åŠŸèƒ½æ—¶ï¼Œæ§åˆ¶å™¨çš„å®šä½å°±æœ‰äº›è®¸å›°éš¾ã€‚ å……åˆ†æ¡ä»¶: Xcode 9.0 åŠä»¥ä¸Š æ¨¡æ‹Ÿå™¨/çœŸæœº iOS 11.0 åŠä»¥ä¸Š è¿‡ç¨‹: æ¨¡æ‹Ÿå™¨/çœŸæœºå®šä½éœ€è¦è°ƒè¯•çš„ç•Œé¢ å®šä½åˆ° debug å·¥å…· -&gt; ç‚¹å‡» debug view hierarchies è½»è½¬ä¸€ä¸‹è§†å›¾å±‚æ¬¡,å°±å¯ä»¥çœ‹åˆ°æ•´ä¸ªçš„é¡µé¢çš„å±‚æ¬¡ç»“æ„,ä»Šå¤©çš„é‡ç‚¹åœ¨è¿™é‡Œ,æ§åˆ¶å™¨å®ä¾‹ ç‚¹å‡»æ§åˆ¶å™¨å®ä¾‹(ä¸Šå›¾çº¢æ¡†éƒ¨åˆ†),çœ‹ Xcode å³ä¾§ show the object inspector","path":"2018/03/23/å¿«é€Ÿå®šä½ç›®æ ‡æ§åˆ¶å™¨/","date":"03-23","excerpt":""},{"title":"éè‘—åä¸ä¸“ä¸šç¨‹åºå‘˜å¿…å¤‡å·¥å…·","text":"æ™ºèƒ½æœç´¢å·¥å…·Alfred ä½œä¸ºä¸€åéè‘—åä¸ä¸“ä¸šç¨‹åºå‘˜ï¼Œæœç´¢å‡ ä¹å æ®æˆ‘ä»¬å¤§éƒ¨åˆ†æ—¶é—´ã€‚è€Œè¿™æ¬¾è½¯ä»¶å¯ä»¥å ªç§°æ˜¯åˆ©å™¨ï¼Œæ— è®ºæ˜¯è°·æ­Œç™¾åº¦è¿˜æ˜¯å¿«æ·æ‰“å¼€è½¯ä»¶éƒ½å¯ä»¥å¤§é‡èŠ‚çœæˆ‘ä»¬æ—¶é—´ã€‚æ¨è Alfred æ’ä»¶ï¼š1. CodeVar : å¯ä»¥è®©è‹±æ–‡ç¨€çƒ‚çš„ä½ ä¸€æ ·èƒ½å†™å‡ºä¸€ä¸ªæ ‡å‡†è‹±æ–‡å˜é‡å2. Kill Process: å¿«æ·æ€æ­»ç¨‹åº ç¼–ç¨‹è¯­è¨€Apiæ–‡æ¡£ Dash Dash for macæ˜¯ä½¿ç”¨ä¸Mac OSå¹³å°çš„è½¯ä»¶ç¼–ç¨‹æ–‡æ¡£ç®¡ç†å·¥å…·ï¼Œå¯ä»¥æµè§ˆAPIæ–‡æ¡£ï¼Œä»¥åŠç®¡ç†ä»£ç ç‰‡æ®µå·¥å…·ã€‚Dashè‡ªå¸¦äº†ä¸°å¯Œçš„APIæ–‡æ¡£ï¼Œæ¶‰åŠå„ç§ä¸»æµçš„ç¼–ç¨‹è¯­è¨€å’Œæ¡†æ¶ã€‚ æ¥å£è°ƒè¯•å·¥å…· postman å¼•ç”¨å®˜ç½‘ä¸€å¥è¯ï¼š Developers use Postman to build modern software for the API-first world. ä»£ç ç®¡ç†å¯è§†åŒ–å·¥å…· SVNï¼š ä½¿ç”¨cornerstone Git: ä½¿ç”¨Sourcetree Finderæ‰©å±•å·¥å…· TotalFinder TotalFinderæ˜¯macæœç´¢å¢å¼ºå·¥å…·ï¼Œå…·æœ‰å¤šæ ‡ç­¾å¼æµè§ˆã€æ‹·è´è·¯å¾„ã€å‰ªåˆ‡æ–‡ä»¶ã€æ˜¾ç¤ºéšè—æ–‡ä»¶ã€åŒçª—å£æ¨¡å¼ç­‰åŠŸèƒ½ï¼Œè®©ä½ æµè§ˆå’Œæœç´¢æ–‡ä»¶æ›´åŠ æ–¹ä¾¿ MarkDownç¬”è®°ç¼–å†™å·¥å…· FaIcon å¦‚æœä½ åƒæˆ‘ä¸€æ ·æ¯”è¾ƒæ‡’ä¸å–œæ¬¢è®°MarkDownè¯­æ³•ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨è¿™æ¬¾MarkDown å·¥å…·ï¼Œå†…ç½®å¸¸ç”¨è¯­æ³•æ ‡ç­¾æŒ‰é’® é‚®ä»¶åº”ç”¨ Airmail å¦‚æœä½ åƒæˆ‘ä¸€æ ·å–œæ¬¢æ ¹æ®ä¸ªäººä¹ æƒ¯æ¥å®šåˆ¶åº”ç”¨ï¼Œä»¥æ±‚æ•ˆç‡æœ€å¤§åŒ–çš„äººï¼ŒAirmail é«˜åº¦çš„å¯å®šåˆ¶æ€§ä¸€å®šä¼šè®©ä½ æ¬£å–œè‹¥ç‹‚ã€‚åªè¦ä½ ä¸Šæ‰‹ä½“éªŒå‡ åˆ†é’Ÿï¼Œä½ ä¹Ÿä¼šåƒæˆ‘ä¸€æ ·å¾—å‡ºã€ŒAirmail æ˜¯ç°åœ¨ iOS ä¸Šå¯è‡ªå®šä¹‰ç¨‹åº¦æœ€é«˜çš„é‚®ä»¶åº”ç”¨ã€ å¼ºå¤§çš„ç»ˆç«¯å·¥å…· ITerm2 å¦‚æœä½ åƒæˆ‘ä¸€æ ·ä¹Ÿå–œæ¬¢æäº›èŠ±é‡Œèƒ¡å“¨çš„ç•Œé¢ï¼Œè¿˜å¯ä»¥é…åˆoh-my-zshæ’ä»¶åšä¸€äº›è‡ªå®šä¹‰é…è‰²æ–¹æ¡ˆ ~~~~æœ€åé€ç»™å¤§å®¶ä¸¤ä¸ªMacç ´è§£è½¯ä»¶çš„ç½‘ç«™å¤§éƒ¨åˆ†ç ´è§£è½¯ä»¶éƒ½èƒ½æœç´¢åˆ°ã€‚ç²¾å“MACåº”ç”¨åˆ†äº«å²è’‚èŠ¬å‘¨çš„åšå®¢","path":"2018/03/20/éè‘—åä¸ä¸“ä¸šç¨‹åºå‘˜å¿…å¤‡å·¥å…·/","date":"03-20","excerpt":""},{"title":"iOSä¼˜è´¨åšå®¢","text":"é«˜è´¨é‡ iOS åšå®¢æ¨è","path":"2018/03/18/iOSä¼˜è´¨åšå®¢/","date":"03-18","excerpt":""},{"title":"RxSwift+HandyJson+Moyaä¼˜é›…å®ç°ç½‘ç»œè¯·æ±‚","text":"é¦–å…ˆåœ¨podfileæ–‡ä»¶ä¸­å¯¼å…¥éœ€è¦ç”¨åˆ°çš„åº“ 12pod &apos;Moya/RxSwift&apos;pod &apos;HandyJSON&apos; å› ä¸ºMoya/RxSwiftä¸­åŒ…å«äº†RxSwiftæ‰€ä»¥ä¸å¿…å†å¯¼å…¥RxSwiftåº“,Moyaå’ŒHandyJSONåº“çš„ä½¿ç”¨è¿™é‡Œå°±ä¸ä»‹ç»äº†. 1234567891011121314151617&#123; &quot;code&quot;: 10000, &quot;msg&quot;: &quot;&quot;, &quot;tips&quot;: &quot;&quot;, &quot;data&quot;: &#123;&#125;&#125;&#123; &quot;code&quot;: 10000, &quot;msg&quot;: &quot;&quot;, &quot;tips&quot;: &quot;&quot;, &quot;data&quot;: &#123; &quot;total_page&quot;: 1, &quot;list&quot;: [ ] &#125;&#125; ä¸Šé¢æ˜¯æˆ‘ä»¬æœåŠ¡ç«¯çº¦å®šè¿”å›çš„ä¸¤ç§jsonæ ¼å¼. 12345678910111213141516171819202122232425262728293031323334353637383940414243import UIKitimport HandyJSONenum RxSwiftMoyaError: Error &#123; case RxSwiftMoyaNoRepresentor case RxSwiftMoyaNotSuccessfulHTTP case RxSwiftMoyaNoData case RxSwiftMoyaCouldNotMakeObjectError case RxSwiftMoyaBizError(resultCode: Int?, resultMsg: String?) case RXSwiftMoyaNoNetwork&#125;public class BaseModel&lt;T: HandyJSON&gt;: HandyJSON &#123; var code: UInt? var msg: String? var tips: String? var data: T? var success: Bool &#123; guard let cd = code, cd == 10000 else &#123; return false &#125; return true &#125; required public init() &#123;&#125; &#125;public class BaseListModel&lt;T: HandyJSON&gt;: HandyJSON &#123; var total_page: UInt? var list: [T]? required public init() &#123;&#125;&#125; ä¸Šé¢æ˜¯æ ¹æ®jsonè¿”å›çš„æ ¼å¼å®šä¹‰çš„BaseModelå’Œç½‘ç»œè¯·æ±‚çš„é”™è¯¯æšä¸¾ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192import Foundationimport RxSwiftimport Moyaimport HandyJSONimport Alamofireextension ObservableType where E == Response &#123; public func mapBaseModel&lt;T: HandyJSON&gt;(_ type: T.Type ) -&gt; Observable&lt;BaseModel&lt;T&gt;&gt; &#123; return flatMap &#123; response -&gt; Observable&lt;BaseModel&lt;T&gt;&gt; in let ele: BaseModel&lt;T&gt; = try response.mapBaseModel(T.self) return Observable.just(ele) &#125; &#125; public func mapBaseModelArray&lt;T: HandyJSON&gt;(_ type: T.Type ) -&gt; Observable&lt;BaseModel&lt;BaseListModel&lt;T&gt;&gt;&gt; &#123; return flatMap &#123; response -&gt; Observable&lt;BaseModel&lt;BaseListModel&lt;T&gt;&gt;&gt; in return Observable.just(try response.mapBaseModelArray(T.self)) &#125; &#125;&#125;extension Response &#123; func mapBaseModel&lt;T: HandyJSON&gt;(_ type: T.Type) throws -&gt; BaseModel&lt;T&gt; &#123; // check http status guard -1001 != self.statusCode else &#123; throw RxSwiftMoyaError.RXSwiftMoyaNoNetwork &#125; guard ((200...209) ~= self.statusCode) else &#123; throw RxSwiftMoyaError.RxSwiftMoyaNotSuccessfulHTTP &#125; let jsonString = String.init(data: data, encoding: .utf8) let baseModel = JSONDeserializer&lt;BaseModel&lt;T&gt;&gt;.deserializeFrom(json: jsonString) guard let model = baseModel else &#123; throw RxSwiftMoyaError.RxSwiftMoyaCouldNotMakeObjectError &#125; guard model.success else&#123; throw RxSwiftMoyaError.RxSwiftMoyaBizError(resultCode:model.code,resultMsg:model.msg) &#125; guard (model.data != nil) else &#123; throw RxSwiftMoyaError.RxSwiftMoyaNoData &#125; return model &#125; func mapBaseModelArray&lt;T: HandyJSON&gt;(_ type: T.Type) throws -&gt; BaseModel&lt;BaseListModel&lt;T&gt;&gt; &#123; // check http status guard -1001 != self.statusCode else &#123; throw RxSwiftMoyaError.RXSwiftMoyaNoNetwork &#125; guard ((200...209) ~= self.statusCode) else &#123; throw RxSwiftMoyaError.RxSwiftMoyaNotSuccessfulHTTP &#125; let jsonString = String.init(data: data, encoding: .utf8) guard let baseModel = JSONDeserializer&lt;BaseModel&lt;BaseListModel&lt;T&gt;&gt;&gt;.deserializeFrom(json: jsonString) else &#123; throw RxSwiftMoyaError.RxSwiftMoyaCouldNotMakeObjectError &#125; guard baseModel.success else&#123; throw RxSwiftMoyaError.RxSwiftMoyaBizError(resultCode:baseModel.code,resultMsg:baseModel.msg) &#125; guard let count = baseModel.data?.list?.count,count &gt; 0 else &#123; throw RxSwiftMoyaError.RxSwiftMoyaNoData &#125; return baseModel &#125;&#125; ä½¿ç”¨ï¼š 1234567891011121314151617181920212223242526272829provider.request(.api()).mapBaseModelArray(apiModel.self).subscribe( onNext: &#123; model in //è¿™é‡Œé¢çš„modelæ˜¯baseModel //model -&gt; data -&gt; list æ˜¯ä¸ª apiModelæ•°ç»„ //å¦‚æœå°†mapBaseModelArrayæ”¹ä¸ºmapBaseModel,é‚£ä¹ˆ model -&gt; data å°±æ˜¯apiModel &#125;, onError: &#123; error in let myError: RxSwiftMoyaError? = error as? RxSwiftMoyaError guard let err = myError else &#123; print(error.localizedDescription) return &#125; switch err &#123; case .RxSwiftMoyaNoData: debugPrint(&quot;no data&quot;) case .RxSwiftMoyaBizError( _,let resultMsg): debugPrint(&quot;\\(String(describing: resultMsg))&quot;) case .RXSwiftMoyaNoNetwork: //æ²¡æœ‰ç½‘ç»œçš„æƒ…å†µä¸‹ debugPrint(&quot;æ²¡æœ‰ç½‘ç»œ&quot;) default: print(err) &#125; &#125; ).addDisposableTo(self.dispose) éœ€è¦æ³¨æ„çš„æ˜¯providerè¦ä½¿ç”¨RxMoyaProviderå®šä¹‰","path":"2017/12/15/RxSwift-HandyJson-Moyaä¼˜é›…å®ç°ç½‘ç»œè¯·æ±‚/","date":"12-15","excerpt":""},{"title":"RxSwiftæ“ä½œç¬¦é€‰æ‹©","text":"æˆ‘æƒ³è¦åˆ›å»ºä¸€ä¸ª Observableäº§ç”Ÿç‰¹å®šçš„ä¸€ä¸ªå…ƒç´ ï¼šjust ç»è¿‡ä¸€æ®µå»¶æ—¶ï¼štimerä»ä¸€ä¸ªåºåˆ—æ‹‰å–å…ƒç´ ï¼šfromé‡å¤çš„äº§ç”ŸæŸä¸€ä¸ªå…ƒç´ ï¼šrepeatElementå­˜åœ¨è‡ªå®šä¹‰é€»è¾‘ï¼šcreateæ¯æ¬¡è®¢é˜…æ—¶äº§ç”Ÿï¼šdeferredæ¯éš”ä¸€æ®µæ—¶é—´ï¼Œå‘å‡ºä¸€ä¸ªå…ƒç´ ï¼šintervalä¸€ä¸ªç©ºåºåˆ—ï¼Œåªæœ‰ä¸€ä¸ªå®Œæˆäº‹ä»¶ï¼šemptyä¸€ä¸ªä»»ä½•äº‹ä»¶éƒ½æ²¡æœ‰äº§ç”Ÿçš„åºåˆ—ï¼šnever åˆ›å»ºç»„åˆå…¶ä»–çš„ Observablesä»»æ„ä¸€ä¸ª Observable äº§ç”Ÿäº†å…ƒç´ ï¼Œå°±å‘å‡ºè¿™ä¸ªå…ƒç´ ï¼šmergeè®©è¿™äº› Observables ä¸€ä¸ªæ¥ä¸€ä¸ªçš„å‘å‡ºå…ƒç´ ï¼Œå½“ä¸Šä¸€ä¸ª Observable å…ƒç´ å‘é€å®Œæ¯•åï¼Œä¸‹ä¸€ä¸ª Observable æ‰èƒ½å¼€å§‹å‘å‡ºå…ƒç´ ï¼šconcatç»„åˆæ¯ä¸€ä¸ª Observable ç„¶åå‘å‡ºä¸€ä¸ªç»„åˆçš„æ–°å…ƒç´ ï¼šzipå½“ä»»æ„ä¸€ä¸ª Observable å‘å‡ºä¸€ä¸ªæ–°çš„å…ƒç´ ï¼šcombineLatest è½¬æ¢ Observable çš„å…ƒç´ åï¼Œå†å°†å®ƒä»¬å‘å‡ºæ¥å¯¹æ¯ä¸ªå…ƒç´ ç›´æ¥è½¬æ¢ï¼šmapè½¬æ¢åˆ°å¦ä¸€ä¸ª Observableï¼šflatMapåªæ¥æ”¶æœ€æ–°çš„å…ƒç´ è½¬æ¢çš„ Observable æ‰€äº§ç”Ÿçš„å…ƒç´ ï¼šflatMapLatestæ¯ä¸€ä¸ªå…ƒç´ è½¬æ¢çš„ Observable æŒ‰é¡ºåºäº§ç”Ÿå…ƒç´ ï¼šconcatMapåŸºäºæ‰€æœ‰éå†è¿‡çš„å…ƒç´ ï¼š scan æˆ‘æƒ³è¦å°†äº§ç”Ÿçš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œæ‹–å»¶ä¸€æ®µæ—¶é—´åå†å‘å‡ºï¼šdelay æˆ‘æƒ³è¦å°†äº§ç”Ÿçš„äº‹ä»¶å°è£…æˆå…ƒç´ å‘é€å‡ºæ¥å°†ä»–ä»¬å°è£…æˆ Eventï¼šmaterializeï¼Œç„¶åè§£å°å‡ºæ¥ï¼šdematerialize æˆ‘æƒ³è¦å¿½ç•¥æ‰æ‰€æœ‰çš„ next äº‹ä»¶ï¼Œåªæ¥æ”¶ completed å’Œ error äº‹ä»¶ï¼šignoreElements æˆ‘æƒ³åˆ›å»ºä¸€ä¸ªæ–°çš„ Observable åœ¨åŸæœ‰çš„åºåˆ—å‰é¢åŠ å…¥ä¸€äº›å…ƒç´ ï¼šstartWith æˆ‘æƒ³ä» Observable ä¸­æ”¶é›†å…ƒç´ ï¼Œç¼“å­˜è¿™äº›å…ƒç´ ä¹‹ååœ¨å‘å‡ºï¼šbuffer æˆ‘æƒ³å°† Observable æ‹†åˆ†æˆå¤šä¸ª Observablesï¼šwindowåŸºäºå…ƒç´ çš„å…±åŒç‰¹å¾ï¼šgroupBy æˆ‘æƒ³åªæ¥æ”¶ Observable ä¸­ç‰¹å®šçš„å…ƒç´ å‘å‡ºå”¯ä¸€çš„å…ƒç´ ï¼šsingle æˆ‘æƒ³é‡æ–°ä» Observable ä¸­å‘å‡ºæŸäº›å…ƒç´ é€šè¿‡åˆ¤å®šæ¡ä»¶è¿‡æ»¤å‡ºä¸€äº›å…ƒç´ ï¼šfilterä»…ä»…å‘å‡ºå¤´å‡ ä¸ªå…ƒç´ ï¼štakeä»…ä»…å‘å‡ºå°¾éƒ¨çš„å‡ ä¸ªå…ƒç´ ï¼štakeLastä»…ä»…å‘å‡ºç¬¬ n ä¸ªå…ƒç´ ï¼šelementAt è·³è¿‡å¤´å‡ ä¸ªå…ƒç´ è·³è¿‡å¤´ n ä¸ªå…ƒç´ ï¼šskipè·³è¿‡å¤´å‡ ä¸ªæ»¡è¶³åˆ¤å®šçš„å…ƒç´ ï¼šskipWhileï¼ŒskipWhileWithIndexè·³è¿‡æŸæ®µæ—¶é—´å†…äº§ç”Ÿçš„å¤´å‡ ä¸ªå…ƒç´ ï¼šskipè·³è¿‡å¤´å‡ ä¸ªå…ƒç´ ç›´åˆ°å¦ä¸€ä¸ª Observable å‘å‡ºä¸€ä¸ªå…ƒç´ ï¼šskipUntil åªå–å¤´å‡ ä¸ªå…ƒç´ åªå–å¤´å‡ ä¸ªæ»¡è¶³åˆ¤å®šçš„å…ƒç´ ï¼štakeWhileï¼ŒtakeWhileWithIndexåªå–æŸæ®µæ—¶é—´å†…äº§ç”Ÿçš„å¤´å‡ ä¸ªå…ƒç´ ï¼štakeåªå–å¤´å‡ ä¸ªå…ƒç´ ç›´åˆ°å¦ä¸€ä¸ª Observable å‘å‡ºä¸€ä¸ªå…ƒç´ ï¼štakeUntilå‘¨æœŸæ€§çš„å¯¹ Observable æŠ½æ ·ï¼šsampleå‘å‡ºé‚£äº›å…ƒç´ ï¼Œè¿™äº›å…ƒç´ äº§ç”Ÿåçš„ç‰¹å®šçš„æ—¶é—´å†…ï¼Œæ²¡æœ‰æ–°çš„å…ƒç´ äº§ç”Ÿï¼šdebounceç›´åˆ°å…ƒç´ çš„å€¼å‘ç”Ÿå˜åŒ–ï¼Œæ‰å‘å‡ºæ–°çš„å…ƒç´ ï¼šdistinctUntilChangedå¹¶æä¾›å…ƒç´ æ˜¯å¦ç›¸ç­‰çš„åˆ¤å®šå‡½æ•°ï¼šdistinctUntilChangedåœ¨å¼€å§‹å‘å‡ºå…ƒç´ æ—¶ï¼Œå»¶æ—¶åè¿›è¡Œè®¢é˜…ï¼šdelaySubscription æˆ‘æƒ³è¦ä»ä¸€äº› Observables ä¸­ï¼Œåªå–ç¬¬ä¸€ä¸ªäº§ç”Ÿå…ƒç´ çš„ Observableï¼šamb æˆ‘æƒ³è¯„ä¼° Observable çš„å…¨éƒ¨å…ƒç´ å¹¶ä¸”å¯¹æ¯ä¸ªå…ƒç´ åº”ç”¨èšåˆæ–¹æ³•ï¼Œå¾…æ‰€æœ‰å…ƒç´ éƒ½åº”ç”¨èšåˆæ–¹æ³•åï¼Œå‘å‡ºç»“æœï¼šreduceå¹¶ä¸”å¯¹æ¯ä¸ªå…ƒç´ åº”ç”¨èšåˆæ–¹æ³•ï¼Œæ¯æ¬¡åº”ç”¨èšåˆæ–¹æ³•åï¼Œå‘å‡ºç»“æœï¼šscan æˆ‘æƒ³æŠŠ Observable è½¬æ¢ä¸ºå…¶ä»–çš„æ•°æ®ç»“æ„ï¼šasâ€¦ æˆ‘æƒ³åœ¨æŸä¸ª Scheduler åº”ç”¨æ“ä½œç¬¦ï¼šsubscribeOnåœ¨æŸä¸ª Scheduler ç›‘å¬ï¼šobserveOn æˆ‘æƒ³è¦ Observable å‘ç”ŸæŸä¸ªäº‹ä»¶æ—¶, é‡‡å–æŸä¸ªè¡ŒåŠ¨ï¼šdo æˆ‘æƒ³è¦ Observable å‘å‡ºä¸€ä¸ª error äº‹ä»¶ï¼šerrorå¦‚æœè§„å®šæ—¶é—´å†…æ²¡æœ‰äº§ç”Ÿå…ƒç´ ï¼štimeout æˆ‘æƒ³è¦ Observable å‘ç”Ÿé”™è¯¯æ—¶ï¼Œä¼˜é›…çš„æ¢å¤å¦‚æœè§„å®šæ—¶é—´å†…æ²¡æœ‰äº§ç”Ÿå…ƒç´ ï¼Œå°±åˆ‡æ¢åˆ°å¤‡é€‰ Observable ï¼štimeoutå¦‚æœäº§ç”Ÿé”™è¯¯ï¼Œå°†é”™è¯¯æ›¿æ¢æˆæŸä¸ªå…ƒç´  ï¼šcatchErrorJustReturnå¦‚æœäº§ç”Ÿé”™è¯¯ï¼Œå°±åˆ‡æ¢åˆ°å¤‡é€‰ Observable ï¼šcatchErrorå¦‚æœäº§ç”Ÿé”™è¯¯ï¼Œå°±é‡è¯• ï¼šretry æˆ‘åˆ›å»ºä¸€ä¸ª Disposable èµ„æºï¼Œä½¿å®ƒä¸ Observable å…·æœ‰ç›¸åŒçš„å¯¿å‘½ï¼šusing æˆ‘åˆ›å»ºä¸€ä¸ª Observableï¼Œç›´åˆ°æˆ‘é€šçŸ¥å®ƒå¯ä»¥äº§ç”Ÿå…ƒç´ åï¼Œæ‰èƒ½äº§ç”Ÿå…ƒç´ ï¼špublishå¹¶ä¸”ï¼Œå°±ç®—æ˜¯åœ¨äº§ç”Ÿå…ƒç´ åè®¢é˜…ï¼Œä¹Ÿè¦å‘å‡ºå…¨éƒ¨å…ƒç´ ï¼šreplayå¹¶ä¸”ï¼Œä¸€æ—¦æ‰€æœ‰è§‚å¯Ÿè€…å–æ¶ˆè§‚å¯Ÿï¼Œä»–å°±è¢«é‡Šæ”¾æ‰ï¼šrefCounté€šçŸ¥å®ƒå¯ä»¥äº§ç”Ÿå…ƒç´ äº†ï¼šconnect","path":"2017/11/07/RxSwiftæ“ä½œç¬¦é€‰æ‹©/","date":"11-07","excerpt":""},{"title":"RxSwiftæ“ä½œç¬¦","text":"ambå½“ä½ ä¼ å…¥å¤šä¸ª Observables åˆ° amb æ“ä½œç¬¦æ—¶ï¼Œå®ƒå°†å–å…¶ä¸­ä¸€ä¸ª Observableï¼šç¬¬ä¸€ä¸ªäº§ç”Ÿäº‹ä»¶çš„é‚£ä¸ª Observableï¼Œå¯ä»¥æ˜¯ä¸€ä¸ª nextï¼Œerror æˆ–è€… completed äº‹ä»¶. amb å°†å¿½ç•¥æ‰å…¶ä»–çš„ Observables. 123456789101112131415161718192021222324 let subject1 = PublishSubject&lt;Int&gt;() let subject2 = PublishSubject&lt;Int&gt;() let subject3 = PublishSubject&lt;Int&gt;() subject1 .amb(subject2) .amb(subject3) .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag) subject2.onNext(1) subject1.onNext(20) subject2.onNext(2) subject1.onNext(40) subject3.onNext(0) subject2.onNext(3) subject1.onNext(60) subject3.onNext(0) subject3.onNext(0)è¿è¡Œç»“æœï¼š123 bufferç¼“å­˜å…ƒç´ ï¼Œç„¶åå°†ç¼“å­˜çš„å…ƒç´ é›†åˆï¼Œå‘¨æœŸæ€§çš„å‘å‡ºæ¥.buffer æ“ä½œç¬¦å°†ç¼“å­˜ Observable ä¸­å‘å‡ºçš„æ–°å…ƒç´ ï¼Œå½“å…ƒç´ è¾¾åˆ°æŸä¸ªæ•°é‡ï¼Œæˆ–è€…ç»è¿‡äº†ç‰¹å®šçš„æ—¶é—´ï¼Œå®ƒå°±ä¼šå°†è¿™ä¸ªå…ƒç´ é›†åˆå‘é€å‡ºæ¥ã€‚ 1234567891011121314151617181920212223 let subject = PublishSubject&lt;String&gt;() //æ¯ç¼“å­˜3ä¸ªå…ƒç´ åˆ™ç»„åˆèµ·æ¥ä¸€èµ·å‘å‡ºã€‚ //å¦‚æœ1ç§’é’Ÿå†…ä¸å¤Ÿ3ä¸ªä¹Ÿä¼šå‘å‡ºï¼ˆæœ‰å‡ ä¸ªå‘å‡ ä¸ªï¼Œä¸€ä¸ªéƒ½æ²¡æœ‰å‘ç©ºæ•°ç»„ []ï¼‰ subject .buffer(timeSpan: 1, count: 3, scheduler: MainScheduler.instance) .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag) subject.onNext(&quot;a&quot;) subject.onNext(&quot;b&quot;) subject.onNext(&quot;c&quot;) subject.onNext(&quot;1&quot;) subject.onNext(&quot;2&quot;) subject.onNext(&quot;3&quot;)è¿è¡Œç»“æœï¼š[&quot;a&quot;, &quot;b&quot;, &quot;c&quot;][&quot;1&quot;, &quot;2&quot;, &quot;3&quot;][][][] catchErrorcatchError æ“ä½œç¬¦å°†ä¼šæ‹¦æˆªä¸€ä¸ª error äº‹ä»¶ï¼Œå°†å®ƒæ›¿æ¢æˆå…¶ä»–çš„å…ƒç´ æˆ–è€…ä¸€ç»„å…ƒç´ ï¼Œç„¶åä¼ é€’ç»™è§‚å¯Ÿè€…ã€‚è¿™æ ·å¯ä»¥ä½¿å¾— Observable æ­£å¸¸ç»“æŸï¼Œæˆ–è€…æ ¹æœ¬éƒ½ä¸éœ€è¦ç»“æŸã€‚ 123456789101112131415161718192021222324252627282930313233enum TestError: Error &#123; case test&#125; let sequenceThatFails = PublishSubject&lt;String&gt;() let recoverySequence = PublishSubject&lt;String&gt;() sequenceThatFails .catchError &#123; print(&quot;Error:&quot;, $0) return recoverySequence &#125; .subscribe &#123; print($0) &#125; .disposed(by: disposeBag) sequenceThatFails.onNext(&quot;1&quot;) sequenceThatFails.onNext(&quot;2&quot;) sequenceThatFails.onNext(&quot;3&quot;) sequenceThatFails.onError(TestError.testï¼‰ sequenceThatFails.onNext(&quot;4&quot;) recoverySequence.onNext(&quot;a&quot;) recoverySequence.onNext(&quot;b&quot;) recoverySequence.onNext(&quot;c&quot;)è¿è¡Œç»“æœï¼šnext(1)next(2)next(3)Error: testnext(a)next(b)next(c) catchErrorJustReturncatchErrorJustReturn æ“ä½œç¬¦ä¼šå°†error äº‹ä»¶æ›¿æ¢æˆå…¶ä»–çš„ä¸€ä¸ªå…ƒç´ ï¼Œç„¶åç»“æŸè¯¥åºåˆ—ã€‚ 1234567891011121314151617 let sequenceThatFails = PublishSubject&lt;String&gt;() sequenceThatFails .catchErrorJustReturn(&quot;tihuan&quot;) .subscribe &#123; print($0) &#125; .disposed(by: disposeBag) sequenceThatFails.onNext(&quot;1&quot;) sequenceThatFails.onNext(&quot;2&quot;) sequenceThatFails.onError(TestError.test) sequenceThatFails.onNext(&quot;3&quot;)è¿è¡Œç»“æœï¼šnext(1)next(2)next(tihuan)completed combineLatestcombineLatest æ“ä½œç¬¦å°†å¤šä¸ª Observables ä¸­æœ€æ–°çš„å…ƒç´ é€šè¿‡ä¸€ä¸ªå‡½æ•°ç»„åˆèµ·æ¥ï¼Œç„¶åå°†è¿™ä¸ªç»„åˆçš„ç»“æœå‘å‡ºæ¥ã€‚è¿™äº›æº Observables ä¸­ä»»ä½•ä¸€ä¸ªå‘å‡ºä¸€ä¸ªå…ƒç´ ï¼Œä»–éƒ½ä¼šå‘å‡ºä¸€ä¸ªå…ƒç´ ï¼ˆå‰ææ˜¯ï¼Œè¿™äº› Observables æ›¾ç»å‘å‡ºè¿‡å…ƒç´ . 123456789101112131415161718192021222324 let first = PublishSubject&lt;String&gt;() let second = PublishSubject&lt;String&gt;() Observable.combineLatest(first, second) &#123; $0 + $1 &#125; .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag) first.onNext(&quot;1&quot;) second.onNext(&quot;A&quot;) first.onNext(&quot;2&quot;) second.onNext(&quot;B&quot;) second.onNext(&quot;C&quot;) second.onNext(&quot;D&quot;) first.onNext(&quot;3&quot;) first.onNext(&quot;4&quot;)è¿è¡Œç»“æœ:1A2A2B2C2D3D4D concatconcat æ“ä½œç¬¦å°†å¤šä¸ª Observables æŒ‰é¡ºåºä¸²è”èµ·æ¥ï¼Œå½“å‰ä¸€ä¸ª Observable å…ƒç´ å‘é€å®Œæ¯•åï¼Œåä¸€ä¸ª Observable æ‰å¯ä»¥å¼€å§‹å‘å‡ºå…ƒç´ ã€‚ 1234567891011121314151617181920212223242526272829let subject1 = BehaviorSubject(value: &quot;ğŸ&quot;) let subject2 = BehaviorSubject(value: &quot;ğŸ¶&quot;) let variable = Variable(subject1) variable.asObservable() .concat() .subscribe &#123; print($0) &#125; .disposed(by: disposeBag) subject1.onNext(&quot;ğŸ&quot;) subject1.onNext(&quot;ğŸŠ&quot;) variable.value = subject2 subject2.onNext(&quot;I would be ignored&quot;) subject2.onNext(&quot;ğŸ±&quot;) subject1.onCompleted() subject2.onNext(&quot;ğŸ­&quot;)è¿è¡Œç»“æœ:next(ğŸ)next(ğŸ)next(ğŸŠ)next(ğŸ±)next(ğŸ­) concatMapconcatMap æ“ä½œç¬¦å°†æº Observable çš„æ¯ä¸€ä¸ªå…ƒç´ åº”ç”¨ä¸€ä¸ªè½¬æ¢æ–¹æ³•ï¼Œå°†ä»–ä»¬è½¬æ¢æˆ Observablesã€‚ç„¶åè®©è¿™äº› Observables æŒ‰é¡ºåºçš„å‘å‡ºå…ƒç´ ï¼Œå½“å‰ä¸€ä¸ª Observable å…ƒç´ å‘é€å®Œæ¯•åï¼Œåä¸€ä¸ª Observable æ‰å¯ä»¥å¼€å§‹å‘å‡ºå…ƒç´ ã€‚ç­‰å¾…å‰ä¸€ä¸ª Observable äº§ç”Ÿå®Œæˆäº‹ä»¶åï¼Œæ‰å¯¹åä¸€ä¸ª Observable è¿›è¡Œè®¢é˜…ã€‚ 12345678910111213141516171819202122232425262728let subject1 = BehaviorSubject(value: &quot;ğŸ&quot;)let subject2 = BehaviorSubject(value: &quot;ğŸ¶&quot;)let variable = Variable(subject1)variable.asObservable() .concatMap &#123; $0 &#125; .subscribe &#123; print($0) &#125; .disposed(by: disposeBag)subject1.onNext(&quot;ğŸ&quot;)subject1.onNext(&quot;ğŸŠ&quot;)variable.value = subject2subject2.onNext(&quot;I would be ignored&quot;)subject2.onNext(&quot;ğŸ±&quot;)subject1.onCompleted()subject2.onNext(&quot;ğŸ­&quot;)è¿è¡Œç»“æœ:next(ğŸ)next(ğŸ)next(ğŸŠ)next(ğŸ±)next(ğŸ­) connecté€šçŸ¥ ConnectableObservable å¯ä»¥å¼€å§‹å‘å‡ºå…ƒç´ äº†,ConnectableObservable å’Œæ™®é€šçš„ Observable ååˆ†ç›¸ä¼¼ï¼Œä¸è¿‡åœ¨è¢«è®¢é˜…åä¸ä¼šå‘å‡ºå…ƒç´ ï¼Œç›´åˆ° connect æ“ä½œç¬¦è¢«åº”ç”¨ä¸ºæ­¢ã€‚è¿™æ ·ä¸€æ¥ä½ å¯ä»¥ç­‰æ‰€æœ‰è§‚å¯Ÿè€…å…¨éƒ¨è®¢é˜…å®Œæˆåï¼Œæ‰å‘å‡ºå…ƒç´ ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839let intSequence = Observable&lt;Int&gt;.interval(1, scheduler: MainScheduler.instance) .publish()_ = intSequence .subscribe(onNext: &#123; print(&quot;Subscription 1:, Event: \\($0)&quot;) &#125;)DispatchQueue.main.asyncAfter(deadline: .now() + 2) &#123; _ = intSequence.connect()&#125;DispatchQueue.main.asyncAfter(deadline: .now() + 4) &#123; _ = intSequence .subscribe(onNext: &#123; print(&quot;Subscription 2:, Event: \\($0)&quot;) &#125;)&#125;DispatchQueue.main.asyncAfter(deadline: .now() + 6) &#123; _ = intSequence .subscribe(onNext: &#123; print(&quot;Subscription 3:, Event: \\($0)&quot;) &#125;)&#125;è¿è¡Œç»“æœ:Subscription 1:, Event: 0Subscription 1:, Event: 1Subscription 2:, Event: 1Subscription 1:, Event: 2Subscription 2:, Event: 2Subscription 1:, Event: 3Subscription 2:, Event: 3Subscription 3:, Event: 3Subscription 1:, Event: 4Subscription 2:, Event: 4Subscription 3:, Event: 4Subscription 1:, Event: 5Subscription 2:, Event: 5Subscription 3:, Event: 5Subscription 1:, Event: 6Subscription 2:, Event: 6Subscription 3:, Event: 6... createé€šè¿‡ä¸€ä¸ªæ„å»ºå‡½æ•°å®Œæ•´çš„åˆ›å»ºä¸€ä¸ª Observable 123456789101112131415//åˆ›å»ºä¸€ä¸ª [0, 1, ... 8, 9] çš„åºåˆ—ï¼šlet id = Observable&lt;Int&gt;.create &#123; observer in observer.onNext(0) observer.onNext(1) observer.onNext(2) observer.onNext(3) observer.onNext(4) observer.onNext(5) observer.onNext(6) observer.onNext(7) observer.onNext(8) observer.onNext(9) observer.onCompleted() return Disposables.create()&#125; debouncedebounce æ“ä½œç¬¦å°†å‘å‡ºè¿™ç§å…ƒç´ ï¼Œåœ¨ Observable äº§ç”Ÿè¿™ç§å…ƒç´ åï¼Œä¸€æ®µæ—¶é—´å†…æ²¡æœ‰æ–°å…ƒç´ äº§ç”Ÿã€‚ 123456789101112131415161718 let intSequence = PublishSubject&lt;Int&gt;() intSequence.debounce(4, scheduler: MainScheduler.instance).subscribe &#123; print($0) &#125; .disposed(by: disposeBag) DispatchQueue.main.asyncAfter(deadline: .now() + 2) &#123; intSequence.onNext(1) &#125; DispatchQueue.main.asyncAfter(deadline: .now() + 4) &#123; intSequence.onNext(2) &#125; DispatchQueue.main.asyncAfter(deadline: .now() + 6) &#123; intSequence.onNext(3) &#125; &#125;è¿è¡Œç»“æœ:next(3) debugæ‰“å°æ‰€æœ‰çš„è®¢é˜…ï¼Œäº‹ä»¶ä»¥åŠé”€æ¯ä¿¡æ¯ 123456789101112131415161718 let sequence = Observable&lt;String&gt;.create &#123; observer in observer.onNext(&quot;ğŸ&quot;) observer.onNext(&quot;ğŸ&quot;) observer.onCompleted() return Disposables.create() &#125; sequence .debug(&quot;Fruit&quot;) .subscribe() .disposed(by: disposeBag)è¿è¡Œç»“æœ:2017-11-04 10:20:36.519: Fruit -&gt; subscribed2017-11-04 10:20:36.527: Fruit -&gt; Event next(ğŸ)2017-11-04 10:20:36.528: Fruit -&gt; Event next(ğŸ)2017-11-04 10:20:36.528: Fruit -&gt; Event completed2017-11-04 10:20:36.528: Fruit -&gt; isDisposed deferreddeferred æ“ä½œç¬¦å°†ç­‰å¾…è§‚å¯Ÿè€…è®¢é˜…å®ƒï¼Œæ‰åˆ›å»ºä¸€ä¸ª Observableï¼Œå®ƒä¼šé€šè¿‡ä¸€ä¸ªæ„å»ºå‡½æ•°ä¸ºæ¯ä¸€ä½è®¢é˜…è€…åˆ›å»ºæ–°çš„ Observableã€‚çœ‹ä¸Šå»æ¯ä½è®¢é˜…è€…éƒ½æ˜¯å¯¹åŒä¸€ä¸ª Observable äº§ç”Ÿè®¢é˜…ï¼Œå®é™…ä¸Šå®ƒä»¬éƒ½è·å¾—äº†ç‹¬ç«‹çš„åºåˆ—ã€‚ delaydelay æ“ä½œç¬¦å°†ä¿®æ”¹ä¸€ä¸ª Observableï¼Œå®ƒä¼šå°† Observable çš„æ‰€æœ‰å…ƒç´ éƒ½æ‹–å»¶ä¸€æ®µè®¾å®šå¥½çš„æ—¶é—´ï¼Œ ç„¶åæ‰å°†å®ƒä»¬å‘é€å‡ºæ¥ã€‚ delaySubscriptiondelaySubscription æ“ä½œç¬¦å°†åœ¨ç»è¿‡æ‰€è®¾å®šçš„æ—¶é—´åï¼Œæ‰å¯¹ Observable è¿›è¡Œè®¢é˜…æ“ä½œã€‚ dematerializedematerialize æ“ä½œç¬¦å°† materialize è½¬æ¢åçš„å…ƒç´ è¿˜åŸ 1234567891011121314151617181920 //materialize è¯¥æ“ä½œç¬¦å¯ä»¥å°†åºåˆ—äº§ç”Ÿçš„äº‹ä»¶ï¼Œè½¬æ¢æˆå…ƒç´  Observable.of(1, 2, 3) .materialize() .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag) Observable.of(1, 2, 3) .materialize() .dematerialize() .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag)è¿è¡Œç»“æœ:next(1)next(2)next(3)completed123 distinctUntilChangeddistinctUntilChanged æ“ä½œç¬¦å°†é˜»æ­¢ Observable å‘å‡ºç›¸åŒçš„å…ƒç´ ã€‚å¦‚æœåä¸€ä¸ªå…ƒç´ å’Œå‰ä¸€ä¸ªå…ƒç´ æ˜¯ç›¸åŒçš„ï¼Œé‚£ä¹ˆè¿™ä¸ªå…ƒç´ å°†ä¸ä¼šè¢«å‘å‡ºæ¥ã€‚å¦‚æœåä¸€ä¸ªå…ƒç´ å’Œå‰ä¸€ä¸ªå…ƒç´ ä¸ç›¸åŒï¼Œé‚£ä¹ˆè¿™ä¸ªå…ƒç´ æ‰ä¼šè¢«å‘å‡ºæ¥ã€‚ 1234567891011Observable.of(&quot;ğŸ±&quot;, &quot;ğŸ·&quot;, &quot;ğŸ±&quot;, &quot;ğŸ±&quot;, &quot;ğŸ±&quot;, &quot;ğŸµ&quot;, &quot;ğŸ±&quot;) .distinctUntilChanged() .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag)è¿è¡Œç»“æœ:ğŸ±ğŸ·ğŸ±ğŸµğŸ± doå½“ Observable çš„æŸäº›äº‹ä»¶äº§ç”Ÿæ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ do æ“ä½œç¬¦æ¥æ³¨å†Œä¸€äº›å›è°ƒæ“ä½œã€‚è¿™äº›å›è°ƒä¼šè¢«å•ç‹¬è°ƒç”¨ï¼Œå®ƒä»¬ä¼šå’Œ Observable åŸæœ¬çš„å›è°ƒåˆ†ç¦»ã€‚ elementAtelementAt æ“ä½œç¬¦å°†æ‹‰å– Observable åºåˆ—ä¸­æŒ‡å®šç´¢å¼•æ•°çš„å…ƒç´ ï¼Œç„¶åå°†å®ƒä½œä¸ºå”¯ä¸€çš„å…ƒç´ å‘å‡ºã€‚ 1234567Observable.of(&quot;ğŸ±&quot;, &quot;ğŸ°&quot;, &quot;ğŸ¶&quot;, &quot;ğŸ¸&quot;, &quot;ğŸ·&quot;, &quot;ğŸµ&quot;) .elementAt(3) .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag)è¿è¡Œç»“æœ:ğŸ¸ emptyempty æ“ä½œç¬¦å°†åˆ›å»ºä¸€ä¸ª Observableï¼Œè¿™ä¸ª Observable åªæœ‰ä¸€ä¸ªå®Œæˆäº‹ä»¶ã€‚ errorerror æ“ä½œç¬¦å°†åˆ›å»ºä¸€ä¸ª Observableï¼Œè¿™ä¸ª Observable åªä¼šäº§ç”Ÿä¸€ä¸ª error äº‹ä»¶ã€‚ filterfilter æ“ä½œç¬¦å°†é€šè¿‡ä½ æä¾›çš„åˆ¤å®šæ–¹æ³•è¿‡æ»¤ä¸€ä¸ª Observableã€‚ 123456789Observable.of(2, 30, 22, 5, 60, 1) .filter &#123; $0 &gt; 10 &#125; .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag)è¿è¡Œç»“æœ:302260 flatMapflatMap æ“ä½œç¬¦å°†æº Observable çš„æ¯ä¸€ä¸ªå…ƒç´ åº”ç”¨ä¸€ä¸ªè½¬æ¢æ–¹æ³•ï¼Œå°†ä»–ä»¬è½¬æ¢æˆ Observablesã€‚ ç„¶åå°†è¿™äº› Observables çš„å…ƒç´ åˆå¹¶ä¹‹åå†å‘é€å‡ºæ¥ã€‚è¿™ä¸ªæ“ä½œç¬¦æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œä¾‹å¦‚ï¼Œå½“ Observable çš„å…ƒç´ æœ¬èº«æ‹¥æœ‰å…¶ä»–çš„ Observable æ—¶ï¼Œä½ å¯ä»¥å°†æ‰€æœ‰å­ Observables çš„å…ƒç´ å‘é€å‡ºæ¥ã€‚ 123456789101112131415161718192021let subject1 = BehaviorSubject(value: &quot;A&quot;) let subject2 = BehaviorSubject(value: &quot;1&quot;) let variable = Variable(subject1) variable.asObservable() .flatMap &#123; $0 &#125; .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag) subject1.onNext(&quot;B&quot;) variable.value = subject2 subject2.onNext(&quot;2&quot;) subject1.onNext(&quot;C&quot;) è¿è¡Œç»“æœ:AB12C flatMapLatestflatMapLatest æ“ä½œç¬¦å°†æº Observable çš„æ¯ä¸€ä¸ªå…ƒç´ åº”ç”¨ä¸€ä¸ªè½¬æ¢æ–¹æ³•ï¼Œå°†ä»–ä»¬è½¬æ¢æˆ Observablesã€‚ä¸€æ—¦è½¬æ¢å‡ºä¸€ä¸ªæ–°çš„ Observableï¼Œå°±åªå‘å‡ºå®ƒçš„å…ƒç´ ï¼Œæ—§çš„ Observables çš„å…ƒç´ å°†è¢«å¿½ç•¥æ‰ã€‚ 1234567891011121314151617181920let subject1 = BehaviorSubject(value: &quot;A&quot;)let subject2 = BehaviorSubject(value: &quot;1&quot;) let variable = Variable(subject1) variable.asObservable() .flatMapLatest &#123; $0 &#125; .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag) subject1.onNext(&quot;B&quot;)variable.value = subject2subject2.onNext(&quot;2&quot;)subject1.onNext(&quot;C&quot;)è¿è¡Œç»“æœ:AB12 fromå½“ä½ åœ¨ä½¿ç”¨ Observable æ—¶ï¼Œå¦‚æœèƒ½å¤Ÿç›´æ¥å°†å…¶ä»–ç±»å‹è½¬æ¢ä¸º Observableï¼Œè¿™å°†æ˜¯éå¸¸çœäº‹çš„ã€‚from æ“ä½œç¬¦å°±æä¾›äº†è¿™ç§åŠŸèƒ½ã€‚ 1let numbers = Observable.from([0, 1, 2]) groupBygroupBy æ“ä½œç¬¦å°†æº Observable åˆ†è§£ä¸ºå¤šä¸ªå­ Observableï¼Œç„¶åå°†è¿™äº›å­ Observable å‘é€å‡ºæ¥ã€‚å®ƒä¼šå°†å…ƒç´ é€šè¿‡æŸä¸ªé”®è¿›è¡Œåˆ†ç»„ï¼Œç„¶åå°†åˆ†ç»„åçš„å…ƒç´ åºåˆ—ä»¥ Observable çš„å½¢æ€å‘é€å‡ºæ¥ã€‚ 1234567891011121314151617//å°†å¥‡æ•°å¶æ•°åˆ†æˆä¸¤ç»„Observable&lt;Int&gt;.of(0, 1, 2, 3, 4, 5) .groupBy(keySelector: &#123; (element) -&gt; String in return element % 2 == 0 ? &quot;å¶æ•°&quot; : &quot;åŸºæ•°&quot; &#125;) .subscribe &#123; (event) in switch event &#123; case .next(let group): group.asObservable().subscribe(&#123; (event) in print(&quot;keyï¼š\\(group.key) eventï¼š\\(event)&quot;) &#125;) .disposed(by: self.disposeBag) default: print(&quot;&quot;) &#125; &#125; .disposed(by: disposeBag) ignoreElementsignoreElements æ“ä½œç¬¦å°†é˜»æ­¢ Observable å‘å‡º next äº‹ä»¶ï¼Œä½†æ˜¯å…è®¸ä»–å‘å‡º error æˆ– completed äº‹ä»¶ã€‚ intervalinterval æ“ä½œç¬¦å°†åˆ›å»ºä¸€ä¸ª Observableï¼Œå®ƒæ¯éš”ä¸€æ®µè®¾å®šçš„æ—¶é—´ï¼Œå‘å‡ºä¸€ä¸ªç´¢å¼•æ•°çš„å…ƒç´ ã€‚å®ƒå°†å‘å‡ºæ— æ•°ä¸ªå…ƒç´ ã€‚ justust æ“ä½œç¬¦å°†æŸä¸€ä¸ªå…ƒç´ è½¬æ¢ä¸º Observableã€‚ mapmap æ“ä½œç¬¦å°†æº Observable çš„æ¯ä¸ªå…ƒç´ åº”ç”¨ä½ æä¾›çš„è½¬æ¢æ–¹æ³•ï¼Œç„¶åè¿”å›å«æœ‰è½¬æ¢ç»“æœçš„ Observableã€‚ 123456789Observable.of(1, 2, 3) .map &#123; $0 * 10 &#125; .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag)è¿è¡Œç»“æœ:102030 mergeé€šè¿‡ä½¿ç”¨ merge æ“ä½œç¬¦ä½ å¯ä»¥å°†å¤šä¸ª Observables åˆå¹¶æˆä¸€ä¸ªï¼Œå½“æŸä¸€ä¸ª Observable å‘å‡ºä¸€ä¸ªå…ƒç´ æ—¶ï¼Œä»–å°±å°†è¿™ä¸ªå…ƒç´ å‘å‡ºã€‚ 123456789101112131415161718192021222324252627let subject1 = PublishSubject&lt;String&gt;()let subject2 = PublishSubject&lt;String&gt;()Observable.of(subject1, subject2) .merge() .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag)subject1.onNext(&quot;ğŸ…°ï¸&quot;)subject1.onNext(&quot;ğŸ…±ï¸&quot;)subject2.onNext(&quot;â‘ &quot;)subject2.onNext(&quot;â‘¡&quot;)subject1.onNext(&quot;ğŸ†&quot;)subject2.onNext(&quot;â‘¢&quot;)è¿è¡Œç»“æœ:ğŸ…°ï¸ğŸ…±ï¸â‘ â‘¡ğŸ†â‘¢ materializeé€šå¸¸ï¼Œä¸€ä¸ªæœ‰é™çš„ Observable å°†äº§ç”Ÿé›¶ä¸ªæˆ–è€…å¤šä¸ª onNext äº‹ä»¶ï¼Œç„¶åäº§ç”Ÿä¸€ä¸ª onCompleted æˆ–è€… onError äº‹ä»¶ã€‚materialize æ“ä½œç¬¦å°† Observable äº§ç”Ÿçš„è¿™äº›äº‹ä»¶å…¨éƒ¨è½¬æ¢æˆå…ƒç´ ï¼Œç„¶åå‘é€å‡ºæ¥ã€‚ nevernever æ“ä½œç¬¦å°†åˆ›å»ºä¸€ä¸ª Observableï¼Œè¿™ä¸ª Observable ä¸ä¼šäº§ç”Ÿä»»ä½•äº‹ä»¶ã€‚ observeOnobserveOn æ“ä½œç¬¦å°†æŒ‡å®šä¸€ä¸ªä¸åŒçš„ Scheduler æ¥è®© Observable é€šçŸ¥è§‚å¯Ÿè€…ã€‚ publishpublish ä¼šå°† Observable è½¬æ¢ä¸ºå¯è¢«è¿æ¥çš„ Observableã€‚å¯è¢«è¿æ¥çš„ Observable å’Œæ™®é€šçš„ Observable ååˆ†ç›¸ä¼¼ï¼Œä¸è¿‡åœ¨è¢«è®¢é˜…åä¸ä¼šå‘å‡ºå…ƒç´ ï¼Œç›´åˆ° connect æ“ä½œç¬¦è¢«åº”ç”¨ä¸ºæ­¢ã€‚è¿™æ ·ä¸€æ¥ä½ å¯ä»¥æ§åˆ¶ Observable åœ¨ä»€ä¹ˆæ—¶å€™å¼€å§‹å‘å‡ºå…ƒç´ ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839let intSequence = Observable&lt;Int&gt;.interval(1, scheduler: MainScheduler.instance) .publish()_ = intSequence .subscribe(onNext: &#123; print(&quot;Subscription 1:, Event: \\($0)&quot;) &#125;)DispatchQueue.main.asyncAfter(deadline: .now() + 2) &#123; _ = intSequence.connect()&#125;DispatchQueue.main.asyncAfter(deadline: .now() + 4) &#123; _ = intSequence .subscribe(onNext: &#123; print(&quot;Subscription 2:, Event: \\($0)&quot;) &#125;)&#125;DispatchQueue.main.asyncAfter(deadline: .now() + 6) &#123; _ = intSequence .subscribe(onNext: &#123; print(&quot;Subscription 3:, Event: \\($0)&quot;) &#125;)&#125;è¾“å‡ºç»“æœ:Subscription 1:, Event: 0Subscription 1:, Event: 1Subscription 2:, Event: 1Subscription 1:, Event: 2Subscription 2:, Event: 2Subscription 1:, Event: 3Subscription 2:, Event: 3Subscription 3:, Event: 3Subscription 1:, Event: 4Subscription 2:, Event: 4Subscription 3:, Event: 4Subscription 1:, Event: 5Subscription 2:, Event: 5Subscription 3:, Event: 5Subscription 1:, Event: 6Subscription 2:, Event: 6Subscription 3:, Event: 6... reducereduce æ“ä½œç¬¦å°†å¯¹ç¬¬ä¸€ä¸ªå…ƒç´ åº”ç”¨ä¸€ä¸ªå‡½æ•°ã€‚ç„¶åï¼Œå°†ç»“æœä½œä¸ºå‚æ•°å¡«å…¥åˆ°ç¬¬äºŒä¸ªå…ƒç´ çš„åº”ç”¨å‡½æ•°ä¸­ã€‚ä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°éå†å®Œå…¨éƒ¨çš„å…ƒç´ åå‘å‡ºæœ€ç»ˆç»“æœã€‚ 123456789let disposeBag = DisposeBag()Observable.of(10, 100, 1000) .reduce(1, accumulator: +) .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag)è¾“å‡ºç»“æœ:1111 refCountrefCount æ“ä½œç¬¦å°†è‡ªåŠ¨è¿æ¥å’Œæ–­å¼€å¯è¢«è¿æ¥çš„ Observableã€‚å®ƒå°†å¯è¢«è¿æ¥çš„ Observable è½¬æ¢ä¸ºæ™®é€š Observableã€‚å½“ç¬¬ä¸€ä¸ªè§‚å¯Ÿè€…å¯¹å®ƒè®¢é˜…æ—¶ï¼Œé‚£ä¹ˆåº•å±‚çš„ Observable å°†è¢«è¿æ¥ã€‚å½“æœ€åä¸€ä¸ªè§‚å¯Ÿè€…ç¦»å¼€æ—¶ï¼Œé‚£ä¹ˆåº•å±‚çš„ Observable å°†è¢«æ–­å¼€è¿æ¥ã€‚ repeatElementepeatElement æ“ä½œç¬¦å°†åˆ›å»ºä¸€ä¸ª Observableï¼Œè¿™ä¸ª Observable å°†æ— æ­¢å°½çš„å‘å‡ºåŒä¸€ä¸ªå…ƒç´ ã€‚ replayreplay æ“ä½œç¬¦å°† Observable è½¬æ¢ä¸ºå¯è¢«è¿æ¥çš„ Observableï¼Œå¹¶ä¸”è¿™ä¸ªå¯è¢«è¿æ¥çš„ Observable å°†ç¼“å­˜æœ€æ–°çš„ n ä¸ªå…ƒç´ ã€‚å½“æœ‰æ–°çš„è§‚å¯Ÿè€…å¯¹å®ƒè¿›è¡Œè®¢é˜…æ—¶ï¼Œå®ƒå°±æŠŠè¿™äº›è¢«ç¼“å­˜çš„å…ƒç´ å‘é€ç»™è§‚å¯Ÿè€…ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142let intSequence = Observable&lt;Int&gt;.interval(1, scheduler: MainScheduler.instance) .replay(5)_ = intSequence .subscribe(onNext: &#123; print(&quot;Subscription 1:, Event: \\($0)&quot;) &#125;)DispatchQueue.main.asyncAfter(deadline: .now() + 2) &#123; _ = intSequence.connect()&#125;DispatchQueue.main.asyncAfter(deadline: .now() + 4) &#123; _ = intSequence .subscribe(onNext: &#123; print(&quot;Subscription 2:, Event: \\($0)&quot;) &#125;)&#125;DispatchQueue.main.asyncAfter(deadline: .now() + 8) &#123; _ = intSequence .subscribe(onNext: &#123; print(&quot;Subscription 3:, Event: \\($0)&quot;) &#125;)&#125;è¾“å‡ºç»“æœ:Subscription 1:, Event: 0Subscription 2:, Event: 0Subscription 1:, Event: 1Subscription 2:, Event: 1Subscription 1:, Event: 2Subscription 2:, Event: 2Subscription 1:, Event: 3Subscription 2:, Event: 3Subscription 1:, Event: 4Subscription 2:, Event: 4Subscription 3:, Event: 0Subscription 3:, Event: 1Subscription 3:, Event: 2Subscription 3:, Event: 3Subscription 3:, Event: 4Subscription 1:, Event: 5Subscription 2:, Event: 5Subscription 3:, Event: 5Subscription 1:, Event: 6Subscription 2:, Event: 6Subscription 3:, Event: 6... retryretry æ“ä½œç¬¦å°†ä¸ä¼šå°† error äº‹ä»¶ï¼Œä¼ é€’ç»™è§‚å¯Ÿè€…ï¼Œç„¶è€Œï¼Œå®ƒä¼šä»æ–°è®¢é˜…æº Observableï¼Œç»™è¿™ä¸ª Observable ä¸€ä¸ªé‡è¯•çš„æœºä¼šï¼Œè®©å®ƒæœ‰æœºä¼šä¸äº§ç”Ÿ error äº‹ä»¶ã€‚retry æ€»æ˜¯å¯¹è§‚å¯Ÿè€…å‘å‡º next äº‹ä»¶ï¼Œå³ä¾¿æºåºåˆ—äº§ç”Ÿäº†ä¸€ä¸ª error äº‹ä»¶ï¼Œæ‰€ä»¥è¿™æ ·å¯èƒ½ä¼šäº§ç”Ÿé‡å¤çš„å…ƒç´ ã€‚ 123456789101112131415161718192021222324252627282930313233343536var count = 1let sequenceThatErrors = Observable&lt;String&gt;.create &#123; observer in observer.onNext(&quot;ğŸ&quot;) observer.onNext(&quot;ğŸ&quot;) observer.onNext(&quot;ğŸŠ&quot;) if count == 1 &#123; observer.onError(TestError.test) print(&quot;Error encountered&quot;) count += 1 &#125; observer.onNext(&quot;ğŸ¶&quot;) observer.onNext(&quot;ğŸ±&quot;) observer.onNext(&quot;ğŸ­&quot;) observer.onCompleted() return Disposables.create()&#125;sequenceThatErrors .retry() .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag)è¾“å‡ºç»“æœ:ğŸğŸğŸŠError encounteredğŸğŸğŸŠğŸ¶ğŸ±ğŸ­ samplesample æ“ä½œç¬¦å°†ä¸å®šæœŸçš„å¯¹æº Observable è¿›è¡Œå–æ ·æ“ä½œã€‚é€šè¿‡ç¬¬äºŒä¸ª Observable æ¥æ§åˆ¶å–æ ·æ—¶æœºã€‚ä¸€æ—¦ç¬¬äºŒä¸ª Observable å‘å‡ºä¸€ä¸ªå…ƒç´ ï¼Œå°±ä»æº Observable ä¸­å–å‡ºæœ€åäº§ç”Ÿçš„å…ƒç´ ã€‚ scanscan æ“ä½œç¬¦å°†å¯¹ç¬¬ä¸€ä¸ªå…ƒç´ åº”ç”¨ä¸€ä¸ªå‡½æ•°ï¼Œå°†ç»“æœä½œä¸ºç¬¬ä¸€ä¸ªå…ƒç´ å‘å‡ºã€‚ç„¶åï¼Œå°†ç»“æœä½œä¸ºå‚æ•°å¡«å…¥åˆ°ç¬¬äºŒä¸ªå…ƒç´ çš„åº”ç”¨å‡½æ•°ä¸­ï¼Œåˆ›å»ºç¬¬äºŒä¸ªå…ƒç´ ã€‚ä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°éå†å®Œå…¨éƒ¨çš„å…ƒç´ ã€‚ 1234567891011Observable.of(10, 100, 1000) .scan(1) &#123; aggregateValue, newValue in aggregateValue + newValue &#125; .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag)è¾“å‡ºç»“æœ:111111111 shareReplayshareReplay æ“ä½œç¬¦å°†ä½¿å¾—è§‚å¯Ÿè€…å…±äº«æº Observableï¼Œå¹¶ä¸”ç¼“å­˜æœ€æ–°çš„ n ä¸ªå…ƒç´ ï¼Œå°†è¿™äº›å…ƒç´ ç›´æ¥å‘é€ç»™æ–°çš„è§‚å¯Ÿè€…ã€‚ singlesingle æ“ä½œç¬¦å°†é™åˆ¶ Observable åªäº§ç”Ÿä¸€ä¸ªå…ƒç´ ã€‚å¦‚æœ Observable åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œå®ƒå°†é•œåƒè¿™ä¸ª Observable ã€‚å¦‚æœ Observable æ²¡æœ‰å…ƒç´ æˆ–è€…å…ƒç´ æ•°é‡å¤§äºä¸€ï¼Œå®ƒå°†äº§ç”Ÿä¸€ä¸ª error äº‹ä»¶ã€‚ skipskip æ“ä½œç¬¦å¯ä»¥è®©ä½ è·³è¿‡ Observable ä¸­å¤´ n ä¸ªå…ƒç´ ï¼Œåªå…³æ³¨åé¢çš„å…ƒç´ ã€‚ 12345678910Observable.of(&quot;ğŸ±&quot;, &quot;ğŸ°&quot;, &quot;ğŸ¶&quot;, &quot;ğŸ¸&quot;, &quot;ğŸ·&quot;, &quot;ğŸµ&quot;) .skip(2) .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag)è¾“å‡ºç»“æœ:ğŸ¶ğŸ¸ğŸ·ğŸµ skipUntilskipUntil æ“ä½œç¬¦å¯ä»¥è®©ä½ å¿½ç•¥æº Observable ä¸­å¤´å‡ ä¸ªå…ƒç´ ï¼Œç›´åˆ°å¦ä¸€ä¸ª Observable å‘å‡ºä¸€ä¸ªå…ƒç´ åï¼Œå®ƒæ‰é•œåƒæº Observableã€‚ 12345678910111213141516171819202122let sourceSequence = PublishSubject&lt;String&gt;()let referenceSequence = PublishSubject&lt;String&gt;()sourceSequence .skipUntil(referenceSequence) .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag)sourceSequence.onNext(&quot;ğŸ±&quot;)sourceSequence.onNext(&quot;ğŸ°&quot;)sourceSequence.onNext(&quot;ğŸ¶&quot;)referenceSequence.onNext(&quot;ğŸ”´&quot;)sourceSequence.onNext(&quot;ğŸ¸&quot;)sourceSequence.onNext(&quot;ğŸ·&quot;)sourceSequence.onNext(&quot;ğŸµ&quot;)è¾“å‡ºç»“æœ:ğŸ¸ğŸ·ğŸµ skipWhileskipWhile æ“ä½œç¬¦å¯ä»¥è®©ä½ å¿½ç•¥æº Observable ä¸­å¤´å‡ ä¸ªå…ƒç´ ï¼Œç›´åˆ°å…ƒç´ çš„åˆ¤å®šä¸ºå¦åï¼Œå®ƒæ‰é•œåƒæº Observableã€‚ 12345678910Observable.of(1, 2, 3, 4, 3, 2, 1) .skipWhile &#123; $0 &lt; 4 &#125; .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag)è¾“å‡ºç»“æœ:4321 startWithstartWith æ“ä½œç¬¦ä¼šåœ¨ Observable å¤´éƒ¨æ’å…¥ä¸€äº›å…ƒç´ ã€‚ï¼ˆå¦‚æœä½ æƒ³åœ¨å°¾éƒ¨åŠ å…¥ä¸€äº›å…ƒç´ å¯ä»¥ç”¨concatï¼‰ 1234567891011121314151617Observable.of(&quot;ğŸ¶&quot;, &quot;ğŸ±&quot;, &quot;ğŸ­&quot;, &quot;ğŸ¹&quot;) .startWith(&quot;1&quot;) .startWith(&quot;2&quot;) .startWith(&quot;3&quot;, &quot;ğŸ…°ï¸&quot;, &quot;ğŸ…±ï¸&quot;) .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag)è¾“å‡ºç»“æœ:3ğŸ…°ï¸ğŸ…±ï¸21ğŸ¶ğŸ±ğŸ­ğŸ¹ subscribeOnæŒ‡å®š Observable åœ¨é‚£ä¸ª Scheduler æ‰§è¡Œ takeé€šè¿‡ take æ“ä½œç¬¦ä½ å¯ä»¥åªå‘å‡ºå¤´ n ä¸ªå…ƒç´ ã€‚å¹¶ä¸”å¿½ç•¥æ‰åé¢çš„å…ƒç´ ï¼Œç›´æ¥ç»“æŸåºåˆ—ã€‚ 123456789Observable.of(&quot;ğŸ±&quot;, &quot;ğŸ°&quot;, &quot;ğŸ¶&quot;, &quot;ğŸ¸&quot;, &quot;ğŸ·&quot;, &quot;ğŸµ&quot;) .take(3) .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag)è¿è¡Œç»“æœ:ğŸ±ğŸ°ğŸ¶ takeLasté€šè¿‡ takeLast æ“ä½œç¬¦ä½ å¯ä»¥åªå‘å‡ºå°¾éƒ¨ n ä¸ªå…ƒç´ ã€‚å¹¶ä¸”å¿½ç•¥æ‰å‰é¢çš„å…ƒç´  123456789Observable.of(&quot;ğŸ±&quot;, &quot;ğŸ°&quot;, &quot;ğŸ¶&quot;, &quot;ğŸ¸&quot;, &quot;ğŸ·&quot;, &quot;ğŸµ&quot;) .takeLast(3) .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag)è¿è¡Œç»“æœ:ğŸ¸ğŸ·ğŸµ takeUntiltakeUntil æ“ä½œç¬¦å°†é•œåƒæº Observableï¼Œå®ƒåŒæ—¶è§‚æµ‹ç¬¬äºŒä¸ª Observableã€‚ä¸€æ—¦ç¬¬äºŒä¸ª Observable å‘å‡ºä¸€ä¸ªå…ƒç´ æˆ–è€…äº§ç”Ÿä¸€ä¸ªç»ˆæ­¢äº‹ä»¶ï¼Œé‚£ä¸ªé•œåƒçš„ Observable å°†ç«‹å³ç»ˆæ­¢ã€‚ 1234567891011121314151617181920212223let sourceSequence = PublishSubject&lt;String&gt;()let referenceSequence = PublishSubject&lt;String&gt;()sourceSequence .takeUntil(referenceSequence) .subscribe &#123; print($0) &#125; .disposed(by: disposeBag)sourceSequence.onNext(&quot;ğŸ±&quot;)sourceSequence.onNext(&quot;ğŸ°&quot;)sourceSequence.onNext(&quot;ğŸ¶&quot;)referenceSequence.onNext(&quot;ğŸ”´&quot;)sourceSequence.onNext(&quot;ğŸ¸&quot;)sourceSequence.onNext(&quot;ğŸ·&quot;)sourceSequence.onNext(&quot;ğŸµ&quot;)è¿è¡Œç»“æœ:next(ğŸ±)next(ğŸ°)next(ğŸ¶)completed takeWhiletakeWhile æ“ä½œç¬¦å°†é•œåƒæº Observable ç›´åˆ°æŸä¸ªå…ƒç´ çš„åˆ¤å®šä¸º falseã€‚æ­¤æ—¶ï¼Œè¿™ä¸ªé•œåƒçš„ Observable å°†ç«‹å³ç»ˆæ­¢ã€‚ 123456789Observable.of(1, 2, 3, 4, 3, 2, 1) .takeWhile &#123; $0 &lt; 4 &#125; .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag)è¿è¡Œç»“æœ:123 timeoutå¦‚æœ Observable åœ¨ä¸€æ®µæ—¶é—´å†…æ²¡æœ‰äº§ç”Ÿå…ƒç´ ï¼Œtimeout æ“ä½œç¬¦å°†ä½¿å®ƒå‘å‡ºä¸€ä¸ª error äº‹ä»¶ã€‚ timertimer æ“ä½œç¬¦å°†åˆ›å»ºä¸€ä¸ª Observableï¼Œå®ƒåœ¨ç»è¿‡è®¾å®šçš„ä¸€æ®µæ—¶é—´åï¼Œäº§ç”Ÿå”¯ä¸€çš„ä¸€ä¸ªå…ƒç´ ã€‚ usingé€šè¿‡ä½¿ç”¨ using æ“ä½œç¬¦åˆ›å»º Observable æ—¶ï¼ŒåŒæ—¶åˆ›å»ºä¸€ä¸ªå¯è¢«æ¸…é™¤çš„èµ„æºï¼Œä¸€æ—¦ Observable ç»ˆæ­¢äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªèµ„æºå°±ä¼šè¢«æ¸…é™¤æ‰äº†ã€‚ windowwindow æ“ä½œç¬¦å’Œ buffer ååˆ†ç›¸ä¼¼ï¼Œbuffer å‘¨æœŸæ€§çš„å°†ç¼“å­˜çš„å…ƒç´ é›†åˆå‘é€å‡ºæ¥ï¼Œè€Œ window å‘¨æœŸæ€§çš„å°†å…ƒç´ é›†åˆä»¥ Observable çš„å½¢æ€å‘é€å‡ºæ¥ã€‚buffer è¦ç­‰åˆ°å…ƒç´ æœé›†å®Œæ¯•åï¼Œæ‰ä¼šå‘å‡ºå…ƒç´ åºåˆ—ã€‚è€Œ window å¯ä»¥å®æ—¶å‘å‡ºå…ƒç´ åºåˆ—ã€‚ withLatestFromwithLatestFrom æ“ä½œç¬¦å°†ä¸¤ä¸ª Observables ä¸­æœ€æ–°çš„å…ƒç´ é€šè¿‡ä¸€ä¸ªå‡½æ•°ç»„åˆèµ·æ¥ï¼Œç„¶åå°†è¿™ä¸ªç»„åˆçš„ç»“æœå‘å‡ºæ¥ã€‚å½“ç¬¬ä¸€ä¸ª Observable å‘å‡ºä¸€ä¸ªå…ƒç´ æ—¶ï¼Œå°±ç«‹å³å–å‡ºç¬¬äºŒä¸ª Observable ä¸­æœ€æ–°çš„å…ƒç´ ï¼Œé€šè¿‡ä¸€ä¸ªç»„åˆå‡½æ•°å°†ä¸¤ä¸ªæœ€æ–°çš„å…ƒç´ åˆå¹¶åå‘é€å‡ºå»ã€‚ 123456789101112131415161718192021222324252627282930313233let firstSubject = PublishSubject&lt;String&gt;()let secondSubject = PublishSubject&lt;String&gt;()firstSubject .withLatestFrom(secondSubject) .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag)firstSubject.onNext(&quot;ğŸ…°ï¸&quot;)firstSubject.onNext(&quot;ğŸ…±ï¸&quot;)secondSubject.onNext(&quot;1&quot;)secondSubject.onNext(&quot;2&quot;)firstSubject.onNext(&quot;ğŸ†&quot;)è¾“å‡ºç»“æœ:2firstSubject .withLatestFrom(secondSubject) &#123; (first, second) in return first + second &#125; .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag)firstSubject.onNext(&quot;ğŸ…°ï¸&quot;)firstSubject.onNext(&quot;ğŸ…±ï¸&quot;)secondSubject.onNext(&quot;1&quot;)secondSubject.onNext(&quot;2&quot;)firstSubject.onNext(&quot;ğŸ†&quot;)è¾“å‡ºç»“æœ:ğŸ†2 zipzip æ“ä½œç¬¦å°†å¤šä¸ª(æœ€å¤šä¸è¶…è¿‡8ä¸ª) Observables çš„å…ƒç´ é€šè¿‡ä¸€ä¸ªå‡½æ•°ç»„åˆèµ·æ¥ï¼Œç„¶åå°†è¿™ä¸ªç»„åˆçš„ç»“æœå‘å‡ºæ¥ã€‚å®ƒä¼šä¸¥æ ¼çš„æŒ‰ç…§åºåˆ—çš„ç´¢å¼•æ•°è¿›è¡Œç»„åˆã€‚ä¾‹å¦‚ï¼Œè¿”å›çš„ Observable çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œæ˜¯ç”±æ¯ä¸€ä¸ªæº Observables çš„ç¬¬ä¸€ä¸ªå…ƒç´ ç»„åˆå‡ºæ¥çš„ã€‚å®ƒçš„ç¬¬äºŒä¸ªå…ƒç´  ï¼Œæ˜¯ç”±æ¯ä¸€ä¸ªæº Observables çš„ç¬¬äºŒä¸ªå…ƒç´ ç»„åˆå‡ºæ¥çš„ã€‚å®ƒçš„ç¬¬ä¸‰ä¸ªå…ƒç´  ï¼Œæ˜¯ç”±æ¯ä¸€ä¸ªæº Observables çš„ç¬¬ä¸‰ä¸ªå…ƒç´ ç»„åˆå‡ºæ¥çš„ï¼Œä»¥æ­¤ç±»æ¨ã€‚å®ƒçš„å…ƒç´ æ•°é‡ç­‰äºæº Observables ä¸­å…ƒç´ æ•°é‡æœ€å°‘çš„é‚£ä¸ªã€‚ 123456789101112131415161718192021let first = PublishSubject&lt;String&gt;()let second = PublishSubject&lt;String&gt;()Observable.zip(first, second) &#123; $0 + $1 &#125; .subscribe(onNext: &#123; print($0) &#125;) .disposed(by: disposeBag)first.onNext(&quot;1&quot;)second.onNext(&quot;A&quot;)first.onNext(&quot;2&quot;)second.onNext(&quot;B&quot;)second.onNext(&quot;C&quot;)second.onNext(&quot;D&quot;)first.onNext(&quot;3&quot;)first.onNext(&quot;4&quot;)è¾“å‡ºç»“æœ:1A2B3C4D","path":"2017/11/03/RxSwiftæ“ä½œç¬¦/","date":"11-03","excerpt":""},{"title":"RxSwiftæ ¸å¿ƒæ¦‚å¿µ","text":"RxSwiftæ˜¯Swiftå‡½æ•°å“åº”å¼ç¼–ç¨‹çš„ä¸€ä¸ªå¼€æºåº“ï¼Œç”±Githubçš„ReactiveXç»„ç»‡å¼€å‘ï¼Œç»´æŠ¤ã€‚RxSwiftçš„ä½œç”¨æ˜¯è®©è®©æ•°æ®/äº‹ä»¶æµå’Œå¼‚æ­¥ä»»åŠ¡èƒ½å¤Ÿæ›´æ–¹ä¾¿çš„åºåˆ—åŒ–å¤„ç†ï¼Œèƒ½å¤Ÿä½¿ç”¨Swiftè¿›è¡Œå“åº”å¼ç¼–ç¨‹. é“¾å¼ç¼–ç¨‹é€šè¿‡é«˜é˜¶å‡½æ•°ä»¥ç‚¹ä¸ºè¿æ¥å°†å¤šä¸ªå‡½æ•°è¿æ¥åœ¨ä¸€èµ·å®Œæˆå‚æ•°ä¼ é€’å’Œå¤æ‚çš„æ“ä½œ. 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152enum MyError: Error &#123; case DivZero // é™¤æ•°ä¸º0&#125;class Calculate: NSObject &#123; class func ts_calculate(make: (Calculate) -&gt; Void) &#123; let calculate = Calculate() make(calculate) print(calculate.result) &#125; //ä¿å­˜è®¡ç®—ç»“æœ var result: Float = 0.0 //åŠ  func add(num: Float) -&gt; Calculate &#123; result += num return self &#125; //å‡ func sub(num: Float) -&gt; Calculate &#123; result -= num return self &#125; //ä¹˜ func mul(num: Float) -&gt; Calculate &#123; result *= num return self &#125; //é™¤ func div(num: Float) throws -&gt; Calculate &#123; guard num != 0 else&#123; throw MyError.DivZero &#125; result /= num return self &#125;&#125;//ä½¿ç”¨ Calculate.ts_calculate &#123; (make) in make.add(num: 6).sub(num: 2).mul(num: 5) do &#123; try make.div(num: 0) &#125;catch &#123; print(error) &#125; &#125; å“åº”å¼ç¼–ç¨‹å“åº”å¼ç¼–ç¨‹æ ¹æºäº FRPï¼ˆå‡½æ•°å“åº”å¼ç¼–ç¨‹ï¼‰å‘½ä»¤é©±åŠ¨çš„ç¼–ç¨‹æ–¹å¼ï¼Œæ˜¯ä»¥å¼‚æ­¥æ•°æ®æµçš„å½¢å¼è¿›è¡Œç¼–ç¨‹ã€‚ 1234567var B = 20let C = A * 2 + B// å½“å‰å€¼// A = 10, B = 20, C = 40A = 0// å½“å‰å€¼// A = 0, B = 20, C = 40 åœ¨è¿™é‡ŒæŠŠa,b,cå½“æˆæŸä¸ªçŠ¶æ€ï¼Œcæ˜¯a,bä¸¤ä¸ªçŠ¶æ€çš„ç»„åˆï¼Œæ­£å¸¸çš„ç¼–ç¨‹ä¸­ï¼Œåœ¨è®¡ç®—äº†cçš„çŠ¶æ€ä¹‹åï¼Œå†å»æ”¹å˜a,bçš„çŠ¶æ€æ˜¯ä¸ä¼šå½±å“åˆ°cçš„çŠ¶æ€çš„ã€‚æ‰€ä»¥åœ¨æ­£å¸¸ç¼–ç¨‹ä¸­æˆ‘ä»¬è¦å»è®°å½•å¾ˆå¤šçŠ¶æ€å¹¶åŠæ—¶æ›´æ–°çŠ¶æ€ï¼Œæ¯”å¦‚ç½‘ç»œè¯·æ±‚çš„çŠ¶æ€ï¼Œä¸‹æ‹‰åˆ·æ–°çš„çŠ¶æ€ã€‚å„ç§å„æ ·çš„äº‹ä»¶å“åº”æ–¹å¼ï¼Œæ— å½¢ä¸­å¢åŠ äº†ç¼–ç çš„å¤æ‚åº¦ã€‚è€Œåœ¨å“åº”å¼ç¼–ç¨‹ä¸­ï¼Œæ¯ä¸€ä¸ªçŠ¶æ€çš„æ”¹å˜éƒ½ä¼šå‘å‡ºä¸€ä¸ªä¿¡å·ï¼Œæ›´æ–°ä¸ä¹‹å…³è”çš„çŠ¶æ€ã€‚ ä¸€èˆ¬å¯ä½¿ç”¨å¼¹ç å›¾æ¥å±•ç¤ºè¿™ä¸ªåŸç†ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ¯ä¸€è¡Œè¡¨ç¤ºè¿ç»­çš„ä¸€æ®µæ—¶é—´ï¼Œæ¯ä¸€ä¸ªå¼¹ç è¡¨ç¤ºå‘ç”Ÿåœ¨ç‰¹å®šæ—¶åˆ»çš„ä¸€ä¸ªäº‹ä»¶ã€‚ Observable - å¯è¢«ç›‘å¬çš„åºåˆ—Observableä¹Ÿå°±æ˜¯ä¸€ä¸ªè¢«è§‚å¯Ÿçš„å¯¹è±¡ï¼Œæ˜¯ä¸€ä¸ªäº‹ä»¶åºåˆ—ï¼Œè®¢é˜…è€…å¯ä»¥è®¢é˜…å®ƒï¼Œç›‘æµ‹äº‹ä»¶çš„å‘ç”Ÿ(Next\\Complete\\Error) .onNext(element) è¡¨ç¤ºæ–°çš„äº‹ä»¶æ•°æ®ã€‚ .onError(error) è¡¨ç¤ºäº‹ä»¶åºåˆ—å› å¼‚å¸¸è€Œå®Œç»“ã€‚ .onCompleted() è¡¨ç¤ºäº‹ä»¶åºåˆ—å®Œç»“ã€‚ åˆ›å»ºåºåˆ—1234567891011121314151617181920212223242526let numbers: Observable&lt;Int&gt; = Observable.create &#123; observer -&gt; Disposable in observer.onNext(0) observer.onNext(1) observer.onNext(2) observer.onNext(3) observer.onNext(4) observer.onNext(5) observer.onNext(6) observer.onNext(7) observer.onNext(8) observer.onNext(9) observer.onCompleted() return Disposables.create()&#125;numbers .subscribe(onNext: &#123; num in print(&quot;å–å¾— num æˆåŠŸ: \\(num)&quot;) &#125;, onError: &#123; error in print(&quot;å–å¾— num å¤±è´¥ Error: \\(error.localizedDescription)&quot;) &#125;, onCompleted: &#123; print(&quot;å–å¾— num ä»»åŠ¡æˆåŠŸå®Œæˆ&quot;) &#125;) .disposed(by: disposeBag) ç‰¹å¾åºåˆ—RxSwift é‡Œé¢ Observable ä¹Ÿå­˜åœ¨ä¸€äº›ç‰¹å¾åºåˆ—ï¼Œè¿™äº›ç‰¹å¾åºåˆ—å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å‡†ç¡®çš„æè¿°åºåˆ—ã€‚å¹¶ä¸”å®ƒä»¬è¿˜å¯ä»¥ç»™æˆ‘ä»¬æä¾›è¯­æ³•ç³–ï¼Œè®©æˆ‘ä»¬èƒ½å¤Ÿç”¨æ›´åŠ ä¼˜é›…çš„æ–¹å¼ä¹¦å†™ä»£ç  SingleSingle æ˜¯ Observable çš„å¦å¤–ä¸€ä¸ªç‰ˆæœ¬ã€‚ä¸åƒ Observable å¯ä»¥å‘å‡ºå¤šä¸ªå…ƒç´ ï¼Œå®ƒè¦ä¹ˆåªèƒ½å‘å‡ºä¸€ä¸ªå…ƒç´ ï¼Œè¦ä¹ˆäº§ç”Ÿä¸€ä¸ª error äº‹ä»¶ã€‚ ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„ä¾‹å­å°±æ˜¯æ‰§è¡Œ HTTP è¯·æ±‚ï¼Œç„¶åè¿”å›ä¸€ä¸ªåº”ç­”æˆ–é”™è¯¯ã€‚ä¸è¿‡ä½ ä¹Ÿå¯ä»¥ç”¨ Single æ¥æè¿°ä»»ä½•åªæœ‰ä¸€ä¸ªå…ƒç´ çš„åºåˆ—,ä¸å…±äº«çŠ¶æ€å˜åŒ–.ä¹Ÿå¯ä»¥å¯¹ Observable è°ƒç”¨ .asSingle() æ–¹æ³•ï¼Œå°†å®ƒè½¬æ¢ä¸º Single 1234567891011121314151617181920212223242526272829303132333435func getRepo(_ repo: String) -&gt; Single&lt;[String: Any]&gt; &#123; return Single&lt;[String: Any]&gt;.create &#123; single in let url = URL(string: &quot;https://api.github.com/repos/\\(repo)&quot;)! let task = URLSession.shared.dataTask(with: url) &#123; data, _, error in if let error = error &#123; single(.error(error)) return &#125; guard let data = data, let json = try? JSONSerialization.jsonObject(with: data, options: .mutableLeaves), let result = json as? [String: Any] else &#123; single(.error(DataError.cantParseJSON)) return &#125; single(.success(result)) &#125; task.resume() return Disposables.create &#123; task.cancel() &#125; &#125;&#125;getRepo(&quot;ReactiveX/RxSwift&quot;) .subscribe(onSuccess: &#123; json in print(&quot;JSON: &quot;, json) &#125;, onError: &#123; error in print(&quot;Error: &quot;, error) &#125;) .disposed(by: disposeBag) CompletableCompletable æ˜¯ Observable çš„å¦å¤–ä¸€ä¸ªç‰ˆæœ¬ã€‚ä¸åƒ Observable å¯ä»¥å‘å‡ºå¤šä¸ªå…ƒç´ ï¼Œå®ƒè¦ä¹ˆåªèƒ½äº§ç”Ÿä¸€ä¸ª completed äº‹ä»¶ï¼Œè¦ä¹ˆäº§ç”Ÿä¸€ä¸ª error äº‹ä»¶,ä¸å…±äº«çŠ¶æ€å˜åŒ–. Completable é€‚ç”¨äºé‚£ç§ä½ åªå…³å¿ƒä»»åŠ¡æ˜¯å¦å®Œæˆï¼Œè€Œä¸éœ€è¦åœ¨æ„ä»»åŠ¡è¿”å›å€¼çš„æƒ…å†µã€‚å®ƒå’Œ Observable æœ‰ç‚¹ç›¸ä¼¼ã€‚ 1234567891011121314151617181920212223func cacheLocally() -&gt; Completable &#123; return Completable.create &#123; completable in // Store some data locally ... ... guard success else &#123; completable(.error(CacheError.failedCaching)) return Disposables.create &#123;&#125; &#125; completable(.completed) return Disposables.create &#123;&#125; &#125;&#125;cacheLocally() .subscribe(onCompleted: &#123; print(&quot;Completed with no error&quot;) &#125;, onError: &#123; error in print(&quot;Completed with an error: \\(error.localizedDescription)&quot;) &#125;) .disposed(by: disposeBag) MaybeMaybe æ˜¯ Observable çš„å¦å¤–ä¸€ä¸ªç‰ˆæœ¬ã€‚å®ƒä»‹äº Single å’Œ Completable ä¹‹é—´ï¼Œå®ƒè¦ä¹ˆåªèƒ½å‘å‡ºä¸€ä¸ªå…ƒç´ ï¼Œè¦ä¹ˆäº§ç”Ÿä¸€ä¸ª completed äº‹ä»¶ï¼Œè¦ä¹ˆäº§ç”Ÿä¸€ä¸ª error äº‹ä»¶,ä¸å…±äº«çŠ¶æ€å˜åŒ–.å¯ä»¥å¯¹ Observable è°ƒç”¨ .asMaybe() æ–¹æ³•ï¼Œå°†å®ƒè½¬æ¢ä¸º Maybeã€‚ 12345678910111213141516171819202122232425func generateString() -&gt; Maybe&lt;String&gt; &#123; return Maybe&lt;String&gt;.create &#123; maybe in maybe(.success(&quot;RxSwift&quot;)) // OR maybe(.completed) // OR maybe(.error(error)) return Disposables.create &#123;&#125; &#125;&#125;generateString() .subscribe(onSuccess: &#123; element in print(&quot;Completed with element \\(element)&quot;) &#125;, onError: &#123; error in print(&quot;Completed with an error \\(error.localizedDescription)&quot;) &#125;, onCompleted: &#123; print(&quot;Completed with no element&quot;) &#125;) .disposed(by: disposeBag) Driverå®ƒä¸»è¦æ˜¯ä¸ºäº†ç®€åŒ– UI å±‚çš„ä»£ç .ä¸ä¼šäº§ç”Ÿ error äº‹ä»¶,ä¸€å®šåœ¨ MainScheduler ç›‘å¬ï¼ˆä¸»çº¿ç¨‹ç›‘å¬ï¼‰,å…±äº«çŠ¶æ€å˜åŒ–. 1234567891011121314151617let results = query.rx.text .throttle(0.3, scheduler: MainScheduler.instance) .flatMapLatest &#123; query in fetchAutoCompleteItems(query) &#125;results .map &#123; &quot;\\($0.count)&quot; &#125; .bind(to: resultCount.rx.text) .disposed(by: disposeBag)results .bind(to: resultsTableView.rx.items(cellIdentifier: &quot;Cell&quot;)) &#123; (_, result, cell) in cell.textLabel?.text = &quot;\\(result)&quot; &#125; .disposed(by: disposeBag) è¿™æ®µä»£ç çš„ä¸»è¦ç›®çš„æ˜¯ï¼š å–å‡ºç”¨æˆ·è¾“å…¥ç¨³å®šåçš„å†…å®¹ å‘æœåŠ¡å™¨è¯·æ±‚ä¸€ç»„ç»“æœ å°†è¿”å›çš„ç»“æœç»‘å®šåˆ°ä¸¤ä¸ª UI å…ƒç´ ä¸Šï¼štableView å’Œ æ˜¾ç¤ºç»“æœæ•°é‡çš„label é‚£ä¹ˆè¿™é‡Œå­˜åœ¨ä»€ä¹ˆé—®é¢˜ï¼Ÿ å¦‚æœ fetchAutoCompleteItems çš„åºåˆ—äº§ç”Ÿäº†ä¸€ä¸ªé”™è¯¯ï¼ˆç½‘ç»œè¯·æ±‚å¤±è´¥ï¼‰ï¼Œè¿™ä¸ªé”™è¯¯å°†å–æ¶ˆæ‰€æœ‰ç»‘å®šï¼Œå½“ç”¨æˆ·è¾“å…¥ä¸€ä¸ªæ–°çš„å…³é”®å­—æ—¶ï¼Œæ˜¯æ— æ³•å‘èµ·æ–°çš„ç½‘ç»œè¯·æ±‚ã€‚ å¦‚æœ fetchAutoCompleteItems åœ¨åå°è¿”å›åºåˆ—ï¼Œé‚£ä¹ˆåˆ·æ–°é¡µé¢ä¹Ÿä¼šåœ¨åå°è¿›è¡Œï¼Œè¿™æ ·å°±ä¼šå‡ºç°å¼‚å¸¸å´©æºƒã€‚ è¿”å›çš„ç»“æœè¢«ç»‘å®šåˆ°ä¸¤ä¸ª UI å…ƒç´ ä¸Šã€‚é‚£å°±æ„å‘³ç€ï¼Œæ¯æ¬¡ç”¨æˆ·è¾“å…¥ä¸€ä¸ªæ–°çš„å…³é”®å­—æ—¶ï¼Œå°±ä¼šåˆ†åˆ«ä¸ºä¸¤ä¸ª UI å…ƒç´ å‘èµ· HTTP è¯·æ±‚ï¼Œè¿™å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœã€‚ ä¸€ä¸ªæ›´å¥½çš„æ–¹æ¡ˆæ˜¯è¿™æ ·çš„ï¼š 1234567891011121314151617181920let results = query.rx.text .throttle(0.3, scheduler: MainScheduler.instance) .flatMapLatest &#123; query in fetchAutoCompleteItems(query) .observeOn(MainScheduler.instance) // ç»“æœåœ¨ä¸»çº¿ç¨‹è¿”å› .catchErrorJustReturn([]) // é”™è¯¯è¢«å¤„ç†äº†ï¼Œè¿™æ ·è‡³å°‘ä¸ä¼šç»ˆæ­¢æ•´ä¸ªåºåˆ— &#125; .share(replay: 1) // HTTP è¯·æ±‚æ˜¯è¢«å…±äº«çš„results .map &#123; &quot;\\($0.count)&quot; &#125; .bind(to: resultCount.rx.text) .disposed(by: disposeBag)results .bind(to: resultsTableView.rx.items(cellIdentifier: &quot;Cell&quot;)) &#123; (_, result, cell) in cell.textLabel?.text = &quot;\\(result)&quot; &#125; .disposed(by: disposeBag) ä»¥ä¸‹æ˜¯ä½¿ç”¨ Driver ä¼˜åŒ–åçš„ä»£ç ï¼š 123456789101112131415161718let results = query.rx.text.asDriver() // å°†æ™®é€šåºåˆ—è½¬æ¢ä¸º Driver .throttle(0.3, scheduler: MainScheduler.instance) .flatMapLatest &#123; query in fetchAutoCompleteItems(query) .asDriver(onErrorJustReturn: []) // ä»…ä»…æä¾›å‘ç”Ÿé”™è¯¯æ—¶çš„å¤‡é€‰è¿”å›å€¼ &#125;results .map &#123; &quot;\\($0.count)&quot; &#125; .drive(resultCount.rx.text) // è¿™é‡Œæ”¹ç”¨ `drive` è€Œä¸æ˜¯ `bindTo` .disposed(by: disposeBag) // è¿™æ ·å¯ä»¥ç¡®ä¿å¿…å¤‡æ¡ä»¶éƒ½å·²ç»æ»¡è¶³äº†results .drive(resultsTableView.rx.items(cellIdentifier: &quot;Cell&quot;)) &#123; (_, result, cell) in cell.textLabel?.text = &quot;\\(result)&quot; &#125; .disposed(by: disposeBag) drive æ–¹æ³•åªèƒ½è¢« Driver è°ƒç”¨ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœä½ å‘ç°ä»£ç æ‰€å­˜åœ¨ driveï¼Œé‚£ä¹ˆè¿™ä¸ªåºåˆ—ä¸ä¼šäº§ç”Ÿé”™è¯¯äº‹ä»¶å¹¶ä¸”ä¸€å®šåœ¨ä¸»çº¿ç¨‹ç›‘å¬ã€‚è¿™æ ·ä½ å¯ä»¥å®‰å…¨çš„ç»‘å®š UI å…ƒç´ ã€‚ Observer - è§‚å¯Ÿè€…è§‚å¯Ÿè€…éœ€è¦å»è®¢é˜…(subscribe)è¢«è§‚å¯Ÿè€…(Observable)ï¼Œæ‰èƒ½æ”¶åˆ°Observableçš„äº‹ä»¶é€šçŸ¥æ¶ˆæ¯.è€Œè§‚å¯Ÿè€…å°±æ˜¯ç”±åé¢çš„ onNextï¼ŒonErrorï¼ŒonCompletedçš„è¿™äº›é—­åŒ…æ„å»ºå‡ºæ¥çš„. 123456789numbers .subscribe(onNext: &#123; num in print(&quot;å–å¾— num æˆåŠŸ: \\(num)&quot;) &#125;, onError: &#123; error in print(&quot;å–å¾— num å¤±è´¥ Error: \\(error.localizedDescription)&quot;) &#125;, onCompleted: &#123; print(&quot;å–å¾— num ä»»åŠ¡æˆåŠŸå®Œæˆ&quot;) &#125;) .disposed(by: disposeBag) ç‰¹å¾è§‚å¯Ÿè€…AnyObserverAnyObserver å¯ä»¥ç”¨æ¥æå™ä»»æ„ä¸€ç§è§‚å¯Ÿè€…ã€‚ 1234567891011121314let observer: AnyObserver&lt;Data&gt; = AnyObserver &#123; (event) in switch event &#123; case .next(let data): print(&quot;Data Task Success with count: \\(data.count)&quot;) case .error(let error): print(&quot;Data Task Error: \\(error)&quot;) default: break &#125;&#125;URLSession.shared.rx.data(request: URLRequest(url: url)) .subscribe(observer) .disposed(by: disposeBag) Binderä¸ä¼šå¤„ç†é”™è¯¯äº‹ä»¶,ç¡®ä¿ç»‘å®šéƒ½æ˜¯åœ¨ç»™å®š Scheduler ä¸Šæ‰§è¡Œï¼ˆé»˜è®¤ MainSchedulerï¼‰.ä¸€æ—¦äº§ç”Ÿé”™è¯¯äº‹ä»¶ï¼Œåœ¨è°ƒè¯•ç¯å¢ƒä¸‹å°†æ‰§è¡Œ fatalErrorï¼Œåœ¨å‘å¸ƒç¯å¢ƒä¸‹å°†æ‰“å°é”™è¯¯ä¿¡æ¯ã€‚ 123456789101112let observer: AnyObserver&lt;Bool&gt; = AnyObserver &#123; [weak self] (event) in switch event &#123; case .next(let isHidden): self?.usernameValidOutlet.isHidden = isHidden default: break &#125;&#125;usernameValid .bind(to: observer) .disposed(by: disposeBag) ç”±äºè¿™ä¸ªè§‚å¯Ÿè€…æ˜¯ä¸€ä¸ª UI è§‚å¯Ÿè€…ï¼Œæ‰€ä»¥å®ƒåœ¨å“åº”äº‹ä»¶æ—¶ï¼Œåªä¼šå¤„ç† next äº‹ä»¶ï¼Œå¹¶ä¸”æ›´æ–° UI çš„æ“ä½œéœ€è¦åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œ.å› æ­¤ä¸€ä¸ªæ›´å¥½çš„æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨ Binderï¼š 1234567let observer: Binder&lt;Bool&gt; = Binder(usernameValidOutlet) &#123; (view, isHidden) in view.isHidden = isHidden&#125;usernameValid .bind(to: observer) .disposed(by: disposeBag) Binder å¯ä»¥åªå¤„ç† next äº‹ä»¶ï¼Œå¹¶ä¸”ä¿è¯å“åº” next äº‹ä»¶çš„ä»£ç ä¸€å®šä¼šåœ¨ç»™å®š Scheduler ä¸Šæ‰§è¡Œï¼Œè¿™é‡Œé‡‡ç”¨é»˜è®¤çš„ MainSchedulerã€‚ å¯è¢«ç›‘å¬çš„åºåˆ—ä¹Ÿæ˜¯è§‚å¯Ÿè€…1234567// ä½œä¸ºå¯è¢«ç›‘å¬çš„åºåˆ—let observable = textField.rx.textobservable.subscribe(onNext: &#123; text in show(text: text) &#125;)// ä½œä¸ºè§‚å¯Ÿè€…let observer = textField.rx.textlet text: Observable&lt;String?&gt; = ...text.bind(to: observer) æœ‰è®¸å¤š UI æ§ä»¶éƒ½å­˜åœ¨è¿™ç§ç‰¹æ€§ï¼Œä¾‹å¦‚ï¼šswitchçš„å¼€å…³çŠ¶æ€ï¼ŒsegmentedControlçš„é€‰ä¸­ç´¢å¼•å·ï¼ŒdatePickerçš„é€‰ä¸­æ—¥æœŸç­‰ç­‰ã€‚ AsyncSubjectAsyncSubject å°†åœ¨æº Observable äº§ç”Ÿå®Œæˆäº‹ä»¶åï¼Œå‘å‡ºæœ€åä¸€ä¸ªå…ƒç´ ï¼ˆä»…ä»…åªæœ‰æœ€åä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œå¦‚æœæº Observable æ²¡æœ‰å‘å‡ºä»»ä½•å…ƒç´ ï¼Œåªæœ‰ä¸€ä¸ªå®Œæˆäº‹ä»¶ã€‚é‚£ AsyncSubject ä¹Ÿåªæœ‰ä¸€ä¸ªå®Œæˆäº‹ä»¶ã€‚å®ƒä¼šå¯¹éšåçš„è§‚å¯Ÿè€…å‘å‡ºæœ€ç»ˆå…ƒç´ ã€‚å¦‚æœæº Observable å› ä¸ºäº§ç”Ÿäº†ä¸€ä¸ª error äº‹ä»¶è€Œä¸­æ­¢ï¼Œ AsyncSubject å°±ä¸ä¼šå‘å‡ºä»»ä½•å…ƒç´ ï¼Œè€Œæ˜¯å°†è¿™ä¸ª error äº‹ä»¶å‘é€å‡ºæ¥ã€‚123456789101112131415let disposeBag = DisposeBag()let subject = AsyncSubject&lt;String&gt;()subject .subscribe &#123; print(&quot;Subscription: 1 Event:&quot;, $0) &#125; .disposed(by: disposeBag)subject.onNext(&quot;ğŸ¶&quot;)subject.onNext(&quot;ğŸ±&quot;)subject.onNext(&quot;ğŸ¹&quot;)subject.onCompleted()è¾“å‡ºç»“æœï¼šSubscription: 1 Event: next(ğŸ¹)Subscription: 1 Event: completed PublishSubjectPublishSubject å°†å¯¹è§‚å¯Ÿè€…å‘é€è®¢é˜…åäº§ç”Ÿçš„å…ƒç´ ï¼Œè€Œåœ¨è®¢é˜…å‰å‘å‡ºçš„å…ƒç´ å°†ä¸ä¼šå‘é€ç»™è§‚å¯Ÿè€…ã€‚å¦‚æœä½ å¸Œæœ›è§‚å¯Ÿè€…æ¥æ”¶åˆ°æ‰€æœ‰çš„å…ƒç´ ï¼Œä½ å¯ä»¥é€šè¿‡ä½¿ç”¨ Observable çš„ create æ–¹æ³•æ¥åˆ›å»º Observableï¼Œæˆ–è€…ä½¿ç”¨ ReplaySubjectã€‚å¦‚æœæº Observable å› ä¸ºäº§ç”Ÿäº†ä¸€ä¸ª error äº‹ä»¶è€Œä¸­æ­¢ï¼Œ PublishSubject å°±ä¸ä¼šå‘å‡ºä»»ä½•å…ƒç´ ï¼Œè€Œæ˜¯å°†è¿™ä¸ª error äº‹ä»¶å‘é€å‡ºæ¥ã€‚ 123456789101112131415161718192021222324let disposeBag = DisposeBag()let subject = PublishSubject&lt;String&gt;()subject .subscribe &#123; print(&quot;Subscription: 1 Event:&quot;, $0) &#125; .disposed(by: disposeBag)subject.onNext(&quot;ğŸ¶&quot;)subject.onNext(&quot;ğŸ±&quot;)subject .subscribe &#123; print(&quot;Subscription: 2 Event:&quot;, $0) &#125; .disposed(by: disposeBag)subject.onNext(&quot;ğŸ…°ï¸&quot;)subject.onNext(&quot;ğŸ…±ï¸&quot;)è¾“å‡ºç»“æœï¼šSubscription: 1 Event: next(ğŸ¶)Subscription: 1 Event: next(ğŸ±)Subscription: 1 Event: next(ğŸ…°ï¸)Subscription: 2 Event: next(ğŸ…°ï¸)Subscription: 1 Event: next(ğŸ…±ï¸)Subscription: 2 Event: next(ğŸ…±ï¸) ReplaySubjectReplaySubject å°†å¯¹è§‚å¯Ÿè€…å‘é€å…¨éƒ¨çš„å…ƒç´ ï¼Œæ— è®ºè§‚å¯Ÿè€…æ˜¯ä½•æ—¶è¿›è¡Œè®¢é˜…çš„ã€‚è¿™é‡Œå­˜åœ¨å¤šä¸ªç‰ˆæœ¬çš„ ReplaySubjectï¼Œæœ‰çš„åªä¼šå°†æœ€æ–°çš„ n ä¸ªå…ƒç´ å‘é€ç»™è§‚å¯Ÿè€…ï¼Œæœ‰çš„åªä¼šå°†é™åˆ¶æ—¶é—´æ®µå†…æœ€æ–°çš„å…ƒç´ å‘é€ç»™è§‚å¯Ÿè€…ã€‚å¦‚æœæŠŠ ReplaySubject å½“ä½œè§‚å¯Ÿè€…æ¥ä½¿ç”¨ï¼Œæ³¨æ„ä¸è¦åœ¨å¤šä¸ªçº¿ç¨‹è°ƒç”¨ onNext, onError æˆ– onCompletedã€‚è¿™æ ·ä¼šå¯¼è‡´æ— åºè°ƒç”¨ï¼Œå°†é€ æˆæ„æƒ³ä¸åˆ°çš„ç»“æœã€‚ 12345678910111213141516171819202122232425let disposeBag = DisposeBag()let subject = ReplaySubject&lt;String&gt;.create(bufferSize: 1)subject .subscribe &#123; print(&quot;Subscription: 1 Event:&quot;, $0) &#125; .disposed(by: disposeBag)subject.onNext(&quot;ğŸ¶&quot;)subject.onNext(&quot;ğŸ±&quot;)subject .subscribe &#123; print(&quot;Subscription: 2 Event:&quot;, $0) &#125; .disposed(by: disposeBag)subject.onNext(&quot;ğŸ…°ï¸&quot;)subject.onNext(&quot;ğŸ…±ï¸&quot;)è¾“å‡ºç»“æœï¼šSubscription: 1 Event: next(ğŸ¶)Subscription: 1 Event: next(ğŸ±)Subscription: 2 Event: next(ğŸ±)Subscription: 1 Event: next(ğŸ…°ï¸)Subscription: 2 Event: next(ğŸ…°ï¸)Subscription: 1 Event: next(ğŸ…±ï¸)Subscription: 2 Event: next(ğŸ…±ï¸) BehaviorSubjectå½“è§‚å¯Ÿè€…å¯¹ BehaviorSubject è¿›è¡Œè®¢é˜…æ—¶ï¼Œå®ƒä¼šå°†æº Observable ä¸­æœ€æ–°çš„å…ƒç´ å‘é€å‡ºæ¥ï¼ˆå¦‚æœä¸å­˜åœ¨æœ€æ–°çš„å…ƒç´ ï¼Œå°±å‘å‡ºé»˜è®¤å…ƒç´ ï¼‰ã€‚ç„¶åå°†éšåäº§ç”Ÿçš„å…ƒç´ å‘é€å‡ºæ¥ã€‚å¦‚æœæº Observable å› ä¸ºäº§ç”Ÿäº†ä¸€ä¸ª error äº‹ä»¶è€Œä¸­æ­¢ï¼Œ BehaviorSubject å°±ä¸ä¼šå‘å‡ºä»»ä½•å…ƒç´ ï¼Œè€Œæ˜¯å°†è¿™ä¸ª error äº‹ä»¶å‘é€å‡ºæ¥ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940let disposeBag = DisposeBag()let subject = BehaviorSubject(value: &quot;ğŸ”´&quot;)subject .subscribe &#123; print(&quot;Subscription: 1 Event:&quot;, $0) &#125; .disposed(by: disposeBag)subject.onNext(&quot;ğŸ¶&quot;)subject.onNext(&quot;ğŸ±&quot;)subject .subscribe &#123; print(&quot;Subscription: 2 Event:&quot;, $0) &#125; .disposed(by: disposeBag)subject.onNext(&quot;ğŸ…°ï¸&quot;)subject.onNext(&quot;ğŸ…±ï¸&quot;)subject .subscribe &#123; print(&quot;Subscription: 3 Event:&quot;, $0) &#125; .disposed(by: disposeBag)subject.onNext(&quot;ğŸ&quot;)subject.onNext(&quot;ğŸŠ&quot;)è¾“å‡ºç»“æœï¼šSubscription: 1 Event: next(ğŸ”´)Subscription: 1 Event: next(ğŸ¶)Subscription: 1 Event: next(ğŸ±)Subscription: 2 Event: next(ğŸ±)Subscription: 1 Event: next(ğŸ…°ï¸)Subscription: 2 Event: next(ğŸ…°ï¸)Subscription: 1 Event: next(ğŸ…±ï¸)Subscription: 2 Event: next(ğŸ…±ï¸)Subscription: 3 Event: next(ğŸ…±ï¸)Subscription: 1 Event: next(ğŸ)Subscription: 2 Event: next(ğŸ)Subscription: 3 Event: next(ğŸ)Subscription: 1 Event: next(ğŸŠ)Subscription: 2 Event: next(ğŸŠ)Subscription: 3 Event: next(ğŸŠ) Variableåœ¨ Swift ä¸­æˆ‘ä»¬ç»å¸¸ä¼šç”¨ var å…³é”®å­—æ¥å£°æ˜å˜é‡.RxSwift æä¾›çš„ Variable å®é™…ä¸Šæ˜¯ var çš„ Rx ç‰ˆæœ¬ï¼Œä½ å¯ä»¥å°†å®ƒçœ‹ä½œæ˜¯ RxVar. 123456789101112131415161718192021222324252627282930313233//ä½¿ç”¨ varï¼š// åœ¨ ViewController ä¸­var model: Model? = nil &#123; didSet &#123; updateUI(with: model) &#125;&#125;override func viewDidLoad() &#123; super.viewDidLoad() model = getModel()&#125;func updateUI(with model: Model?) &#123; ... &#125;func getModel() -&gt; Model &#123; ... &#125;//ä½¿ç”¨ Variableï¼š// åœ¨ ViewController ä¸­let model: Variable&lt;Model?&gt; = Variable(nil)override func viewDidLoad() &#123; super.viewDidLoad() model.asObservable() .subscribe(onNext: &#123; [weak self] model in self?.updateUI(with: model) &#125;) .disposed(by: disposeBag) model.value = getModel()&#125;func updateUI(with model: Model?) &#123; ... &#125;func getModel() -&gt; Model &#123; ... &#125; ç¬¬ä¸€ç§ä½¿ç”¨ var çš„æ–¹å¼ååˆ†å¸¸è§ï¼Œåœ¨ ViewController ä¸­ç›‘å¬ Model çš„å˜åŒ–ï¼Œç„¶ååˆ·æ–°é¡µé¢ã€‚ ç¬¬äºŒç§ä½¿ç”¨ Variable åˆ™æ˜¯ RxSwift ç‹¬æœ‰çš„ã€‚Variable å‡ ä¹æä¾›äº† var çš„æ‰€æœ‰åŠŸèƒ½ã€‚å¦å¤–ï¼ŒåŠ ä¸Šä¸€æ¡éå¸¸é‡è¦çš„ç‰¹æ€§ï¼Œå°±æ˜¯å¯ä»¥é€šè¿‡è°ƒç”¨ asObservable() æ–¹æ³•è½¬æ¢æˆåºåˆ—ã€‚ç„¶åä½ å¯ä»¥å¯¹è¿™ä¸ªåºåˆ—åº”ç”¨æ“ä½œç¬¦ï¼Œæ¥åˆæˆå…¶ä»–çš„åºåˆ—ã€‚æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬å£°æ˜çš„å˜é‡éœ€è¦æä¾› Rx æ”¯æŒï¼Œé‚£å°±é€‰ç”¨ Variable è¿™ä¸ªç±»å‹ã€‚ Variable å°è£…äº†ä¸€ä¸ª BehaviorSubjectï¼Œæ‰€ä»¥å®ƒä¼šæŒæœ‰å½“å‰å€¼ï¼Œå¹¶ä¸” Variable ä¼šå¯¹æ–°çš„è§‚å¯Ÿè€…å‘é€å½“å‰å€¼ã€‚å®ƒä¸ä¼šäº§ç”Ÿ error äº‹ä»¶ã€‚Variable åœ¨ deinit æ—¶ï¼Œä¼šå‘å‡ºä¸€ä¸ª completed äº‹ä»¶ã€‚ Disposable - å¯è¢«æ¸…é™¤çš„èµ„æºé€šå¸¸æ¥è¯´ï¼Œä¸€ä¸ªåºåˆ—å¦‚æœå‘å‡ºäº† error æˆ–è€… completed äº‹ä»¶ï¼Œé‚£ä¹ˆæ‰€æœ‰å†…éƒ¨èµ„æºéƒ½ä¼šè¢«é‡Šæ”¾ã€‚å¦‚æœä½ éœ€è¦æå‰é‡Šæ”¾è¿™äº›èµ„æºæˆ–å–æ¶ˆè®¢é˜…çš„è¯ï¼Œé‚£ä¹ˆä½ å¯ä»¥å¯¹è¿”å›çš„ å¯è¢«æ¸…é™¤çš„èµ„æºï¼ˆDisposableï¼‰ è°ƒç”¨ dispose æ–¹æ³•ï¼š 1234567891011121314var disposable: Disposable?override func viewWillAppear(_ animated: Bool) &#123; super.viewWillAppear(animated) self.disposable = textField.rx.text.orEmpty .subscribe(onNext: &#123; text in print(text) &#125;)&#125;override func viewWillDisappear(_ animated: Bool) &#123; super.viewWillDisappear(animated) self.disposable?.dispose()&#125; è°ƒç”¨ dispose æ–¹æ³•åï¼Œè®¢é˜…å°†è¢«å–æ¶ˆï¼Œå¹¶ä¸”å†…éƒ¨èµ„æºéƒ½ä¼šè¢«é‡Šæ”¾ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œä½ æ˜¯ä¸éœ€è¦æ‰‹åŠ¨è°ƒç”¨ dispose æ–¹æ³•çš„ï¼Œè¿™é‡Œåªæ˜¯åšä¸ªæ¼”ç¤ºè€Œå·²ã€‚æˆ‘ä»¬æ¨èä½¿ç”¨ æ¸…é™¤åŒ…ï¼ˆDisposeBagï¼‰ æˆ–è€… takeUntil æ“ä½œç¬¦ æ¥ç®¡ç†è®¢é˜…çš„ç”Ÿå‘½å‘¨æœŸã€‚ æ¸…é™¤åŒ…ï¼ˆDisposeBagï¼‰å› ä¸ºæˆ‘ä»¬ç”¨çš„æ˜¯ Swift ï¼Œæ‰€ä»¥æˆ‘ä»¬æ›´ä¹ æƒ¯äºä½¿ç”¨ ARC æ¥ç®¡ç†å†…å­˜ã€‚é‚£ä¹ˆæˆ‘ä»¬èƒ½ä¸èƒ½ç”¨ ARC æ¥ç®¡ç†è®¢é˜…çš„ç”Ÿå‘½å‘¨æœŸäº†ã€‚ç­”æ¡ˆæ˜¯è‚¯å®šäº†ï¼Œä½ å¯ä»¥ç”¨ æ¸…é™¤åŒ…ï¼ˆDisposeBagï¼‰ æ¥å®ç°è¿™ç§è®¢é˜…ç®¡ç†æœºåˆ¶ï¼š 123456789101112131415var disposeBag = DisposeBag()override func viewWillAppear(_ animated: Bool) &#123; super.viewWillAppear(animated) textField.rx.text.orEmpty .subscribe(onNext: &#123; text in print(text) &#125;) .disposed(by: self.disposeBag)&#125;override func viewWillDisappear(_ animated: Bool) &#123; super.viewWillDisappear(animated) self.disposeBag = DisposeBag()&#125; takeUntilå¦å¤–ä¸€ç§å®ç°è‡ªåŠ¨å–æ¶ˆè®¢é˜…çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨ takeUntil æ“ä½œç¬¦ 12345678910111213141516171819202122232425override func viewDidLoad() &#123; super.viewDidLoad() ... _ = usernameValid .takeUntil(self.rx.deallocated) .bind(to: passwordOutlet.rx.isEnabled) _ = usernameValid .takeUntil(self.rx.deallocated) .bind(to: usernameValidOutlet.rx.isHidden) _ = passwordValid .takeUntil(self.rx.deallocated) .bind(to: passwordValidOutlet.rx.isHidden) _ = everythingValid .takeUntil(self.rx.deallocated) .bind(to: doSomethingOutlet.rx.isEnabled) _ = doSomethingOutlet.rx.tap .takeUntil(self.rx.deallocated) .subscribe(onNext: &#123; [weak self] in self?.showAlert() &#125;)&#125; è¿™å°†ä½¿å¾—è®¢é˜…ä¸€ç›´æŒç»­åˆ°æ§åˆ¶å™¨çš„ dealloc äº‹ä»¶äº§ç”Ÿä¸ºæ­¢ã€‚ Schedulers - è°ƒåº¦å™¨Schedulers æ˜¯ Rx å®ç°å¤šçº¿ç¨‹çš„æ ¸å¿ƒæ¨¡å—ï¼Œå®ƒä¸»è¦ç”¨äºæ§åˆ¶ä»»åŠ¡åœ¨å“ªä¸ªçº¿ç¨‹æˆ–é˜Ÿåˆ—è¿è¡Œã€‚ 1234567891011121314151617// åå°å–å¾—æ•°æ®ï¼Œä¸»çº¿ç¨‹å¤„ç†ç»“æœDispatchQueue.global(qos: .userInitiated).async &#123; let data = try? Data(contentsOf: url) DispatchQueue.main.async &#123; self.data = data &#125;&#125;let rxData: Observable&lt;Data&gt; = ...rxData .subscribeOn(ConcurrentDispatchQueueScheduler(qos: .userInitiated)) .observeOn(MainScheduler.instance) .subscribe(onNext: &#123; [weak self] data in self?.data = data &#125;) .disposed(by: disposeBag) subscribeOnæˆ‘ä»¬ç”¨ subscribeOn æ¥å†³å®šæ•°æ®åºåˆ—çš„æ„å»ºå‡½æ•°åœ¨å“ªä¸ª Scheduler ä¸Šè¿è¡Œã€‚ä»¥ä¸Šä¾‹å­ä¸­ï¼Œç”±äºè·å– Data éœ€è¦èŠ±å¾ˆé•¿çš„æ—¶é—´ï¼Œæ‰€ä»¥ç”¨ subscribeOn åˆ‡æ¢åˆ° åå° Scheduler æ¥è·å– Dataã€‚è¿™æ ·å¯ä»¥é¿å…ä¸»çº¿ç¨‹è¢«é˜»å¡ã€‚ ä½¿ç”¨ observeOnæˆ‘ä»¬ç”¨ observeOn æ¥å†³å®šåœ¨å“ªä¸ª Scheduler ç›‘å¬è¿™ä¸ªæ•°æ®åºåˆ—ã€‚ä»¥ä¸Šä¾‹å­ä¸­ï¼Œé€šè¿‡ä½¿ç”¨ observeOn æ–¹æ³•åˆ‡æ¢åˆ°ä¸»çº¿ç¨‹æ¥ç›‘å¬å¹¶ä¸”å¤„ç†ç»“æœã€‚ ä¸€ä¸ªæ¯”è¾ƒå…¸å‹çš„ä¾‹å­å°±æ˜¯ï¼Œåœ¨åå°å‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œç„¶åè§£ææ•°æ®ï¼Œæœ€ååœ¨ä¸»çº¿ç¨‹åˆ·æ–°é¡µé¢ã€‚ä½ å°±å¯ä»¥å…ˆç”¨ subscribeOn åˆ‡åˆ°åå°å»å‘é€è¯·æ±‚å¹¶è§£ææ•°æ®ï¼Œæœ€åç”¨ observeOn åˆ‡æ¢åˆ°ä¸»çº¿ç¨‹æ›´æ–°é¡µé¢ã€‚ MainSchedulerï¼šMainScheduler ä»£è¡¨ä¸»çº¿ç¨‹ã€‚å¦‚æœä½ éœ€è¦æ‰§è¡Œä¸€äº›å’Œ UI ç›¸å…³çš„ä»»åŠ¡ï¼Œå°±éœ€è¦åˆ‡æ¢åˆ°è¯¥ Scheduler è¿è¡Œã€‚ SerialDispatchQueueSchedulerï¼šSerialDispatchQueueScheduler æŠ½è±¡äº†ä¸²è¡Œ DispatchQueueã€‚å¦‚æœä½ éœ€è¦æ‰§è¡Œä¸€äº›ä¸²è¡Œä»»åŠ¡ï¼Œå¯ä»¥åˆ‡æ¢åˆ°è¿™ä¸ª Scheduler è¿è¡Œã€‚ ConcurrentDispatchQueueSchedulerï¼šConcurrentDispatchQueueScheduler æŠ½è±¡äº†å¹¶è¡Œ DispatchQueueã€‚å¦‚æœä½ éœ€è¦æ‰§è¡Œä¸€äº›å¹¶å‘ä»»åŠ¡ï¼Œå¯ä»¥åˆ‡æ¢åˆ°è¿™ä¸ª Scheduler è¿è¡Œã€‚ OperationQueueSchedulerï¼šOperationQueueScheduler æŠ½è±¡äº† NSOperationQueueã€‚å®ƒå…·å¤‡ NSOperationQueue çš„ä¸€äº›ç‰¹ç‚¹ï¼Œä¾‹å¦‚ï¼Œä½ å¯ä»¥é€šè¿‡è®¾ç½® maxConcurrentOperationCountï¼Œæ¥æ§åˆ¶åŒæ—¶æ‰§è¡Œå¹¶å‘ä»»åŠ¡çš„æœ€å¤§æ•°é‡ã€‚ Error Handling - é”™è¯¯å¤„ç†ä¸€æ—¦åºåˆ—é‡Œé¢äº§å‡ºäº†ä¸€ä¸ª error äº‹ä»¶ï¼Œæ•´ä¸ªåºåˆ—å°†è¢«ç»ˆæ­¢ã€‚RxSwift ä¸»è¦æœ‰ä¸¤ç§é”™è¯¯å¤„ç†æœºåˆ¶ retry - é‡è¯•12345678910111213// è¯·æ±‚ JSON å¤±è´¥æ—¶ï¼Œç«‹å³é‡è¯•ï¼Œ// é‡è¯• 3 æ¬¡åä»ç„¶å¤±è´¥ï¼Œå°±å°†é”™è¯¯æŠ›å‡ºlet rxJson: Observable&lt;JSON&gt; = ...rxJson .retry(3) .subscribe(onNext: &#123; json in print(&quot;å–å¾— JSON æˆåŠŸ: \\(json)&quot;) &#125;, onError: &#123; error in print(&quot;å–å¾— JSON å¤±è´¥: \\(error)&quot;) &#125;) .disposed(by: disposeBag) å¦‚æœæˆ‘ä»¬éœ€è¦åœ¨å‘ç”Ÿé”™è¯¯æ—¶ï¼Œç»è¿‡ä¸€æ®µå»¶æ—¶åé‡è¯•ï¼Œé‚£å¯ä»¥ç”¨retryWhenï¼š 1234567891011121314151617// è¯·æ±‚ JSON å¤±è´¥æ—¶ï¼Œç­‰å¾… 5 ç§’åé‡è¯•ï¼Œ// é‡è¯• 4 æ¬¡åä»ç„¶å¤±è´¥ï¼Œå°±å°†é”™è¯¯æŠ›å‡ºlet maxRetryCount = 4 // æœ€å¤šé‡è¯• 4 æ¬¡let retryDelay: Double = 5 // é‡è¯•å»¶æ—¶ 5 ç§’rxJson .retryWhen &#123; (rxError: Observable&lt;Error&gt;) -&gt; Observable&lt;Int&gt; in return rxError.flatMapWithIndex &#123; (error, index) -&gt; Observable&lt;Int&gt; in guard index &lt; maxRetryCount else &#123; return Observable.error(error) &#125; return Observable&lt;Int&gt;.timer(retryDelay, scheduler: MainScheduler.instance) &#125; &#125; .subscribe(...) .disposed(by: disposeBag) æˆ‘ä»¬è¿™é‡Œè¦å®ç°çš„æ˜¯ï¼Œå¦‚æœé‡è¯•è¶…è¿‡ 4 æ¬¡ï¼Œå°±å°†é”™è¯¯æŠ›å‡ºã€‚å¦‚æœé”™è¯¯åœ¨ 4 æ¬¡ä»¥å†…æ—¶ï¼Œå°±ç­‰å¾… 5 ç§’åé‡è¯•ï¼Œæˆ‘ä»¬ç”¨ flatMapWithIndex è¿™ä¸ªæ“ä½œç¬¦ï¼Œå› ä¸ºå®ƒå¯ä»¥ç»™æˆ‘ä»¬æä¾›é”™è¯¯çš„ç´¢å¼•æ•° indexã€‚ç„¶åç”¨è¿™ä¸ªç´¢å¼•æ•°åˆ¤æ–­æ˜¯å¦è¶…è¿‡æœ€å¤§é‡è¯•æ•°ï¼Œå¦‚æœè¶…è¿‡äº†ï¼Œå°±å°†é”™è¯¯æŠ›å‡ºã€‚å¦‚æœæ²¡æœ‰è¶…è¿‡ï¼Œå°±ç­‰å¾… 5 ç§’åé‡è¯•ã€‚ catchError - æ¢å¤catchError å¯ä»¥åœ¨é”™è¯¯äº§ç”Ÿæ—¶ï¼Œç”¨ä¸€ä¸ªå¤‡ç”¨å…ƒç´ æˆ–è€…ä¸€ç»„å¤‡ç”¨å…ƒç´ å°†é”™è¯¯æ›¿æ¢æ‰ï¼š 12345678910searchBar.rx.text.orEmpty ... .flatMapLatest &#123; query -&gt; Observable&lt;[Repository]&gt; in ... return searchGitHub(query) .catchErrorJustReturn([]) &#125; ... .bind(to: ...) .disposed(by: disposeBag) Result1234567891011121314151617// å½“ç”¨æˆ·ç‚¹å‡»æ›´æ–°æŒ‰é’®æ—¶ï¼Œ// å°±ç«‹å³å–å‡ºä¿®æ”¹åçš„ç”¨æˆ·ä¿¡æ¯ã€‚// ç„¶åå‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œè¿›è¡Œæ›´æ–°æ“ä½œï¼Œ// ä¸€æ—¦æ“ä½œå¤±è´¥å°±æç¤ºç”¨æˆ·å¤±è´¥åŸå› updateUserInfoButton.rx.tap .withLatestFrom(rxUserInfo) .flatMapLatest &#123; userInfo -&gt; Observable&lt;Void&gt; in return update(userInfo) &#125; .observeOn(MainScheduler.instance) .subscribe(onNext: &#123; print(&quot;ç”¨æˆ·ä¿¡æ¯æ›´æ–°æˆåŠŸ&quot;) &#125;, onError: &#123; error in print(&quot;ç”¨æˆ·ä¿¡æ¯æ›´æ–°å¤±è´¥ï¼š \\(error.localizedDescription)&quot;) &#125;) .disposed(by: disposeBag) è¿™æ ·å®ç°æ˜¯éå¸¸ç›´æ¥çš„ã€‚ä½†æ˜¯ä¸€æ—¦ç½‘ç»œè¯·æ±‚æ“ä½œå¤±è´¥äº†ï¼Œåºåˆ—å°±ä¼šç»ˆæ­¢ã€‚æ•´ä¸ªè®¢é˜…å°†è¢«å–æ¶ˆã€‚å¦‚æœç”¨æˆ·å†æ¬¡ç‚¹å‡»æ›´æ–°æŒ‰é’®ï¼Œå°±æ— æ³•å†æ¬¡å‘èµ·ç½‘ç»œè¯·æ±‚è¿›è¡Œæ›´æ–°æ“ä½œäº†ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦é€‰æ‹©åˆé€‚çš„æ–¹æ¡ˆæ¥è¿›è¡Œé”™è¯¯å¤„ç†ã€‚ä¾‹å¦‚ä½¿ç”¨æšä¸¾ Resultï¼š 1234567891011121314151617181920212223// è‡ªå®šä¹‰ä¸€ä¸ªæšä¸¾ç±»å‹ Resultpublic enum Result&lt;T&gt; &#123; case success(T) case failure(Swift.Error)&#125;updateUserInfoButton.rx.tap .withLatestFrom(rxUserInfo) .flatMapLatest &#123; userInfo -&gt; Observable&lt;Result&lt;Void&gt;&gt; in return update(userInfo) .map(Result.success) // è½¬æ¢æˆ Result .catchError &#123; error in Observable.just(Result.failure(error)) &#125; &#125; .observeOn(MainScheduler.instance) .subscribe(onNext: &#123; result in switch result &#123; // å¤„ç† Result case .success: print(&quot;ç”¨æˆ·ä¿¡æ¯æ›´æ–°æˆåŠŸ&quot;) case .failure(let error): print(&quot;ç”¨æˆ·ä¿¡æ¯æ›´æ–°å¤±è´¥ï¼š \\(error.localizedDescription)&quot;) &#125; &#125;) .disposed(by: disposeBag) è¿™æ ·æˆ‘ä»¬çš„é”™è¯¯äº‹ä»¶è¢«åŒ…è£…æˆäº† Result.failure(Error) å…ƒç´ ï¼Œå°±ä¸ä¼šç»ˆæ­¢æ•´ä¸ªåºåˆ—ã€‚å°±ç®—ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œæ•´ä¸ªè®¢é˜…ä¾ç„¶å­˜åœ¨ã€‚å¦‚æœç”¨æˆ·å†æ¬¡ç‚¹å‡»æ›´æ–°æŒ‰é’®ï¼Œä¹Ÿæ˜¯èƒ½å¤Ÿå‘èµ·ç½‘ç»œè¯·æ±‚è¿›è¡Œæ›´æ–°æ“ä½œçš„ã€‚","path":"2017/10/20/RxSwiftæ ¸å¿ƒæ¦‚å¿µ/","date":"10-20","excerpt":""},{"title":"è·¯ç”±åè®®","text":"é¡¹ç›®ç»„ä»¶åŒ–çš„å¥½å¤„éšç€å·¥ç¨‹çš„ä»£ç çš„å¢åŠ ï¼Œä¸šåŠ¡é€»è¾‘ä¹Ÿè¶Šæ¥è¶Šå¤æ‚ä»¥åŠå¼€å‘äººå‘˜çš„å¢å¤š.è‡´ä½¿é¡¹ç›®å„ä¸ªæ¨¡å—ä¹‹é—´è€¦åˆæ€§å¾ˆå¼º.ç»„ä»¶åŒ–çš„ç›®çš„å°±æ˜¯é‡ç”¨é«˜åº¦æŠ½è±¡åŒ–ä»£ç å•å…ƒ. é¡¹ç›®ç»„ä»¶åŒ–çš„å®æ–½ ä½¿ç”¨Cocoapodsçš„æ¨¡å—åŒ–åŠŸèƒ½, å°†ä¸€äº›é€šç”¨çš„ç±», å·¥å…·ç±», å°è£…æˆç§æœ‰çš„Pod(å‚è€ƒè¿™é‡Œ). è¿™æ ·ä¸€æ¥, å°±æŠŠåŸºç¡€ä»£ç ä»é¡¹ç›®ä¸­æŠ½ç¦»å‡ºæ¥, å…¶ä»–çš„é¡¹ç›®è¦æƒ³ä½¿ç”¨, åªéœ€ä¾èµ–æˆ‘ä»¬çš„ç§æœ‰Podå°±å¯ä»¥äº†. é€šè¿‡è·¯ç”±åè®®, ç›¸å½“äºæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¸­é—´å±‚æ¥è½¬å‘æˆ‘ä»¬ç»„ä»¶ä¸ç»„ä»¶ä¹‹é—´çš„é€šä¿¡, è¿™æ ·å°±å®ç°äº†ç»„ä»¶ä¹‹é—´çš„è§£è€¦, è€Œç»„ä»¶å†…éƒ¨åˆæ˜¯å®Œæ•´çš„ä¸šåŠ¡é€»è¾‘, å±äºé«˜å†…èš, ä½è€¦åˆ. è·¯ç”±åè®®çš„å¥½å¤„ å¤–éƒ¨è·³è½¬åˆ°Appå†…éƒ¨ä¸€ä¸ªå¾ˆæ·±å±‚æ¬¡çš„ä¸€ä¸ªç•Œé¢. Appä¹‹é—´çš„ç›¸äº’è·³è½¬. è§£é™¤Appç»„ä»¶ä¹‹é—´å’ŒAppé¡µé¢ä¹‹é—´çš„è€¦åˆæ€§. ç»Ÿä¸€iOSå’ŒAndroidä¸¤ç«¯çš„é¡µé¢è·³è½¬é€»è¾‘, ç»Ÿä¸€ä¸‰ç«¯çš„è¯·æ±‚èµ„æºçš„æ–¹å¼. iOSå’ŒAndroidä¸¤è¾¹åªè¦å…±ç”¨ä¸€å¥—åŠ¨æ€ä¸‹å‘é…ç½®æ–‡ä»¶æ¥é…ç½®Appçš„è·³è½¬é€»è¾‘. åœ¨Appä»»ä½•ç•Œé¢éƒ½å¯ä»¥è°ƒç”¨ä»»æ„ä¸€ä¸ªç•Œé¢æˆ–è€…ä»»æ„ä¸€ä¸ªç»„ä»¶. å‚è€ƒèµ„æ–™ è˜‘è‡è¡—Appçš„ç»„ä»¶åŒ–ä¹‹è·¯ è˜‘è‡è¡—Appçš„ç»„ä»¶åŒ–ä¹‹è·¯.ç»­ iOSåº”ç”¨æ¶æ„è°ˆ ç»„ä»¶åŒ–æ–¹æ¡ˆ iOSç»„ä»¶åŒ–æ–¹æ¡ˆæ¢è®¨ iOS ç»„ä»¶åŒ– â€”â€” è·¯ç”±è®¾è®¡æ€è·¯åˆ†æ","path":"2017/10/14/iOSç»„ä»¶åŒ–/","date":"10-14","excerpt":""},{"title":"å¤šçº¿ç¨‹ä½¿ç”¨","text":"æ­»é”1234567dispatch_queue_t queue = dispatch_get_main_queue(); dispatch_sync(queue, ^&#123; NSLog(@&quot;ä»»åŠ¡1...%@&quot;,[NSThread currentThread]);&#125;); NSLog(@&quot;ä»»åŠ¡2...%@&quot;,[NSThread currentThread]); ä»¥ä¸Šqueueä¸ºä¸»é˜Ÿåˆ—æ‰€ä»¥dispatch_syncé»˜è®¤åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œï¼Œdispatch_syncåˆæ˜¯åŒæ­¥æ‰€ä»¥ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼ˆä¸»çº¿ç¨‹ï¼‰ï¼Œè€Œä¸»é˜Ÿåˆ—åˆæ˜¯ä¸²è¡Œé˜Ÿåˆ—ï¼Œæ‰€ä»¥ä»»åŠ¡åªèƒ½æŒ‰ç…§é¡ºåºæ‰§è¡Œ.è¿™å°±é€ æˆäº†dispatch_syncé˜»å¡å°†ä»»åŠ¡1åŠ å…¥é˜Ÿåˆ—æ”¾åˆ°ä»»åŠ¡2åé¢ï¼Œç­‰å¾…ä»»åŠ¡2æ‰§è¡Œå®Œæ¯•æ‰èƒ½æ‰§è¡Œï¼Œè€Œä»»åŠ¡2åˆåœ¨ç­‰dispatch_syncä¸­çš„ä»»åŠ¡1æ‰§è¡Œå®Œæ¯•æ‰èƒ½æ‰§è¡Œã€‚æœ€åå½¢æˆä»»åŠ¡äº’ç›¸ç­‰å¾…çš„ç»“å±€ï¼Œé€ æˆäº†æ­»é”. GCDå‘ä¸²è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡123456789101112131415161718//åˆ›å»ºä¸²è¡Œé˜Ÿåˆ—, ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºä¸²è¡Œé˜Ÿåˆ—çš„åç§°, ç¬¬äºŒä¸ªå‚æ•°ä¸ºé˜Ÿåˆ—çš„å±æ€§, NULLæˆ–è€…DISPATCH_QUEUE_SERIALè¡¨ç¤ºæ˜¯ä¸²è¡Œé˜Ÿåˆ— dispatch_queue_t queue = dispatch_queue_create(&quot;com.levinluo.thread&quot;, NULL); //å‘é˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡ dispatch_async(queue, ^&#123; NSLog(@&quot;ä¸‹è½½å›¾ç‰‡1----%@&quot;, [NSThread currentThread]); sleep(5); &#125;); //å‘é˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡ dispatch_async(queue, ^&#123; NSLog(@&quot;ä¸‹è½½å›¾ç‰‡2----%@&quot;, [NSThread currentThread]); &#125;); //å‘é˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡ dispatch_async(queue, ^&#123; NSLog(@&quot;ä¸‹è½½å›¾ç‰‡3----%@&quot;, [NSThread currentThread]); &#125;); è¯¥è¿‡ç¨‹ä¸€å…±åˆ†ä¸ºä¸¤æ­¥, ç¬¬ä¸€æ­¥åˆ›å»ºä¸²è¡Œé˜Ÿåˆ—, ç¬¬äºŒæ­¥å‘ä¸²è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡. ä»»åŠ¡ä¼šéµå®ˆFIFOåŸåˆ™æ¥æ‰§è¡Œ, æ¯ä¸ªä»»åŠ¡ä½•æ—¶æ‰§è¡Œå®Œæˆ‘ä»¬å´å¹¶ä¸çŸ¥é“. ä½†æ˜¯ç”±äºæˆ‘ä»¬æ˜¯åœ¨ä¸²è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ çš„ä»»åŠ¡, æ‰€æœ‰ä»»åŠ¡åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œ, æ‰€æœ‰çš„å¼‚æ­¥ä»»åŠ¡ä¼šæŒ‰ç…§é¡ºåºå‰ä¸€ä¸ªæ‰§è¡Œå®Œæ¯•å†æ‰§è¡Œåä¸€ä¸ª. GCDå‘ä¸²è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ åŒæ­¥ä»»åŠ¡123456789101112131415161718//åˆ›å»ºä¸²è¡Œé˜Ÿåˆ—, ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºä¸²è¡Œé˜Ÿåˆ—çš„åç§°, ç¬¬äºŒä¸ªå‚æ•°ä¸ºé˜Ÿåˆ—çš„å±æ€§, NULLæˆ–è€…DISPATCH_QUEUE_SERIALè¡¨ç¤ºæ˜¯ä¸²è¡Œé˜Ÿåˆ— dispatch_queue_t queue = dispatch_queue_create(&quot;com.levinluo.thread&quot;, NULL); //å‘é˜Ÿåˆ—ä¸­æ·»åŠ åŒæ­¥ä»»åŠ¡ dispatch_sync(queue, ^&#123; NSLog(@&quot;ä¸‹è½½å›¾ç‰‡1----%@&quot;, [NSThread currentThread]); sleep(5); &#125;); //å‘é˜Ÿåˆ—ä¸­æ·»åŠ åŒæ­¥ä»»åŠ¡ dispatch_sync(queue, ^&#123; NSLog(@&quot;ä¸‹è½½å›¾ç‰‡2----%@&quot;, [NSThread currentThread]); &#125;); //å‘é˜Ÿåˆ—ä¸­æ·»åŠ åŒæ­¥ä»»åŠ¡ dispatch_sync(queue, ^&#123; NSLog(@&quot;ä¸‹è½½å›¾ç‰‡3----%@&quot;, [NSThread currentThread]); &#125;); è¯¥è¿‡ç¨‹ä¸€å…±åˆ†ä¸ºä¸¤æ­¥, ç¬¬ä¸€æ­¥åˆ›å»ºä¸²è¡Œé˜Ÿåˆ—, ç¬¬äºŒæ­¥å‘ä¸²è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ åŒæ­¥ä»»åŠ¡. ä»»åŠ¡ä¼šéµå®ˆFIFOåŸåˆ™æ¥æ‰§è¡Œ, æ¯ä¸ªä»»åŠ¡ä½•æ—¶æ‰§è¡Œå®Œæˆ‘ä»¬å´å¹¶ä¸çŸ¥é“. ä½†æ˜¯ç”±äºæˆ‘ä»¬æ˜¯åœ¨ä¸²è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ çš„ä»»åŠ¡, æ‰€æœ‰ä»»åŠ¡åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œ, æ‰€æœ‰çš„å¼‚æ­¥ä»»åŠ¡ä¼šæŒ‰ç…§é¡ºåºå‰ä¸€ä¸ªæ‰§è¡Œå®Œæ¯•å†æ‰§è¡Œåä¸€ä¸ª.æ³¨æ„ï¼Œå¦‚æœè¿™é‡Œæ˜¯ä¸»é˜Ÿåˆ—çš„è¯å°±ä¼šé€ æˆæ­»é”. GCDå‘å¹¶è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡123456789101112131415161718//è·å–ç³»ç»Ÿæä¾›çš„å…¨å±€é˜Ÿåˆ— dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0); //å‘é˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡ dispatch_async(queue, ^&#123; NSLog(@&quot;ä¸‹è½½å›¾ç‰‡1----%@&quot;, [NSThread currentThread]); sleep(5); &#125;); //å‘é˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡ dispatch_async(queue, ^&#123; NSLog(@&quot;ä¸‹è½½å›¾ç‰‡2----%@&quot;, [NSThread currentThread]); &#125;); //å‘é˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡ dispatch_async(queue, ^&#123; NSLog(@&quot;ä¸‹è½½å›¾ç‰‡3----%@&quot;, [NSThread currentThread]); &#125;); è¯¥è¿‡ç¨‹ä¸€å…±åˆ†ä¸ºä¸¤æ­¥, ç¬¬ä¸€æ­¥è·å–ç³»ç»Ÿæä¾›çš„å…¨å±€å¹¶è¡Œé˜Ÿåˆ—, ç¬¬äºŒæ­¥å‘å¹¶è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡. ä»»åŠ¡ä¼šéµå®ˆFIFOåŸåˆ™æ¥æ‰§è¡Œ, ä½†æ˜¯æ¯ä¸ªä»»åŠ¡ä½•æ—¶æ‰§è¡Œå®Œæˆ‘ä»¬å´å¹¶ä¸çŸ¥é“. ä½†æ˜¯ç³»ç»Ÿä¼šæ–°å¼€çº¿ç¨‹æ¥æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡, ä¸‰ä¸ªå¼‚æ­¥ä»»åŠ¡ä¼šåˆ†åˆ«åœ¨ä¸‰ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œ, å„ä¸ªä»»åŠ¡çš„æ‰§è¡Œé¡ºåºæ— æ³•ç¡®å®š. GCDå‘å¹¶è¡Œé˜Ÿåˆ—æ·»åŠ åŒæ­¥ä»»åŠ¡1234567891011121314151617dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0); //å‘é˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡ dispatch_sync(queue, ^&#123; NSLog(@&quot;ä¸‹è½½å›¾ç‰‡1----%@&quot;, [NSThread currentThread]); sleep(5); &#125;); //å‘é˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡ dispatch_sync(queue, ^&#123; NSLog(@&quot;ä¸‹è½½å›¾ç‰‡2----%@&quot;, [NSThread currentThread]); &#125;); //å‘é˜Ÿåˆ—ä¸­æ·»åŠ å¼‚æ­¥ä»»åŠ¡ dispatch_sync(queue, ^&#123; NSLog(@&quot;ä¸‹è½½å›¾ç‰‡3----%@&quot;, [NSThread currentThread]); &#125;); è¯¥è¿‡ç¨‹ä¸€å…±åˆ†ä¸ºä¸¤æ­¥, ç¬¬ä¸€æ­¥è·å–ç³»ç»Ÿæä¾›çš„å…¨å±€å¹¶è¡Œé˜Ÿåˆ—, ç¬¬äºŒæ­¥å‘å¹¶è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ åŒæ­¥ä»»åŠ¡. ä»»åŠ¡ä¼šéµå®ˆFIFOåŸåˆ™æ¥æ‰§è¡Œ, æ¯ä¸ªä»»åŠ¡ä½•æ—¶æ‰§è¡Œå®Œæˆ‘ä»¬å´å¹¶ä¸çŸ¥é“. è™½ç„¶æ˜¯å¹¶è¡Œé˜Ÿåˆ—, å•ç”±äºæ·»åŠ çš„æ˜¯åŒæ­¥ä»»åŠ¡, ä¸ä¼šæ–°å¼€çº¿ç¨‹, å…¨éƒ½åœ¨å½“å‰çº¿ç¨‹ä¸­æ‰§è¡Œ, æ‰€ä»¥ä¸‰ä¸ªä»»åŠ¡ä¼šé¡ºåºæ‰§è¡Œ, å¹¶è¡Œé˜Ÿåˆ—å¤±å»äº†å¹¶è¡Œçš„èƒ½åŠ›. Dispatch Groupåˆ†ç»„æ¨¡å¼ dispatch_group_notify. å¯ä»¥å¼‚æ­¥æ‰§è¡Œå¤šä¸ªè€—æ—¶æ“ä½œ. ç­‰è€—æ—¶æ“ä½œéƒ½æ‰§è¡Œå®Œæ¯•ä¹‹åä¼šå›åˆ°ä¸»çº¿ç¨‹æ‰§è¡Œæ“ä½œ, ä¸»è¦ç”¨äºç›‘å¬ä»»åŠ¡æ˜¯å¦å®Œæˆ. ä¸»è¦æœ‰ä¸¤ç§ç”¨æ³•: ç¬¬ä¸€ç§ç”¨æ³•æ˜¯é€šè¿‡dispatch_group_async, é¦–å…ˆåˆ›å»ºä¸€ä¸ªå…¨å±€å¹¶è¡Œé˜Ÿåˆ—å’Œä¸€ä¸ªgroupé˜Ÿåˆ—ç»„, å†æ¬¡åˆ›å»ºå¼‚æ­¥groupä»»åŠ¡åŠ å…¥åˆ°å‰é¢åˆ›å»ºçš„groupé˜Ÿåˆ—ä¸­å». å½“æ‰€æœ‰å¼‚æ­¥ä»»åŠ¡å®Œæˆå, ä¼šé€šè¿‡dispatch_group_notifyå›åˆ°ä¸»çº¿ç¨‹. 123456789101112131415161718192021222324//è·å–å…¨å±€é˜Ÿåˆ— dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0); //åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—ç»„ dispatch_group_t group = dispatch_group_create(); dispatch_group_async(group, queue, ^&#123; NSLog(@&quot;--- 1 å¼€å§‹--- %@&quot;, [NSThread currentThread]); //å»¶æ—¶5ç§’ æ¨¡ä»¿å µå¡å­çº¿ç¨‹ [NSThread sleepForTimeInterval:5]; NSLog(@&quot;--- 1 --- å®Œæˆ %@&quot;, [NSThread currentThread]); &#125;); dispatch_group_async(group, queue, ^&#123; NSLog(@&quot;--- 2 å¼€å§‹--- %@&quot;, [NSThread currentThread]); //å»¶æ—¶5ç§’ æ¨¡ä»¿å µå¡å­çº¿ç¨‹ [NSThread sleepForTimeInterval:5]; NSLog(@&quot;--- 2 --- å®Œæˆ %@&quot;, [NSThread currentThread]); &#125;); //åœ¨è¿™ä¸ªé˜Ÿåˆ—ç»„é‡Œé¢ï¼Œä¼šç­‰groupä¸­çš„å…¨éƒ¨ä»£ç æ‰§è¡Œå®Œæ¯•å†å»æ‰§è¡Œå…¶å®ƒçš„æ“ä½œ dispatch_group_notify(group, dispatch_get_main_queue(), ^&#123; // ç­‰å‰é¢çš„å¼‚æ­¥æ“ä½œéƒ½æ‰§è¡Œå®Œæ¯•åï¼Œå›åˆ°ä¸»çº¿ç¨‹... NSLog(@&quot;å…¨éƒ¨å®Œæˆ&quot;); &#125;); ç¬¬äºŒç§ç”¨æ³•æ˜¯é€šè¿‡ä¿¡å·é‡dispatch_group_enter å’Œ dispatch_group_leave. åˆ›å»ºä¸€ä¸ªå¹¶è¡Œçº¿ç¨‹å’Œå¤šä¸ªå¼‚æ­¥ä»»åŠ¡, å°†å¼‚æ­¥ä»»åŠ¡æ·»åŠ åˆ°å¹¶è¡Œçº¿ç¨‹ä¸­åŒº. é€šè¿‡dispatch_group_enteræ¥å‘ŠçŸ¥groupä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡å¼€å§‹, æœªæ‰§è¡Œå®Œæ¯•ä»»åŠ¡æ•°åŠ 1. åœ¨å¼‚æ­¥çº¿ç¨‹ä»»åŠ¡æ‰§è¡Œå®Œæ¯•æ—¶, é€šè¿‡dispatch_group_leaveå‘ŠçŸ¥group, ä¸€ä¸ªä»»åŠ¡ç»“æŸ, æœªæ‰§è¡Œå®Œæ¯•ä»»åŠ¡æ•°å‡1. å½“æœªæ‰§è¡Œå®Œæ¯•ä»»åŠ¡æ•°ä¸º0çš„æ—¶å€™, è¿™æ—¶groupæ‰è®¤ä¸ºç»„å†…ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæ¯•äº†(è¿™ä¸ªå’ŒGCDçš„ä¿¡å·é‡çš„æœºåˆ¶æœ‰äº›ç›¸ä¼¼), è¿™æ—¶å€™æ‰ä¼šå›è°ƒdispatch_group_notifyä¸­çš„block. æ­¤å¤„éœ€è¦æ³¨æ„, dispatch_group_enterå’Œdispatch_group_leaveçš„æ•°é‡ä¸€å®šè¦ä¸€è‡´. 1234567891011121314151617181920dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0); dispatch_group_t group = dispatch_group_create(); dispatch_group_enter(group); dispatch_async(queue, ^&#123; sleep(2); //è¿™é‡Œçº¿ç¨‹ç¡çœ 1ç§’é’Ÿï¼Œæ¨¡æ‹Ÿå¼‚æ­¥è¯·æ±‚ NSLog(@&quot;%@ one finish&quot;, [NSThread currentThread]); dispatch_group_leave(group); &#125;); dispatch_group_enter(group); dispatch_async(queue, ^&#123; sleep(2); //è¿™é‡Œçº¿ç¨‹ç¡çœ 1ç§’é’Ÿï¼Œæ¨¡æ‹Ÿå¼‚æ­¥è¯·æ±‚ NSLog(@&quot;%@ two finish&quot;, [NSThread currentThread]); dispatch_group_leave(group); &#125;); dispatch_group_notify(group, queue, ^&#123; NSLog(@&quot;group finished&quot;); &#125;); GCDå»¶æ—¶æ“ä½œ(dispatch_after)ä½¿ç”¨å¾ˆç®€å•, ä¸¤ä¸ªæ ¸å¿ƒçš„å¯¹è±¡dispatch_time_tå’Œdispatch_after. å¤§å®¶éƒ½ç»å¸¸ä½¿ç”¨, ä¸ç”¨å¤šè¯´. ä¸‹é¢çš„ä»£ç å’Œåœ¨3å¦™æ‰‹ç”¨dispatch_asyncå‡½æ•°è¿½åŠ blockåˆ°ä¸»çº¿ç¨‹çš„æ“ä½œæ˜¯ç›¸åŒçš„ 123456double delayInSeconds = 2.0; dispatch_time_t popTime = dispatch_time(DISPATCH_TIME_NOW, (int64_t) (delayInSeconds * NSEC_PER_SEC)); //ç¬¬ä¸€ä¸ªå‚æ•°ä»£è¡¨æ—¶é—´, ç¬¬äºŒå„å‚æ•°ä»£è¡¨è¦åœ¨å“ªä¸ªçº¿ç¨‹æ‰§è¡Œæ¥ä¸‹æ¥çš„ä»»åŠ¡, ç¬¬ä¸‰ä¸ªå‚æ•°å°±æ˜¯ä»»åŠ¡block dispatch_after(popTime, dispatch_get_main_queue(), ^(void)&#123; NSLog(@&quot;%@&quot;, [NSThread currentThread]); &#125;); GCDå•ä¾‹12345678910111213@interface Tool : NSObject+ (instancetype)sharedTool;@end@implementation Toolstatic id _instance;+ (instancetype)sharedTool &#123; static dispatch_once_t onceToken; dispatch_once(&amp;onceToken, ^&#123; _instance = [[Tool alloc] init]; &#125;); return _instance;&#125;@end GCD çº¿ç¨‹é—´çš„é€šè®¯1234567dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0); dispatch_async(queue, ^&#123; //åœ¨è¿™é‡Œæ‰§è¡Œè€—æ—¶çš„æ“ä½œ dispatch_async(dispatch_get_main_queue(), ^&#123; //åœ¨ä¸»çº¿ç¨‹ä½¿ç”¨ä¸Šé¢æ“ä½œçš„ç»“æœ &#125;); &#125;); GCDé‡å¤æ‰§è¡ŒåŒä¸€ä¸ªä»»åŠ¡12345dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0); dispatch_apply(10, queue, ^(size_t index) &#123; //å¹¶è¡Œå¤„ç†10æ¬¡ä»»åŠ¡ NSLog(@&quot;%zu&quot;, index); &#125;); ç”±äºdispatch_applyå‡½æ•°ä¸dispatch_syncå‡½æ•°ç›¸åŒ, ä¼šç­‰å¾…ä»»åŠ¡æ‰§è¡Œç»“æŸ, æ‰€ä»¥æ¨èåœ¨dispatch_asyncå‡½æ•°ä¸­å¼‚æ­¥æ‰§è¡Œ. 12345678910111213141516dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0); //åœ¨å…¨å±€å¹¶è¡Œé˜Ÿåˆ—ä¸­å¼‚æ­¥æ‰§è¡Œ dispatch_async(queue, ^&#123; //ç­‰å¾…å‡½æ•°ä¸­æ“ä½œå…¨éƒ¨æ‰§è¡Œå®Œæ¯• dispatch_apply(10, queue, ^(size_t index) &#123; //å¹¶è¡Œå¤„ç†10æ¬¡ä»»åŠ¡ sleep(2); NSLog(@&quot;%zu&quot;, index); &#125;); //dispatch_applyä¸­çš„å¤„ç†å…¨éƒ¨ç»“æŸ, åœ¨ä¸»çº¿ç¨‹å¼‚æ­¥æ‰§è¡Œ dispatch_async(dispatch_get_main_queue(), ^&#123; NSLog(@&quot;Done&quot;); &#125;); &#125;); GCDè®¾ç½®ä¼˜å…ˆçº§1234dispatch_queue_t queue = dispatch_queue_create(&quot;test&quot;, NULL); dispatch_queue_t queue1 = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0); //æŠŠç¬¬ä¸€ä¸ªå‚æ•°çš„æ‰§è¡Œä¼˜å…ˆçº§è®¾ç½®çš„å’Œç¬¬äºŒä¸ªå‚æ•°çš„ä¼˜å…ˆçº§ä¸€è‡´. dispatch_set_target_queue(queue, queue1); GCDæ …æ å‡è®¾ä¸€ä¸ªå¹¶è¡Œé˜Ÿåˆ—ä¸­æ·»åŠ äº†äº”ä¸ªå¼‚æ­¥ä»»åŠ¡, è™½ç„¶éµå¾ªFIFOçš„åŸåˆ™, è¿™äº”ä¸ªä»»åŠ¡çš„æ‰§è¡Œå¿…å®šæ˜¯æ— åºçš„. å½“æˆ‘ä»¬åœ¨ç¬¬ä¸‰ä¸ªä»»åŠ¡ä¹‹ååŠ å…¥dispatch_barrier_asyncä»»åŠ¡, é‚£ä¹ˆè¿™äº”ä¸ªä»»åŠ¡å°±è¢«åˆ†å‰²æˆä¸¤éƒ¨åˆ†, å‰ä¸‰æ¬¡æ— åºæ‰§è¡Œ, ç„¶åæ‰§è¡Œdispatch_barrier_asyncä»»åŠ¡, ç„¶åå†æ— åºæ‰§è¡Œåä¸¤æ¬¡ä»»åŠ¡. æ³¨æ„æ­¤å¤„çš„é˜Ÿåˆ—åªèƒ½ä½¿ç”¨è‡ªå®šä¹‰çš„å¹¶è¡Œé˜Ÿåˆ—, ç³»ç»Ÿæä¾›çš„å…¨å±€é˜Ÿåˆ—ä¸è¡Œ 12345678910111213141516171819202122//æ­¤å¤„çš„é˜Ÿåˆ—åªèƒ½ä½¿ç”¨è‡ªå®šä¹‰çš„å¹¶è¡Œé˜Ÿåˆ—, ç³»ç»Ÿæä¾›çš„å…¨å±€é˜Ÿåˆ—ä¸è¡Œ dispatch_queue_t queue = dispatch_queue_create(&quot;barrierTest&quot;, DISPATCH_QUEUE_CONCURRENT); dispatch_async(queue, ^&#123; NSLog(@&quot;1&quot;); &#125;); dispatch_async(queue, ^&#123; NSLog(@&quot;2&quot;); &#125;); dispatch_async(queue, ^&#123; NSLog(@&quot;3&quot;); &#125;); dispatch_barrier_async(queue, ^&#123; sleep(3); NSLog(@&quot;æ’å…¥æ‰§è¡Œ&quot;); &#125;); dispatch_async(queue, ^&#123; NSLog(@&quot;4&quot;); &#125;); dispatch_async(queue, ^&#123; NSLog(@&quot;5&quot;); &#125;); GCDä¿¡å·é‡ä¿¡å·é‡æ¥æ§åˆ¶ä»»åŠ¡çš„æ‰§è¡Œ. dispatch_semaphore_tç±»ä¼¼äºå•ä¸ªé˜Ÿåˆ—çš„æœ€å¤§å¹¶å‘æ•°æ§åˆ¶æœºåˆ¶, æé«˜å¹¶è¡Œæ•ˆç‡çš„åŒæ—¶, ä¹Ÿå¯ä»¥é˜²æ­¢å¤ªå¤šçº¿ç¨‹çš„å¼€è¾Ÿå¯¹ç³»ç»Ÿé€ æˆå¤ªå¤§çš„è´Ÿæ‹….1234567891011121314151617181920212223242526dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0); dispatch_semaphore_t semaphore = dispatch_semaphore_create(1); NSMutableArray *array = [[NSMutableArray alloc]init]; for (NSInteger i = 0; i &lt; 100000; i++) &#123; dispatch_async(queue, ^&#123; /* æ­¤æ—¶semaphoreä¿¡å·é‡çš„å€¼å¦‚æœ &gt;= 1æ—¶ï¼šå¯¹semaphoreè®¡æ•°è¿›è¡Œå‡1,ç„¶ådispatch_semaphore_wait å‡½æ•°è¿”å›ã€‚è¯¥å‡½æ•°æ‰€å¤„çº¿ç¨‹å°±ç»§ç»­æ‰§è¡Œä¸‹é¢çš„è¯­å¥ã€‚ æ­¤æ—¶semaphoreä¿¡å·é‡çš„å€¼å¦‚æœ=0ï¼šé‚£ä¹ˆå°±é˜»å¡è¯¥å‡½æ•°æ‰€å¤„çš„çº¿ç¨‹,é˜»å¡æ—¶é•¿ä¸ºtimeoutæŒ‡å®šçš„æ—¶é—´ï¼Œå¦‚æœé˜»å¡æ—¶é—´å†…semaphoreçš„å€¼è¢«dispatch_semaphore_signalå‡½æ•°åŠ 1äº†ï¼Œè¯¥å‡½æ•°æ‰€å¤„çº¿ç¨‹è·å¾—äº†ä¿¡å·é‡è¢«å”¤é†’ã€‚ç„¶åå¯¹semaphoreè®¡æ•°è¿›è¡Œå‡1å¹¶è¿”å›ï¼Œç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚ å¦‚æœé˜»å¡æ—¶é—´å†…æ²¡æœ‰è·å–åˆ°ä¿¡å·é‡å”¤é†’çº¿ç¨‹æˆ–è€…ä¿¡å·é‡çš„å€¼ä¸€ç›´ä¸º0ï¼Œé‚£ä¹ˆå°±è¦ç­‰åˆ°æŒ‡å®šçš„é˜»å¡æ—¶é—´åï¼Œè¯¥å‡½æ•°æ‰€å¤„çº¿ç¨‹æ‰ç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚ æ‰§è¡Œåˆ°è¿™é‡Œsemaphoreçš„å€¼æ€»æ˜¯1 */ dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER); /* å› ä¸ºdispatch_semaphore_createåˆ›å»ºçš„semaphoreçš„åˆå§‹å€¼ä¸º1ï¼Œæ‰§è¡Œå®Œä¸Šé¢çš„ dispatch_semaphore_waitå‡½æ•°ä¹‹åï¼Œsemaphoreè®¡æ•°å€¼å‡1ä¼šå˜ä¸º0ï¼Œæ‰€ä»¥å¯è®¿é—®arrayå¯¹è±¡çš„çº¿ç¨‹åªæœ‰1ä¸ªï¼Œå› æ­¤å¯å®‰å…¨åœ°å¯¹arrayè¿›è¡Œæ“ä½œã€‚ */ [array addObject:[NSNumber numberWithInteger:i]]; /* å¯¹arrayæ“ä½œä¹‹åï¼Œé€šè¿‡dispatch_semaphore_signalå°†semaphoreçš„è®¡æ•°å€¼åŠ 1ï¼Œæ­¤æ—¶semaphoreçš„å€¼ç”±å˜æˆäº†1ï¼Œæ‰€å¤„ */ dispatch_semaphore_signal(semaphore); &#125;); &#125; GCDå®šæ—¶å™¨12345678910111213141516171819202122NSLog(@&quot;%@&quot;, [NSThread currentThread]); //æŒ‡å®šDISPATCH_SOURCE_TYPE_TIMERç±»å‹, ä½œæˆDispatch Source //åœ¨å®šæ—¶å™¨ç»è¿‡æŒ‡å®šæ—¶é—´, æŠŠä»»åŠ¡è¿½åŠ åˆ°main queue dispatch_source_t timer = dispatch_source_create(DISPATCH_SOURCE_TYPE_TIMER, 0, 0, dispatch_get_main_queue()); //å®šæ—¶å™¨çš„ç›¸å…³è®¾ç½®, å°†å®šæ—¶å™¨è®¾ç½®ä¸º5så, ä¸æŒ‡å®šä¸ºé‡å¤, å…è®¸å»¶è¿Ÿ1s dispatch_source_set_timer(timer, dispatch_time(DISPATCH_TIME_NOW, 5ull * NSEC_PER_SEC), DISPATCH_TIME_FOREVER, 1ull * NSEC_PER_SEC); //æŒ‡å®šå®šæ—¶å™¨æŒ‡å®šæ—¶é—´å†…æ‰§è¡Œçš„å¤„ç† dispatch_source_set_event_handler(timer, ^&#123; NSLog(@&quot;wake up&quot;); dispatch_source_cancel(timer); &#125;); //å–æ¶ˆå®šæ—¶å™¨æ—¶çš„å¤„ç† dispatch_source_set_cancel_handler(timer, ^&#123; NSLog(@&quot;canceled&quot;); &#125;); //å®šæ—¶å™¨å¯åŠ¨ dispatch_resume(timer); NSOperationçš„ä¼˜å…ˆçº§NSOperationQueueä¸­NSOperationå¯¹è±¡çš„æ‰§è¡Œæ–¹å¼æ˜¯æŒ‰ç…§FIFOçš„åŸåˆ™é¡ºåºæ‰§è¡Œ, ä½†æ˜¯å¦‚æœæˆ‘ä»¬è®¾ç½®äº†ä»»åŠ¡çš„ä¼˜å…ˆçº§, é‚£ä¹ˆç³»ç»Ÿå°±ä¼šç»™ä¼˜å…ˆçº§é«˜çš„ä¼˜å…ˆåˆ†é…èµ„æº. ä¼˜å…ˆçº§ä¸€å…±æœ‰è¿™å‡ ç§, ä»é«˜åˆ°ä½ä¾æ¬¡æ’åˆ—. 1234567typedef NS_ENUM(NSInteger, NSOperationQueuePriority) &#123; NSOperationQueuePriorityVeryLow = -8L, NSOperationQueuePriorityLow = -4L, NSOperationQueuePriorityNormal = 0, NSOperationQueuePriorityHigh = 4, NSOperationQueuePriorityVeryHigh = 8&#125;; ç¤ºä¾‹ä»£ç å¦‚ä¸‹, ä¸‰ä¸ªä»»åŠ¡è¢«æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­å», è¿™ä¸‰ä¸ªä»»åŠ¡åˆ†åˆ«åœ¨ä¸‰ä¸ªçº¿ç¨‹, äº’ä¸å¹²æ‰°, ç±»ä¼¼äºGCDçš„å¼‚æ­¥å¹¶è¡Œæ¨¡å¼, å¦‚æœæˆ‘ä»¬è®¾ç½®invocationOper.queuePriority = NSOperationQueuePriorityVeryLowç†è®ºä¸Š, invocationOperä»»åŠ¡ä¼šåœ¨æœ€åæ‰§è¡Œ, ä½†æ˜¯æˆ‘ä»¬å‘ç°å¹¶æ²¡æœ‰, é‚£æ˜¯å› ä¸ºæˆ‘ä»¬æ²¡æœ‰è®¾ç½®æœ€å¤§å¹¶å‘æ•°çš„åŸå› , æˆ‘çŒœæµ‹ç³»ç»Ÿå¯èƒ½æ˜¯åšäº†æŸäº›é™åˆ¶, è™½ç„¶æ˜¯æ–°å¼€äº†çº¿ç¨‹, ä½†æ˜¯ç”±äºæœ€å¤§å¹¶å‘æ•°å°äºç­‰äº1å®é™…è¿˜æ˜¯æŒ‰ç…§FIFOé¡ºåºæ‰§è¡Œ, æ‰€ä»¥æ³¨æ„ä¸€å®šè¦è®¾ç½®æœ€å¤§å¹¶å‘æ•° 123456789101112131415161718//æŠŠæ³¨é‡Šæ‰“å¼€å°±å¯ä»¥çœ‹åˆ°æƒ³è¦çš„æ•ˆæœ- (void)NSOperationQueueRun &#123; NSOperationQueue *queue = [[NSOperationQueue alloc] init]; //queue.maxConcurrentOperationCount = 3; NSInvocationOperation *invocationOper = [[NSInvocationOperation alloc] initWithTarget:self selector:@selector(invocationOperSel) object:nil]; //invocationOper.queuePriority = NSOperationQueuePriorityVeryLow; [queue addOperation:invocationOper]; NSBlockOperation *blockOper = [NSBlockOperation blockOperationWithBlock:^&#123; NSLog(@&quot;NSBlockOperationRun_%@&quot;, [NSThread currentThread]); &#125;]; [queue addOperation:blockOper]; [queue addOperationWithBlock:^&#123; NSLog(@&quot;QUEUEBlockOperationRun_%@&quot;, [NSThread currentThread]); &#125;];&#125;- (void)invocationOperSel &#123; NSLog(@&quot;NSInvocationOperationRun_%@&quot;, [NSThread currentThread]);&#125; NSOperationçš„ä¾èµ–å…³ç³»é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—, åˆ†åˆ«åˆ›å»ºè¦æ‰§è¡Œçš„ä»»åŠ¡, åœ¨æŠŠè¦æ‰§è¡Œçš„ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­å»ä¹‹å‰, é€šè¿‡addDependencyæ¥å»ºç«‹ä»»åŠ¡é—´çš„ä¾èµ–å…³ç³». å¦‚æœæˆ‘ä»¬æ²¡æœ‰è®¾ç½®ä¾èµ–çš„è¯, å¦‚æœè®¾ç½®çš„å¹¶å‘æ•°å¤§äº1, é‚£ä¹ˆblockOper_1å’Œ`blockOper_2çš„æ‰§è¡Œé¡ºåºæ˜¯éšæœºçš„. å¯æ˜¯å½“æˆ‘ä»¬æ‰§è¡Œ[blockOper_1 addDependency:blockOper_2]æ—¶, å°±ç»™ä¸¤ä¸ªä»»åŠ¡æ·»åŠ äº†ä¾èµ–å…³ç³», blockOper_1æ°¸è¿œåªä¼šåœ¨blockOper_2åæ‰§è¡Œ. å³ä½¿æˆ‘ä»¬ç»™blockOper_1è®¾ç½®äº†æœ€é«˜çš„ä¼˜å…ˆçº§, å› ä¸ºä¾èµ–çš„ä¼˜å…ˆçº§è¦é«˜äºqueuePriority. 12345678910111213141516- (void)NSOperationQueueRun2 &#123; NSOperationQueue *queue = [[NSOperationQueue alloc] init];// queue.maxConcurrentOperationCount = 2; NSBlockOperation *blockOper_1 = [NSBlockOperation blockOperationWithBlock:^&#123; NSLog(@&quot;blockOper_1_%@_%@&quot;,@(1),[NSThread currentThread]); &#125;]; NSBlockOperation *blockOper_2 = [NSBlockOperation blockOperationWithBlock:^&#123; NSLog(@&quot;blockOper_2_%@_%@&quot;,@(2),[NSThread currentThread]); &#125;]; // blockOper_1.queuePriority = NSOperationQueuePriorityVeryHigh; [blockOper_1 addDependency:blockOper_2]; [queue addOperation:blockOper_1]; [queue addOperation:blockOper_2];&#125;","path":"2017/09/26/å¤šçº¿ç¨‹ä½¿ç”¨/","date":"09-26","excerpt":""},{"title":"å¤šçº¿ç¨‹","text":"æ¦‚å¿µè¿›ç¨‹å’Œçº¿ç¨‹è¿›ç¨‹æ˜¯å…·æœ‰ä¸€å®šç‹¬ç«‹åŠŸèƒ½çš„ç¨‹åºå…³äºæŸä¸ªæ•°æ®é›†åˆä¸Šçš„ä¸€æ¬¡è¿è¡Œæ´»åŠ¨ï¼Œè¿›ç¨‹æ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„ä¸€ä¸ªç‹¬ç«‹å•ä½. çº¿ç¨‹æ˜¯è¿›ç¨‹çš„ä¸€ä¸ªå®ä½“ï¼Œæ˜¯CPUè°ƒåº¦å’Œåˆ†æ´¾ï¼ˆèµ„æºåˆ†é…ï¼‰çš„åŸºæœ¬å•ä½ï¼Œå®ƒæ˜¯æ¯”è¿›ç¨‹æ›´å°çš„èƒ½ç‹¬ç«‹è¿è¡Œçš„åŸºæœ¬å•ä½.çº¿ç¨‹è‡ªå·±åŸºæœ¬ä¸Šä¸æ‹¥æœ‰ç³»ç»Ÿèµ„æºï¼Œåªæ‹¥æœ‰ä¸€ç‚¹åœ¨è¿è¡Œä¸­å¿…ä¸å¯å°‘çš„èµ„æºï¼ˆå¦‚ç¨‹åºè®¡æ•°å™¨ï¼Œä¸€ç»„å¯„å­˜å™¨å’Œæ ˆï¼‰ï¼Œä½†æ˜¯å®ƒå¯ä¸åŒå±ä¸€ä¸ªè¿›ç¨‹çš„å…¶ä»–çº¿ç¨‹å…±äº«è¿›ç¨‹æ‰€æ‹¥æœ‰çš„å…¨éƒ¨èµ„æº. å¹¶å‘å’Œå¹¶è¡Œå¹¶å‘æŒ‡èƒ½å¤Ÿè®©å¤šä¸ªä»»åŠ¡åœ¨é€»è¾‘ä¸Šäº¤ç»‡æ‰§è¡Œçš„ç¨‹åºè®¾è®¡, ä½†å¹¶å‘äº‹ä»¶ä¹‹é—´ä¸ä¸€å®šè¦åŒä¸€æ—¶åˆ»å‘ç”Ÿ. å¹¶è¡ŒæŒ‡çš„æ˜¯ç¨‹åºè¿è¡Œæ—¶çš„çŠ¶æ€æ˜¯ç‰©ç†ä¸ŠåŒæ—¶æ‰§è¡Œ, æ˜¯æŒ‡åŒæ—¶å‘ç”Ÿçš„ä¸¤ä¸ªå¹¶å‘äº‹ä»¶, å…·æœ‰å¹¶å‘çš„å«ä¹‰, è€Œå¹¶å‘åˆ™ä¸ä¸€å®šå¹¶è¡Œ.å¹¶å‘æ˜¯ä¸€ç§ç°è±¡, é¢å¯¹è¿™ä¸€ç°è±¡, æˆ‘ä»¬é¦–å…ˆåˆ›å»ºå¤šä¸ªçº¿ç¨‹. çœŸæ­£åŠ å¿«ç¨‹åºè¿è¡Œé€Ÿåº¦çš„, æ˜¯å¹¶è¡ŒæŠ€æœ¯. ä¹Ÿå°±æ˜¯è®©å¤šä¸ªCPUåŒæ—¶å·¥ä½œ. è€Œå¤šçº¿ç¨‹, æ˜¯ä¸ºäº†è®©å¤šä¸ªCPUåŒæ—¶å·¥ä½œæˆä¸ºå¯èƒ½. å¹¶å‘è®¾è®¡è®©å¹¶å‘æ‰§è¡Œæˆä¸ºå¯èƒ½, è€Œå¹¶è¡Œæ˜¯å¹¶å‘æ‰§è¡Œçš„ä¸€ç§æ¨¡å¼. å¹¶å‘å’Œå¹¶è¡Œçš„åŒºåˆ«å°±æ˜¯ä¸€ä¸ªäººåŒæ—¶åƒä¸‰ä¸ªé¦’å¤´å’Œä¸‰ä¸ªäººåŒæ—¶åƒä¸‰ä¸ªé¦’å¤´. ä¸€ä¸ªäººåŒæ—¶åƒä¸‰ä¸ªé¦’å¤´ä½†æ˜¯åŒä¸€æ—¶é—´åªèƒ½å•ƒä¸€ä¸ªé¦’å¤´, ä¸‰ä¸ªäººåŒæ—¶åƒä¸‰ä¸ªé¦’å¤´, ä¸‰ä¸ªé¦’å¤´åŒä¸€æ—¶é—´éƒ½ä¼šè¢«å•ƒ. ä¸‹å›¾åæ˜ äº†ä¸€ä¸ªåŒ…å«8ä¸ªæ“ä½œçš„ä»»åŠ¡åœ¨ä¸€ä¸ªæœ‰ä¸¤æ ¸å¿ƒçš„CPUä¸­åˆ›å»ºå››ä¸ªçº¿ç¨‹è¿è¡Œçš„æƒ…å†µ. å‡è®¾æ¯ä¸ªæ ¸å¿ƒæœ‰ä¸¤ä¸ªçº¿ç¨‹, é‚£ä¹ˆæ¯ä¸ªCPUä¸­ä¸¤ä¸ªçº¿ç¨‹ä¼šäº¤æ›¿å¹¶å‘, ä¸¤ä¸ªCPUä¹‹é—´çš„æ“ä½œä¼šå¹¶è¡Œè¿ç®—. å°±CPU1è€Œè¨€è™½ç„¶å®ç°äº†å¹¶å‘ä½†æ˜¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªä»»åŠ¡åœ¨è¿›è¡Œ, CPUåªæ˜¯å¿«é€Ÿçš„åœ¨ä»»åŠ¡ä¹‹é—´åˆ‡æ¢, CPU1å’ŒCPU2æ•´ä½“æ¥çœ‹æ˜¯å¹¶è¡Œå…ƒç®—, åŒä¸€æ—¶é—´æ˜¯æœ‰å¤šä¸ªä»»åŠ¡åœ¨è¿›è¡Œ. å•å°±ä¸€ä¸ªCPUè€Œè¨€ä¸¤ä¸ªçº¿ç¨‹å¯ä»¥è§£å†³çº¿ç¨‹é˜»å¡é€ æˆçš„ä¸æµç•…é—®é¢˜, å…¶æœ¬èº«è¿è¡Œæ•ˆç‡å¹¶æ²¡æœ‰æé«˜. å¤šCPUçš„å¹¶è¡Œè¿ç®—æ‰çœŸæ­£è§£å†³äº†è¿è¡Œæ•ˆç‡é—®é¢˜, è¿™ä¹Ÿæ­£æ˜¯å¹¶å‘å’Œå¹¶è¡Œçš„åŒºåˆ«. åŒæ­¥å’Œå¼‚æ­¥åŒæ­¥åœ¨å‘å‡ºä¸€ä¸ªåŒæ­¥è°ƒç”¨æ—¶, åœ¨æ²¡æœ‰å¾—åˆ°ç»“æœä¹‹å‰, è¯¥è°ƒç”¨å°±ä¸è¿”å›. å¤šä¸ªä»»åŠ¡æƒ…å†µä¸‹, ä¸€ä¸ªä»»åŠ¡Aæ‰§è¡Œç»“æŸ, æ‰å¯ä»¥æ‰§è¡Œå¦ä¸€ä¸ªä»»åŠ¡B. åªå­˜åœ¨ä¸€ä¸ªçº¿ç¨‹. å¼‚æ­¥åœ¨å‘å‡ºä¸€ä¸ªå¼‚æ­¥è°ƒç”¨å, è°ƒç”¨è€…ä¸ä¼šç«‹åˆ»å¾—åˆ°ç»“æœ, è¯¥è°ƒç”¨å°±è¿”å›äº†. åªè¦æ˜¯åŒæ­¥æ‰§è¡Œçš„ä»»åŠ¡ï¼Œéƒ½ä¼šåœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œï¼Œä¸ä¼šå¦å¼€çº¿ç¨‹.åªè¦æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ä»»åŠ¡ï¼Œéƒ½ä¼šå¦å¼€çº¿ç¨‹ï¼Œåœ¨åˆ«çš„çº¿ç¨‹æ‰§è¡Œ. iOSå¤šçº¿ç¨‹æ–¹æ¡ˆpthreadPOSIXçº¿ç¨‹(POSIX threads), ç®€ç§°Pthreads, æ˜¯çº¿ç¨‹çš„POSIXæ ‡å‡†. è¯¥æ ‡å‡†å®šä¹‰äº†åˆ›å»ºå’Œæ“çºµçº¿ç¨‹çš„ä¸€æ•´å¥—API, åœ¨ç±»Unixæ“ä½œç³»ç»Ÿ(Unixã€Linuxã€Mac OSXç­‰)ä¸­, éƒ½ä½¿ç”¨Pthreadsä½œä¸ºæ“ä½œç³»ç»Ÿçš„çº¿ç¨‹. é‚£ä¹Ÿå°±æ„å‘³ç€å¯ä»¥è·¨å¹³å°ä½¿ç”¨. 1234567891011121314151617181920212223242526272829303132333435363738394041424344#import &lt;pthread.h&gt;//å±æ€§pthread_tï¼šçº¿ç¨‹æŒ‡é’ˆpthread_attr_tï¼šçº¿ç¨‹å±æ€§pthread_mutex_tï¼šäº’æ–¥å¯¹è±¡pthread_mutexattr_tï¼šäº’æ–¥å±æ€§å¯¹è±¡pthread_cond_tï¼šæ¡ä»¶å˜é‡pthread_condattr_tï¼šæ¡ä»¶å±æ€§å¯¹è±¡pthread_key_tï¼šçº¿ç¨‹æ•°æ®é”®pthread_rwlock_tï¼šè¯»å†™é”//æ–¹æ³•pthread_create()ï¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹pthread_exit()ï¼šç»ˆæ­¢å½“å‰çº¿ç¨‹pthread_cancel()ï¼šä¸­æ–­å¦å¤–ä¸€ä¸ªçº¿ç¨‹çš„è¿è¡Œpthread_join()ï¼šé˜»å¡å½“å‰çš„çº¿ç¨‹, ç›´åˆ°å¦å¤–ä¸€ä¸ªçº¿ç¨‹è¿è¡Œç»“æŸpthread_attr_init()ï¼šåˆå§‹åŒ–çº¿ç¨‹çš„å±æ€§pthread_attr_setdetachstate()ï¼šè®¾ç½®è„±ç¦»çŠ¶æ€çš„å±æ€§ï¼ˆå†³å®šè¿™ä¸ªçº¿ç¨‹åœ¨ç»ˆæ­¢æ—¶æ˜¯å¦å¯ä»¥è¢«ç»“åˆï¼‰pthread_attr_getdetachstate()ï¼šè·å–è„±ç¦»çŠ¶æ€çš„å±æ€§pthread_attr_destroy()ï¼šåˆ é™¤çº¿ç¨‹çš„å±æ€§pthread_kill()ï¼šå‘çº¿ç¨‹å‘é€ä¸€ä¸ªä¿¡å·pthread_equal(): å¯¹ä¸¤ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ ‡è¯†å·è¿›è¡Œæ¯”è¾ƒpthread_detach(): åˆ†ç¦»çº¿ç¨‹pthread_self(): æŸ¥è¯¢çº¿ç¨‹è‡ªèº«çº¿ç¨‹æ ‡è¯†å·/*åˆ›å»ºçº¿ç¨‹ int pthread_create(pthread_t _Nullable * _Nonnull __restrict, //æŒ‡å‘æ–°å»ºçº¿ç¨‹æ ‡è¯†ç¬¦çš„æŒ‡é’ˆ const pthread_attr_t * _Nullable __restrict, //è®¾ç½®çº¿ç¨‹å±æ€§. é»˜è®¤å€¼NULL. void * _Nullable (* _Nonnull)(void * _Nullable), //è¯¥çº¿ç¨‹è¿è¡Œå‡½æ•°çš„åœ°å€ void * _Nullable __restrict); //è¿è¡Œå‡½æ•°æ‰€éœ€çš„å‚æ•° *è¿”å›å€¼ï¼š *è‹¥çº¿ç¨‹åˆ›å»ºæˆåŠŸ, åˆ™è¿”å›0 *è‹¥çº¿ç¨‹åˆ›å»ºå¤±è´¥, åˆ™è¿”å›å‡ºé”™ç¼–å· */pthread_t thread = NULL;NSString *params = @&quot;Hello World&quot;;int result = pthread_create(&amp;thread, NULL, threadTask, (__bridge void *)(params));result == 0 ? NSLog(@&quot;creat thread success&quot;) : NSLog(@&quot;creat thread failure&quot;);//è®¾ç½®å­çº¿ç¨‹çš„çŠ¶æ€è®¾ç½®ä¸ºdetached,åˆ™è¯¥çº¿ç¨‹è¿è¡Œç»“æŸåä¼šè‡ªåŠ¨é‡Šæ”¾æ‰€æœ‰èµ„æºpthread_detach(thread);void *threadTask(void *params) &#123; NSLog(@&quot;%@ - %@&quot;, [NSThread currentThread], (__bridge NSString *)(params)); return NULL;&#125; NSThread1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950@interface NSThread : NSObject//å½“å‰çº¿ç¨‹@property (class, readonly, strong) NSThread *currentThread;//ä½¿ç”¨ç±»æ–¹æ³•åˆ›å»ºçº¿ç¨‹æ‰§è¡Œä»»åŠ¡+ (void)detachNewThreadWithBlock:(void (^)(void))block API_AVAILABLE(macosx(10.12), ios(10.0), watchos(3.0), tvos(10.0));+ (void)detachNewThreadSelector:(SEL)selector toTarget:(id)target withObject:(nullable id)argument;//åˆ¤æ–­å½“å‰æ˜¯å¦ä¸ºå¤šçº¿ç¨‹+ (BOOL)isMultiThreaded;//æŒ‡å®šçº¿ç¨‹çš„çº¿ç¨‹å‚æ•°, ä¾‹å¦‚è®¾ç½®å½“å‰çº¿ç¨‹çš„æ–­è¨€å¤„ç†å™¨. @property (readonly, retain) NSMutableDictionary *threadDictionary;//å½“å‰çº¿ç¨‹æš‚åœåˆ°æŸä¸ªæ—¶é—´+ (void)sleepUntilDate:(NSDate *)date;//å½“å‰çº¿ç¨‹æš‚åœä¸€æ®µæ—¶é—´+ (void)sleepForTimeInterval:(NSTimeInterval)ti;//é€€å‡ºå½“å‰çº¿ç¨‹+ (void)exit;//å½“å‰çº¿ç¨‹ä¼˜å…ˆçº§+ (double)threadPriority;//è®¾ç½®å½“å‰çº¿ç¨‹ä¼˜å…ˆçº§+ (BOOL)setThreadPriority:(double)p;//æŒ‡å®šçº¿ç¨‹å¯¹è±¡ä¼˜å…ˆçº§ 0.0ï½1.0, é»˜è®¤å€¼ä¸º0.5@property double threadPriority NS_AVAILABLE(10_6, 4_0);//æœåŠ¡è´¨é‡@property NSQualityOfService qualityOfService NS_AVAILABLE(10_10, 8_0);//çº¿ç¨‹åç§°@property (nullable, copy) NSString *name NS_AVAILABLE(10_5, 2_0);//æ ˆåŒºå¤§å°@property NSUInteger stackSize NS_AVAILABLE(10_5, 2_0);//æ˜¯å¦ä¸ºä¸»çº¿ç¨‹@property (class, readonly) BOOL isMainThread NS_AVAILABLE(10_5, 2_0);//è·å–ä¸»çº¿ç¨‹@property (class, readonly, strong) NSThread *mainThread NS_AVAILABLE(10_5, 2_0);//åˆå§‹åŒ–- (instancetype)init NS_AVAILABLE(10_5, 2_0) NS_DESIGNATED_INITIALIZER;//å®ä¾‹æ–¹æ³•åˆå§‹åŒ–, éœ€è¦å†è°ƒç”¨startæ–¹æ³•- (instancetype)initWithTarget:(id)target selector:(SEL)selector object:(nullable id)argument NS_AVAILABLE(10_5, 2_0);- (instancetype)initWithBlock:(void (^)(void))block API_AVAILABLE(macosx(10.12), ios(10.0), watchos(3.0), tvos(10.0));//çº¿ç¨‹çŠ¶æ€, æ­£åœ¨æ‰§è¡Œ@property (readonly, getter=isExecuting) BOOL executing NS_AVAILABLE(10_5, 2_0);//çº¿ç¨‹çŠ¶æ€, æ­£åœ¨å®Œæˆ@property (readonly, getter=isFinished) BOOL finished NS_AVAILABLE(10_5, 2_0);//çº¿ç¨‹çŠ¶æ€, å·²ç»å–æ¶ˆ@property (readonly, getter=isCancelled) BOOL cancelled NS_AVAILABLE(10_5, 2_0);//å–æ¶ˆ, ä»…ä»…æ”¹å˜çº¿ç¨‹çŠ¶æ€, å¹¶ä¸èƒ½åƒexistä¸€æ ·çœŸæ­£çš„ç»ˆæ­¢çº¿ç¨‹- (void)cancel NS_AVAILABLE(10_5, 2_0);//å¼€å§‹- (void)start NS_AVAILABLE(10_5, 2_0);//çº¿ç¨‹éœ€è¦æ‰§è¡Œçš„ä»£ç , ä¸€èˆ¬å†™å­ç±»çš„æ—¶å€™ä¼šç”¨åˆ°- (void)main NS_AVAILABLE(10_5, 2_0);@end è¿˜æœ‰ä¸€ä¸ªNSObjectçš„åˆ†ç±» 12345678@interface NSObject (NSThreadPerformAdditions)//éšå¼çš„åˆ›å»ºå¹¶å¯åŠ¨çº¿ç¨‹, å¹¶åœ¨æŒ‡å®šçš„çº¿ç¨‹ï¼ˆä¸»çº¿ç¨‹æˆ–å­çº¿ç¨‹ï¼‰ä¸Šæ‰§è¡Œæ–¹æ³•. - (void)performSelectorOnMainThread:(SEL)aSelector withObject:(nullable id)arg waitUntilDone:(BOOL)wait modes:(nullable NSArray&lt;NSString *&gt; *)array;- (void)performSelectorOnMainThread:(SEL)aSelector withObject:(nullable id)arg waitUntilDone:(BOOL)wait;- (void)performSelector:(SEL)aSelector onThread:(NSThread *)thr withObject:(nullable id)arg waitUntilDone:(BOOL)wait modes:(nullable NSArray&lt;NSString *&gt; *)array NS_AVAILABLE(10_5, 2_0);- (void)performSelector:(SEL)aSelector onThread:(NSThread *)thr withObject:(nullable id)arg waitUntilDone:(BOOL)wait NS_AVAILABLE(10_5, 2_0);- (void)performSelectorInBackground:(SEL)aSelector withObject:(nullable id)arg NS_AVAILABLE(10_5, 2_0);@end å¸¸è§çš„ç”¨æ³•æœ‰ä»¥ä¸‹å‡ ç§: 123456789101112- (void) startThread &#123; //åˆ›å»ºå¹¶ä¸”æ‰‹åŠ¨å¯åŠ¨ NSThread *thread = [[NSThread alloc] initWithTarget:self selector:@selector(run) object:nil]; [thread start]; //ç±»æ–¹æ³•åˆ›å»ºå¹¶ä¸”è‡ªåŠ¨å¯åŠ¨ [NSThread detachNewThreadSelector:@selector(run) toTarget:self withObject:nil]; //é€šè¿‡NSObjectçš„æ–¹æ³•è‡ªåŠ¨å¯åŠ¨ [self performSelectorInBackground:@selector(run) withObject:nil];&#125; - (void)run &#123; NSLog(@&quot;%@&quot;, [NSThread currentThread]);&#125; GCDGrand Central Dispatch, å®ƒæ˜¯è‹¹æœä¸ºå¤šæ ¸çš„å¹¶è¡Œè¿ç®—æå‡ºçš„è§£å†³æ–¹æ¡ˆ, ä¼šè‡ªåŠ¨åˆç†åœ°åˆ©ç”¨æ›´å¤šçš„CPUå†…æ ¸(æ¯”å¦‚åŒæ ¸ã€å››æ ¸), æœ€é‡è¦çš„æ˜¯å®ƒä¼šè‡ªåŠ¨ç®¡ç†çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ(åˆ›å»ºçº¿ç¨‹ã€è°ƒåº¦ä»»åŠ¡ã€é”€æ¯çº¿ç¨‹), å®Œå…¨ä¸éœ€è¦æˆ‘ä»¬ç®¡ç†, æˆ‘ä»¬åªéœ€è¦å‘Šè¯‰å¹²ä»€ä¹ˆå°±è¡Œ. åŒæ—¶å®ƒä½¿ç”¨çš„ä¹Ÿæ˜¯Cè¯­è¨€. ä»»åŠ¡è¦æ‰§è¡Œçš„æ“ä½œæˆ–æ–¹æ³•å‡½æ•°. åœ¨GCDä¸­æŒ‡çš„å°±æ˜¯blockå—, åœ¨NSThreadä¸­æŒ‡çš„æ˜¯performSelector:ä¸­çš„æ–¹æ³•. åŠ å…¥ä»»åŠ¡æ—¶æœ‰ä¸¤ç§å½¢å¼: åŒæ­¥ä»»åŠ¡(dispatch_sync)å’Œå¼‚æ­¥ä»»åŠ¡(dispatch_async). åŒæ­¥ä»»åŠ¡: ä¸ä¼šå¼€å¯æ–°çš„çº¿ç¨‹, ä¼šé˜»å¡å½“å‰çº¿ç¨‹. å®Œæˆéœ€è¦åšçš„ä»»åŠ¡åæ‰ä¼šè¿”å›, è¿›è¡Œä¸‹ä¸€ä»»åŠ¡. åˆ›å»ºæ–¹å¼ä¸º: 12//æŠŠå³è¾¹çš„å‚æ•°(ä»»åŠ¡)æäº¤ç»™å·¦è¾¹çš„å‚æ•°(é˜Ÿåˆ—)è¿›è¡Œæ‰§è¡Œdispatch_sync(dispatch_queue_t queue, dispatch_block_t block); å¼‚æ­¥ä»»åŠ¡: ä¸ä¼šç­‰å¾…ä»»åŠ¡å®Œæˆæ‰è¿”å›, ä¼šç«‹å³è¿”å›. å¼‚æ­¥æ˜¯å¤šçº¿ç¨‹çš„ä»£åè¯, å› ä¸ºå¿…å®šä¼šå¼€å¯æ–°çš„çº¿ç¨‹, çº¿ç¨‹çš„ç”³è¯·æ˜¯ç”±å¼‚æ­¥è´Ÿè´£, èµ·åˆ°å¼€åˆ†æ”¯çš„ä½œç”¨. åˆ›å»ºæ–¹å¼ä¸º: 12//æŠŠå³è¾¹çš„å‚æ•°(ä»»åŠ¡)æäº¤ç»™å·¦è¾¹çš„å‚æ•°(é˜Ÿåˆ—)è¿›è¡Œæ‰§è¡Œdispatch_async(dispatch_queue_t queue, dispatch_block_t block); é˜Ÿåˆ—å­˜æ”¾ä»»åŠ¡çš„é›†åˆ, æˆ‘ä»¬è¦åšçš„å°±æ˜¯å°†ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—ç„¶åæ‰§è¡Œ, GCDä¼šè‡ªåŠ¨å°†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æŒ‰å…ˆè¿›å…ˆå‡ºçš„æ–¹å¼å–å‡º. é˜Ÿåˆ—ä¸»è¦æœ‰çš„æœ‰ä¸²è¡Œé˜Ÿåˆ—(Serial Dispatch Queue), å¹¶è¡Œé˜Ÿåˆ—(Concurrent Dispatch Queue), å…¨å±€é˜Ÿåˆ—(Global Queue)å’Œä¸»é˜Ÿåˆ—(Main Queue). ä¸²è¡Œé˜Ÿåˆ—: ä»»åŠ¡ä¾æ¬¡æ‰§è¡Œ, åŒä¸€æ—¶é—´é˜Ÿåˆ—ä¸­åªæœ‰ä¸€ä¸ªä»»åŠ¡åœ¨æ‰§è¡Œ, æ¯ä¸ªä»»åŠ¡åªæœ‰åœ¨å‰ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæˆåæ‰èƒ½å¼€å§‹æ‰§è¡Œ 1234//åˆ›å»ºä¸€ä¸ªåä¸ºqueueçš„ä¸²è¡Œé˜Ÿåˆ—//ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºé˜Ÿåˆ—åç§°//ç¬¬äºŒä¸ªå‚æ•°ä¸ºé˜Ÿåˆ—ç±»å‹, DISPATCH_QUEUE_SERIALå’ŒNULLè¡¨ç¤ºä¸²è¡Œé˜Ÿåˆ—dispatch_queue_t queue = dispatch_queue_create(&quot;com.levinluo.SerialQueue&quot;, DISPATCH_QUEUE_SERIAL); å¹¶è¡Œé˜Ÿåˆ—: ä»»åŠ¡å¹¶å‘æ‰§è¡Œ, å”¯ä¸€èƒ½ä¿è¯çš„æ˜¯, è¿™äº›ä»»åŠ¡ä¼šæŒ‰ç…§è¢«æ·»åŠ çš„é¡ºåºå¼€å§‹æ‰§è¡Œ. ä½†æ˜¯ä»»åŠ¡å¯ä»¥ä»¥ä»»ä½•é¡ºåºå®Œæˆ, ä½ ä¸çŸ¥é“åœ¨æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡æ˜¯ä»ä»€ä¹ˆæ—¶å€™å¼€å§‹, æˆ–è€…è¯´ä»»æ„æ—¶åˆ»æœ‰å¤šä¸ªBlock(ä»»åŠ¡)è¿è¡Œ, è¿™ä¸ªå®Œå…¨æ˜¯å–å†³äºGCD. 1234//åˆ›å»ºä¸€ä¸ªåä¸ºqueueçš„å¹¶è¡Œé˜Ÿåˆ—//ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºé˜Ÿåˆ—åç§°//ç¬¬äºŒä¸ªå‚æ•°ä¸ºé˜Ÿåˆ—ç±»å‹, DISPATCH_QUEUE_CONCURRENTè¡¨ç¤ºå¹¶è¡Œé˜Ÿåˆ—dispatch_queue_t queue = dispatch_queue_create(&quot;com.levinluo.ConcurrentQueue&quot;,DISPATCH_QUEUE_CONCURRENT); å…¨å±€é˜Ÿåˆ—: GCDé»˜è®¤æä¾›çš„å…¨å±€çš„å¹¶å‘é˜Ÿåˆ—, ä¾›æ•´ä¸ªåº”ç”¨ä½¿ç”¨ 123456789//è·å–ç³»ç»Ÿå…¨å±€é˜Ÿåˆ—, å¹¶èµ‹å€¼ç»™é˜Ÿåˆ—queue//ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºä¼˜å…ˆçº§, è¿™é‡Œæ˜¯æ–°è€ä¼˜å…ˆçº§çš„å¯¹ç…§Map* - DISPATCH_QUEUE_PRIORITY_HIGH: QOS_CLASS_USER_INITIATED//é«˜* - DISPATCH_QUEUE_PRIORITY_DEFAULT: QOS_CLASS_DEFAULT//é»˜è®¤* - DISPATCH_QUEUE_PRIORITY_LOW: QOS_CLASS_UTILITY//ä½* - DISPATCH_QUEUE_PRIORITY_BACKGROUND: QOS_CLASS_BACKGROUND//åå° //ç¬¬äºŒä¸ªå‚æ•°æ˜¯é¢„ç•™å‚æ•°, ä¼ 0å°±å¥½dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0); ä¸»é˜Ÿåˆ—: ä¸»é˜Ÿåˆ—æ˜¯GCDè‡ªå¸¦çš„ä¸€ç§ç‰¹æ®Šçš„ä¸²è¡Œé˜Ÿåˆ—, æ”¾åœ¨ä¸»é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡, éƒ½ä¼šæ”¾åˆ°ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œ 12//è·å–ç³»ç»Ÿä¸»é˜Ÿåˆ—, å¹¶èµ‹å€¼ç»™é˜Ÿåˆ—queue dispatch_queue_t queue = dispatch_get_main_queue(); ä¸ç®¡æ˜¯ä¸²è¡Œé˜Ÿåˆ—(SerialQueue)è¿˜æ˜¯å¹¶è¡Œé˜Ÿåˆ—(ConcurrencyQueue), éƒ½æ˜¯FIFOé˜Ÿåˆ—. ä¹Ÿå°±æ„å‘³ç€, ä»»åŠ¡ä¸€å®šæ˜¯ä¸€ä¸ªä¸€ä¸ªåœ°, æŒ‰ç…§å…ˆè¿›å…ˆå‡ºçš„é¡ºåºæ¥æ‰§è¡Œ. NSOperation &amp; NSOperationQueueNSOperation æ˜¯è‹¹æœå…¬å¸å¯¹GCDçš„å°è£…, NSOperationå’ŒNSOperationQueueåˆ†åˆ«å¯¹åº”GCDçš„ä»»åŠ¡å’Œé˜Ÿåˆ—.é¦–å…ˆå°†è¦æ‰§è¡Œçš„ä»»åŠ¡å°è£…åˆ°ä¸€ä¸ªNSOperationå¯¹è±¡ä¸­. ç„¶åå°†æ­¤ä»»åŠ¡æ·»åŠ åˆ°ä¸€ä¸ªNSOperationQueueå¯¹è±¡ä¸­. NSOperation1234567891011121314151617181920212223242526272829303132333435363738394041424344454647@interface NSOperation : NSObject &#123;@private id _private; int32_t _private1;#if __LP64__ int32_t _private1b;#endif&#125; - (void)start;//å¯åŠ¨ä»»åŠ¡ é»˜è®¤åœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œ- (void)main;//è‡ªå®šä¹‰NSOperationï¼Œå†™ä¸€ä¸ªå­ç±»ï¼Œé‡å†™è¿™ä¸ªæ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢æ·»åŠ éœ€è¦æ‰§è¡Œçš„æ“ä½œã€‚ @property (readonly, getter=isCancelled) BOOL cancelled;//æ˜¯å¦å·²ç»å–æ¶ˆï¼Œåªè¯»- (void)cancel;//å–æ¶ˆä»»åŠ¡ @property (readonly, getter=isExecuting) BOOL executing;//æ­£åœ¨æ‰§è¡Œï¼Œåªè¯»@property (readonly, getter=isFinished) BOOL finished;//æ‰§è¡Œç»“æŸï¼Œåªè¯»@property (readonly, getter=isConcurrent) BOOL concurrent; // To be deprecated; use and override &apos;asynchronous&apos; below@property (readonly, getter=isAsynchronous) BOOL asynchronous NS_AVAILABLE(10_8, 7_0);//æ˜¯å¦å¹¶å‘ï¼Œåªè¯»@property (readonly, getter=isReady) BOOL ready;//å‡†å¤‡æ‰§è¡Œ - (void)addDependency:(NSOperation *)op;//æ·»åŠ ä¾èµ–- (void)removeDependency:(NSOperation *)op;//ç§»é™¤ä¾èµ– @property (readonly, copy) NSArray&lt;NSOperation *&gt; *dependencies;//æ‰€æœ‰ä¾èµ–å…³ç³»ï¼Œåªè¯» typedef NS_ENUM(NSInteger, NSOperationQueuePriority) &#123; NSOperationQueuePriorityVeryLow = -8L, NSOperationQueuePriorityLow = -4L, NSOperationQueuePriorityNormal = 0, NSOperationQueuePriorityHigh = 4, NSOperationQueuePriorityVeryHigh = 8&#125;;//ç³»ç»Ÿæä¾›çš„ä¼˜å…ˆçº§å…³ç³»æšä¸¾ @property NSOperationQueuePriority queuePriority;//æ‰§è¡Œä¼˜å…ˆçº§ @property (nullable, copy) void (^completionBlock)(void) NS_AVAILABLE(10_6, 4_0);//ä»»åŠ¡æ‰§è¡Œå®Œæˆä¹‹åçš„å›è°ƒ - (void)waitUntilFinished NS_AVAILABLE(10_6, 4_0);//é˜»å¡å½“å‰çº¿ç¨‹ï¼Œç­‰åˆ°æŸä¸ªoperationæ‰§è¡Œå®Œæ¯•ã€‚ @property double threadPriority NS_DEPRECATED(10_6, 10_10, 4_0, 8_0);//å·²åºŸå¼ƒï¼Œç”¨qualityOfServiceæ›¿ä»£ã€‚ @property NSQualityOfService qualityOfService NS_AVAILABLE(10_10, 8_0);//æœåŠ¡è´¨é‡ï¼Œä¸€ä¸ªé«˜è´¨é‡çš„æœåŠ¡å°±æ„å‘³ç€æ›´å¤šçš„èµ„æºå¾—ä»¥æä¾›æ¥æ›´å¿«çš„å®Œæˆæ“ä½œã€‚ @property (nullable, copy) NSString *name NS_AVAILABLE(10_10, 8_0);//ä»»åŠ¡åç§° @end ç”±äºNSOperationæ˜¯ä¸€ä¸ªæŠ½è±¡åŸºç±», ä¸èƒ½ç›´æ¥ä½¿ç”¨, åœ¨è¿™é‡Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨NSOperationçš„ä¸¤ä¸ªå­ç±»NSInvocationOperationå’ŒNSBlockOperation, æˆ–è€…NSOperationçš„è‡ªå®šä¹‰å­ç±»: NSInvocationOperationï¼šåŸºäºåº”ç”¨çš„ä¸€ä¸ªtargetå¯¹è±¡å’Œselectoræ¥åˆ›å»ºoperation object. å¦‚æœä½ å·²ç»æœ‰ç°æœ‰çš„æ–¹æ³•æ¥æ‰§è¡Œéœ€è¦çš„ä»»åŠ¡, å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªç±». ä½¿ç”¨æ–¹å¼å¤§è‡´å¦‚ä¸‹: 1234567- (void)NSInvocationOperationRun &#123; NSInvocationOperation *invocationOper = [[NSInvocationOperation alloc] initWithTarget:self selector:@selector(invocationOperSel) object:nil]; [invocationOper start];&#125;- (void)invocationOperSel &#123; NSLog(@&quot;NSInvocationOperationRun_%@&quot;, [NSThread currentThread]);&#125; NSBlockOperationç”¨æ¥å¹¶å‘åœ°æ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ªblockå¯¹è±¡. operation objectä½¿ç”¨ç»„çš„è¯­ä¹‰æ¥æ‰§è¡Œå¤šä¸ªblockå¯¹è±¡ï¼Œæ‰€æœ‰ç›¸å…³çš„ block éƒ½æ‰§è¡Œå®Œæˆä¹‹å, operation objectæ‰ç®—å®Œæˆ. ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹: 12345678910111213//ç³»ç»Ÿæä¾›çš„API@interface NSBlockOperation : NSOperation &#123;@privateid _private2;void *_reserved2;&#125; + (instancetype)blockOperationWithBlock:(void (^)(void))block;//åœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œ - (void)addExecutionBlock:(void (^)(void))block;//æ–°å¼€çº¿ç¨‹æ‰§è¡Œ@property (readonly, copy) NSArray&lt;void (^)(void)&gt; *executionBlocks; @end ä½¿ç”¨NSBlockOperationç±»æ–¹æ³•åˆ›å»ºä»»åŠ¡, ä»æ‰“å°ç»“æœå¯ä»¥çœ‹å‡ºæ¥è¯¥ä»»åŠ¡æ˜¯åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œçš„ 123456- (void)NSBlockOperationRun &#123;NSBlockOperation *blockOper = [NSBlockOperation blockOperationWithBlock:^&#123; NSLog(@&quot;NSBlockOperationRun_%@_%@&quot;, [NSOperationQueue currentQueue], [NSThread currentThread]);&#125;];[blockOper start];&#125; ä½¿ç”¨NBlockOperationçš„å®ä¾‹æ–¹æ³•åˆ›å»ºä»»åŠ¡, ä»æ‰“å°ç»“æœå¯ä»¥çœ‹å‡ºæ¥, ç¬¬ä¸€ä¸ªä»»åŠ¡æ˜¯åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œ, å…¶ä»–ä»»åŠ¡å‡æ˜¯æ–°å¼€çš„çº¿ç¨‹, æ‰€æœ‰çš„ä»»åŠ¡æ˜¯ä»¥å¼‚æ­¥å¹¶å‘çš„å½¢å¼æ‰§è¡Œ. 123456789101112131415- (void)NSBlockOperationRun &#123;NSBlockOperation *blockOper = [NSBlockOperation blockOperationWithBlock:^&#123; NSLog(@&quot;NSBlockOperationRun_1_%@&quot;, [NSThread currentThread]);&#125;];[blockOper addExecutionBlock:^&#123; NSLog(@&quot;NSBlockOperationRun_2_%@&quot;, [NSThread currentThread]);&#125;];[blockOper addExecutionBlock:^&#123; NSLog(@&quot;NSBlockOperationRun_3_%@&quot;, [NSThread currentThread]);&#125;];[blockOper addExecutionBlock:^&#123; NSLog(@&quot;NSBlockOperationRun_4_%@&quot;, [NSThread currentThread]);&#125;];[blockOper start];&#125; NSOperationçš„è‡ªå®šä¹‰å­ç±». åœ¨å­ç±»ä¸­é‡å†™çˆ¶ç±»çš„-(void)mainå‡½æ•°, åœ¨é‡Œé¢å®ç°ä¸»è¦é€»è¾‘. NSBlockOperation, NSBlockOperationRunæˆ–è€…NSOperationçš„è‡ªå®šä¹‰å­ç±»åˆ›å»ºçš„operation objectéƒ½å¯ä»¥ä½¿ç”¨NSOperationçš„æ‰€æœ‰å±æ€§, æ„å‘³ç€ä»–ä»¬å…·æœ‰ä»¥ä¸‹ä¸»è¦ç‰¹æ€§: å¤šä¸ªä»»åŠ¡ä¹‹é—´å¯ä»¥ä½¿ç”¨æœ‰ä¾èµ–å…³ç³» å¯ä»¥è·å¾—Operation objectä»»åŠ¡æ‰§è¡Œå®Œæˆä¹‹åçš„å›è°ƒ æ”¯æŒåº”ç”¨ä½¿ç”¨ KVO é€šçŸ¥æ¥ç›‘æ§ operation çš„æ‰§è¡ŒçŠ¶æ€ å¯ä»¥é€šè¿‡operationä¼˜å…ˆçº§, ä»è€Œå½±å“ç›¸å¯¹çš„æ‰§è¡Œé¡ºåº å¯ä»¥ç»ˆæ­¢æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ NSOperationQueueNSOperationQueueç±»ä¼¼äºGCDä¸­çš„é˜Ÿåˆ—, åªéœ€è¦å§ä»»åŠ¡åŠ å…¥åˆ°NSOperationQueueä¸­, å°±ä¼šè‡ªåŠ¨è¿è¡Œ, ç”±ç³»ç»Ÿé€šè¿‡æœ€å¤§å¹¶å‘æ•°æ¥æ§åˆ¶æ˜¯å¹¶è¡Œè¿˜æ˜¯ä¸²è¡Œ, å®˜æ–¹æä¾›çš„APIå¦‚ä¸‹: 1234567891011121314151617181920212223242526272829303132333435static const NSInteger NSOperationQueueDefaultMaxConcurrentOperationCount = -1; NS_CLASS_AVAILABLE(10_5, 2_0)@interface NSOperationQueue : NSObject &#123;@private id _private; void *_reserved;&#125; - (void)addOperation:(NSOperation *)op;//å‘é˜Ÿåˆ—ä¸­æ·»åŠ ä»»åŠ¡- (void)addOperations:(NSArray&lt;NSOperation *&gt; *)ops waitUntilFinished:(BOOL)wait API_AVAILABLE(macos(10.6), ios(4.0), watchos(2.0), tvos(9.0));//æ·»åŠ ä¸€ç»„ä»»åŠ¡ - (void)addOperationWithBlock:(void (^)(void))block API_AVAILABLE(macos(10.6), ios(4.0), watchos(2.0), tvos(9.0));//æ·»åŠ ä¸€ä¸ªblockå½¢å¼çš„ä»»åŠ¡ @property (readonly, copy) NSArray&lt;__kindof NSOperation *&gt; *operations;//é˜Ÿåˆ—ä¸­æ‰€æœ‰ä»»åŠ¡çš„æ•°ç»„@property (readonly) NSUInteger operationCount API_AVAILABLE(macos(10.6), ios(4.0), watchos(2.0), tvos(9.0));//é˜Ÿåˆ—ä¸­æ‰€æœ‰ä»»åŠ¡æ•° @property NSInteger maxConcurrentOperationCount;//æœ€å¤§å¹¶å‘æ•° @property (getter=isSuspended) BOOL suspended;//æš‚åœ @property (nullable, copy) NSString *name API_AVAILABLE(macos(10.6), ios(4.0), watchos(2.0), tvos(9.0));//åç§° @property NSQualityOfService qualityOfService API_AVAILABLE(macos(10.10), ios(8.0), watchos(2.0), tvos(9.0));//æœåŠ¡è´¨é‡, ç³»ç»Ÿä¼šä¸ºæƒé‡é«˜çš„æœåŠ¡åˆ†é…æ›´å¤šçš„èµ„æº @property (nullable, assign /* actually retain */) dispatch_queue_t underlyingQueue API_AVAILABLE(macos(10.10), ios(8.0), watchos(2.0), tvos(9.0)); - (void)cancelAllOperations;//å–æ¶ˆé˜Ÿåˆ—ä¸­æ‰€æœ‰çš„ä»»åŠ¡ - (void)waitUntilAllOperationsAreFinished;//é˜»å¡å½“å‰çº¿ç¨‹, ç­‰åˆ°é˜Ÿåˆ—ä¸­çš„å…¨éƒ¨ä»»åŠ¡å…¨éƒ¨æ‰§è¡Œå®Œæ¯• @property (class, readonly, strong, nullable) NSOperationQueue *currentQueue API_AVAILABLE(macos(10.6), ios(4.0), watchos(2.0), tvos(9.0));//è·å–å½“å‰é˜Ÿåˆ—@property (class, readonly, strong) NSOperationQueue *mainQueue API_AVAILABLE(macos(10.6), ios(4.0), watchos(2.0), tvos(9.0));//è·å–ä¸»é˜Ÿåˆ— @end 1234567891011121314151617//ä»¥ä¸‰ç§æ–¹å¼ä¸ºé˜Ÿåˆ—æ·»åŠ äº†ä¸‰ä¸ªä»»åŠ¡, - (void)NSOperationQueueRun &#123; NSOperationQueue *queue = [[NSOperationQueue alloc] init]; NSInvocationOperation *invocationOper = [[NSInvocationOperation alloc] initWithTarget:self selector:@selector(invocationOperSel) object:nil]; [queue addOperation:invocationOper]; NSBlockOperation *blockOper = [NSBlockOperation blockOperationWithBlock:^&#123; NSLog(@&quot;NSBlockOperationRun_%@&quot;, [NSThread currentThread]); &#125;]; [queue addOperation:blockOper]; [queue addOperationWithBlock:^&#123; NSLog(@&quot;QUEUEBlockOperationRun_%@&quot;, [NSThread currentThread]); &#125;];&#125; - (void)invocationOperSel &#123; NSLog(@&quot;NSInvocationOperationRun_%@&quot;, [NSThread currentThread]);&#125; ä¸€èˆ¬æƒ…å†µä¸‹, NSOperationQueueä¼šæŒ‰ç…§ä»»åŠ¡æ·»åŠ çš„é¡ºåºæ¥æ‰§è¡Œä»»åŠ¡, ä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ä¼˜å…ˆçº§å’Œä¾èµ–å…³ç³»æ¥æ”¹å˜æ‰§è¡Œé¡ºåº.","path":"2017/09/15/å¤šçº¿ç¨‹/","date":"09-15","excerpt":""},{"title":"runloopå®è·µ","text":"å¸¸é©»çº¿ç¨‹éœ€è¦åˆ›å»ºä¸€ä¸ªåœ¨åå°ä¸€ç›´å­˜åœ¨çš„ç¨‹åº, æ¥åšä¸€äº›éœ€è¦é¢‘ç¹å¤„ç†çš„ä»»åŠ¡. æ¯”å¦‚æ£€æµ‹ç½‘ç»œçŠ¶æ€ç­‰. é»˜è®¤æƒ…å†µä¸€ä¸ªçº¿ç¨‹åˆ›å»ºå‡ºæ¥, è¿è¡Œå®Œè¦åšçš„äº‹æƒ…, çº¿ç¨‹å°±ä¼šæ¶ˆäº¡. è€Œç¨‹åºå¯åŠ¨çš„æ—¶å€™, å°±åˆ›å»ºçš„ä¸»çº¿ç¨‹å·²ç»åŠ å…¥åˆ°runloop, æ‰€ä»¥ä¸»çº¿ç¨‹ä¸ä¼šæ¶ˆäº¡. AFNé‡Œé¢å°±æœ‰ä¸€æ¡é€šè¿‡æ·»åŠ NSPortæ¥å®ç°å¸¸é©»çš„çº¿ç¨‹, å¸¸è§çš„æœ‰ä¸¤ç§æ–¹å¼: æ·»åŠ NSPort 1234567891011121314151617181920212223242526- (void)viewDidLoad &#123; [super viewDidLoad]; self.thread = [[NSThread alloc] initWithTarget:self selector:@selector(run) object:nil]; [self.thread start];&#125;- (void)run &#123; NSLog(@&quot;----------run----%@&quot;, [NSThread currentThread]); @autoreleasepool&#123; /*å¦‚æœä¸åŠ è¿™å¥ï¼Œä¼šå‘ç°runloopåˆ›å»ºå‡ºæ¥å°±æŒ‚äº†ï¼Œå› ä¸ºrunloopå¦‚æœæ²¡æœ‰CFRunLoopSourceRefäº‹ä»¶æºè¾“å…¥æˆ–è€…å®šæ—¶å™¨ï¼Œå°±ä¼šç«‹é©¬æ¶ˆäº¡ã€‚ ä¸‹é¢çš„æ–¹æ³•ç»™runloopæ·»åŠ ä¸€ä¸ªNSportï¼Œå°±æ˜¯æ·»åŠ ä¸€ä¸ªäº‹ä»¶æºï¼Œä¹Ÿå¯ä»¥æ·»åŠ ä¸€ä¸ªå®šæ—¶å™¨ï¼Œæˆ–è€…observerï¼Œè®©runloopä¸ä¼šæŒ‚æ‰*/ [[NSRunLoop currentRunLoop] addPort:[NSPort port] forMode:NSDefaultRunLoopMode]; // æ–¹æ³•1 [[NSRunLoop currentRunLoop] run]; &#125; // æ–¹æ³•2 [[NSRunLoop currentRunLoop] runMode:NSDefaultRunLoopMode beforeDate:[NSDate distantFuture]]; // æ–¹æ³•3 [[NSRunLoop currentRunLoop] runUntilDate:[NSDate distantFuture]]; NSLog(@&quot;---------&quot;);&#125;- (void)test &#123; NSLog(@&quot;----------test----%@&quot;, [NSThread currentThread]);&#125;- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event &#123; [self performSelector:@selector(test) onThread:self.thread withObject:nil waitUntilDone:NO];&#125; æ·»åŠ NSTimer 123456789- (void)viewDidLoad &#123; [super viewDidLoad]; self.thread = [[NSThread alloc] initWithTarget:self selector:@selector(run) object:nil]; [self.thread start];&#125;- (void)run &#123; [NSTimer scheduledTimerWithTimeInterval:2.0 target:self selector:@selector(test) userInfo:nil repeats:YES]; [[NSRunLoop currentRunLoop] run];&#125; å¦‚æœæ²¡æœ‰å®ç°æ·»åŠ NSPortæˆ–è€…NSTimer, ä¼šå‘ç°æ‰§è¡Œå®Œrunæ–¹æ³•, çº¿ç¨‹å°±ä¼šæ¶ˆäº¡, åç»­å†æ‰§è¡Œtouchbeganæ–¹æ³•æ— æ•ˆ. æˆ‘ä»¬å¿…é¡»ä¿è¯çº¿ç¨‹ä¸æ¶ˆäº¡, æ‰å¯ä»¥åœ¨åå°æ¥å—æ—¶é—´å¤„ç†. RunLoop å¯åŠ¨å‰å†…éƒ¨å¿…é¡»è¦æœ‰è‡³å°‘ä¸€ä¸ª Timer/Observer/Source, æ‰€ä»¥åœ¨ [runLoop run] ä¹‹å‰å…ˆåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ NSMachPort æ·»åŠ è¿›å»äº†. é€šå¸¸æƒ…å†µä¸‹, è°ƒç”¨è€…éœ€è¦æŒæœ‰è¿™ä¸ª NSMachPort (mach_port) å¹¶åœ¨å¤–éƒ¨çº¿ç¨‹é€šè¿‡è¿™ä¸ª port å‘é€æ¶ˆæ¯åˆ° loop å†…; ä½†æ­¤å¤„æ·»åŠ  port åªæ˜¯ä¸ºäº†è®© RunLoop ä¸è‡³äºé€€å‡º, å¹¶æ²¡æœ‰ç”¨äºå®é™…çš„å‘é€æ¶ˆæ¯. å¯ä»¥å‘ç°æ‰§è¡Œå®Œäº†runæ–¹æ³•, è¿™ä¸ªæ—¶å€™å†ç‚¹å‡»å±å¹•, å¯ä»¥ä¸æ–­æ‰§è¡Œtestæ–¹æ³•, å› ä¸ºçº¿ç¨‹self.threadä¸€ç›´å¸¸é©»åå°, ç­‰å¾…äº‹ä»¶åŠ å…¥å…¶ä¸­, ç„¶åæ‰§è¡Œ. å‚è€ƒé“¾æ¥ï¼šé¿å…ä½¿ç”¨ GCD Globalé˜Ÿåˆ—åˆ›å»ºRunloopå¸¸é©»çº¿ç¨‹ æ»šåŠ¨scrollViewå¯¼è‡´å®šæ—¶å™¨å¤±æ•ˆå¦‚æœåœ¨ç•Œé¢ä¸Šæœ‰ä¸€ä¸ªUIscrollviewæ§ä»¶(tableview, collectionviewç­‰), å¦‚æœæ­¤æ—¶è¿˜æœ‰ä¸€ä¸ªå®šæ—¶å™¨åœ¨æ‰§è¡Œä¸€ä¸ªäº‹ä»¶, ä½ ä¼šå‘ç°å½“ä½ æ»šåŠ¨scrollviewçš„æ—¶å€™, å®šæ—¶å™¨ä¼šå¤±æ•ˆ. åŸå› æ˜¯å½“æ»šåŠ¨UIscrollviewçš„æ—¶å€™, runloopä¼šè¿›å…¥UITrackingRunLoopMode æ¨¡å¼, è€Œå®šæ—¶å™¨è¿è¡Œåœ¨defaultModeä¸‹é¢, ç³»ç»Ÿä¸€æ¬¡åªèƒ½å¤„ç†ä¸€ç§æ¨¡å¼çš„runloop, æ‰€ä»¥å¯¼è‡´defaultModeä¸‹çš„å®šæ—¶å™¨å¤±æ•ˆ. è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§: 1.æŠŠå®šæ—¶å™¨çš„runloopçš„modelæ”¹ä¸ºNSRunLoopCommonModes æ¨¡å¼, è¿™ä¸ªæ¨¡å¼æ˜¯ä¸€ç§å ä½mode, å¹¶ä¸æ˜¯çœŸæ­£å¯ä»¥è¿è¡Œçš„mode, å®ƒæ˜¯ç”¨æ¥æ ‡è®°ä¸€ä¸ªmodeçš„. é»˜è®¤æƒ…å†µä¸‹defaultå’Œtrackingè¿™ä¸¤ç§mode éƒ½ä¼šè¢«æ ‡è®°ä¸ŠNSRunLoopCommonModes æ ‡ç­¾ æ”¹å˜å®šæ—¶å™¨çš„modeä¸ºcommonmodel, å¯ä»¥è®©å®šæ—¶å™¨è¿è¡Œåœ¨defaultModeå’ŒtrackingModelä¸¤ç§æ¨¡å¼ä¸‹, ä¸ä¼šå‡ºç°æ»šåŠ¨scrollviewå¯¼è‡´å®šæ—¶å™¨å¤±æ•ˆçš„æ•…éšœ.1[[NSRunLoop currentRunLoop] addTimer:timer forMode:NSRunLoopCommonModes]; ä½¿ç”¨GCDåˆ›å»ºå®šæ—¶å™¨1234567891011121314151617// è·å¾—é˜Ÿåˆ—dispatch_queue_t queue = dispatch_get_main_queue();// åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨(dispatch_source_tæœ¬è´¨è¿˜æ˜¯ä¸ªOCå¯¹è±¡)self.timer = dispatch_source_create(DISPATCH_SOURCE_TYPE_TIMER, 0, 0, queue);// è®¾ç½®å®šæ—¶å™¨çš„å„ç§å±æ€§ï¼ˆå‡ æ—¶å¼€å§‹ä»»åŠ¡ï¼Œæ¯éš”å¤šé•¿æ—¶é—´æ‰§è¡Œä¸€æ¬¡ï¼‰// GCDçš„æ—¶é—´å‚æ•°ï¼Œä¸€èˆ¬æ˜¯çº³ç§’ï¼ˆ1ç§’ == 10çš„9æ¬¡æ–¹çº³ç§’ï¼‰// æ¯”å½“å‰æ—¶é—´æ™š1ç§’å¼€å§‹æ‰§è¡Œdispatch_time_t start = dispatch_time(DISPATCH_TIME_NOW, (int64_t)(1.0 * NSEC_PER_SEC));//æ¯éš”ä¸€ç§’æ‰§è¡Œä¸€æ¬¡uint64_t interval = (uint64_t)(1.0 * NSEC_PER_SEC);dispatch_source_set_timer(self.timer, start, interval, 0);// è®¾ç½®å›è°ƒdispatch_source_set_event_handler(self.timer, ^&#123; NSLog(@&quot;------------%@&quot;, [NSThread currentThread]);&#125;);// å¯åŠ¨å®šæ—¶å™¨dispatch_resume(self.timer); å›¾ç‰‡ä¸‹è½½ç”±äºå›¾ç‰‡æ¸²æŸ“åˆ°å±å¹•éœ€è¦æ¶ˆè€—è¾ƒå¤šèµ„æº, ä¸ºäº†æé«˜ç”¨æˆ·ä½“éªŒ, å½“ç”¨æˆ·æ»šåŠ¨UIscrollviewçš„æ—¶å€™, åªåœ¨åå°ä¸‹è½½å›¾ç‰‡, ä½†æ˜¯ä¸æ˜¾ç¤ºå›¾ç‰‡, å½“ç”¨æˆ·åœä¸‹æ¥çš„æ—¶å€™æ‰æ˜¾ç¤ºå›¾ç‰‡. æ ¸å¿ƒä»£ç å¦‚ä¸‹: 1[self.imageView performSelector:@selector(setImage:) withObject:[UIImage imageNamed:@&quot;placeholder&quot;] afterDelay:3.0 inModes:@[NSDefaultRunLoopMode]]; è¿™æ˜¯å› ä¸ºé™å®šäº†æ–¹æ³•setImageåªèƒ½åœ¨NSDefaultRunLoopMode æ¨¡å¼ä¸‹ä½¿ç”¨. è€Œæ»šåŠ¨UIscrollviewçš„æ—¶å€™, ç¨‹åºè¿è¡Œåœ¨trackingæ¨¡å¼ä¸‹é¢, æ‰€ä»¥æ–¹æ³•setImageä¸ä¼šæ‰§è¡Œ.","path":"2017/08/11/runloopå®è·µ/","date":"08-11","excerpt":""},{"title":"runloop","text":"RunLoopçš„æ¦‚å¿µRunLoopå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ç®¡ç†äº†å…¶éœ€è¦å¤„ç†çš„äº‹ä»¶å’Œæ¶ˆæ¯ï¼Œå¹¶æä¾›ä¸€ä¸ªå…¥å£å‡½æ•°æ‰§è¡ŒEvent Loopçš„é€»è¾‘.çº¿ç¨‹æ‰§è¡Œäº†è¿™ä¸ªå‡½æ•°åï¼Œå°±ä¼šä¸€ç›´å¤„äºè¿™ä¸ªå‡½æ•°å†…éƒ¨â€œæ¥æ”¶æ¶ˆæ¯-&gt; ç­‰å¾… -&gt; å¤„ç†â€çš„å¾ªç¯ä¸­ï¼Œç›´åˆ°è¿™ä¸ªå¾ªç¯ç»“æŸï¼ˆæ¯”å¦‚ä¼ å…¥quitæ¶ˆæ¯ï¼‰. runloopåœ¨iOSå¼€å‘ä¸­çš„ä½œç”¨æ˜¯ï¼š runloopä¿æŒä¸»çº¿ç¨‹ä¸ä¼šè¢«é”€æ¯ï¼Œèƒ½ä¿è¯ç¨‹åºçš„æŒç»­è¿è¡Œ.ï¼ˆç¨‹åºä¸€å¯åŠ¨å°±ä¼šå¼€å¯ä¸€ä¸ªä¸»çº¿ç¨‹ï¼Œä¸»çº¿ç¨‹ä¸­çš„runloopæ˜¯è‡ªåŠ¨åˆ›å»ºå¹¶è¿è¡Œçš„ï¼‰ å¤„ç†Appä¸­çš„å„ç§äº‹ä»¶(å¦‚: touches è§¦æ‘¸äº‹ä»¶, NSTimer å®šæ—¶å™¨äº‹ä»¶ï¼‰ èŠ‚çœCPUèµ„æº, æé«˜ç¨‹åºæ€§èƒ½(æœ‰äº‹æƒ…å°±åšäº‹æƒ…, æ²¡äº‹æƒ…å°±ä¼‘æ¯(å…¶èµ„æºé‡Šæ”¾)). è´Ÿè´£æ¸²æŸ“å±å¹•ä¸Šçš„æ‰€æœ‰UI è·å–çº¿ç¨‹ä¸­çš„runloopè‹¹æœä¸å…è®¸ç›´æ¥åˆ›å»º RunLoop, å®ƒåªæä¾›äº†ä¸¤ä¸ªè‡ªåŠ¨è·å–çš„å‡½æ•°. Foundationï¼š [NSRunLoop currentRunLoop]; // è·å¾—å½“å‰çº¿ç¨‹çš„RunLoopå¯¹è±¡ [NSRunLoop mainRunLoop]; // è·å¾—ä¸»çº¿ç¨‹çš„RunLoopå¯¹è±¡ Core Foundationï¼š CFRunLoopGetCurrent(); // è·å¾—å½“å‰çº¿ç¨‹çš„RunLoopå¯¹è±¡ CFRunLoopGetMain(); // è·å¾—ä¸»çº¿ç¨‹çš„RunLoopå¯¹è±¡ iOSæä¾›äº†ä¸¤ä¸ªè¿™æ ·çš„å¯¹è±¡: NSRunLoop å’Œ CFRunLoopRef. CFRunLoopRef æ˜¯åœ¨ CoreFoundation æ¡†æ¶å†…çš„, å®ƒæä¾›äº†çº¯ C å‡½æ•°çš„ API, æ‰€æœ‰è¿™äº› API éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„.NSRunLoop æ˜¯åŸºäº CFRunLoopRef çš„å°è£…, æä¾›äº†é¢å‘å¯¹è±¡çš„ API, ä½†æ˜¯è¿™äº› API ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„. CFDictionarySetValue(loopsDic, thread, loop)çº¿ç¨‹ä¸RunLoopä¹‹é—´æ˜¯ä¸€ä¸€å¯¹åº”çš„å…³ç³»ï¼Œä¿å­˜åœ¨ä¸€ä¸ªå…¨å±€çš„å­—å…¸ä¸­(key æ˜¯ pthread_t, value æ˜¯ CFRunLoopRef), çº¿ç¨‹åˆšåˆ›å»ºæ—¶æ˜¯æ²¡æœ‰RunLoopçš„, å¦‚æœä¸ä¸»åŠ¨è·å–å°±ä¸€ç›´ä¸ä¼šæœ‰, RunLoopçš„åˆ›å»ºæ˜¯å‘ç”Ÿåœ¨ç¬¬ä¸€æ¬¡è·å–æ—¶, RunLoopçš„é”€æ¯å‘ç”Ÿè‡ªçº¿ç¨‹ç»“æŸæ—¶. åªèƒ½åœ¨ä¸€ä¸ªçº¿ç¨‹çš„å†…éƒ¨è·å–å…¶RunLoop. RunLoop ModeCFRunLoopRefCFRunLoopModeRefCFRunLoopSourceRefCFRunLoopTimerRefCFRunLoopObserverReä»ä¸Šå›¾ä¸­å¯ä»¥çœ‹å‡ºä¸€ä¸ªRunLoopå¯¹è±¡ä¸­å¯ä»¥åŒ…å«å¤šä¸ªMode,æ¯ä¸ªModeåˆåŒ…å«è‹¥å¹²ä¸ª Source/Timer/Observer.ä½†æ˜¯æ¯æ¬¡è°ƒç”¨ RunLoop çš„ä¸»å‡½æ•°æ—¶ï¼Œåªèƒ½æŒ‡å®šå…¶ä¸­ä¸€ä¸ª Modeï¼Œè¿™ä¸ªModeè¢«ç§°ä½œ CurrentMode.å¦‚æœéœ€è¦åˆ‡æ¢ Modeï¼Œåªèƒ½é€€å‡º Loopï¼Œå†é‡æ–°æŒ‡å®šä¸€ä¸ª Mode è¿›å…¥ã€‚è¿™æ ·åšä¸»è¦æ˜¯ä¸ºäº†åˆ†éš”å¼€ä¸åŒç»„çš„ Source/Timer/Observerï¼Œè®©å…¶äº’ä¸å½±å“. å¦‚æœä¸€ä¸ª mode ä¸­ä¸€ä¸ª item éƒ½æ²¡æœ‰, åˆ™ RunLoop ä¼šç›´æ¥é€€å‡º, ä¸è¿›å…¥å¾ªç¯. CFRunLoopSourceRefCFRunLoopSourceRefæ˜¯äº‹ä»¶æº(è¾“å…¥æº), ä¾‹å¦‚å¤–éƒ¨çš„è§¦æ‘¸, ç‚¹å‡»äº‹ä»¶å’Œç³»ç»Ÿå†…éƒ¨è¿›ç¨‹é—´çš„é€šä¿¡ç­‰ source0:éåŸºäºPortçš„,ç”¨äºç”¨æˆ·ä¸»åŠ¨è§¦å‘çš„äº‹ä»¶source1:åŸºäºPortçš„ï¼Œé€šè¿‡å†…æ ¸å’Œå…¶ä»–çº¿ç¨‹ç›¸äº’å‘é€æ¶ˆæ¯ CFRunLoopTimerRefæ˜¯åŸºäºæ—¶é—´çš„è§¦å‘å™¨ï¼Œå®ƒå’Œ NSTimer æ˜¯toll-free bridged çš„ï¼Œå¯ä»¥æ··ç”¨ã€‚å…¶åŒ…å«ä¸€ä¸ªæ—¶é—´é•¿åº¦å’Œä¸€ä¸ªå›è°ƒï¼ˆå‡½æ•°æŒ‡é’ˆï¼‰ã€‚å½“å…¶åŠ å…¥åˆ° RunLoop æ—¶ï¼ŒRunLoopä¼šæ³¨å†Œå¯¹åº”çš„æ—¶é—´ç‚¹ï¼Œå½“æ—¶é—´ç‚¹åˆ°æ—¶ï¼ŒRunLoopä¼šè¢«å”¤é†’ä»¥æ‰§è¡Œé‚£ä¸ªå›è°ƒã€‚å®ƒå—RunLoopçš„Modeå½±å“, GCDçš„å®šæ—¶å™¨ä¸å—RunLoopçš„Modeå½±å“. CFRunLoopObserverRefæ¯ä¸ª Observer éƒ½åŒ…å«äº†ä¸€ä¸ªå›è°ƒ(å‡½æ•°æŒ‡é’ˆ)å½“ RunLoop çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶, è§‚å¯Ÿè€…å°±èƒ½é€šè¿‡å›è°ƒæ¥å—åˆ°è¿™ä¸ªå˜åŒ–. å¯ä»¥è§‚æµ‹çš„æ—¶é—´ç‚¹æœ‰ä»¥ä¸‹å‡ ä¸ª: 123456789typedef CF_OPTIONS(CFOptionFlags, CFRunLoopActivity) &#123; kCFRunLoopEntry = (1UL &lt;&lt; 0), // å³å°†è¿›å…¥Loop ï¼ˆ1ï¼‰ kCFRunLoopBeforeTimers = (1UL &lt;&lt; 1), // å³å°†å¤„ç† Timer ï¼ˆ2ï¼‰ kCFRunLoopBeforeSources = (1UL &lt;&lt; 2), // å³å°†å¤„ç† Source ï¼ˆ4ï¼‰ kCFRunLoopBeforeWaiting = (1UL &lt;&lt; 5), // å³å°†è¿›å…¥ä¼‘çœ  ï¼ˆ32ï¼‰ kCFRunLoopAfterWaiting = (1UL &lt;&lt; 6), // åˆšä»ä¼‘çœ ä¸­å”¤é†’ (64) kCFRunLoopExit = (1UL &lt;&lt; 7), // å³å°†é€€å‡ºLoop (128) kCFRunLoopAllActivities = 0x0FFFFFFU, // åŒ…å«ä¸Šé¢æ‰€æœ‰çŠ¶æ€&#125;; CFRunLoopModeRefç³»ç»Ÿé»˜è®¤æ³¨å†Œäº†5ä¸ªMode: NSDefaultRunLoopMode: Appçš„é»˜è®¤Mode, é€šå¸¸ä¸»çº¿ç¨‹æ˜¯åœ¨è¿™ä¸ªModeä¸‹è¿è¡Œ, App å¹³æ—¶å°±æ˜¯å¤„åœ¨è¿™ä¸ªçŠ¶æ€. UITrackingRunLoopMode: ç•Œé¢è·Ÿè¸ª Mode, ç”¨äº ScrollView è¿½è¸ªè§¦æ‘¸æ»‘åŠ¨, ä¿è¯ç•Œé¢æ»‘åŠ¨æ—¶ä¸å—å…¶ä»– Mode å½±å“. UIInitializationRunLoopMode: åœ¨åˆšå¯åŠ¨ App æ—¶ç¬¬è¿›å…¥çš„ç¬¬ä¸€ä¸ª Mode, å¯åŠ¨å®Œæˆåå°±ä¸å†ä½¿ç”¨. GSEventReceiveRunLoopMode: æ¥å—ç³»ç»Ÿäº‹ä»¶çš„å†…éƒ¨ Mode, é€šå¸¸ç”¨ä¸åˆ°. NSRunLoopCommonModes: è¿™æ˜¯ä¸€ä¸ªå ä½ç”¨çš„Mode, ä¸æ˜¯ä¸€ç§çœŸæ­£çš„Mode. è¿™é‡Œæœ‰ä¸ªæ¦‚å¿µå« â€œCommonModesâ€: ä¸€ä¸ª Mode å¯ä»¥å°†è‡ªå·±æ ‡è®°ä¸ºâ€Commonâ€å±æ€§(é€šè¿‡å°†å…¶ ModeName æ·»åŠ åˆ° RunLoop çš„ â€œcommonModesâ€ ä¸­). æ¯å½“ RunLoop çš„å†…å®¹å‘ç”Ÿå˜åŒ–æ—¶, RunLoop éƒ½ä¼šè‡ªåŠ¨å°† _commonModeItems é‡Œçš„ Source/Observer/Timer åŒæ­¥åˆ°å…·æœ‰ â€œCommonâ€æ ‡è®°çš„æ‰€æœ‰Modeé‡Œ.åº”ç”¨åœºæ™¯ä¸¾ä¾‹: ä¸»çº¿ç¨‹çš„ RunLoop é‡Œæœ‰ä¸¤ä¸ªé¢„ç½®çš„ Modeï¼škCFRunLoopDefaultMode å’Œ UITrackingRunLoopModeã€‚è¿™ä¸¤ä¸ª Mode éƒ½å·²ç»è¢«æ ‡è®°ä¸ºâ€Commonâ€å±æ€§ã€‚DefaultMode æ˜¯ App å¹³æ—¶æ‰€å¤„çš„çŠ¶æ€ï¼ŒTrackingRunLoopMode æ˜¯è¿½è¸ª ScrollView æ»‘åŠ¨æ—¶çš„çŠ¶æ€ã€‚å½“ä½ åˆ›å»ºä¸€ä¸ª Timer å¹¶åŠ åˆ° DefaultMode æ—¶ï¼ŒTimer ä¼šå¾—åˆ°é‡å¤å›è°ƒï¼Œä½†æ­¤æ—¶æ»‘åŠ¨ä¸€ä¸ªTableViewæ—¶ï¼ŒRunLoop ä¼šå°† mode åˆ‡æ¢ä¸º TrackingRunLoopModeï¼Œè¿™æ—¶ Timer å°±ä¸ä¼šè¢«å›è°ƒï¼Œå¹¶ä¸”ä¹Ÿä¸ä¼šå½±å“åˆ°æ»‘åŠ¨æ“ä½œ. æœ‰æ—¶ä½ éœ€è¦ä¸€ä¸ª Timerï¼Œåœ¨ä¸¤ä¸ª Mode ä¸­éƒ½èƒ½å¾—åˆ°å›è°ƒï¼Œä¸€ç§åŠæ³•å°±æ˜¯å°†è¿™ä¸ª Timer åˆ†åˆ«åŠ å…¥è¿™ä¸¤ä¸ª Modeã€‚è¿˜æœ‰ä¸€ç§æ–¹å¼ï¼Œå°±æ˜¯å°† Timer åŠ å…¥åˆ°commonMode ä¸­ã€‚é‚£ä¹ˆæ‰€æœ‰è¢«æ ‡è®°ä¸ºcommonModeçš„modeï¼ˆdefaultModeå’ŒTrackingModeï¼‰éƒ½ä¼šæ‰§è¡Œè¯¥timerã€‚è¿™æ ·ä½ åœ¨æ»‘åŠ¨ç•Œé¢çš„æ—¶å€™ä¹Ÿèƒ½å¤Ÿè°ƒç”¨timer è¿è¡ŒRunLoopå…·ä½“çš„æµç¨‹ å‚è€ƒèµ„æ–™ï¼šæ·±å…¥ç†è§£RunLoop","path":"2017/08/07/runloop/","date":"08-07","excerpt":""},{"title":"runtimeå®è·µ","text":"ä¾‹é¢˜åˆ†æ[self class]ä¸[super class]1234567891011@implementation Son : Father- (id)init &#123; self = [super init]; if (self) &#123; NSLog(@&quot;%@&quot;, NSStringFromClass([self class])); NSLog(@&quot;%@&quot;, NSStringFromClass([super class])); &#125;return self;&#125;@end è¿è¡Œç»“æœï¼š 122017-07-23 12:27:36.776910+0800 Runtime[2173:159137] Son2017-07-23 12:27:36.777059+0800 Runtime[2173:159137] Son å½“è°ƒç”¨[self class]æ—¶, å…ˆè°ƒç”¨çš„æ˜¯ objc_msgSend å‡½æ•°, ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯Sonè¿™ä¸ªç±»çš„å®ä¾‹, ç„¶åå»ç¤ºä¾‹çš„ISA(Sonç±»)ä¸­æ‰¾ - (Class)class è¿™ä¸ªæ–¹æ³•, æ²¡æ‰¾åˆ°, ç„¶åå»Sonç±»çš„çˆ¶ç±»(Fatherç±»)ä¸­æ‰¾, æ²¡æ‰¾åˆ°, ä¸€ç›´æ‰¾åˆ°NSObjectç±»ä¸­æ‰¾åˆ°. è€Œ - (Class)class çš„å®ç°å°±æ˜¯è¿”å›selfçš„ç±»åˆ«, æ•…ä¸Šè¿°è¾“å‡ºç»“æœä¸º Son. å½“è°ƒç”¨[supe class]æ—¶, å…ˆè°ƒç”¨çš„æ˜¯class_getSuperclasså‡½æ•°, è¯¥å‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç»“æ„ä½“ objc_super(ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯self, ç¬¬äºŒä¸ªå‚æ•°æ˜¯å½“å‰å®ä¾‹å˜é‡çš„super_class, å°±æ˜¯Fatherç±»). ç„¶åç›´æ¥ä»å®ä¾‹å˜é‡æ‰€åœ¨ç±»çš„çˆ¶ç±»(Father)å»æ‰¾- (Class)class è¿™ä¸ªæ–¹æ³•, æ²¡æ‰¾åˆ°, ç„¶åå»Sonç±»çš„çˆ¶ç±»(Fatherç±»)ä¸­æ‰¾, æ²¡æ‰¾åˆ°, ä¸€ç›´æ‰¾åˆ°NSObjectç±»ä¸­æ‰¾åˆ°. æœ€åå†…éƒ¨æ˜¯ä½¿ç”¨ objc_msgSend(objc_super-&gt;receiver, @selector(class))å»è°ƒç”¨, æ­¤æ—¶å·²ç»å’Œ[self class]è°ƒç”¨ç›¸åŒäº†, æ•…ä¸Šè¿°è¾“å‡ºç»“æœä»ç„¶è¿”å› Son. isKindOfClassä¸isMemberOfClass1234567BOOL res1 = [[NSObject class] isKindOfClass:[NSObject class]];BOOL res2 = [[NSObject class] isMemberOfClass:[NSObject class]];BOOL res3 = [[Father class] isKindOfClass:[Father class]];BOOL res4 = [[Father class] isMemberOfClass:[Father class]];NSLog(@&quot;%d %d %d %d&quot;, res1, res2, res3, res4); ç»“æœï¼š 12017-07-23 13:03:38.053683+0800 Runtime[2262:176716] 1 0 0 0 å†…éƒ¨å®ç°ï¼š 1234567891011121314151617181920212223242526272829+ (Class)class &#123; return self;&#125;- (Class)class &#123; return object_getClass(self);&#125;Class object_getClass(id obj) &#123; if (obj) return obj-&gt;getIsa(); else return Nil;&#125;- (BOOL)isKindOf:(Class)cls &#123; Class cls; for (cls = isa; cls; cls = cls-&gt;superclass) if (cls == (Class)aClass) return YES; return NO;&#125;+ (BOOL)isKindOfClass:(Class)cls &#123; for (Class tcls = object_getClass((id)self); tcls; tcls = tcls-&gt;superclass) &#123; if (tcls == cls) return YES; &#125; return NO;&#125;- (BOOL)isMemberOf:(Class)cls &#123; return [self class] == cls;&#125;+ (BOOL)isMemberOfClass:(Class)cls &#123; return object_getClass((id)self) == cls;&#125; res1ï¼š[NSObject class]è¿”å›NSObject,æ¥ç€æ‰§è¡Œ + isKindOfClass, object_getClass((id)self)è¿”å›çš„æ˜¯NSObjectçš„isa ä¹Ÿå°±æ˜¯NSObject çš„meta class,æ‰€ä»¥ç¬¬ä¸€æ¬¡å¾ªç¯åˆ¤æ–­ä¸ç­‰ï¼Œç¬¬äºŒæ¬¡tcls = tcls-&gt;superclassä¹Ÿå°±æ˜¯NSObjectæ‰€ä»¥ç›¸ç­‰.ç»“æœä¸ºYES. res2ï¼š[NSObject class]è¿”å›NSObject,æ¥ç€æ‰§è¡Œ+ (BOOL)isMemberOfClass:(Class)cls,ç»“æœä¸ºNO res3ï¼š[Father class]è¿”å›Father,æ¥ç€æ‰§è¡Œ + isKindOfClass, object_getClass((id)self)è¿”å›çš„æ˜¯Fatherçš„isa ä¹Ÿå°±æ˜¯Father çš„meta class,ç¬¬äºŒæ¬¡tcls = tcls-&gt;superclassä¹Ÿå°±æ˜¯NSObjectçš„Meta Class,ç¬¬ä¸‰æ¬¡æ˜¯NSObjectçš„Meta Classçš„superclassä¹Ÿå°±æ˜¯NSObject,ç¬¬å››æ¬¡æ˜¯NSObjectçš„superclass ä¸ºnilã€‚é€€å‡ºå¾ªç¯ï¼Œç»“æœä¸ºNO. [Father class]è¿”å›Father,æ¥ç€æ‰§è¡Œ+ (BOOL)isMemberOfClass:(Class)cls,ç»“æœä¸ºNO Category123456789101112131415161718ä¸‹é¢çš„ä»£ç ä¼šï¼ŸCompile Error / Runtime Crash / NSLogâ€¦? @interface NSObject (Student) + (void)foo; - (void)foo; @end @implementation NSObject (Student) - (void)foo &#123; NSLog(@&quot;IMP: -[NSObject(Student) foo]&quot;); &#125;@end#import &quot;NSObject+Student.h&quot;int main(int argc, char * argv[]) &#123; @autoreleasepool &#123; [NSObject foo]; [[NSObject new] foo]; return UIApplicationMain(argc, argv, nil, NSStringFromClass([AppDelegate class])); &#125;&#125; ç»“æœï¼š 122017-07-23 13:34:33.595243+0800 Runtime[12538:440536] IMP: -[NSObject(Student) foo]2017-07-23 13:34:33.595243+0800 Runtime[12538:440536] IMP: -[NSObject(Student) foo] åˆ†æï¼šcategoryä¸­æ–°å¢çš„æ–¹æ³•, å¦‚æœæ˜¯å®ä¾‹æ–¹æ³•, åè®®ä»¥åŠå±æ€§æ˜¯ç›´æ¥æ·»åŠ åˆ°å½“å‰ç±»ä¸Šé¢, å¦‚æœæ˜¯ç±»æ–¹æ³•å’Œåè®®åˆ™ä¼šæ·»åŠ åˆ°å½“å‰ç±»çš„åŸç±»ä¸Šé¢å». æ‰€ä»¥è°ƒç”¨[NSObject foo]æ—¶, ç”±äºæ˜¯ç±»æ–¹æ³•, æ ¹æ®objc_msgSendçš„ç›¸å…³çŸ¥è¯†, ä¼šå…ˆåœ¨NSObject(Class)çš„isaä¸­ä¹Ÿå°±æ˜¯NSObjectçš„meta-classä¸­, å»æŸ¥æ‰¾fooæ–¹æ³•çš„IMP, æ²¡æ‰¾åˆ°, ç„¶åå»NSObjectçš„meta-classçš„superclass(NSObject)ä¸­æ‰¾, æ‰¾åˆ°äº†, æ‰§è¡Œfooæ–¹æ³•. è°ƒç”¨[[NSObject new] foo]æ—¶, ä¼šå…ˆåœ¨NSObject(Object)çš„isaä¸­, ä¹Ÿå°±æ˜¯NSObject(Class)ä¸­æ‰¾, æ‰¾åˆ°äº†, ç›´æ¥æ‰§è¡Œ, è¾“å‡ºç»“æœ. Runtimeçš„å¸¸è§ç”¨æ³•Method SwizzlingMethod Swizzlingæœ¬è´¨ä¸Šå°±æ˜¯å¯¹IMPå’ŒSELè¿›è¡Œäº¤æ¢, å½“Method Swilzzlingä»£ç æ‰§è¡Œå®Œæ¯•ä¹‹åäº’æ¢æ‰èµ·ä½œç”¨, Method Swizzlingä¹Ÿæ˜¯iOSä¸­AOP(é¢ç›¸åˆ‡é¢ç¼–ç¨‹)çš„ä¸€ç§å®ç°æ–¹å¼. æˆ‘ä»¬æ›¿æ¢ViewControllerçš„viewWillAppear:æ–¹æ³•ä¸ºä¾‹, ä½¿ç”¨æ–¹å¼å¦‚ä¸‹: 123456789101112131415161718192021222324252627@implementation ViewController (MethodSwizzling)+ (void)load &#123; static dispatch_once_t once; dispatch_once(&amp;once, ^&#123; Class class = [self class]; //è¿™é‡Œéœ€è¦æ³¨æ„, å¦‚æœè¦Swizzlingç±»æ–¹æ³•åˆ™è¦è·å–å½“å‰ç±»çš„åŸç±», å› ä¸ºæ ¹æ®objc_msgSend, å®ä¾‹æ–¹æ³•æˆ‘ä»¬ä»å¯¹è±¡çš„isaä¹Ÿå°±æ˜¯å¯¹è±¡æ‰€åœ¨çš„ç±»ä¸­å¼€å§‹æ‰¾, ç±»æ–¹æ³•åˆ™æ˜¯ä»ç±»çš„isaä¹Ÿå°±æ˜¯ç±»çš„åŸç±»ä¸­å¼€å§‹æ‰¾. object_getClass((id)self) ä¸ [self class] è¿”å›çš„ç»“æœç±»å‹éƒ½æ˜¯ Class, ä½†å‰è€…ä¸ºå…ƒç±», åè€…ä¸ºå…¶æœ¬èº«. // Class class = object_getClass((id)self); SEL originalSelector = @selector(viewWillAppear:); SEL swizzledSelector = @selector(xxx_viewWillAppear:); Method originalMethod = class_getInstanceMethod(class, originalSelector); Method swizzledMethod = class_getInstanceMethod(class, swizzledSelector); //æˆ‘ä»¬å…ˆæŠŠè¦æ›¿æ¢çš„ç±»æ·»åŠ åˆ°categoryä¸­ BOOL didAddMethod = class_addMethod(class, originalSelector, method_getImplementation(swizzledMethod), method_getTypeEncoding(swizzledMethod)); if (didAddMethod) &#123; //class_replaceMethodç›¸å½“äºç›´æ¥è°ƒç”¨class_addMethodå‘ç±»ä¸­æ·»åŠ è¯¥æ–¹æ³•çš„å®ç° class_replaceMethod(class, swizzledSelector, method_getImplementation(originalMethod), method_getTypeEncoding(originalMethod)); &#125; else &#123; //äº¤æ¢IMP, IMPæ˜¯å‡½æ•°æŒ‡é’ˆ, ç›´æ¥æŒ‡å‘æ–¹æ³•çš„å†…å­˜åœ°å€ method_exchangeImplementations(originalMethod, swizzledMethod); &#125; &#125;);&#125;- (void)xxx_viewWillAppear:(BOOL)animated &#123; [self xxx_viewWillAppear:animated]; NSLog(@&quot;%@ viewWillAppear&quot;, self);&#125;@end è¿™é‡Œæœ‰å‡ ç‚¹æ˜¯è¦æ³¨æ„çš„: Objective-Cåœ¨è¿è¡Œæ—¶ä¼šè‡ªåŠ¨è°ƒç”¨ç±»çš„ä¸¤ä¸ªæ–¹æ³•+loadå’Œ+initialize. +loadä¼šåœ¨ç±»åˆå§‹åŠ è½½æ—¶è°ƒç”¨, +initializeæ–¹æ³•æ˜¯ä»¥æ‡’åŠ è½½çš„æ–¹å¼è¢«è°ƒç”¨çš„, åªæœ‰å½“ä½ ç»™æŸä¸ªç±»æˆ–å®ƒçš„å­ç±»å‘é€æ¶ˆæ¯, é‚£ä¹ˆè¿™ä¸ªç±»çš„+initializeæ–¹æ³•æ‰ä¼šè¢«è°ƒç”¨. æ‰€ä»¥Swizzlingè¦å†™åœ¨+loadæ–¹æ³•ä¸­, å› ä¸ºå†™åœ¨+initializeæ–¹æ³•ä¸­, æ˜¯æœ‰å¯èƒ½æ°¸è¿œéƒ½ä¸è¢«æ‰§è¡Œ. Swizzlingåº”è¯¥åªè¢«æ‰§è¡Œä¸€æ¬¡, å¦‚æœSwizzlingçš„æ–¹æ³•è¢«å¤šæ¬¡æ‰§è¡Œ, é‚£ä¹ˆå°±æœ‰å¯èƒ½é€ æˆSwizzlingå¤±æ•ˆ, æ‰€ä»¥æˆ‘ä»¬è¦ç”¨dispatch_onceæ¥ä¿è¯åªè¢«æ‰§è¡Œä¸€æ¬¡. Swizzlingåœ¨+loadä¸­æ‰§è¡Œæ—¶, ä¸è¦è°ƒç”¨[super load]. å¦‚æœæ˜¯å¤šç»§æ‰¿, å¹¶ä¸”å¯¹åŒä¸€ä¸ªæ–¹æ³•éƒ½è¿›è¡Œäº†Swizzling, é‚£ä¹ˆè°ƒç”¨[super load]ä»¥å, çˆ¶ç±»çš„Swizzlingå°±å¤±æ•ˆäº†. åœ¨swizzlingçš„è¿‡ç¨‹ä¸­, æ–¹æ³•ä¸­çš„[self xxx_viewWillAppear:animated]å·²ç»è¢«é‡æ–°æŒ‡å®šåˆ°UIViewControllerç±»çš„-viewWillAppear:ä¸­. è¿™æ—¶ä¸ä¼šäº§ç”Ÿæ— é™å¾ªç¯. å¦‚æœæˆ‘ä»¬è°ƒç”¨çš„æ˜¯[self viewWillAppear:animated], å› ä¸ºviewWillAppear:è¢«é‡å®šå‘åˆ°xxx_viewWillAppear:, å°±ä¼šäº§ç”Ÿæ— é™å¾ªç¯. å¦‚æœè¦Swizzlingç±»æ–¹æ³•åˆ™è¦è·å–å½“å‰ç±»çš„åŸç±», å› ä¸ºæ ¹æ®objc_msgSend, å®ä¾‹æ–¹æ³•æˆ‘ä»¬ä»å¯¹è±¡çš„isaä¹Ÿå°±æ˜¯å¯¹è±¡æ‰€åœ¨çš„ç±»ä¸­å¼€å§‹æ‰¾, ç±»æ–¹æ³•åˆ™æ˜¯ä»ç±»çš„isaä¹Ÿå°±æ˜¯ç±»çš„åŸç±»ä¸­å¼€å§‹æ‰¾. object_getClass((id)self) ä¸ [self class] è¿”å›çš„ç»“æœç±»å‹éƒ½æ˜¯ Class, ä½†å‰è€…ä¸ºå…ƒç±», åè€…ä¸ºå…¶æœ¬èº«. æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ä¸ªæ¥åšä¸€äº›å¼‚å¸¸ä¿æŠ¤, ä¾‹å¦‚æ•°ç»„çš„è¶Šç•Œé—®é¢˜, æˆ‘ä»¬å¯ä»¥Swizzlingæ•°ç»„çš„objectAtIndex:æ–¹æ³•, åœ¨æ–°æ–¹æ³•ä¸­åšä¸€äº›å¼‚å¸¸å¤„ç†, æ¥æŠ›å‡ºä¸€äº›å¼‚å¸¸ä¿¡æ¯, æ–¹ä¾¿æˆ‘ä»¬å®šä½é—®é¢˜. NSCodingçš„è‡ªåŠ¨å½’æ¡£å’Œè‡ªåŠ¨è§£æ¡£ä¸»è¦æ€è·¯æ˜¯è·å–æˆå‘˜å˜é‡åˆ—è¡¨, åˆ©ç”¨KVCè¯»å–å’Œèµ‹å€¼æ¥å®ŒæˆencodeWithCoderå’ŒinitWithCoder. 123456789101112131415161718192021222324252627282930#import &quot;Student.h&quot;#import &lt;objc/runtime.h&gt;#import &lt;objc/message.h&gt;@implementation Student- (void)encodeWithCoder:(NSCoder *)aCoder&#123; unsigned int outCount = 0; Ivar *vars = class_copyIvarList([self class], &amp;outCount); for (int i = 0; i &lt; outCount; i ++) &#123; Ivar var = vars[i]; const char *name = ivar_getName(var); NSString *key = [NSString stringWithUTF8String:name]; id value = [self valueForKey:key]; [aCoder encodeObject:value forKey:key]; &#125;&#125;- (nullable __kindof)initWithCoder:(NSCoder *)aDecoder&#123; if (self = [super init]) &#123; unsigned int outCount = 0; Ivar *vars = class_copyIvarList([self class], &amp;outCount); for (int i = 0; i &lt; outCount; i ++) &#123; Ivar var = vars[i]; const char *name = ivar_getName(var); NSString *key = [NSString stringWithUTF8String:name]; id value = [aDecoder decodeObjectForKey:key]; [self setValue:value forKey:key]; &#125; &#125; return self;&#125;@end å‚è€ƒèµ„æ–™ï¼š ç¥ç»ç—…é™¢ Objective-C Runtime å…¥é™¢ç³»åˆ— Objective-C Runtime Objective-C Runtime è¿è¡Œæ—¶ç³»åˆ— iOS å¦‚ä½•å®ç° Aspect Oriented Programming Method Swizzling å’Œ AOP å®è·µ åˆ¨æ ¹é—®åº•Objectiveï¼C Runtime æ·±å…¥ç†è§£Objective-Cï¼šCategory Objective-C æ¶ˆæ¯å‘é€ä¸è½¬å‘æœºåˆ¶åŸç†","path":"2017/07/23/runtimeå®è·µ/","date":"07-23","excerpt":""},{"title":"iOSä¸­çš„runtime","text":"Objective-Cæ˜¯Cçš„è¯­è¨€çš„è¶…é›†,Cæ˜¯ä¸€é—¨é™æ€è¯­è¨€è€ŒObjective-Cå´æ˜¯ä¸€é—¨åŠ¨æ€è¯­è¨€,è¿™ä¸ªåŠ¨æ€ç‰¹æ€§å°±æ˜¯ç”±åŸºäºSmalltalkæ¶ˆæ¯ä¼ é€’ç‰¹æ€§çš„Runtimeæ¥æä¾›çš„.çº¯Swiftç±»æ²¡æœ‰åŠ¨æ€æ€§ï¼Œä½†åœ¨æ–¹æ³•ã€å±æ€§å‰æ·»åŠ dynamicä¿®é¥°å¯ä»¥è·å¾—åŠ¨æ€æ€§ã€‚ Runtimeç®€ä»‹Objective-Cåœ¨ä¸‰ç§å±‚é¢ä¸Šä¸Runtimeç³»ç»Ÿè¿›è¡Œäº¤äº’: é€šè¿‡ Objective-C æºä»£ç Runtime ç³»ç»Ÿè‡ªåŠ¨åœ¨å¹•åæŠŠæˆ‘ä»¬å†™çš„æºä»£ç åœ¨ç¼–è¯‘é˜¶æ®µè½¬æ¢æˆè¿è¡Œæ—¶ä»£ç , åœ¨è¿è¡Œæ—¶ç¡®å®šå¯¹åº”çš„æ•°æ®ç»“æ„å’Œè°ƒç”¨å…·ä½“å“ªä¸ªæ–¹æ³•. é€šè¿‡ Foundation æ¡†æ¶çš„ NSObject ç±»å®šä¹‰çš„æ–¹æ³•NSObjectç±»æ˜¯éµå®ˆNSObjectåè®®çš„, åœ¨è¿™ä¸ªåè®®é‡Œé¢æœ‰å¾ˆå¤šæ–¹æ³•æ˜¯å’ŒRuntimeç›¸å…³, æˆ–è€…ç›´æ¥ä»Runtimeä¸­è·å–ä¿¡æ¯çš„. é€šè¿‡å¯¹ Runtime åº“å‡½æ•°çš„ç›´æ¥è°ƒç”¨åœ¨è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸‹, ç³»ç»Ÿæœ¬èº«æ˜¯é»˜è®¤å…³é—­äº†Runtimeçš„ä»£ç æç¤ºçš„, æˆ‘ä»¬éœ€è¦åœ¨BuildSettings -&gt; Enable Strict Checking objc_msgSend Calls -&gt;è®¾ç½®ä¸ºNOObjective-C çš„ Runtime ä¸ºæˆ‘ä»¬æä¾›äº†å¾ˆå¤šè¿è¡Œæ—¶çŠ¶æ€ä¸‹è·Ÿç±»ä¸å¯¹è±¡ç›¸å…³çš„å‡½æ•°,å…·ä½“çš„å¯ä»¥çœ‹Objective-C Runtime Reference. Runtime åŸºç¡€æ•°æ®ç»“æ„Object(å¯¹è±¡), Class(ç±»), Meta Class(åŸç±»), id. é€šè¿‡objc_classçš„å®šä¹‰æˆ‘ä»¬å¤§è‡´å¯ä»¥çœ‹å‡ºä»–ä»¬ä¹‹é—´çš„å…³ç³»: 12345678910111213141516171819202122232425typedef struct objc_class *Class; typedef struct objc_object *id;@interface Object &#123; Class isa; &#125;@interface NSObject &lt;NSObject&gt; &#123; Class isa OBJC_ISA_AVAILABILITY;&#125;struct objc_object &#123; private: isa_t isa;&#125;struct objc_class : objc_object &#123; // Class ISA; Class superclass; cache_t cache; // formerly cache pointer and vtable class_data_bits_t bits; // class_rw_t * plus custom rr/alloc flags&#125;union isa_t &#123; isa_t() &#123; &#125; isa_t(uintptr_t value) : bits(value) &#123; &#125; Class cls; uintptr_t bits;&#125; idåœ¨Objective-Cä¸­å¯ä»¥ä»£æŒ‡ä»»æ„çš„å¯¹è±¡ç±»å‹ï¼Œä»–æ˜¯ä¸€ä¸ªæŒ‡å‘objc_objectç»“æ„ä½“çš„æŒ‡é’ˆï¼ˆtypedef struct objc_object *id;è¿™ä¸ªstructçš„å®šä¹‰æœ¬èº«å°±å¸¦äº†ä¸€ä¸ª , æ‰€ä»¥æˆ‘ä»¬åœ¨ä½¿ç”¨å…¶ä»–NSObjectç±»å‹çš„å®ä¾‹æ—¶éœ€è¦åœ¨å‰é¢åŠ ä¸Š , è€Œä½¿ç”¨ id æ—¶å´ä¸ç”¨ï¼‰ é‚£ä¹ˆä»€ä¹ˆæ˜¯ objc_object å‘¢? Objective-Cä¸­çš„Object(objc_object)åœ¨æœ€åä¼šè¢«è½¬æ¢æˆCçš„ç»“æ„ä½“, è€Œåœ¨è¿™ä¸ªstructä¸­æœ‰ä¸€ä¸ª isa_t ç±»å‹çš„ç»“æ„ä½“isa, é€šè¿‡æŸ¥çœ‹ isa_t æˆ‘ä»¬å‘ç°å®ƒé‡Œé¢æœ‰ä¸€ä¸ªæŒ‡å‘å®ƒçš„ç±»åˆ« Class(å®šä¹‰äº†å¯¹è±¡æ‰€å±çš„ç±»). æ³¨æ„: isa æŒ‡é’ˆä¸æ€»æ˜¯æŒ‡å‘å®ä¾‹å¯¹è±¡æ‰€å±çš„ç±», ä¸èƒ½ä¾é å®ƒæ¥ç¡®å®šç±»å‹, è€Œæ˜¯åº”è¯¥ç”¨ class æ–¹æ³•æ¥ç¡®å®šå®ä¾‹å¯¹è±¡çš„ç±». 123456789101112struct objc_object &#123; private: isa_t isa;public: // initIsa() should be used to init the isa of new objects only. // If this object already has an isa, use changeIsa() for correctness. // initInstanceIsa(): objects with no custom RR/AWZ void initIsa(Class cls /*indexed=false*/); void initInstanceIsa(Class cls, bool hasCxxDtor);private: void initIsa(Class newCls, bool indexed, bool hasCxxDtor);&#125; 3.é‚£ä¹ˆä»€ä¹ˆæ˜¯ Class å‘¢? Class å…¶å®æ˜¯ä¸€ä¸ªæŒ‡å‘ objc_class ç»“æ„ä½“çš„æŒ‡é’ˆï¼ˆtypedef struct objc_class *Class;ï¼‰ 123456struct objc_class : objc_object &#123; // Class ISA; Class superclass; cache_t cache; // formerly cache pointer and vtable class_data_bits_t bits; // class_rw_t * plus custom rr/alloc flags&#125; æ€»ç»“: Classåœ¨è®¾è®¡ä¸­æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡. è€Œè¿™ä¸ªClasså¯¹è±¡çš„å¯¹åº”çš„ç±», æˆ‘ä»¬å«å®ƒ Meta Class, å®ƒç”¨æ¥è¡¨è¿°ç±»å¯¹è±¡æœ¬èº«æ‰€å…·å¤‡çš„å…ƒæ•°æ®, ç±»æ–¹æ³•å°±å®šä¹‰äºæ­¤å¤„, å› ä¸ºè¿™äº›æ–¹æ³•å¯ä»¥ç†è§£æˆç±»å¯¹è±¡çš„å®ä¾‹æ–¹æ³•. æ¯ä¸ªç±»ä»…æœ‰ä¸€ä¸ªç±»å¯¹è±¡, è€Œæ¯ä¸ªç±»å¯¹è±¡ä»…æœ‰ä¸€ä¸ªä¸ä¹‹ç›¸å…³çš„å…ƒç±». å³Classç»“æ„ä½“ä¸­çš„ isa æŒ‡å‘çš„å°±æ˜¯å®ƒçš„ Meta Class. æˆ‘ä»¬å¯ä»¥æŠŠMeta Classç†è§£ä¸ºä¸€ä¸ªClasså¯¹è±¡çš„Class. å½“æˆ‘ä»¬ç»™ä¸€ä¸ªNSObjectå¯¹è±¡å‘é€æ¶ˆæ¯æ—¶(å®ä¾‹æ–¹æ³•), è¿™æ¡æ¶ˆæ¯ä¼šåœ¨å¯¹è±¡æ‰€å±çš„ç±»çš„æ–¹æ³•åˆ—è¡¨é‡ŒæŸ¥æ‰¾. å½“æˆ‘ä»¬å‘é€ä¸€ä¸ªæ¶ˆæ¯ç»™ä¸€ä¸ªç±»æ—¶(ç±»æ–¹æ³•), è¿™æ¡æ¶ˆæ¯ä¼šåœ¨ç±»çš„Meta Classçš„æ–¹æ³•åˆ—è¡¨é‡ŒæŸ¥æ‰¾. ä¸‹é¢è¿™ä¸ªå›¾å¾ˆå¥½åœ°è¯´æ˜äº†Object, Class, Meta Classä¹‹é—´çš„å…³ç³». æ¯ä¸ªå®ä¾‹(Object)çš„isaæŒ‡é’ˆéƒ½æŒ‡å‘è¯¥å®ä¾‹æ‰€å±çš„ç±». æ¯ä¸ªç±»(Class)çš„isaæŒ‡é’ˆéƒ½æŒ‡å‘ä¸ºä¸€ä¸ªè¯¥ç±»æ‰€å±çš„Meta Class(åŸç±»). æ¯ä¸ªMeta Class(åŸç±»)çš„isaæŒ‡é’ˆéƒ½æŒ‡å‘Root Class(Meta)(æ ¹åŸç±»), å¤§éƒ¨åˆ†æƒ…å†µæ˜¯éƒ½æ˜¯NSObject. Root class(meta)çš„superclassæŒ‡å‘Root class(Class), ä¹Ÿå°±æ˜¯NSObject, å½¢æˆä¸€ä¸ªå›è·¯. Root class(Class)å…¶å®å°±æ˜¯NSObject, NSObjectæ˜¯æ²¡æœ‰è¶…ç±»çš„, æ‰€ä»¥Root class(Class)çš„superclassæŒ‡å‘nil. isa_tobjc_object ç»“æ„ä½“åŒ…å«ä¸€ä¸ª isa æŒ‡é’ˆ, ç±»å‹ä¸º isa_t è”åˆä½“. å› ä¸º isa_t ä½¿ç”¨ union å®ç°, æ‰€ä»¥å¯èƒ½è¡¨ç¤ºå¤šç§å½¢æ€, æ—¢å¯ä»¥å½“æˆæ˜¯æŒ‡é’ˆ, ä¹Ÿå¯ä»¥å­˜å‚¨æ ‡å¿—ä½. æœ‰å…³ isa_t è”åˆä½“çš„æ›´å¤šå†…å®¹å¯ä»¥æŸ¥çœ‹Objective-C å¼•ç”¨è®¡æ•°åŸç†. 1234567union isa_t &#123; isa_t() &#123; &#125; isa_t(uintptr_t value) : bits(value) &#123; &#125; Class cls; uintptr_t bits;&#125; cache_tcache_t å‡ºç°åœ¨ objc_class ä¸­, cache_t ä¸­å­˜å‚¨äº†ä¸€ä¸ª bucket_t çš„ç»“æ„ä½“ _buckets ï¼Œå’Œä¸¤ä¸ªunsigned int çš„å˜é‡ _mask å’Œ _occupied. _mask åˆ†é…ç”¨æ¥ç¼“å­˜bucketçš„æ€»æ•°, _occupied è¡¨æ˜ç›®å‰å®é™…å ç”¨çš„ç¼“å­˜bucketçš„ä¸ªæ•°. bucket_t çš„ç»“æ„ä½“ä¸­å­˜å‚¨äº†ä¸€ä¸ª unsigned long å’Œä¸€ä¸ª IMP. IMPæ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆ, æŒ‡å‘äº†ä¸€ä¸ªæ–¹æ³•çš„å…·ä½“å®ç°. bucket_t *_bucketså…¶å®å°±æ˜¯ä¸€ä¸ªæ•£åˆ—è¡¨, ç”¨æ¥å­˜å‚¨Methodçš„é“¾è¡¨. Cache çš„ä½œç”¨ä¸»è¦æ˜¯ä¸ºäº†ä¼˜åŒ–æ–¹æ³•è°ƒç”¨çš„æ€§èƒ½. å½“å¯¹è±¡receiverè°ƒç”¨æ–¹æ³•messageæ—¶, é¦–å…ˆæ ¹æ®å¯¹è±¡receiver çš„ isa æŒ‡é’ˆæŸ¥æ‰¾åˆ°å®ƒå¯¹åº”çš„ç±», ç„¶ååœ¨ç±»çš„ methodLists ä¸­æœç´¢æ–¹æ³•, å¦‚æœæ²¡æœ‰æ‰¾åˆ°, å°±ä½¿ç”¨ super_class æŒ‡é’ˆåˆ°çˆ¶ç±»ä¸­çš„ methodLists æŸ¥æ‰¾, ä¸€æ—¦æ‰¾åˆ°å°±è°ƒç”¨æ–¹æ³•. å¦‚æœæ²¡æœ‰æ‰¾åˆ°, æœ‰å¯èƒ½æ¶ˆæ¯è½¬å‘, ä¹Ÿå¯èƒ½å¿½ç•¥å®ƒ. ä½†è¿™æ ·æŸ¥æ‰¾æ–¹å¼æ•ˆç‡å¤ªä½, æ‰€ä»¥ä½¿ç”¨Cacheæ¥ç¼“å­˜ç»å¸¸è°ƒç”¨çš„æ–¹æ³•, å½“è°ƒç”¨æ–¹æ³•æ—¶, ä¼˜å…ˆåœ¨CacheæŸ¥æ‰¾, å¦‚æœæ²¡æœ‰æ‰¾åˆ°, å†åˆ°methodListsæŸ¥æ‰¾. 123456789101112131415161718192021222324//cache_tç»“æ„struct cache_t &#123; struct bucket_t *_buckets; mask_t _mask; mask_t _occupied;&#125; typedef unsigned int uint32_t; typedef uint32_t mask_t; // x86_64 &amp; arm64 asm are less efficient with 16-bits typedef unsigned long uintptr_t; typedef uintptr_t cache_key_t; struct bucket_t &#123; private: cache_key_t _key; IMP _imp;public: inline cache_key_t key() const &#123; return _key; &#125; inline IMP imp() const &#123; return (IMP)_imp; &#125; inline void setKey(cache_key_t newKey) &#123; _key = newKey; &#125; inline void setImp(IMP newImp) &#123; _imp = newImp; &#125; void set(cache_key_t newKey, IMP newImp);&#125; class_data_bits_t1234567891011121314151617181920212223242526272829303132333435363738394041424344//class_data_bits_tç»“æ„struct class_data_bits_t &#123; // Values are the FAST_ flags above. uintptr_t bits;&#125; struct class_rw_t &#123; uint32_t flags; uint32_t version; const class_ro_t *ro; method_array_t methods; property_array_t properties; protocol_array_t protocols; Class firstSubclass; Class nextSiblingClass; char *demangledName;&#125; struct class_ro_t &#123; uint32_t flags; uint32_t instanceStart; uint32_t instanceSize;#ifdef __LP64__ uint32_t reserved;#endif const uint8_t * ivarLayout; const char * name; method_list_t * baseMethodList; protocol_list_t * baseProtocols; const ivar_list_t * ivars; const uint8_t * weakIvarLayout; property_list_t *baseProperties; method_list_t *baseMethods() const &#123; return baseMethodList; &#125;&#125;; ä¸Šé¢è¿™å¼ å›¾å¾ˆå¥½åœ°è¯´æ˜äº† class_data_bits_t çš„ä½œç”¨. è¯¦è§æ·±å…¥è§£æ ObjC ä¸­æ–¹æ³•çš„ç»“æ„. å¤§è‡´è¯´æ˜ä¸€ä¸‹å°±æ˜¯, Objcçš„ç±»çš„å±æ€§, æ–¹æ³•, ä»¥åŠéµå¾ªçš„åè®®åœ¨obj 2.0çš„ç‰ˆæœ¬ä¹‹åéƒ½æ”¾åœ¨ class_rw_t ä¸­. class_ro_t æ˜¯ä¸€ä¸ªæŒ‡å‘å¸¸é‡çš„æŒ‡é’ˆ, å­˜å‚¨æ¥ç¼–è¯‘å™¨å†³å®šäº†çš„å±æ€§ã€æ–¹æ³•å’Œéµå®ˆåè®®. åœ¨è¿è¡Œæ—¶å‘æ¶ˆæ¯æ—¶, ä¼šä» class_data_bits_t è°ƒç”¨ data æ–¹æ³•, å°†ç»“æœä» class_rw_t å¼ºåˆ¶è½¬æ¢ä¸º class_ro_t æŒ‡é’ˆ. æœ€åè°ƒç”¨ methodizeClass æ–¹æ³•, æŠŠç±»é‡Œé¢çš„å±æ€§, åè®®, æ–¹æ³•éƒ½åŠ è½½è¿›æ¥. æ–¹æ³•ä¸æ¶ˆæ¯SELSEL åˆå«åšæ–¹æ³•é€‰æ‹©å™¨, æ˜¯è¡¨ç¤ºä¸€ä¸ªæ–¹æ³•çš„ selector çš„æŒ‡é’ˆ, å®šä¹‰å¦‚ä¸‹: 1typedef struct objc_selector *SEL; OCåœ¨ç¼–è¯‘æ—¶ï¼Œä¼šä¾æ®æ¯ä¸€ä¸ªæ–¹æ³•çš„åå­—ï¼Œå‚æ•°åºåˆ—ï¼Œç”Ÿæˆä¸€ä¸ªå”¯ä¸€æ•´å½¢æ ‡è¯†ï¼ˆIntç±»å‹çš„åœ°å€ï¼‰ï¼Œè¿™ä¸ªæ ‡è¯†å°±æ˜¯SEL.ä¸åŒç±»çš„ä¸åŒæ–¹æ³•ï¼Œåªè¦æ–¹æ³•åç›¸åŒï¼Œå“ªæ€•å‚æ•°ç±»å‹ä¸åŒï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•çš„SELå°±æ˜¯ä¸€æ ·çš„.åŒä¸€ä¸ªç±»ä¸­å°±ä¸èƒ½å­˜åœ¨ä¸¤ä¸ªæ–¹æ³•åä¸€è‡´ï¼Œå‚æ•°ä¸ä¸€è‡´ï¼Œè¿™æ ·ç¼–è¯‘å™¨å°±ä¼šæŠ¥é”™.ä½†ä¸åŒçš„ç±»å°±å¯ä»¥ï¼Œå› ä¸ºä¸åŒç±»çš„å®ä¾‹å¯¹è±¡æ‰§è¡Œæ–¹æ³•æ—¶ï¼Œæ˜¯ä»å„è‡ªç±»çš„æ–¹æ³•åˆ—è¡¨ä¸­æ ¹æ®selectorå»å¯»æ‰¾è‡ªå·±å¯¹åº”çš„IMP. å·¥ç¨‹ä¸­æ‰€æœ‰çš„SELç»„åˆæˆä¸€ä¸ªseté›†åˆï¼Œå› æ­¤SELæ˜¯å”¯ä¸€çš„.setä¸­çš„å…ƒç´ éƒ½æ˜¯å”¯ä¸€çš„ï¼Œæ‰€ä»¥SELä¹Ÿæ˜¯å”¯ä¸€çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰¾ä¸€ä¸ªselectorï¼Œé€šè¿‡ä»–å¯¹åº”çš„SELæ˜¯æœ€å¿«çš„æ–¹æ³•.SELå®é™…å°±æ˜¯æ ¹æ®æ–¹æ³•åHashè¿‡çš„ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆè¿™ä¹Ÿè§£é‡Šäº†ä¸Šé¢ç›¸åŒæ–¹æ³•åç¼–è¯‘ä¸ºä»€ä¹ˆæŠ¥é”™çš„åŸå› ï¼‰ï¼Œå­—ç¬¦ä¸²çš„æ¯”è¾ƒåªéœ€æ¯”è¾ƒåœ°å€å°±å¯ä»¥äº†ï¼Œé€Ÿåº¦éå¸¸å¿«.æœ¬è´¨ä¸Šï¼ŒSELåªæ˜¯ä¸€ä¸ªæŒ‡å‘æ–¹æ³•çš„æŒ‡é’ˆï¼ˆå‡†ç¡®çš„è¯´ï¼Œåªæ˜¯ä¸€ä¸ªæ ¹æ®æ–¹æ³•åhashåŒ–çš„KEYå€¼ï¼Œèƒ½å”¯ä¸€ä»£è¡¨ä¸€ä¸ªæ–¹æ³•ï¼‰ï¼Œå®ƒçš„å­˜åœ¨åªæ˜¯ä¸ºäº†åŠ å¿«æ–¹æ³•çš„æŸ¥è¯¢é€Ÿåº¦ æˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œæ—¶æ·»åŠ å’Œè·å–selectorï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¸‹é¢å‡ ç§æ–¹æ³•æ¥è·å–SEL: 1231. sel_registerNameå‡½æ•°2. Objective-Cç¼–è¯‘å™¨æä¾›çš„@selector()3. NSSelectorFromString()æ–¹æ³• IMPIMPå®é™…ä¸Šæ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼ŒæŒ‡å‘æ–¹æ³•å®ç°çš„åœ°å€ï¼Œå®šä¹‰å¦‚ä¸‹ 1id (*IMP)(id, SEL,...) è¯¥å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯selfçš„æŒ‡é’ˆï¼Œå¦‚æœæ˜¯å®ä¾‹æ–¹æ³•ï¼Œåˆ™æ˜¯ç±»å®ä¾‹çš„å†…å­˜åœ°å€ï¼›å¦‚æœæ˜¯ç±»æ–¹æ³•ï¼Œåˆ™æ˜¯æŒ‡å‘å…ƒç±»çš„æŒ‡é’ˆ.ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ–¹æ³•é€‰æ‹©å™¨ï¼Œåé¢æ˜¯æ–¹æ³•çš„å‚æ•°åˆ—è¡¨. æ¯ä¸ªæ–¹æ³•å¯¹åº”å”¯ä¸€çš„SELï¼Œæˆ‘ä»¬é€šè¿‡SELå°±æ˜¯ä¸ºäº†æŸ¥æ‰¾æ–¹æ³•çš„æœ€ç»ˆå®ç°IMPï¼Œè€ŒIMPè¿™ä¸ªå‡½æ•°æŒ‡é’ˆæŒ‡å‘äº†æœ€ç»ˆçš„æ–¹æ³•å®ç°ï¼Œå–å¾—IMPåï¼Œæˆ‘ä»¬å°±è·å¾—äº†æ‰§è¡Œè¿™ä¸ªæ–¹æ³•ä»£ç çš„å…¥å£ç‚¹.é€šè¿‡å–å¾—IMPï¼Œæˆ‘ä»¬å¯ä»¥è·³è¿‡Runtimeçš„æ¶ˆæ¯ä¼ é€’æœºåˆ¶ï¼Œç›´æ¥æ‰§è¡ŒIMPæŒ‡å‘çš„å‡½æ•°å®ç°.è¿™æ ·å°±çœå»äº†Runtimeæ¶ˆæ¯ä¼ é€’è¿‡ç¨‹ä¸­æ‰€åšçš„ä¸€ç³»åˆ—æŸ¥æ‰¾æ“ä½œï¼Œä¼šæ¯”ç›´æ¥å‘å¯¹è±¡å‘é€æ¶ˆæ¯é«˜æ•ˆä¸€äº›. é€šè¿‡ä¸€ç»„idå’ŒSELå‚æ•°å°±èƒ½ç¡®å®šå”¯ä¸€çš„æ–¹æ³•å®ç°åœ°å€ï¼Œè€Œä¸€ä¸ªç¡®å®šçš„æ–¹æ³•ä¹Ÿåªæœ‰å”¯ä¸€çš„ä¸€ç»„idå’ŒSELå‚æ•° MethodMethodç”¨äºè¡¨ç¤ºç±»å®šä¹‰ä¸­çš„æ–¹æ³•ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š 12345678910111213struct method_t &#123; SEL name; const char *types; IMP imp; struct SortBySELAddress : public std::binary_function&lt;const method_t&amp;, const method_t&amp;, bool&gt; &#123; bool operator() (const method_t&amp; lhs, const method_t&amp; rhs) &#123; return lhs.name &lt; rhs.name; &#125; &#125;;&#125;; æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¯¥ç»“æ„ä½“åŒ…å«name(æ–¹æ³•åï¼Œæœ¬è´¨æ˜¯IMP)ï¼Œtypes(æ–¹æ³•ç±»å‹ï¼Œæœ¬è´¨æ˜¯ä¸ªcharæŒ‡é’ˆï¼Œå­˜å‚¨æ–¹æ³•çš„å‚æ•°ç±»å‹å’Œè¿”å›å€¼)ï¼Œimpï¼ˆæ–¹æ³•æŒ‡å‘ï¼Œæœ¬è´¨æ˜¯ä¸ªIMPï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯å‡½æ•°æŒ‡é’ˆï¼‰.è¯¥ç»“æ„ä½“å®é™…ä¸Šç›¸å½“äºåœ¨SELå’ŒIMPä¹‹é—´åšäº†ä¸€ä¸ªæ˜ å°„ï¼Œè®©æˆ‘ä»¬å¯ä»¥é€šè¿‡SELå¿«é€Ÿæ‰¾åˆ°IMP. æˆå‘˜å˜é‡ä¸å±æ€§IvarIvarç”¨æ¥è¡¨ç¤ºå®ä¾‹å˜é‡ï¼Œå…¶å®é™…æ˜¯ä¸€ä¸ªæŒ‡å‘objc_ivarç»“æ„ä½“çš„æŒ‡é’ˆï¼Œå®šä¹‰å¦‚ä¸‹ï¼š 12345678910111213typedef struct objc_ivar *Ivar;struct ivar_t &#123; int32_t *offset;//è¡¨ç¤ºåŸºåœ°å€åç§»å­—èŠ‚ const char *name; const char *type; // alignment is sometimes -1; use alignment() instead uint32_t alignment_raw; uint32_t size; uint32_t alignment() const &#123; if (alignment_raw == ~(uint32_t)0) return 1U &lt;&lt; WORD_SHIFT; return 1 &lt;&lt; alignment_raw; &#125;&#125;; æˆ‘ä»¬å¯¹ivarçš„è®¿é—®å°±å¯ä»¥é€šè¿‡ å¯¹è±¡åœ°å€ + lvaråç§»å­—èŠ‚çš„æ–¹æ³•æ¥è®¿é—®ï¼Œä½†æ˜¯å¦‚æœå¢åŠ äº†çˆ¶ç±»çš„lvarï¼Œé‚£æ€ä¹ˆåŠï¼ŒOCä½¿ç”¨Non Fragile Ivarsæœºåˆ¶ï¼ŒRuntimeä¼šè¿›è¡Œæ£€æµ‹æ¥è°ƒæ•´ç±»ä¸­æ–°å¢çš„ivarçš„åç§»é‡ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ å¯¹è±¡åœ°å€ + åŸºç±»å¤§å° + lvaråç§»å­—èŠ‚çš„æ–¹æ³•è®¡ç®—å‡ºå¯¹åº”çš„ivaråœ°å€ï¼Œå¹¶è®¿é—®åˆ°ç›¸åº”çš„ivarï¼Œè€Œä¸ç”¨é‡æ–°ç¼–è¯‘å­ç±» æˆ‘ä»¬æ— æ³•é€šè¿‡ -&gt;å‡½æ•°æ¥ä¿®æ”¹ç§æœ‰å±æ€§ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡å¯¹è±¡åœ°å€ + lvaråç§»é‡æ¥è®¿é—®åœ°å€ï¼Œè·å–æŒ‡é’ˆåç›´æ¥ä¿®æ”¹ å±æ€§å®é™…å°±æ˜¯lvaråŠ ä¸Šç³»ç»Ÿè‡ªåŠ¨ä¸ºæˆ‘ä»¬ç”Ÿæˆçš„getå’Œsetæ–¹æ³• objc_property_t@property æ ‡è®°äº†ç±»ä¸­çš„å±æ€§, ä»–æ˜¯ä¸€ä¸ªæŒ‡å‘ objc_property ç»“æ„ä½“çš„æŒ‡é’ˆ: 1typedef struct property_t *objc_property_t; éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸ class_copyIvarList å‡½æ•°ä¸åŒ, ä½¿ç”¨ class_copyPropertyList å‡½æ•°åªèƒ½è·å–ç±»çš„å±æ€§, è€Œä¸åŒ…å«æˆå‘˜å˜é‡, ä½†æ­¤æ—¶è·å–çš„å±æ€§åæ˜¯ä¸å¸¦ä¸‹åˆ’çº¿çš„. æ›´å¤šå§¿åŠ¿å¯ä»¥çœ‹è¿™é‡Œ. protocol_t12345678910111213141516struct protocol_t : objc_object &#123; const char *mangledName; struct protocol_list_t *protocols; method_list_t *instanceMethods; method_list_t *classMethods; method_list_t *optionalInstanceMethods; method_list_t *optionalClassMethods; property_list_t *instanceProperties; uint32_t size; // sizeof(protocol_t) uint32_t flags; // Fields below this point are not always present on disk. const char **_extendedMethodTypes; const char *_demangledName; property_list_t *_classProperties; ... çœç•¥ä¸€äº›å°è£…çš„ä¾¿æ· get æ–¹æ³•&#125; CategoryCategory(åˆ†ç±»), ä»–ä¸ºç°æœ‰çš„ç±»æä¾›äº†æ‰©å±•, å®ƒæ˜¯ category_t ç»“æ„ä½“çš„æŒ‡é’ˆ.è¯¦ç»†æŸ¥çœ‹æ·±å…¥ç†è§£Objective-Cï¼šCategory 123456789typedef struct category_t *Category;typedef struct category_t &#123; const char *name;//ç±»çš„åå­— classref_t cls;//ç±» struct method_list_t *instanceMethods;//categoryä¸­æ‰€æœ‰ç»™ç±»æ·»åŠ çš„å®ä¾‹æ–¹æ³•çš„åˆ—è¡¨ struct method_list_t *classMethods;//ç»™æ‰€æœ‰ç±»æ·»åŠ ç±»æ–¹æ³•çš„åˆ—è¡¨ struct protocol_list_t *protocols;//æ‰€æœ‰åè®®çš„åˆ—è¡¨ struct property_list_t *instanceProperties;//categoryä¸­æ·»åŠ çš„æ‰€æœ‰å±æ€§çš„åˆ—è¡¨&#125; category_t; ä»categoryçš„å®šä¹‰å¯ä»¥çœ‹å‡ºæˆ‘ä»¬å¯ä»¥æ·»åŠ å®ä¾‹æ–¹æ³•ï¼Œç±»æ–¹æ³•ï¼Œç”šè‡³å¯ä»¥å®ç°åè®®ï¼Œæ·»åŠ å±æ€§ï¼Œä½†æ˜¯æ— æ³•æ·»åŠ å®ä¾‹å˜é‡ åœ¨Appçš„å¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œä¼šåœ¨_read_imageså‡½æ•°é—´æ¥è°ƒç”¨åˆ°attachCategorieså‡½æ•°ï¼Œå®Œæˆå‘ç±»ä¸­æ·»åŠ Categoryçš„å·¥ä½œï¼Œå‘class_rw_tä¸­çš„method_array_tï¼Œproperty_array_tï¼Œprotocol_array_t æ•°ç»„ä¸­åˆ†åˆ«æ·»åŠ method_list_tï¼Œproperty_list_tï¼Œprotocol_list_tæŒ‡é’ˆ.æŠŠcategoryçš„å®ä¾‹æ–¹æ³•, åè®®ä»¥åŠå±æ€§æ·»åŠ åˆ°ç±»ä¸Š, æŠŠcategoryçš„ç±»æ–¹æ³•å’Œåè®®æ·»åŠ åˆ°ç±»çš„metaclassä¸Š. æˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯ï¼š categoryä¸ä¼šè¦†ç›–åŸç±»ä¸­çš„æ–¹æ³•ï¼Œè€Œæ˜¯ä¸¤ä¸ªéƒ½å­˜åœ¨ï¼Œä½†æ˜¯categoryçš„åœ¨å‰é¢ï¼ŒæŒ‰ç…§æ–¹æ³•åˆ—è¡¨æ¥æ‰¾ï¼Œæ‰¾åˆ°categoryçš„ä¹‹å, å°±ä¸å†å¾€ä¸‹æ‰¾äº†, é€ æˆè¢«è¦†ç›–çš„å‡è±¡. é™„åŠ categoryçš„ç±»çš„å·¥ä½œä¼šå…ˆäº+loadæ–¹æ³•çš„æ‰§è¡Œ. +loadçš„æ‰§è¡Œé¡ºåºæ˜¯å…ˆç±», åcategory, è€Œcategoryçš„+loadæ‰§è¡Œé¡ºåºæ˜¯æ ¹æ®ç¼–è¯‘é¡ºåº(Compile Sourcesä¸­çš„é¡ºåº)å†³å®šçš„. æ¶ˆæ¯æŸ¥æ‰¾ä¸è½¬å‘Objective-Cä¸­ä»»ä½•æ–¹æ³•çš„è°ƒç”¨, ç¼–è¯‘å™¨éƒ½ä¼šå°†[receiver message]è½¬åŒ–ä¸ºä¸€ä¸ªæ¶ˆæ¯å‡½æ•°çš„è°ƒç”¨, å³objc_msgSend, æ¶ˆæ¯ç›´åˆ°è¿è¡Œæ—¶æ‰ç»‘å®šåˆ°æ–¹æ³•çš„å®ç°ä¸Š. objc_msgSend çš„å®šä¹‰å¦‚ä¸‹: 1objc_msgSend(receiver, selector, arg1, arg2, ...) æ¶ˆæ¯çš„æŸ¥æ‰¾å’ŒåŠ¨æ€è§£æ åˆ¤æ–­ selector æ˜¯ä¸æ˜¯éœ€è¦è¢«å¿½ç•¥çš„åƒåœ¾å›æ”¶ç”¨åˆ°çš„æ–¹æ³•, æ˜¯çš„è¯å°±å¿½ç•¥, ä¸æ˜¯çš„è¯ç»§ç»­ä¸‹ä¸€æ­¥æ“ä½œ. åˆ¤æ–­targetæ˜¯ä¸æ˜¯nil, å¦‚æœè¿™é‡Œæœ‰ç›¸åº”çš„nilçš„å¤„ç†å‡½æ•°, å°±è·³è½¬åˆ°ç›¸åº”çš„å‡½æ•°ä¸­. å¦‚æœæ²¡æœ‰å¤„ç†nilçš„å‡½æ•°, å°±è‡ªåŠ¨æ¸…ç†ç°åœºå¹¶è¿”å›. è¿™ä¸€ç‚¹å°±æ˜¯ä¸ºä½•åœ¨OCä¸­ç»™nilå‘é€æ¶ˆæ¯ä¸ä¼šå´©æºƒçš„åŸå› . æŸ¥æ‰¾å½“å‰ç±»çš„ç¼“å­˜, å¦‚æœå‘½ä¸­ç¼“å­˜è·å–åˆ°äº†IMPå°±å°†IMPè¿”å›, å¦‚æœæ²¡æœ‰ç»§ç»­ä¸‹ä¸€æ­¥æ“ä½œ. åœ¨å½“å‰ç±»çš„æ–¹æ³•åˆ—è¡¨ä¸­æŸ¥æ‰¾(æ ¹æ® selector æŸ¥æ‰¾åˆ° Method å, è·å– Method ä¸­çš„ IMP), å¯¹å·²ç»æ’åºçš„åˆ—è¡¨ä½¿ç”¨äºŒåˆ†æ³•æŸ¥æ‰¾, æœªæ’åºçš„åˆ—è¡¨åˆ™æ˜¯çº¿æ€§éå†. å¦‚æœæ‰¾åˆ°æŠŠæ–¹æ³•åŠ å…¥ cache å¹¶ä¸”æŠŠIMPè¿”å›, å¦‚æœæ²¡æ‰¾åˆ°ç»§ç»­ä¸‹ä¸€æ­¥æ“ä½œ. åœ¨ç»§æ‰¿å±‚çº§ä¸­é€’å½’å‘çˆ¶ç±»(ä¸€ç›´åˆ° NSObject ä¸ºæ­¢)ä¸­æŸ¥æ‰¾, æƒ…å†µè·Ÿä¸Šä¸€æ­¥ç±»ä¼¼, ä¹Ÿæ˜¯å…ˆæŸ¥æ‰¾ç¼“å­˜, ç¼“å­˜æ²¡ä¸­å°±æŸ¥æ‰¾æ–¹æ³•åˆ—è¡¨, æŸ¥åˆ°åå°±ç»ˆæ­¢é€’å½’æŸ¥è¯¢, æŠŠæ–¹æ³•åŠ å…¥ cache å¹¶ä¸”æŠŠIMPè¿”å›, å¦‚æœæ²¡æ‰¾åˆ°ç»§ç»­ä¸‹ä¸€æ­¥æ“ä½œ. åœ¨æ¶ˆæ¯æŸ¥æ‰¾é˜¶æ®µ, å¦‚æœæ²¡æ‰¾åˆ°IMP(ä¹Ÿå°±æ˜¯æ¥æ”¶åˆ°æœªçŸ¥çš„æ¶ˆæ¯), ä¼šè¿›å…¥åŠ¨æ€æ–¹æ³•è§£æé˜¶æ®µ, é¦–å…ˆä¼šè°ƒç”¨æ‰€å±ç±»çš„+resolveInstanceMethod:(å®ä¾‹æ–¹æ³•)æˆ–è€…+resolveClassMethod:(ç±»æ–¹æ³•)æ–¹æ³•. å‰ææ˜¯æˆ‘ä»¬å¿…é¡»è‡ªå·±å®ç°è¯¥æ–¹æ³•, å¹¶ä¸”æ·»åŠ åˆ°ç±»é‡Œé¢. 1234567891011void functionForMethod1(id self, SEL _cmd) &#123; NSLog(@&quot;%@, %p&quot;, self, _cmd);&#125; + (BOOL)resolveInstanceMethod:(SEL)sel &#123; NSString *selectorString = NSStringFromSelector(sel); if ([selectorString isEqualToString:@&quot;method1&quot;]) &#123; class_addMethod(self.class, @selector(method1), (IMP)functionForMethod1, &quot;@:&quot;); &#125; return [super resolveInstanceMethod:sel];&#125; æ­¤æ—¶å¦‚æœæ—¢æ²¡æœ‰æ²¡æŸ¥æ‰¾åˆ° IMP, åŠ¨æ€æ–¹æ³•è§£æä¹Ÿä¸å¥æ•ˆ, é‚£ä¹ˆå°±è¿›å…¥äº†ä¸‹ä¸€ä¸ªé˜¶æ®µ-æ¶ˆæ¯è½¬å‘é˜¶æ®µ. æ¶ˆæ¯çš„è½¬å‘ä¸Šé¢ä¸»è¦æ˜¯æ¶ˆæ¯çš„æŸ¥æ‰¾é˜¶æ®µä¸»è¦å®Œæˆçš„æ˜¯é€šè¿‡select()å¿«é€ŸæŸ¥æ‰¾IMPçš„è¿‡ç¨‹, æ¥ä¸‹æ¥æ‰æ˜¯æ¶ˆæ¯çš„è½¬å‘é˜¶æ®µ, åˆ°äº†è½¬å‘é˜¶æ®µ, ä¼šè°ƒç”¨åˆ°äº†è½¬å‘é˜¶æ®µ, ä¼šè°ƒç”¨id _objc_msgForward(id self, SEL _cmd,â€¦)æ–¹æ³•. åœ¨æ‰§è¡Œ_objc_msgForwardä¹‹åä¼šè°ƒç”¨ __objc_forward_handlerå‡½æ•°. å®ƒçš„å®ç°å¤§è‡´å¦‚ä¸‹: 12345678// Default forward handler halts the process.__attribute__((noreturn)) void objc_defaultForwardHandler(id self, SEL sel) &#123; _objc_fatal(&quot;%c[%s %s]: unrecognized selector sent to instance %p &quot; &quot;(no message forward handler is installed)&quot;, class_isMetaClass(object_getClass(self)) ? &apos;+&apos; : &apos;-&apos;, object_getClassName(self), sel_getName(sel), self);&#125; å½“æˆ‘ä»¬ç»™ä¸€ä¸ªå¯¹è±¡å‘é€ä¸€ä¸ªæ²¡æœ‰å®ç°çš„æ–¹æ³•çš„æ—¶å€™, å¦‚æœå…¶çˆ¶ç±»ä¹Ÿæ²¡æœ‰è¿™ä¸ªæ–¹æ³•, åˆ™ä¼šå´©æºƒ, æŠ¥é”™ä¿¡æ¯ç±»ä¼¼äºè¿™æ ·: unrecognized selector sent to instance, ç„¶åæ¥ç€ä¼šè·³å‡ºä¸€äº›å †æ ˆä¿¡æ¯. è¿™äº›ä¿¡æ¯å°±æ˜¯ä»è¿™é‡Œè€Œæ¥. å¦‚æœä¸Šé¢çš„æŸ¥æ‰¾å’Œè§£æéƒ½å¤±è´¥çš„è¯, æ¶ˆæ¯å°±ä¼šæ— æ³•å¤„ç†, è¿™æ˜¯Runtimeä¼šè°ƒç”¨ä»¥ä¸‹æ–¹æ³•: 1- (id)forwardingTargetForSelector:(SEL)aSelector æˆ‘ä»¬å¯ä»¥é€šè¿‡é‡å†™- (id)forwardingTargetForSelector:(SEL)aSelectoræ–¹æ³•æ¥æŠŠæ¶ˆæ¯çš„æ¥å—è€…æ¢æˆä¸€ä¸ªå¯ä»¥å¤„ç†è¯¥æ¶ˆæ¯çš„å®ä¾‹å¯¹è±¡æˆ–è€…ç±»å¯¹è±¡. ç¤ºä¾‹å¦‚ä¸‹: 12345678910111213- (id)forwardingTargetForSelector:(SEL)aSelector&#123; if(aSelector == @selector(Method:))&#123; return otherObject; &#125; return [super forwardingTargetForSelector:aSelector];&#125;+ (id)forwardingTargetForSelector:(SEL)aSelector &#123; if(aSelector == @selector(xxx)) &#123; return NSClassFromString(@&quot;Class name&quot;); &#125; return [super forwardingTargetForSelector:aSelector];&#125; å¦‚æœä¸€ä¸ªå¯¹è±¡å®ç°äº†è¿™ä¸ªæ–¹æ³•, å¹¶è¿”å›ä¸€ä¸ªénilçš„ç»“æœ, åˆ™è¿™ä¸ªå¯¹è±¡ä¼šä½œä¸ºæ¶ˆæ¯çš„æ–°æ¥æ”¶è€…, ä¸”æ¶ˆæ¯ä¼šè¢«åˆ†å‘åˆ°è¿™ä¸ªå¯¹è±¡.å½“ç„¶è¿™ä¸ªå¯¹è±¡ä¸èƒ½æ˜¯selfè‡ªèº«, å¦åˆ™å°±æ˜¯å‡ºç°æ— é™å¾ªç¯.å¦‚æœæˆ‘ä»¬æ²¡æœ‰æŒ‡å®šç›¸åº”çš„å¯¹è±¡æ¥å¤„ç†aSelector, åˆ™åº”è¯¥è°ƒç”¨çˆ¶ç±»çš„å®ç°æ¥è¿”å›ç»“æœ. è¿™ä¸€æ­¥åˆé€‚äºæˆ‘ä»¬åªæƒ³å°†æ¶ˆæ¯è½¬å‘åˆ°å¦ä¸€ä¸ªèƒ½å¤„ç†è¯¥æ¶ˆæ¯çš„å¯¹è±¡ä¸Š, ä½†è¿™ä¸€æ­¥æ— æ³•å¯¹æ¶ˆæ¯è¿›è¡Œå¤„ç†, å¦‚æ“ä½œæ¶ˆæ¯çš„å‚æ•°å’Œè¿”å›å€¼. å¦‚æœåœ¨ä¸Šä¸€æ­¥è¿˜ä¸èƒ½å¤„ç†æœªçŸ¥æ¶ˆæ¯, åˆ™å”¯ä¸€èƒ½åšçš„å°±æ˜¯å¯ç”¨å®Œæ•´çš„æ¶ˆæ¯è½¬å‘æœºåˆ¶äº†. è¿è¡Œæ—¶ç³»ç»Ÿä¼šç»™æ¶ˆæ¯æ¥æ”¶è€…æœ€åä¸€æ¬¡æœºä¼šå°†æ¶ˆæ¯è½¬å‘ç»™å…¶å®ƒå¯¹è±¡. æˆ‘ä»¬é¦–å…ˆè¦é€šè¿‡, æŒ‡å®šæ–¹æ³•ç­¾å, è‹¥è¿”å›nil, åˆ™è¡¨ç¤ºä¸å¤„ç†. 123456- (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector &#123; if ([NSStringFromSelector(aSelector) isEqualToString:@&quot;testInstanceMethod&quot;])&#123; return [NSMethodSignature signatureWithObjcTypes:&quot;v@:&quot;]; &#125; return [super methodSignatureForSelector: aSelector];&#125; è‹¥è¿”å›æ–¹æ³•ç­¾å, åˆ™ä¼šè¿›å…¥ä¸‹ä¸€æ­¥è°ƒç”¨. 12345678- (void)forwardInvovation:(NSInvocation)anInvocation &#123; if ([someOtherObject respondsToSelector: [anInvocation selector]]) &#123; [anInvocation invokeWithTarget:someOtherObject]; &#125; else &#123; [super forwardInvocation:anInvocation]; &#125;&#125; è¯¥æ–¹æ³•å¯¹è±¡ä¼šåˆ›å»ºä¸€ä¸ªè¡¨ç¤ºæ¶ˆæ¯çš„NSInvocationå¯¹è±¡,æŠŠä¸å°šæœªå¤„ç†çš„æ¶ˆæ¯æœ‰å…³çš„å…¨éƒ¨ç»†èŠ‚éƒ½å°è£…åœ¨anInvocationä¸­, åŒ…æ‹¬selector, ç›®æ ‡(target)å’Œå‚æ•°. æˆ‘ä»¬å¯ä»¥åœ¨forwardInvocationæ–¹æ³•ä¸­é€‰æ‹©å°†æ¶ˆæ¯è½¬å‘ç»™å…¶å®ƒå¯¹è±¡. æˆ‘ä»¬å¯ä»¥é€šè¿‡anInvocationå¯¹è±¡åšå¾ˆå¤šå¤„ç†, æ¯”å¦‚ä¿®æ”¹å®ç°æ–¹æ³•, ä¿®æ”¹å“åº”å¯¹è±¡ç­‰. è¿™ä¸ªæ–¹æ³•çš„ä¸»è¦ä½œç”¨æ˜¯å®šä½å¯ä»¥å“åº”å°è£…åœ¨anInvocationä¸­çš„æ¶ˆæ¯çš„å¯¹è±¡(è¿™ä¸ªå¯¹è±¡ä¸éœ€è¦èƒ½å¤„ç†æ‰€æœ‰æœªçŸ¥æ¶ˆæ¯). ä½¿ç”¨anInvocationä½œä¸ºå‚æ•°, å°†æ¶ˆæ¯å‘é€åˆ°é€‰ä¸­çš„å¯¹è±¡. anInvocationå°†ä¼šä¿ç•™è°ƒç”¨ç»“æœ, è¿è¡Œæ—¶ç³»ç»Ÿä¼šæå–è¿™ä¸€ç»“æœå¹¶å°†å…¶å‘é€åˆ°æ¶ˆæ¯çš„åŸå§‹å‘é€è€…. åœ¨è¿™ä¸ªæ–¹æ³•ä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥å®ç°ä¸€äº›æ›´å¤æ‚çš„åŠŸèƒ½, æˆ‘ä»¬å¯ä»¥å¯¹æ¶ˆæ¯çš„å†…å®¹è¿›è¡Œä¿®æ”¹, æ¯”å¦‚è¿½å›ä¸€ä¸ªå‚æ•°ç­‰, ç„¶åå†å»è§¦å‘æ¶ˆæ¯. å¦å¤–, è‹¥å‘ç°æŸä¸ªæ¶ˆæ¯ä¸åº”ç”±æœ¬ç±»å¤„ç†, åˆ™åº”è°ƒç”¨çˆ¶ç±»çš„åŒåæ–¹æ³•, ä»¥ä¾¿ç»§æ‰¿ä½“ç³»ä¸­çš„æ¯ä¸ªç±»éƒ½æœ‰æœºä¼šå¤„ç†æ­¤è°ƒç”¨è¯·æ±‚. ä¸Šé¢ä¸¤ä¸ªè¡¥æ•‘æªæ–½åšå®Œå, è‹¥å‘ç°æŸè°ƒç”¨ä¸åº”ç”±æœ¬ç±»å¤„ç†, åˆ™ä¼šè°ƒç”¨è¶…ç±»çš„åŒåæ–¹æ³•. å¦‚æ­¤, ç»§æ‰¿ä½“ç³»ä¸­çš„æ¯ä¸ªç±»éƒ½æœ‰æœºä¼šå¤„ç†è¯¥æ–¹æ³•è°ƒç”¨çš„è¯·æ±‚, ä¸€ç›´åˆ°NSObjectæ ¹ç±». å¦‚æœåˆ°NSObjectä¹Ÿä¸èƒ½å¤„ç†è¯¥æ¡æ¶ˆæ¯, é‚£ä¹ˆå°±æ˜¯å†æ— æŒ½æ•‘æªæ–½äº†, åªèƒ½æŠ›å‡ºâ€doesNotRecognizeSelectorâ€å¼‚å¸¸.","path":"2017/07/18/runtime/","date":"07-18","excerpt":""},{"title":"UIViewä»‹ç»","text":"ç”Ÿå‘½å‘¨æœŸåˆ›å»ºViewæ—¶ï¼š initWithFrame: initWithFrameè¿›è¡Œåˆå§‹åŒ–æ—¶, å½“rectçš„å€¼ä¸ä¸ºCGRectZeroæ—¶ä¼šè§¦å‘layoutSubviews. initåˆå§‹åŒ–ä¸ä¼šè§¦å‘layoutSubviews. willMoveToSuperview: å½“è§†å›¾å³å°†åŠ å…¥çˆ¶è§†å›¾æ—¶ / å½“è§†å›¾å³å°†ä»çˆ¶è§†å›¾ç§»é™¤æ—¶è°ƒç”¨ didMoveToSuperview: å½“è¯•å›¾åŠ å…¥çˆ¶è§†å›¾æ—¶ / å½“è§†å›¾ä»çˆ¶è§†å›¾ç§»é™¤æ—¶è°ƒç”¨ willMoveToWindow: å½“è§†å›¾å³å°†åŠ å…¥çˆ¶è§†å›¾æ—¶ / å½“è§†å›¾å³å°†ä»çˆ¶è§†å›¾ç§»é™¤æ—¶è°ƒç”¨ didMoveToWindow: å½“è¯•å›¾åŠ å…¥çˆ¶è§†å›¾æ—¶ / å½“è§†å›¾ä»çˆ¶è§†å›¾ç§»é™¤æ—¶è°ƒç”¨ layoutSubviews: åœ¨å­è§†å›¾å¸ƒå±€å˜åŠ¨æ—¶ä¼šå¤šæ¬¡è°ƒç”¨ å½“Viewé”€æ¯æ—¶: willMoveToWindow didMoveToWindow willMoveToSuperview didMoveToSuperview removeFromSuperview dealloc å¦‚æœViewä¸­æœ‰å­Viewçš„è¯, åˆ›å»ºæ—¶é™¤äº†ä¸Šé¢çš„é¡ºåºä¹‹å¤–, è¿˜ä¼šè°ƒç”¨: layoutSubviews, è¿™æ˜¯å› ä¸ºå­è§†å›¾çš„å¸ƒå±€å˜åŠ¨, æ‰€ä»¥ä¼šè§¦å‘. didAddSubview drawRect ç§»é™¤æ—¶, é™¤äº†ä¸Šé¢çš„é¡ºåºä¹‹å¤–, è¿˜ä¼šè°ƒç”¨willRemoveSubview, æ˜¯åœ¨deallocåé¢æ‰§è¡Œçš„. å¦‚æœæœ‰å¤šä¸ªå­è§†å›¾, willRemoveSubviewä¼šå¾ªç¯æ‰§è¡Œ, ç›´åˆ°ç§»é™¤æ‰€æœ‰å­è§†å›¾. UIViewå’ŒCALayer UIViewç»§æ‰¿äºUIResponder,å¯ä»¥å“åº”è§¦æ‘¸äº‹ä»¶. CALayerç»§æ‰¿äºNSObject,ä¸èƒ½å“åº”è§¦æ‘¸äº‹ä»¶. UIViewä¸»è¦æ˜¯å¯¹æ˜¾ç¤ºå†…å®¹çš„ç®¡ç†, CALayerä¸»è¦ä¾§é‡æ˜¾ç¤ºå†…å®¹çš„ç»˜åˆ¶.æ‰€ä»¥è®¿é—®UIViewä¸ç»˜å›¾ç›¸å…³å±æ€§ï¼ˆframe,boundsï¼‰ç­‰å®é™…ä¸Šå†…éƒ¨éƒ½æ˜¯åœ¨è®¿é—®å®ƒæ‰€åŒ…å«çš„CALayerçš„ç›¸å…³å±æ€§.UIViewçš„åˆ›å»ºå®é™…ä¸Šæ˜¯ä¸€ç³»åˆ—CALayeråˆ›å»ºçš„è¿‡ç¨‹. UIViewæœ‰ä¸ªé‡è¦å±æ€§layer. å¯ä»¥è¿”å›å®ƒçš„ä¸»CALayerå®ä¾‹. æ‰€æœ‰ä»UIViewç»§æ‰¿æ¥çš„å¯¹è±¡éƒ½ç»§æ‰¿äº†è¿™ä¸ªå±æ€§. è¿™æ„å‘³ç€ä½ å¯ä»¥åœ¨æ‰€æœ‰çš„UIVIewå­ç±»ä¸Šå¢åŠ åŠ¨ç”», æ—‹è½¬, ç¼©æ”¾ç­‰CALayeræ”¯æŒçš„æ“ä½œ. UIViewçš„layerClassæ–¹æ³•, å¯ä»¥è¿”å›ä¸»layeræ‰€ä½¿ç”¨çš„ç±», UIViewçš„å­ç±»å¯ä»¥é€šè¿‡é‡è½½è¿™ä¸ªæ–¹æ³•, æ¥è®©UIViewä½¿ç”¨ä¸åŒçš„CALayeræ¥æ˜¾ç¤º. ä»£ç ç¤ºä¾‹ï¼š 123- (class)layerClass &#123; return ([CAEAGLLayer class]);&#125; UIViewçš„ä¸»CALayeræ˜¯ç±»ä¼¼äºsubviewsçš„æ ‘å½¢ç»“æ„, æˆ‘ä»¬å¯ä»¥é€šè¿‡ç»™ä¸»layeræ·»åŠ å­layeræ¥å®Œæˆç‰¹æ®Šçš„ç»˜åˆ¶æ•ˆæœ.åœ¨viewä¸Šæ·»åŠ ä¸€ä¸ªé»‘è‰²é€æ˜layerå±‚çš„ç¤ºä¾‹ä»£ç : 123grayCover = [[CALayer alloc] init];grayCover.backgroundColor = [[UIColor blackColor] colorWithAlphaComponent:0.2] CGColor];[self.layer addSubLayer:grayCover]; UIViewçš„å†…éƒ¨, æœ‰ä¸‰ä¸ªlayer tree: 1.é€»è¾‘æ ‘, è¿™é‡Œæ˜¯ä»£ç å¯ä»¥æ“çºµçš„. 2.åŠ¨ç”»æ ‘, æ˜¯ä¸€ä¸ªä¸­é—´å±‚, ç³»ç»Ÿå°±åœ¨è¿™ä¸€å±‚ä¸Šé€šè¿‡é€»è¾‘æ ‘æ¥æ›´æ”¹å±æ€§, è¿›è¡Œå„ç§æ¸²æŸ“æ“ä½œ. 3.æ˜¾ç¤ºæ ‘, å…¶å†…å®¹å°±æ˜¯å½“å‰æ­£è¢«æ˜¾ç¤ºåœ¨å±å¹•ä¸Šå¾—å†…å®¹. UIViewå®é™…ä¸Šæ˜¯CALayerçš„CALayerDelegate, é€šè¿‡å®ç°ä¸€ç³»åˆ—çš„ä»£ç†æ–¹æ³•æ¥æ˜¾ç¤ºCALayerç»˜åˆ¶çš„å†…å®¹. åœ¨åš iOS åŠ¨ç”»çš„æ—¶å€™, ä¿®æ”¹éRootLayerçš„å±æ€§(è­¬å¦‚ä½ç½®, èƒŒæ™¯è‰²ç­‰)ä¼šé»˜è®¤äº§ç”Ÿéšå¼åŠ¨ç”», è€Œä¿®æ”¹UIViewåˆ™ä¸ä¼š. layerå¯ä»¥è®¾ç½®åœ†è§’æ˜¾ç¤º(cornerRadius), ä¹Ÿå¯ä»¥è®¾ç½®é˜´å½±(shadowColor). ä½†æ˜¯å¦‚æœlayeræ ‘ä¸­æŸä¸ªlayerè®¾ç½®äº†åœ†è§’, æ ‘ç§æ‰€æœ‰layerçš„é˜´å½±æ•ˆæœéƒ½å°†ä¸æ˜¾ç¤ºäº†. å› æ­¤è‹¥æ˜¯è¦æœ‰åœ†è§’åˆè¦é˜´å½±, å˜é€šæ–¹æ³•åªèƒ½åšä¸¤ä¸ªé‡å çš„UIView, ä¸€ä¸ªçš„layeræ˜¾ç¤ºåœ†è§’, ä¸€ä¸ªlayeræ˜¾ç¤ºé˜´å½±. UIView æ˜¯UIKitæ¡†æ¶ä¸‹çš„(åªèƒ½iOSä½¿ç”¨). CALayer æ˜¯QuartzCoreçš„(iOS å’ŒmacOSé€šç”¨). QuartzCoreçš„æ¸²æŸ“èƒ½åŠ›. ä½¿äºŒç»´å›¾åƒå¯ä»¥è¢«è‡ªç”±æ“çºµ, å°±å¥½åƒæ˜¯ä¸‰ç»´çš„. å›¾åƒå¯ä»¥åœ¨ä¸€ä¸ªä¸‰ç»´åæ ‡ç³»ä¸­ä»¥ä»»æ„è§’åº¦è¢«æ—‹è½¬, ç¼©æ”¾å’Œå€¾æ–œ. CATransform3Dçš„ä¸€å¥—æ–¹æ³•æä¾›äº†ä¸€äº›é­”æœ¯èˆ¬çš„å˜æ¢æ•ˆæœ.å‚è€ƒé“¾æ¥ï¼šè¯¦è§£CALayer å’Œ UIViewçš„åŒºåˆ«å’Œè”ç³»,UIViewå’ŒCALayerçš„åŒºåˆ« drawRectè¯¥æ–¹æ³•é»˜è®¤æ²¡æœ‰ä»»ä½•æ“ä½œä»£ç ,å¦‚æœè§†å›¾ä¸­åŒ…å«æˆ‘ä»¬ç”¨UIKitæˆ–è€…Core Graphicsç»˜åˆ¶çš„å†…å®¹, æˆ‘ä»¬éœ€è¦é‡å†™è¯¥æ–¹æ³•. å½“è§†å›¾ç¬¬ä¸€æ¬¡å‡ºç°, æˆ–è€…æ˜¯æ”¹å˜çº¦æŸæ¡ä»¶è®©è§†å›¾çš„å…¨éƒ¨æˆ–è€…ä¸€éƒ¨åˆ†åœ¨å±å¹•ä¸Šå‘ç”Ÿå˜åŒ–æ—¶, ç³»ç»Ÿéƒ½ä¼šè°ƒç”¨UIViewç±»çš„drawRectæ–¹æ³•. ç„¶åæˆ‘ä»¬åœ¨æ­¤æ–¹æ³•ä¸­èƒ½è¿‡è·å–åˆ°å½“å‰å›¾å½¢ä¸Šä¸‹æ–‡, å®ç°æˆ‘ä»¬çš„ç»˜åˆ¶å†…å®¹, æœ€åç³»ç»Ÿä¼šåœ¨åˆé€‚çš„æ—¶æœºè‡ªåŠ¨è°ƒç”¨æ­¤æ–¹æ³•. drawRectä¸€èˆ¬è°ƒç”¨æ˜¯åœ¨UIViewçš„layoutSubviewsæ–¹æ³•æ‰§è¡Œå.ä½†æ˜¯, åœ¨æˆ‘ä»¬çš„è§†å›¾å…¨éƒ¨åˆå§‹åŒ–å,å¦‚æœè§†å›¾åˆå‘ç”Ÿäº†æ”¹å˜, æ­¤æ—¶è§†å›¾å°±éœ€è¦é‡ç»˜, ä½†æ˜¯ç³»ç»Ÿä¸ä¼šå†å¸®æˆ‘ä»¬è‡ªåŠ¨è°ƒç”¨drewRectæ–¹æ³•. è¿™ä¸ªæ—¶å€™å°±éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨è°ƒç”¨UIViewç±»çš„ setNeedsDisplayæˆ–setNeedsDisplayInRectæ–¹æ³•. è¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯ç”¨æ¥å‘Šè¯‰ç³»ç»Ÿ, æˆ‘ä»¬çš„è§†å›¾æœ‰äº†æ›´æ–°éœ€è¦å»é‡ç»˜. ç›¸å½“äºæ˜¯ç»™ç³»ç»Ÿåšäº†æ ‡è®°, åœ¨ç³»ç»Ÿ runloop çš„ä¸‹ä¸€ä¸ªå‘¨æœŸè‡ªåŠ¨è°ƒç”¨drawRectæ–¹æ³•. ä½¿ç”¨ä¸­è¦æ³¨æ„çš„åœ°æ–¹: ä¸è¦ç›´æ¥è°ƒç”¨ drawRect æ–¹æ³•,å¦‚æœå¼ºè¡Œè°ƒç”¨æ­¤æ–¹æ³•ä¹Ÿæ˜¯æ— æ•ˆæœçš„.è‹¹æœè¦æ±‚æˆ‘ä»¬è°ƒç”¨ UIView ç±»çš„ setNeedsDisplay æ–¹æ³•,åˆ™ç¨‹åºä¼šè‡ªåŠ¨è°ƒç”¨ drawRect æ–¹æ³•è¿›è¡Œé‡ç»˜. å› ä¸ºåœ¨ç»˜åˆ¶æ—¶è¦æ‹¿åˆ°å›¾å½¢ä¸Šä¸‹æ–‡,å¦‚æœåœ¨ UIView åˆå§‹åŒ–æ—¶æ²¡æœ‰è®¾ç½® rect å¤§å°, drawRect æ–¹æ³•ä¸ä¼šè¢«è°ƒç”¨. è°ƒç”¨ sizeThatFits å, æ§ä»¶ frame æ”¹å˜, UIView çš„ layoutSubviews è¢«è°ƒç”¨, ç„¶åå†è°ƒç”¨ drawRect æ–¹æ³•. æ‰€ä»¥å¯ä»¥å…ˆè°ƒç”¨ sizeToFit è®¡ç®—å‡ºsize. ç„¶åç³»ç»Ÿè‡ªåŠ¨è°ƒç”¨ drawRect æ–¹æ³•. é€šè¿‡è®¾ç½® contentMode å±æ€§å€¼ä¸º UIViewContentModeRedraw.é‚£ä¹ˆå°†åœ¨æ¯æ¬¡è®¾ç½®æˆ–æ›´æ”¹ bounds çš„æ—¶å€™è‡ªåŠ¨è°ƒç”¨ drawRect. è‹¥è¦å®æ—¶ç”»å›¾, å¦‚æœä½¿ç”¨ gestureRecognizer æ¥åˆ·æ–°å±å¹•, éœ€è¦åˆ¤æ–­å¹¶è½¬åŒ– point çš„åæ ‡; ä½¿ç”¨ touchbegan ç­‰æ–¹æ³•, åªéœ€è°ƒç”¨ setNeedsDisplay å®æ—¶åˆ·æ–°å±å¹•. å‚è€ƒèµ„æ–™ï¼šä½¿ç”¨drawRect:å®ç°ç»˜åˆ¶ç”»æ¿åŠŸèƒ½çš„å†…å­˜ä¼˜åŒ– sizeToFit, sizeThatFitssizeToFitï¼šå½“æˆ‘ä»¬æƒ³è¦resizeå½“å‰Viewä»¥ä¾¿è·å–ä»–åˆé€‚çš„å¤§å°æ—¶, æˆ‘ä»¬éœ€è¦è°ƒç”¨è¯¥æ–¹æ³•. å°¤å…¶æ˜¯UIKitçš„Viewè§†å›¾æ˜¯æ ¹æ®å†…éƒ¨éœ€è¦è¿›è¡Œå°ºå¯¸è°ƒæ•´æ—¶. åœ¨æŸäº›æƒ…å†µä¸‹, å¦‚æœå½“å‰Viewæ²¡æœ‰çˆ¶è§†å›¾, ä»–ä¼šæ ¹æ®å±å¹•çš„boundsæ¥resizeè‡ªèº«å¤§å°. å¦‚æœä½ æƒ³è®©ä¸€ä¸ªViewæ ¹æ®çˆ¶è§†å›¾æ¥è°ƒæ•´å¤§å°, å¿…é¡»å°†è¯¥Viewæ·»åŠ åˆ°çˆ¶è§†å›¾ä¸­.ä¸€èˆ¬æƒ…å†µä¸‹, æˆ‘ä»¬ä¸éœ€è¦é‡å†™è¯¥æ–¹æ³•, å¦‚æœä½ æƒ³æ”¹å˜å½“å‰Viewçš„default size, æˆ‘ä»¬é€šè¿‡é‡å†™sizeThatFits:æ¥å®ç°. åœ¨sizeThatFits:æ–¹æ³•ä¸­è¿›è¡Œå¿…è¦çš„è®¡ç®—, è¿”å›ç»“æœ, ç„¶åæ”¹å˜ä»–çš„å¤§å°. sizeThatFitsï¼šè¯¥æ–¹æ³•è¦æ±‚Viewè®¡ç®—å¹¶è¿”å›æœ€é€‚åˆæŒ‡å®šå¤§å°çš„å¤§å°. ä¼ å…¥çš„å‚æ•°å°±æ˜¯Viewéœ€è¦æœ€åˆé€‚çš„å¤§å°, è¿”å›å€¼æ˜¯æ ¹æ®ä¼ å…¥çš„å¤§å°, è®¡ç®—å¾—åˆ°çš„ä¸€ä¸ªæœ€é€‚åˆreceiverå­è§†å›¾çš„å°ºå¯¸.è¯¥æ–¹æ³•é»˜è®¤è¿”å›è§†å›¾çš„ç°æœ‰å¤§å°, å­ç±»èƒ½å¤Ÿé€šè¿‡é‡å†™è¯¥æ–¹æ³•è·å¾—ä¸€ä¸ªåŸºäºè¯¥å­ç±»æ‰€æœ‰å­è§†å›¾çš„æœŸæœ›å¸ƒå±€çš„è‡ªå®šä¹‰å¤§å°. è°ƒç”¨sizeThatFits:å¹¶ä¸æ”¹å˜viewçš„size, å®ƒåªæ˜¯è®©viewæ ¹æ®å·²æœ‰contentå’Œç»™å®šsizeè®¡ç®—å‡ºæœ€åˆé€‚çš„view.size. sizeToFitä¼šè‡ªåŠ¨è°ƒç”¨sizeThatFitsæ–¹æ³• sizeToFitä¸åº”è¯¥åœ¨å­ç±»ä¸­è¢«é‡å†™, åº”è¯¥é‡å†™sizeThatFits sizeThatFitsä¼ å…¥çš„å‚æ•°æ˜¯receiverå½“å‰çš„size, è¿”å›ä¸€ä¸ªé€‚åˆsubviewsçš„size sizeToFitå¯ä»¥è¢«æ‰‹åŠ¨ç›´æ¥è°ƒç”¨ sizeToFitå’ŒsizeThatFitsæ–¹æ³•éƒ½æ²¡æœ‰é€’å½’ï¼Œå¯¹subviewsä¹Ÿä¸è´Ÿè´£ï¼Œåªè´Ÿè´£è‡ªå·± è°ƒç”¨ sizeToFit() ä¼šå»è‡ªåŠ¨è°ƒç”¨ sizeThatFits(_ size: CGSize) æ–¹æ³• sizeThatFits ä¸ä¼šæ”¹å˜ receiver çš„ size, è°ƒç”¨ sizeToFit() ä¼šæ”¹å˜ receiver çš„ size. æ­¤å¤„çš„receiverä¸€èˆ¬æ˜¯æ–¹æ³•çš„è°ƒç”¨è€… ç³»ç»Ÿè§¦å‘layoutSubviewsçš„æ¡ä»¶ çˆ¶è§†å›¾ä½¿ç”¨initæ–¹æ³•å®Œæˆåˆå§‹åŒ–æ—¶ä¸ä¼šè§¦å‘layoutSubviews çˆ¶è§†å›¾ç”¨initWithFrameå®Œæˆåˆå§‹åŒ–å¹¶ä¸”å½“frameå‚æ•°ä¸ºCGRectZeroæ—¶ä¸ä¼šè§¦å‘layoutSubviews. å½“frameå‚æ•°ä¸ä¸ºCGRectZeroæ—¶åˆ™ä¼šè§¦å‘layoutSubviews çˆ¶è§†å›¾setFrameçš„æ—¶å€™ä¼šè§¦å‘layoutSubviews, å½“ç„¶frameå‰åå€¼å¾—å‘ç”Ÿå˜åŒ– çˆ¶è§†å›¾addSubviewæ·»åŠ å­è§†å›¾æ—¶ä¼šè§¦å‘å…¶å†…éƒ¨çš„layoutSubviews å­è§†å›¾ä»çˆ¶è§†å›¾ä¸ŠremoveFromSuperViewçš„æ—¶å€™ä¼šè§¦å‘å…¶å†…éƒ¨çš„layoutSubviews æ»šåŠ¨ScrollViewçš„æ—¶å€™ä¼šè§¦å‘layoutSubviews æ—‹è½¬å±å¹•çš„æ—¶å€™ä¼šè§¦å‘layoutSubviews ç³»ç»Ÿè§¦å‘drawRect:çš„æ¡ä»¶ å¦‚æœåœ¨UIViewåˆå§‹åŒ–æ—¶æ²¡æœ‰è®¾ç½®rectå¤§å°, å°†ç›´æ¥å¯¼è‡´drawRectä¸è¢«è‡ªåŠ¨è°ƒç”¨. drawRectè°ƒç”¨æ˜¯åœ¨Controller-&gt;loadView, Controller-&gt;viewDidLoad ä¸¤æ–¹æ³•ä¹‹åæ‰ç”¨çš„. æ‰€ä»¥ä¸ç”¨æ‹…å¿ƒä¸€è¿›å…¥åˆ°æ§åˆ¶å™¨ä¸­, è¿™äº›Viewçš„drawRectå°±å¼€å§‹ç”»äº†. è¿™æ ·å¯ä»¥åœ¨æ§åˆ¶å™¨ä¸­è®¾ç½®ä¸€äº›å€¼ç»™View(å¦‚æœè¿™äº›View drawçš„æ—¶å€™éœ€è¦ç”¨åˆ°æŸäº›å˜é‡å€¼). è¯¥æ–¹æ³•åœ¨è°ƒç”¨sizeToFitåè¢«è°ƒç”¨, æ‰€ä»¥å¯ä»¥å…ˆè°ƒç”¨sizeToFitè®¡ç®—å‡ºsize, ç„¶åç³»ç»Ÿè‡ªåŠ¨è°ƒç”¨drawRect:æ–¹æ³•. é€šè¿‡è®¾ç½®contentModeå±æ€§å€¼ä¸ºUIViewContentModeRedraw. é‚£ä¹ˆå°†åœ¨æ¯æ¬¡è®¾ç½®æˆ–æ›´æ”¹frameçš„æ—¶å€™è‡ªåŠ¨è°ƒç”¨drawRect:. ç›´æ¥è°ƒç”¨setNeedsDisplayæˆ–è€…setNeedsDisplayInRect:è§¦å‘drawRect:. ä½†æ˜¯æœ‰ä¸ªå‰ææ¡ä»¶æ˜¯rectä¸èƒ½ä¸ºCGRectZero. ä»¥ä¸Š1, 2æ¨è; è€Œ3, 4ä¸æå€¡.","path":"2017/07/17/UIViewä»‹ç»/","date":"07-17","excerpt":""},{"title":"UIViewControllerä»‹ç»","text":"ç”Ÿå‘½å‘¨æœŸ initWithCoder: æˆ– initWithNibName:bundle:, é¦–å…ˆä»å½’æ¡£æ–‡ä»¶ä¸­åŠ è½½UIViewControllerå¯¹è±¡. éStoryBoardåˆ›å»ºè°ƒç”¨initWithNibName:bundle:, å¦‚æœä½¿ç”¨StoryBoardè¿›è¡Œè§†å›¾ç®¡ç†, ä»nibä¸­åŠ è½½å¯¹è±¡å®ä¾‹æ—¶, ç¨‹åºä¸ä¼šç›´æ¥åˆå§‹åŒ–ä¸€ä¸ªUIViewController, StoryBoardä¼šè‡ªåŠ¨åˆå§‹åŒ–æˆ–åœ¨segueè¢«è§¦å‘æ—¶è‡ªåŠ¨åˆå§‹åŒ–initWithCoder:. awakeFromNib, ä»xibæˆ–è€…storyboardåŠ è½½å®Œæ¯•å°±ä¼šè°ƒç”¨. loadView, æ¯æ¬¡è®¿é—®UIViewControllerçš„view(æ¯”å¦‚controller.view, self.view)è€Œä¸”viewä¸ºnil, loadViewæ–¹æ³•å°±ä¼šè¢«è°ƒç”¨. loadViewæ–¹æ³•æ˜¯ç”¨æ¥è´Ÿè´£åˆ›å»ºUIViewControllerçš„view. å¦‚æœåœ¨åˆå§‹åŒ–UIViewControlleræŒ‡å®šäº†xibæ–‡ä»¶å, å°±ä¼šæ ¹æ®ä¼ å…¥çš„xibæ–‡ä»¶ååŠ è½½å¯¹åº”çš„xibæ–‡ä»¶, å¦‚æœæ²¡æœ‰æ˜æ˜¾åœ°ä¼ xibæ–‡ä»¶å, å°±ä¼šåŠ è½½è·ŸUIViewControlleråŒåçš„xibæ–‡ä»¶. å¦‚æœæ²¡æœ‰æ‰¾åˆ°ç›¸å…³è”çš„xibæ–‡ä»¶, å°±ä¼šåˆ›å»ºä¸€ä¸ªç©ºç™½çš„UIView, ç„¶åèµ‹å€¼ç»™UIViewControllerçš„viewå±æ€§. è‹¹æœè®¾è®¡è¿™ä¸ªæ–¹æ³•å°±æ˜¯ç»™æˆ‘ä»¬è‡ªå®šä¹‰UIViewControllerçš„viewç”¨çš„, æˆ‘ä»¬ç›´æ¥åœ¨è¯¥æ–¹æ³•ä¸­æŒ‡å®šUIViewControllerçš„View. viewDidLoad, æ— è®ºä½ æ˜¯é€šè¿‡xibæ–‡ä»¶è¿˜æ˜¯é‡å†™loadViewæ–¹æ³•åˆ›å»ºUIViewControllerçš„view, åœ¨viewåˆ›å»ºå®Œæ¯•å, æœ€ç»ˆéƒ½ä¼šè°ƒç”¨viewDidLoadæ–¹æ³•. åœ¨è¿™é‡Œè§†å›¾å±‚æ¬¡å·²ç»åŠ è½½åˆ°å†…å­˜ä¸­. é€šå¸¸, æˆ‘ä»¬å¯¹äºå„ç§åˆå§‹åŒ–æ•°æ®çš„è½½å…¥, åˆå§‹è®¾å®š, ä¿®æ”¹çº¦æŸ, ç§»é™¤è§†å›¾ç­‰å¾ˆå¤šæ“ä½œéƒ½å¯ä»¥è¿™ä¸ªæ–¹æ³•ä¸­å®ç°. viewWillAppear:, ç³»ç»Ÿåœ¨è½½å…¥æ‰€æœ‰çš„æ•°æ®å, å°†ä¼šåœ¨å±å¹•ä¸Šæ˜¾ç¤ºè§†å›¾, è¿™æ—¶ä¼šå…ˆè°ƒç”¨è¿™ä¸ªæ–¹æ³•, é€šå¸¸æˆ‘ä»¬ä¼šåœ¨è¿™ä¸ªæ–¹æ³•å¯¹å³å°†æ˜¾ç¤ºçš„è§†å›¾åšè¿›ä¸€æ­¥çš„è®¾ç½®. viewWillLayoutSubviews, view å³å°†å¸ƒå±€å…¶Subviews. æ¯”å¦‚viewçš„boundsæ”¹å˜äº†(ä¾‹å¦‚:çŠ¶æ€æ ä»ä¸æ˜¾ç¤ºåˆ°æ˜¾ç¤º,è§†å›¾æ–¹å‘å˜åŒ–), è¦è°ƒæ•´Subviewsçš„ä½ç½®, åœ¨è°ƒæ•´ä¹‹å‰è¦åšçš„å·¥ä½œå¯ä»¥æ”¾åœ¨è¯¥æ–¹æ³•ä¸­å®ç°. viewDidLayoutSubviews, viewå·²ç»å¸ƒå±€å…¶Subviews, è¿™é‡Œå¯ä»¥æ”¾ç½®è°ƒæ•´å®Œæˆä¹‹åéœ€è¦åšçš„å·¥ä½œ. viewDidAppear:, åœ¨viewè¢«æ·»åŠ åˆ°è§†å›¾å±‚çº§ä¸­ä»¥åŠå¤šè§†å›¾ä¸Šä¸‹çº§è§†å›¾åˆ‡æ¢æ—¶è°ƒç”¨è¿™ä¸ªæ–¹æ³•, å¯ä»¥å¯¹æ­£åœ¨æ˜¾ç¤ºçš„è§†å›¾åšè¿›ä¸€æ­¥çš„è®¾ç½®. viewWillDisappear:, å½“å‰è§†å›¾åœ¨å³å°†è¢«ç§»é™¤, æˆ–è¢«è¦†ç›–æ—¶, ä¼šè°ƒç”¨è¯¥æ–¹æ³•. æ­¤æ—¶è¿˜æ²¡æœ‰è°ƒç”¨removeFromSuperview. viewDidDisappear:, viewå·²ç»æ¶ˆå¤±æˆ–è¢«è¦†ç›–, æ­¤æ—¶å·²ç»è°ƒç”¨removeFromSuperView. dealloc, UIViewControllerè¢«é”€æ¯æ—¶è°ƒç”¨, æ­¤æ¬¡éœ€è¦å¯¹ä½ åœ¨initå’ŒviewDidLoadä¸­åˆ›å»ºçš„å¯¹è±¡è¿›è¡Œé‡Šæ”¾. didReceiveMemoryWarning, å†…å­˜ä¸å¤Ÿæ—¶, ç³»ç»Ÿä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•. é»˜è®¤å®ç°æ˜¯å¦‚æœå½“å‰UIViewControllerçš„viewä¸åœ¨åº”ç”¨ç¨‹åºçš„è§†å›¾å±‚æ¬¡ç»“æ„(View Hierarchy)ä¸­, å³viewçš„superviewä¸ºnilçš„æ—¶å€™, å°±ä¼šå°†viewé‡Šæ”¾, å¹¶ä¸”è°ƒç”¨viewDidUnloadæ–¹æ³•. viewDidUnload, æ”¶åˆ°å†…å­˜è­¦å‘Šæ—¶, å¦‚æœå½“å‰UIViewControllerçš„Viewçš„superViewä¸ºnilæ—¶, å°±ä¼šå°†Viewé‡Šæ”¾, å¹¶ä¸”è°ƒç”¨viewDidUnload. edgesForExtendedLayout, translucent, extendedLayoutIncludesOpaqueBars, automaticallyAdjustsScrollViewInsets edgesForExtendedLayout:iOS7ä»¥å UIViewController å¼€å§‹ä½¿ç”¨å…¨å±å¸ƒå±€ï¼Œè€Œä¸”æ˜¯é»˜è®¤çš„å±æ€§ã€‚é€šå¸¸æ¶‰åŠåˆ°å¸ƒå±€ï¼Œå°±ç¦»ä¸å¼€è¿™ä¸ªå±æ€§ edgesForExtendedLayoutï¼Œå®ƒæ˜¯ä¸€ä¸ªç±»å‹ä¸ºUIExtendedEdgeçš„å±æ€§ï¼ŒæŒ‡å®šUIViewControllerä¸Šçš„æ ¹è§†å›¾self.viewè¾¹ç¼˜è¦å»¶ä¼¸çš„æ–¹å‘ã€‚ç”±äºiOS7é¼“åŠ±å…¨å±å¸ƒå±€ï¼Œæ‰€ä»¥å®ƒçš„é»˜è®¤å€¼æ˜¯UIRectEdgeAllï¼Œå››å‘¨è¾¹ç¼˜å‡å»¶ä¼¸ï¼Œå°±æ˜¯è¯´ï¼Œå¦‚æœå³ä½¿è§†å›¾ä¸­ä¸Šæœ‰UINavigationBarï¼Œä¸‹æœ‰UITabBarï¼Œé‚£ä¹ˆè§†å›¾ä»ä¼šå»¶ä¼¸è¦†ç›–åˆ°å››å‘¨çš„åŒºåŸŸã€‚ 12345678910typedef NS_OPTIONS(NSUInteger, UIRectEdge) &#123; UIRectEdgeNone = 0, UIRectEdgeTop = 1 &lt;&lt; 0, UIRectEdgeLeft = 1 &lt;&lt; 1, UIRectEdgeBottom = 1 &lt;&lt; 2, UIRectEdgeRight = 1 &lt;&lt; 3, UIRectEdgeAl = UIRectEdgeTop | UIRectEdgeLeft | UIRectEdgeBottom | UIRectEdgeRight &#125; NS_ENUM_AVAILABLE_IOS(7_0); è®¾ç½®ä¸º UIRectEdgeNoneå°±æ˜¯ä¸ä¼šå»¶ä¼¸è‡³UINavigationBarå’ŒUITabBar translucent:è¿™ä¸ªæ˜¯self.navigationController.navigationBarçš„å±æ€§ï¼Œè®¾ç½®å¯¼èˆªæ¡UINavigationBaræ˜¯å¦åŠé€æ˜.é»˜è®¤æ˜¯YESï¼Œä¹Ÿå°±æ˜¯åŠé€æ˜. extendedLayoutIncludesOpaqueBars:ä¸é€æ˜çš„æ¡ä¸‹æ˜¯å¦å¯ä»¥æ‰©å±•.é»˜è®¤ä¸ºNOï¼Œä¹Ÿå°±æ˜¯ä¸å¯ä»¥æ‰©å±•ã€‚å½“translucentè®¾ç½®ä¸ºNOï¼Œå³å¯¼èˆªæ UINavigationBarä¸é€æ˜çš„æ—¶å€™ï¼Œé»˜è®¤ä¸èƒ½æ‰©å±•(ç©ºå‡ºå¯¼èˆªæ éƒ¨åˆ†). automaticallyAdjustsScrollViewInsets: è‡ªåŠ¨æ ¡å‡†æ»šåŠ¨è§†å›¾çš„åµŒå…¥è§†å›¾,é»˜è®¤YES.automaticallyAdjustsScrollViewInsetsæ ¹æ®æŒ‰æ‰€åœ¨ç•Œé¢çš„status barï¼Œnavigationbarï¼Œä¸tabbarçš„é«˜åº¦ï¼Œè‡ªåŠ¨è°ƒæ•´scrollviewçš„ inset,è®¾ç½®ä¸ºnoï¼Œä¸è®©viewControllerè°ƒæ•´ï¼Œè¿™ç§å¯¹äºä¸€ä¸ªé¡µé¢å†…æœ‰å¤šä¸ªscrollViewæˆ–è€…å…¶å­ç±»ååˆ†æœ‰å¿…è¦ï¼Œæˆ‘ä»¬è‡ªå·±ä¿®æ”¹å¸ƒå±€å³å¯. addchildviewcontrolleraddChildViewControlleræ˜¯ä¸€ä¸ªä»iOS5å¼€å§‹æ”¯æŒçš„apiæ¥å£ï¼Œç›¸å…³çš„ä¸€ç³»åˆ—çš„æ¥å£æ˜¯ç”¨æ¥å¤„ç†viewcontrollerä¸­åµŒå¥—æ˜¾ç¤ºå…¶ä»–viewcontrollerçš„åœºæ™¯çš„ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯: å¯¹é¡µé¢ä¸­çš„é€»è¾‘æ›´åŠ åˆ†æ˜äº†ã€‚ç›¸åº”çš„Viewå¯¹åº”ç›¸åº”çš„ViewController. å½“æŸä¸ªå­Viewæ²¡æœ‰æ˜¾ç¤ºæ—¶ï¼Œå°†ä¸ä¼šè¢«Loadï¼Œå‡å°‘äº†å†…å­˜çš„ä½¿ç”¨. å½“å†…å­˜ç´§å¼ æ—¶ï¼Œæ²¡æœ‰Loadçš„Viewå°†è¢«é¦–å…ˆé‡Šæ”¾ï¼Œä¼˜åŒ–äº†ç¨‹åºçš„å†…å­˜é‡Šæ”¾æœºåˆ¶. 12345678910111213141516171819202122232425262728293031//åœ¨parent view controller ä¸­æ·»åŠ  child view controller FirstViewController *firstViewController=[[FirstViewController alloc] initWithNibName:@&quot;FirstViewController&quot; bundle:nil];[self addChildViewController:firstViewController];SecondViewController *secondViewController=[[SecondViewController alloc] initWithNibName:@&quot;SecondViewController&quot; bundle:nil];[self addChildViewController:secondViewController];ThirdViewController *thirdViewController=[[ThirdViewController alloc] initWithNibName:@&quot;ThirdViewController&quot; bundle:nil];[self addChildViewController:thirdViewController];[self.view addSubview:thirdViewController.view]; // addChildViewControllerä¼šè°ƒç”¨[child willMoveToParentViewController:self] ï¼Œä½†æ˜¯ä¸ä¼šè°ƒç”¨didMoveToParentViewControllerï¼Œæ‰€ä»¥éœ€è¦xianè°ƒç”¨[thirdViewController didMoveToParentViewController:self];currentViewController=thirdViewController;///////////////////////////////// * fromViewController å½“å‰æ˜¾ç¤ºåœ¨çˆ¶è§†å›¾æ§åˆ¶å™¨ä¸­çš„å­è§†å›¾æ§åˆ¶å™¨ * toViewController å°†è¦æ˜¾ç¤ºçš„å§¿åŠ¿å›¾æ§åˆ¶å™¨ * duration åŠ¨ç”»æ—¶é—´(è¿™ä¸ªå±æ€§,old friend äº† O(âˆ©_âˆ©)O) * options åŠ¨ç”»æ•ˆæœ(æ¸å˜,ä»ä¸‹å¾€ä¸Šç­‰ç­‰,å…·ä½“æŸ¥çœ‹API) * animations è½¬æ¢è¿‡ç¨‹ä¸­å¾—åŠ¨ç”» * completion è½¬æ¢å®Œæˆ *///åˆ‡æ¢child view controller[self transitionFromViewController:currentViewController toViewController:firstViewController duration:4 options:UIViewAnimationOptionTransitionFlipFromLeft animations:^&#123;&#125; completion:^(BOOL finished) &#123; //......&#125;];currentViewController=firstViewController; //ç§»é™¤child view controller// removeFromParentViewControlleråœ¨ç§»é™¤childå‰ä¸ä¼šè°ƒç”¨[self willMoveToParentViewController:nil] ï¼Œæ‰€ä»¥éœ€è¦æ˜¾ç¤ºè°ƒç”¨[currentViewController willMoveToParentViewController:nil];[currentViewController removeFromSuperview];[currentViewController removeFromParentViewController];","path":"2017/07/15/UIViewControllerä»‹ç»/","date":"07-15","excerpt":""},{"title":"UICollectionViewåˆ·æ–°é—ªä¸€ä¸‹çš„é—®é¢˜","text":"UICollectionViewåœ¨reloadItemsçš„æ—¶å€™ é»˜è®¤ä¼šé™„åŠ ä¸€ä¸ªéšå¼çš„fadeåŠ¨ç”»,æœ‰æ—¶å€™å¯èƒ½ä¼šé—ªä¸€ä¸‹ï¼Œæœ‰æ—¶å€™itemçš„å¤§å°ä¼šæœ‰ä¸€ä¸ªä»0åˆ°frameæ‹‰å¤§æ•ˆæœã€‚ä¸ç®¡æ˜¯å“ªç§æ•ˆæœéƒ½æ˜¾å¾—éå¸¸çš„éš¾çœ‹ã€‚ ä½†æ˜¯å¯ä»¥ä½¿ç”¨ä¸‹é¢å‡ ç§æ–¹æ³•å»æ‰UICollectionViewéšå¼fadeåŠ¨ç”» 1234567let time: TimeInterval = 0 DispatchQueue.main.asyncAfter(deadline: DispatchTime.now() + time) &#123; UIView.performWithoutAnimation &#123; self.collectionView.reloadData() &#125;&#125; è¿™æ ·å†™æœ‰å¯èƒ½ä¼šé€ æˆä¸€ä¸ªé—®é¢˜ï¼Œæ¯”æ–¹è¯´åœ¨åˆ—è¡¨é¡µä¸‹æ‹‰çš„åŒæ—¶åˆè¿›è¡Œä¸Šæ‹‰ï¼Œè¿™ç§å†™æ³•ä¼šé€ æˆreloadData()æ–¹æ³•æ¯”æ­£å¸¸çš„è¦æœ‰å»¶è¿Ÿï¼Œæ‰€ä»¥åœ¨ä¸‹æ‹‰åŠ è½½æ›´å¤šreloadDataçš„æ—¶å€™cellforitemæ–¹æ³•ä¸­å¯èƒ½ä¸Šæ‹‰çš„æ•°æ®è¿”å›ï¼Œå¯¼è‡´æ•°ç»„è¶Šç•Œã€‚è¿™æ—¶éœ€è¦åœ¨cellforitemæ–¹æ³•ä¸­åšä¸€ä¸ªè¶Šç•Œåˆ¤æ–­é¿å…ç¨‹åºcrash","path":"2017/06/20/UICollectionViewåˆ·æ–°é—ªä¸€ä¸‹çš„é—®é¢˜/","date":"06-20","excerpt":""},{"title":"UICollectionViewè‡ªå®šä¹‰å¸ƒå±€","text":"å½“æˆ‘ä»¬ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„UICollectionViewFlowLayoutæ— æ³•å®ç°æˆ‘ä»¬çš„å¸ƒå±€æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥è€ƒè™‘è‡ªå®šä¹‰layoutã€‚ ã€å¿…é¡»ã€‘å®šåˆ¶UICollectionViewLayoutå¿…é¡»è¦†ç›–çš„æ–¹æ³•123- (void)prepareLayout;- (CGSize)collectionViewContentSize;- (NSArray&lt;UICollectionViewLayoutAttributes *&gt; *)layoutAttributesForElementsInRect:(CGRect)rect; prepareLayoutæ˜¯ä¸“é—¨ç”¨æ¥å‡†å¤‡å¸ƒå±€çš„ï¼Œåœ¨prepareLayoutæ–¹æ³•é‡Œé¢æˆ‘ä»¬å¯ä»¥äº‹å…ˆå°±è®¡ç®—åé¢è¦ç”¨åˆ°çš„å¸ƒå±€ä¿¡æ¯å¹¶å­˜å‚¨èµ·æ¥ï¼Œé˜²æ­¢åé¢æ–¹æ³•å¤šæ¬¡è®¡ç®—ï¼Œæé«˜æ€§èƒ½ã€‚æ­¤æ–¹æ³•åœ¨å¸ƒå±€ä¹‹å‰ä¼šè°ƒç”¨ä¸€æ¬¡ï¼Œä¹‹ååªæœ‰åœ¨è°ƒç”¨invalidateLayout,shouldInvalidateLayoutForBoundsChange:è¿”å›YESå’ŒUICollectionViewåˆ·æ–°çš„æ—¶å€™æ‰ä¼šè°ƒç”¨. collectionViewContentSizeè¿”å›å†…å®¹å°ºå¯¸ç»™UICollectionView.è¿™ä¸ªæ–¹æ³•è¿”å›çš„å°ºå¯¸æ˜¯ç»™UICollectionViewè¿™ä¸ªç»§æ‰¿äºUIScrollViewçš„è§†å›¾ä½œä¸ºcontenSize,ä¸æ˜¯UICollectionViewçš„è§†å›¾å°ºå¯¸.è¿™ä¸ªæ–¹æ³•ä¼šå¤šæ¬¡è°ƒç”¨ï¼Œæ‰€ä»¥æœ€å¥½æ˜¯åœ¨prepareLayouté‡Œå°±è®¡ç®—å¥½ã€‚ layoutAttributesForElementsInRectæ–¹æ³•è¿”å›ä¸€ç»„UICollectionViewLayoutAttributesç±»å¯¹è±¡.å®ƒä»£è¡¨ç€åœ¨è¿™ä¸ªæŒ‡å®šçš„åŒºåŸŸä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ˜¾ç¤ºcell,Supplementary View å’Œ Decoration Viewä¸­å“ªäº›è§†å›¾ï¼Œè€Œè¿™äº›è§†å›¾çš„å±æ€§åˆ™ä¿å­˜UICollectionViewLayoutAttributesä¸­.æ­¤æ–¹æ³•ä¼šå¤šæ¬¡è°ƒç”¨ï¼Œä¸ºäº†æ›´å¥½çš„æ€§èƒ½ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•å½“ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„UICollectionViewLayoutAttributesæœ€å¥½æ˜¯åœ¨prepareLayoutå·²ç»å¸ƒå±€å¥½çš„ä¿¡æ¯ã€‚ ã€å¯é€‰ã€‘äº¤äº’å®šåˆ¶æ–¹æ³•12- (BOOL)shouldInvalidateLayoutForBoundsChange:(CGRect)newBounds;- (CGPoint)targetContentOffsetForProposedContentOffset:(CGPoint)proposedContentOffset withScrollingVelocity:(CGPoint)velocity; shouldInvalidateLayoutForBoundsChange:å½“å¸ƒå±€çš„è¾¹ç•Œå‘é€æ”¹å˜çš„æ—¶å€™ï¼Œä¼šè¯¢é—®è¯¥æ–¹æ³•æ˜¯å¦é‡æ–°å¸ƒå±€.ä¸€æ—¦é‡æ–°åˆ·æ–°å¸ƒå±€ï¼Œå°±ä¼šæŒ‰é¡ºåºè°ƒç”¨ä¸‹é¢çš„æ–¹æ³•: prepareLayout,layoutAttributesForElementsInRect. targetContentOffsetForProposedContentOffsetè¿”å›å€¼å†³å®šcollectionViewåœ¨åœæ­¢æ»šåŠ¨çš„æ—¶å€™æœ€ç»ˆçš„åç§»é‡contentOffsetï¼ˆå¸¸è§çš„å¡ç‰‡å¸ƒå±€ä¼šä½¿ç”¨åˆ°ï¼‰ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849- (void)prepareLayout&#123; [super prepareLayout]; NSMutableArray *layoutInfoArr = [NSMutableArray array]; NSInteger maxNumberOfItems = 0; //è·å–å¸ƒå±€ä¿¡æ¯ NSInteger numberOfSections = [self.collectionView numberOfSections]; for (NSInteger section = 0; section &lt; numberOfSections; section++)&#123; NSInteger numberOfItems = [self.collectionView numberOfItemsInSection:section]; NSMutableArray *subArr = [NSMutableArray arrayWithCapacity:numberOfItems]; for (NSInteger item = 0; item &lt; numberOfItems; item++)&#123; NSIndexPath *indexPath = [NSIndexPath indexPathForItem:item inSection:section]; UICollectionViewLayoutAttributes *attributes = [self layoutAttributesForItemAtIndexPath:indexPath]; [subArr addObject:attributes]; &#125; if(maxNumberOfItems &lt; numberOfItems)&#123; maxNumberOfItems = numberOfItems; &#125; //æ·»åŠ åˆ°äºŒç»´æ•°ç»„ [layoutInfoArr addObject:[subArr copy]]; &#125; //å­˜å‚¨å¸ƒå±€ä¿¡æ¯ self.layoutInfoArr = [layoutInfoArr copy]; //ä¿å­˜å†…å®¹å°ºå¯¸ self.contentSize = CGSizeMake(maxNumberOfItems*(self.itemSize.width+self.interitemSpacing)+self.interitemSpacing, numberOfSections*(self.itemSize.height+self.lineSpacing)+self.lineSpacing);&#125;//itemSizeæ˜¯cellçš„å¤§å°ï¼ŒinteritemSpacingæ˜¯cellä¸cellä¹‹é—´çš„é—´è·ï¼ŒlineSpacingæ˜¯è¡Œè·ã€‚- (UICollectionViewLayoutAttributes *)layoutAttributesForItemAtIndexPath:(NSIndexPath *)indexPath&#123; UICollectionViewLayoutAttributes *attributes = [UICollectionViewLayoutAttributes layoutAttributesForCellWithIndexPath:indexPath]; //æ¯ä¸€ç»„cellä¸ºä¸€è¡Œ attributes.frame = CGRectMake((self.itemSize.width+self.interitemSpacing)*indexPath.row+self.interitemSpacing, (self.itemSize.height+self.lineSpacing)*indexPath.section+self.lineSpacing, self.itemSize.width, self.itemSize.height); return attributes;&#125;- (CGSize)collectionViewContentSize&#123; return self.contentSize;&#125;- (NSArray *)layoutAttributesForElementsInRect:(CGRect)rect&#123; NSMutableArray *layoutAttributesArr = [NSMutableArray array]; [self.layoutInfoArr enumerateObjectsUsingBlock:^(NSArray *array, NSUInteger i, BOOL * _Nonnull stop) &#123; [array enumerateObjectsUsingBlock:^(UICollectionViewLayoutAttributes *obj, NSUInteger idx, BOOL * _Nonnull stop) &#123; if(CGRectIntersectsRect(obj.frame, rect)) &#123; [layoutAttributesArr addObject:obj]; &#125; &#125;]; &#125;]; return layoutAttributesArr;&#125;","path":"2017/06/16/UICollectionViewè‡ªå®šä¹‰å¸ƒå±€/","date":"06-16","excerpt":""},{"title":"Cocoapods","text":"Cocoapodsæ¦‚å¿µCocoapodsæ˜¯ä¸€ä¸ªåŸºäºRubyçš„åŒ…ç®¡ç†å·¥å…·, ç±»ä¼¼çš„è¿˜æœ‰Carthage. Cocoapodsçš„å®‰è£…åœ¨è¿™é‡Œä¸åœ¨è¯¦è¿°, è¯·è‡ªè¡Œç™¾åº¦, åœ¨è¿™é‡Œç€é‡è®²ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨Cocoapodsåˆ¶ä½œç§æœ‰åŒ…, ä»¥åŠCocoapodsçš„å®ç°åŸç†. Cocoapodsçš„å®ç°åŸç†cocoapodså®‰è£…æˆåŠŸå, æˆ‘ä»¬æ€ä¹ˆæ¥ä½¿ç”¨å®ƒå‘¢. è¿™é‡Œå°±è¦ç”¨åˆ°cocoapodsçš„æ ¸å¿ƒæ–‡ä»¶ä¹‹ä¸€Podfile. Podfile æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œç”¨äºå®šä¹‰é¡¹ç›®æ‰€éœ€è¦ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹åº“ã€‚è¯¥æ–‡ä»¶æ”¯æŒé«˜åº¦è‡ªå®šä¹‰ï¼Œä½ å¯ä»¥æ ¹æ®ä¸ªäººå–œå¥½å¯¹å…¶åšå‡ºå®šåˆ¶ã€‚ Podfile source: specçš„åœ°å€ platform: æŒ‡å®šæ„å»ºé™æ€åº“çš„å¹³å° target: å®šä¹‰äº†CocoaPodsåœ¨æŒ‡å®štargetçš„ä¾èµ–, æ­¤å¤„çš„Targetåº”è¯¥ä¸Xcodeç›®æ ‡ç›¸å¯¹åº”ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œé™¤éè¡¨æ˜ä¸ç»§æ‰¿å®ƒä»¬, å¦åˆ™TargetåŒ…æ‹¬åœ¨å—å¤–éƒ¨å®šä¹‰çš„ä¾èµ–é¡¹ pod: ä¸€ä¸ªä¾èµ–é¡¹éœ€æ±‚æ˜¯ç”±Podçš„åç§°å’Œå¯é€‰çš„ç‰ˆæœ¬éœ€æ±‚åˆ—è¡¨æ‰€å®šä¹‰çš„ æ‰§è¡Œå®Œpod install å‘½ä»¤ä¹‹åï¼Œå¯ä»¥å‘ç°å·¥ç¨‹é‡Œé¢å¤šäº†ä¸‰ä¸ªæ–‡ä»¶, ä¸€ä¸ªXXX.xcworkspaceæ–‡ä»¶, ä¸€ä¸ªPodfile.lockæ–‡ä»¶, è¿˜æœ‰ä¸€ä¸ªPodsæ–‡ä»¶å¤¹. xcworkspaceï¼šç®¡ç†æ–°ç”Ÿæˆçš„Projectå’ŒåŸæœ¬çš„Project Podfile.lockï¼šè®°å½•å„ä¸ªPodçš„ç‰ˆæœ¬å·å’Œä¹‹å‰çš„ä¾èµ–å…³ç³» Podsï¼š æ–°ç”Ÿæˆåº“çš„æºä»£ç  åˆ›å»ºä¸€ä¸ªSpec RepoSpec Repoæ˜¯æ‰€æœ‰çš„Podsçš„ä¸€ä¸ªç´¢å¼•ï¼Œå°±æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œæ‰€æœ‰å…¬å¼€çš„Podséƒ½åœ¨è¿™ä¸ªé‡Œé¢ï¼Œä»–å®é™…æ˜¯ä¸€ä¸ªGitä»“åº“remoteç«¯. åœ¨GitHubä¸Šï¼Œä½†æ˜¯å½“ä½ ä½¿ç”¨äº†Cocoapodsåä»–ä¼šè¢«cloneåˆ°æœ¬åœ°çš„~/.cocoapods/reposç›®å½•ä¸‹ï¼Œå¯ä»¥è¿›å…¥åˆ°è¿™ä¸ªç›®å½•çœ‹åˆ°masteræ–‡ä»¶å¤¹å°±æ˜¯è¿™ä¸ªå®˜æ–¹çš„Spec Repoäº†ã€‚è¿™ä¸ªmasterç›®å½•çš„ç»“æ„æ˜¯è¿™ä¸ªæ ·å­çš„: â”œâ”€â”€ Specsâ””â”€â”€ [SPEC_NAME]â””â”€â”€ [VERSION]â””â”€â”€ [SPEC_NAME].podspecå¦‚æœä½ è¦åˆ›å»ºç§æœ‰Pod, é‚£ä¹ˆä½ çš„Spec Repoçš„è¿œç«¯åœ°å€å°±å¿…é¡»æ˜¯ç§æœ‰çš„. åä¹‹å¦‚æœä½ è¦åˆ›å»ºä¸€ä¸ªå…¬æœ‰çš„Pod, é‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨GitHubæ¥æ‰˜ç®¡ä½ çš„ä»£ç . å½“ä½ åˆ›å»ºå¥½è¿œç«¯çš„ä»“åº“ä¹‹å, æ‰§è¡Œpod repo add [Spec Repoçš„ä»“åº“å] [Spec Repoçš„gitåœ°å€]æ¥æŠŠè¿œç«¯çš„ä»“åº“cloneåˆ°æœ¬åœ°. æ³¨æ„, è¿™é‡Œ[Spec Repoçš„ä»“åº“å]ä¸ä¸€å®šæ˜¯è¿œç«¯Gitä»“åº“çš„åå­—, è€Œæ˜¯cloneåˆ°æœ¬åœ°å, æœ¬åœ°æ–‡ä»¶åŠ çš„åå­—, ä½†æ˜¯è¿™ä¸ªåå­—ä¼šåœ¨åé¢æäº¤PodSpecæ–‡ä»¶æ—¶ç”¨åˆ°. åˆ›å»ºPodå·¥ç¨‹æ–‡ä»¶æˆ‘ä»¬åœ¨ä½ éœ€è¦åˆ›å»ºPodçš„ç›®å½•ä¸‹ä½¿ç”¨pod lib create [Podåç§°]æ¥åˆ›å»ºå¯¹åº”çš„Podæ¨¡æ¿. å®é™…ä¸Šè¯¥å‘½ä»¤è¡Œéšè—äº†é»˜è®¤å‚æ•°, å‚æ•°è¡¥å…¨ååº”è¯¥æ˜¯pod lib create ProjectName --template-url=https://github.com/CocoaPods/pod-template.git. æ¥ä¸‹æ¥ä¼šé—®ä½ å››ä¸ªé—®é¢˜: What language do you want to use?? [ Swift / ObjC ]. ä½¿ç”¨ä»€ä¹ˆè¯­è¨€ Would you like to include a demo application with your library?. æ˜¯å¦éœ€è¦ä¸€ä¸ªä¾‹å­å·¥ç¨‹, ä¸€èˆ¬é€‰æ‹©YES Which testing frameworks will you use? [ Specta / Kiwi / None ]. é€‰æ‹©ä¸€ä¸ªæµ‹è¯•æ¡†æ¶ Would you like to do view based testing? [ Yes / No ]. æ˜¯å¦åŸºäºViewæµ‹è¯• What is your class prefix?. ç±»çš„å‰ç¼€æ ¹æ®è‡ªå·±çš„å®é™…éœ€è¦æ¥é€‰æ‹©å, å°±ä¼šè‡ªåŠ¨æ‰§è¡ŒPod installå‘½ä»¤æ¥åˆ›å»ºé¡¹ç›®å¹¶ä¸”ç”Ÿæˆä¾èµ–. è¿™æ˜¯è¿™ä¸ªPodçš„æ²¡ç›®å½•ç»“æ„åº”è¯¥æ˜¯è¿™æ ·çš„:MyLibâ”œâ”€â”€ .travis.ymlâ”œâ”€â”€ _Pods.xcprojectâ”œâ”€â”€ Exampleâ”‚ â”œâ”€â”€ MyLibâ”‚ â”œâ”€â”€ MyLib.xcodeprojâ”‚ â”œâ”€â”€ MyLib.xcworkspaceâ”‚ â”œâ”€â”€ Podfileâ”‚ â”œâ”€â”€ Podfile.lockâ”‚ â”œâ”€â”€ Podsâ”‚ â””â”€â”€ Testsâ”œâ”€â”€ LICENSEâ”œâ”€â”€ MyLib.podspecâ”œâ”€â”€ Podâ”‚ â”œâ”€â”€ Assetsâ”‚ â””â”€â”€ Classesâ”‚ â””â”€â”€ RemoveMe.[swift/m]â””â”€â”€ README.mdæ¥ä¸‹æ¥, æˆ‘ä»¬éœ€è¦åˆ›å»ºç¬¬äºŒä¸ªGitåœ°å€, ç”¨æ¥ä¿å­˜Podçš„å®ç°ä»£ç . æˆ‘ä»¬è¿›å…¥åˆ°Podæ–‡ä»¶å¤¹çš„æ ¹ç›®å½•ä¸‹, ä½¿ç”¨å¦‚ä¸‹ä»£ç æ¥å…³è”Podåˆ°è¿œç«¯ä»“åº“: 1234$ git add .$ git commit -s -m â€œInitial Commit of Libraryâ€$ git remote add origin [Podçš„è¿œç«¯åœ°å€] #æ·»åŠ è¿œç«¯ä»“åº“$ git push origin master #æäº¤åˆ°è¿œç«¯ä»“åº“ ç¼–è¾‘Podæ–‡ä»¶Podæ–‡ä»¶å°±æ˜¯è¿™ä¸ªPodè¦å®ç°åŠŸèƒ½çš„å…·ä½“é€»è¾‘, åœ¨ä¸»å·¥ç¨‹æ ¹ç›®å½•ä¸‹é¢æœ‰ä¸€ä¸ªå’ŒPodåŒåçš„æ–‡ä»¶å¤¹, é‡Œé¢æœ‰ä¸¤ä¸ªå­æ–‡ä»¶å¤¹. ä¸€ä¸ªæ˜¯Assets, ä¸€ä¸ªæ˜¯Classes. Assetsæ–‡ä»¶ä¸»è¦ç”¨æ¥å­˜æ”¾èµ„æºæ–‡ä»¶, ä¾‹å¦‚å›¾ç‰‡èµ„æºå’ŒXIBæ–‡ä»¶. Classesåˆ™å­˜æ”¾ä¸»è¦çš„åŠŸèƒ½ä»£ç , ç±».åœ¨è¿™é‡Œéœ€è¦æ³¨æ„ä¸¤ä¸ªåœ°æ–¹: å½“æˆ‘ä»¬è¦ä½¿ç”¨Podä¸­çš„èµ„æºæ—¶, ä»¥å›¾ç‰‡ä¸ºä¾‹, æˆ‘ä»¬é€šè¿‡[UIImage imageWithName:@&quot;xxx.png&quot;]æ˜¯å–ä¸åˆ°Podä¸­çš„å›¾ç‰‡çš„, å› ä¸ºimageWithName:æ–¹æ³•é»˜è®¤æ˜¯ä»mainBundleä¸­æ¥å–çš„, è€ŒPodä¸å±äºmainBundleçš„èŒƒç•´, æˆ‘ä»¬éœ€è¦å…ˆæ ¹æ®classæ¥æ‹¿åˆ°å½“å‰ç±»æ‰€åœ¨çš„bundle, å†å–è¯¥Bundleä¸­çš„èµ„æº. æ¯æ¬¡åœ¨Podæ–‡ä»¶å¤¹ä¸­æ·»åŠ æ–°çš„æ–‡ä»¶æˆ–è€…èµ„æºæ—¶, éƒ½éœ€è¦åœ¨æ ¹ç›®å½•çš„Exampleç›®å½•ä¸‹æ‰§è¡Œpod updateå‘½ä»¤æ¥é‡æ–°å»ºç«‹ç´¢å¼•. ç¼–è¾‘Podspecæ–‡ä»¶åˆå§‹æ—¶çš„Podspecæ–‡ä»¶åŒ…å«äº†å„ç§ä¿¡æ¯, è¯¦ç»†çš„è¯´æ˜æˆ‘ä»¬å¯ä»¥çœ‹å®˜æ–¹æ–‡æ¡£,è¿™é‡Œè´´ä¸Šæœ€åŸºç¡€çš„ç”¨æ³•ä»£ç  123456789101112131415161718192021222324252627282930313233Pod::Spec.new do |s|s.name = â€˜LevinPodsâ€™#Podçš„ç‰ˆæœ¬s.version = â€˜0.1.0â€™s.summary = â€˜ä½ åœ¨æœç´¢æ—¶ä¼šå‘ˆç°â€™s.description = &lt;&lt;-DESCè¿™é‡Œæ˜¯å…³äºä½ PodåŠŸèƒ½çš„æè¿°DESCs.homepage = â€˜https://github.com/HChong3210/HCPodsâ€˜s.license = &#123; :type =&gt; â€˜MITâ€™, :file =&gt; â€˜LICENSEâ€™ &#125;s.author = &#123; â€˜LevinLuoâ€™ =&gt; â€˜786325209@qq.comâ€™ &#125;#Podçš„è¿œç«¯ä»“åº“åœ°å€s.source = &#123; :git =&gt; â€˜https://github.com/xxx/LevinPods.gitâ€˜, :tag =&gt; s.version.to_s &#125;#Podæ”¯æŒçš„æœ€ä½ç‰ˆæœ¬s.ios.deployment_target = â€˜8.0â€™#Podæºæ–‡ä»¶çš„ä½ç½®s.source_files = â€˜LevinPods/Classes/*/â€˜#Podä¸­èµ„æºæ–‡ä»¶çš„ä½ç½®s.resource_bundles = &#123;â€˜DFCFormsâ€™ =&gt; [â€˜LevinPods/Assets/*.&#123;png,xib,plist&#125;â€™]&#125;#å¯¹å¤–å…¬å¼€çš„ç±»s.public_header_files = â€˜DFCForms/Classes/*/.hâ€™#Podä¸­ç”¨åˆ°çš„ç¬¬ä¸‰æ–¹åº“s.frameworks = â€˜UIKitâ€™s.dependency â€˜AFNetworkingâ€™, â€˜~&gt; 2.3â€™s.dependency â€˜SDWebImageâ€™end æäº¤Podæ–‡ä»¶Podæ–‡ä»¶ç¼–è¾‘å¥½å, æˆ‘ä»¬è¦æŠŠä»£ç æäº¤åˆ°è¿œç«¯æœåŠ¡å™¨, æˆ‘ä»¬å°±ä½¿ç”¨æ­£å¸¸çš„æ–¹å¼æ¥æäº¤ä»£ç , å¹¶ä¸”ç»™ä»£ç æ‰“ä¸ŠTag, æ³¨æ„, è¿™é‡Œçš„Tagå¿…é¡»å’ŒPodspecæ–‡ä»¶ä¸­çš„Podç‰ˆæœ¬å·ä¸€è‡´ , å› ä¸ºPodspecä¼šæ ¹æ®Tagä»è¿œç«¯æ¥æ‰¾ç›¸åº”çš„ä»£ç , å¦åˆ™ä¼šå‡ºç°ç‰ˆæœ¬å’Œä»£ç ä¸åŒ¹é…çš„ç°è±¡.å¦‚æœä¸ä½¿ç”¨Sourcetreeè¿™æ ·çš„GUIå·¥å…·, å¯ä»¥å‚è€ƒä¸‹é¢çš„Gitä»£ç : 12345git statusgit add .git tag -m â€˜å¤‡æ³¨â€™ ç‰ˆæœ¬å·git commit -s -m â€˜å¤‡æ³¨â€™git push origin master â€”tags æäº¤Podspecæ–‡ä»¶æäº¤å®ŒPodæ–‡ä»¶å, æˆ‘ä»¬åªç”¨æŠŠPodspecæ–‡ä»¶ä¹Ÿæäº¤ä¸Šå», è¿™æ ·å°±å¯ä»¥åœ¨Cocoapodsä¸­ç®€å†èµ·æ¥ç´¢å¼•, æ‰¾åˆ°è‡ªå·±çš„Podäº†.åœ¨æäº¤ä¹‹å‰æˆ‘ä»¬å¯ä»¥åœ¨æ ¹ç›®å½•ä¸‹ä½¿ç”¨pod lib lintå‘½ä»¤æ¥éªŒè¯æ˜¯å¦ç¼–è¯‘é€šè¿‡. ä¹Ÿå¯ä»¥ç›´æ¥æäº¤pod repo push [ä½ cloneåˆ°æœ¬åœ°çš„Spec Repoçš„ä»“åº“å] [Podåç§°].podspec --use-libraries --allow-warnings --sources=&#39;[Podspecè¿œç«¯åœ°å€],https://github.com/CocoaPods/Specs&#39; --verbose subspecçš„ä½¿ç”¨æœ‰æ—¶ä¸€ä¸ªPodå¤ªå¤§äº†, è€Œæˆ‘ä»¬åˆç”¨ä¸åˆ°å…¨éƒ¨çš„å†…å®¹, è¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨subspecæ¥è§£å†³è¿™ä¸ªé—®é¢˜. æˆ‘ä»¬å¯ä»¥åœ¨Podæ–‡ä»¶å¤¹ä¸­, ä½¿ç”¨æ–‡ä»¶å¤¹æ¥åˆ†å‰²å„ä¸ªå­Pod, ç„¶ååœ¨Podspecæ–‡ä»¶ä¸­è¿™æ ·è®¾ç½®: 1234567s.subspec â€˜[å­Podåç§°]â€™ do |pod1|pod1.source_files = â€˜SCCQRCode/Classes/[å­æ–‡ä»¶å¤¹å]/*/â€˜ends.subspec â€˜[å­Podåç§°]â€™ do |pod2|pod2.source_files = â€˜SCCQRCode/Classes/[å­æ–‡ä»¶å¤¹å]/*/â€˜end æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨å„ä¸ªå­Podä¸­åˆ†åˆ«è®¾ç½®ä»–ä»¬çš„èµ„æºè·¯å¾„, å¯¹å¤–æš´éœ²çš„headerè·¯å¾„, ä»¥åŠdependency. æˆ‘ä»¬åœ¨å¤–é¢å¼•ç”¨è¯¥Podçš„æ—¶å€™å°±å¯ä»¥ä½¿ç”¨pod [Pod/å­Pod]çš„æ–¹å¼æ¥åªå¼•ç”¨ä¸€ä¸ªå­Pod. å¸¸è§Podä¾èµ–çš„å‡ ç§å†™æ³•pod â€˜AFNetworkingâ€™, :configurations =&gt; [â€˜Debugâ€™, â€˜Betaâ€™]pod â€˜QueryKit/Attributeâ€™pod â€˜QueryKitâ€™, :subspecs =&gt; [â€˜Attributeâ€™, â€˜QuerySetâ€™]pod â€˜AFNetworkingâ€™, :path =&gt; â€˜~/Documents/AFNetworkingâ€™pod â€˜AFNetworkingâ€™, :git =&gt; â€˜https://github.com/gowalla/AFNetworking.gitâ€˜pod â€˜JSONKitâ€™, :podspec =&gt; â€˜https://example.com/JSONKit.podspecâ€˜ å‚è€ƒèµ„æ–™ Carthage åŒ…ç®¡ç†å·¥å…·ï¼Œå¦ä¸€ç§æ•æ·è½»å¿«çš„ iOS &amp; MAC å¼€å‘ä½“éªŒ ç»†èŠCocoapodsä¸Xcodeå·¥ç¨‹é…ç½® ä½¿ç”¨Cocoapodsåˆ›å»ºç§æœ‰podspec CocoaPods éƒ½åšäº†ä»€ä¹ˆï¼Ÿ ä½¿ç”¨ç§æœ‰Cocoapodsä»“åº“ä¸­å¼•ç”¨.aåº“ æ·±å…¥ç†è§£CocoaPods","path":"2017/06/03/Cocoapods/","date":"06-03","excerpt":""},{"title":"iOSé¡¹ç›®å·¥ç¨‹æ¦‚å¿µ","text":"Xcode Workspaceworkspaceæ˜¯Xcodeçš„ä¸€ç§æ–‡ä»¶ï¼Œç”¨æ¥ç®¡ç†å·¥ç¨‹å’Œé‡Œé¢çš„æ–‡ä»¶ï¼Œä¸€ä¸ªworkspaceå¯ä»¥åŒ…å«è‹¥å¹²ä¸ªå·¥ç¨‹ï¼Œç”šè‡³å¯ä»¥æ·»åŠ ä»»ä½•ä½ æƒ³æ·»åŠ çš„æ–‡ä»¶ã€‚workspaceæä¾›äº†å·¥ç¨‹å’Œå·¥ç¨‹é‡Œé¢çš„targetä¹‹é—´éšå¼å’Œæ˜¾å¼ä¾èµ–å…³ç³»ï¼Œç”¨æ¥ç®¡ç†å’Œç»„ç»‡å·¥ç¨‹é‡Œé¢çš„æ‰€æœ‰æ–‡ä»¶. ä¸€ä¸ªworkspaceå¯ä»¥ç®¡ç†å¤šä¸ªProject,pod installçš„è¿‡ç¨‹å°±æ˜¯ç”Ÿæˆäº†ä¸€ä¸ªworkspaceå’Œä¸€ä¸ªå…¨æ˜¯Podç»„ä»¶çš„Project, ç„¶åæˆ‘ä»¬é€šè¿‡ç”Ÿæˆçš„workspaceæ¥ç®¡ç†æ–°ç”Ÿæˆçš„Projectå’ŒåŸæœ¬çš„Project. Xcode Projectprojectå°±æ˜¯ä¸€ä¸ªä¸ªçš„ä»“åº“ï¼Œé‡Œé¢ä¼šåŒ…å«å±äºè¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰æ–‡ä»¶ï¼Œèµ„æºï¼Œä»¥åŠç”Ÿæˆä¸€ä¸ªæˆ–è€…å¤šä¸ªè½¯ä»¶äº§å“çš„ä¿¡æ¯ã€‚æ¯ä¸€ä¸ªprojectä¼šåŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ª targetsï¼Œè€Œæ¯ä¸€ä¸ª target å‘Šè¯‰æˆ‘ä»¬å¦‚ä½•ç”Ÿäº§ productsã€‚project ä¼šä¸ºæ‰€æœ‰ targets å®šä¹‰äº†é»˜è®¤çš„ build settingsï¼Œæ¯ä¸€ä¸ª target ä¹Ÿèƒ½è‡ªå®šä¹‰è‡ªå·±çš„ build settingsï¼Œä¸” target çš„ build settings ä¼šé‡å†™ project çš„ build settingsã€‚ Xcodeä¸­çš„ projecté‡Œé¢åŒ…å«äº†æ‰€æœ‰çš„æºæ–‡ä»¶ï¼Œèµ„æºæ–‡ä»¶å’Œæ„å»ºä¸€ä¸ªæˆ–è€…å¤šä¸ªproductçš„ä¿¡æ¯ã€‚projectåˆ©ç”¨ä»–ä»¬å»ç¼–è¯‘æˆ‘ä»¬æ‰€éœ€çš„productï¼Œä¹Ÿå¸®æˆ‘ä»¬ç»„ç»‡å®ƒä»¬ä¹‹é—´çš„å…³ç³»ã€‚ä¸€ä¸ªprojectå¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ªtargetã€‚projectå®šä¹‰äº†ä¸€äº›åŸºæœ¬çš„ç¼–è¯‘è®¾ç½®ï¼Œæ¯ä¸ªtargetéƒ½ç»§æ‰¿äº†projectçš„é»˜è®¤è®¾ç½®ï¼Œæ¯ä¸ªtargetå¯ä»¥é€šè¿‡é‡æ–°è®¾ç½®targetçš„ç¼–è¯‘é€‰é¡¹æ¥å®šä¹‰è‡ªå·±çš„ç‰¹æ®Šç¼–è¯‘é€‰é¡¹ã€‚ projectåŒ…å«äº†ä»¥ä¸‹ä¿¡æ¯ï¼š æºæ–‡ä»¶ ä»£ç çš„å¤´æ–‡ä»¶å’Œå®ç°æ–‡ä»¶ é™æ€åº“ï¼ŒåŠ¨æ€åº“ èµ„æºæ–‡ä»¶(å¦‚å›¾ç‰‡ï¼Œæ–‡æœ¬ï¼Œxmlï¼Œplistç­‰) ç•Œé¢èµ„æºæ–‡ä»¶(xibï¼Œ storyboardç­‰) åœ¨æ–‡ä»¶ç»“æ„çš„å¯¼èˆªä¸­ï¼Œé‡‡ç”¨groupå»ç»„ç»‡æ–‡ä»¶(å®é™…å¼€å‘ä¸­ï¼Œå°½é‡ä½¿ç”¨å®ä½“æ–‡ä»¶å¤¹) projectçš„ç¼–è¯‘çº§åˆ«é…ç½®æ–‡ä»¶å¦‚(debugï¼Œ release) target è¿è¡Œç¯å¢ƒå¦‚ï¼šdebugï¼Œtest projectå¯ä»¥å•ç‹¬å­˜åœ¨ï¼Œæˆ–è€…å­˜åœ¨äºä¸€ä¸ªworkspaceä¸­. Xcode Targettarget å®šä¹‰äº†ç”Ÿæˆçš„å”¯ä¸€ product, å®ƒå°†æ„å»ºè¯¥ product æ‰€éœ€çš„æ–‡ä»¶å’Œå¤„ç†è¿™äº›æ–‡ä»¶æ‰€éœ€çš„æŒ‡ä»¤é›†æ•´åˆè¿› build system ä¸­ã€‚Projects ä¼šåŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ª targets,æ¯ä¸€ä¸ª target å°†ä¼šäº§å‡ºä¸€ä¸ª product. è¿™äº›æŒ‡ä»¤ä»¥ build setting å’Œ build phases çš„å½¢å¼å­˜åœ¨ï¼Œä½ å¯åœ¨ Xcode çš„é¡¹ç›®ç¼–è¾‘å™¨(TARGETS-&gt;Build Setting, TARGETS-&gt;Build Phases)ä¸­è¿›è¡ŒæŸ¥çœ‹å’Œç¼–è¾‘ã€‚target ä¸­çš„ build setting å‚æ•°ç»§æ‰¿è‡ª project çš„ build settings, ä½†æ˜¯ä½ å¯ä»¥åœ¨ target ä¸­ä¿®æ”¹ä»»æ„ settings æ¥é‡å†™ project settingsï¼Œè¿™æ ·ï¼Œæœ€ç»ˆç”Ÿæ•ˆçš„ settings å‚æ•°ä»¥åœ¨ target ä¸­è®¾ç½®çš„ä¸ºå‡†. Project å¯åŒ…å«å¤šä¸ª target, ä½†æ˜¯åœ¨åŒä¸€æ—¶åˆ»ï¼Œåªä¼šæœ‰ä¸€ä¸ª target ç”Ÿæ•ˆï¼Œå¯ç”¨ Xcode çš„ scheme æ¥æŒ‡å®šæ˜¯å“ªä¸€ä¸ª target ç”Ÿæ•ˆ. target å’Œå…¶ç”Ÿæˆçš„ product å¯ä¸å¦ä¸€ä¸ª target æœ‰å…³ï¼Œå¦‚æœä¸€ä¸ª target çš„ build ä¾èµ–äºå¦ä¸€ä¸ª target çš„è¾“å‡ºï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¯´å‰ä¸€ä¸ª target ä¾èµ–äºåä¸€ä¸ª target .å¦‚æœè¿™äº› target åœ¨åŒä¸€ä¸ª workspace ä¸­ï¼Œé‚£ä¹ˆ Xcode èƒ½å¤Ÿå‘ç°è¿™ç§ä¾èµ–å…³ç³»ï¼Œä»è€Œä½¿å…¶ä»¥æˆ‘ä»¬æœŸæœ›çš„é¡ºåºç”Ÿæˆ products.è¿™ç§å…³ç³»è¢«ç§°ä¸ºéšå¼ä¾èµ–å…³ç³»ã€‚åŒæ—¶ï¼Œä½ å¯ä»¥æ˜¾ç¤ºæŒ‡å®š targets ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œå¹¶ä¸”è¿™ç§ä¾èµ–å…³ç³»ä¼šè¦†ç›– Xcode æ¨æµ‹å‡ºçš„éšå¼ä¾èµ–å…³ç³»ã€‚ æŒ‡å®š targets ä¹‹é—´çš„ä¾èµ–å…³ç³»çš„åœ°æ–¹åœ¨ Project Editor-&gt;TRAGETS-&gt;Build Phases-&gt;Target Dependencies å¤„è®¾ç½®. Schemeä¸€ä¸ªSchemeå°±åŒ…å«äº†ä¸€å¥—targets(è¿™äº›targetsä¹‹é—´å¯èƒ½æœ‰ä¾èµ–å…³ç³»)ï¼Œä¸€ä¸ªconfigurationï¼Œä¸€å¥—å¾…æ‰§è¡Œçš„testsã€‚æŒ‡å®šäº†ç¼–è¯‘å“ªä¸ªtargetï¼Œä½¿ç”¨å“ªä¸ªbuild configurationå»ç¼–è¯‘targetï¼Œæä¾›è¿è¡Œtargetçš„æ‰§è¡Œç¯å¢ƒç­‰ç­‰ã€‚å¯ä»¥é€šè¿‡scheme editoræ¥ç¼–è¾‘scheme. schemeå®šä¹‰äº†ä¸€ç³»åˆ—æ„å»ºçš„targetsï¼Œæ„å»ºæ—¶çš„é…ç½®ï¼Œå’Œä¸€ç³»åˆ—æ‰§è¡Œçš„æµ‹è¯•ã€‚å¯ä»¥æœ‰å¾ˆå¤šscheme,ä½†åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„ã€‚é€‰æ‹©schemeæ—¶ï¼Œæ„å‘³ç€ä½ ä¹Ÿé€‰æ‹©äº†ä¸€ä¸ªè¿è¡Œç›®æ ‡ï¼ˆproductæ„å»ºçš„ç¡¬ä»¶å¹³å°)ã€‚å¯ä»¥æŒ‡å®šschemeæ˜¯å¦å­˜å‚¨åœ¨projectä¸­ï¼Œä»¥ä¾¿åŒ…å«æ­¤projectçš„æ‰€æœ‰workspaceéƒ½å¯ä»¥ä½¿ç”¨äº›scheme,å½“ç„¶ä¹Ÿå¯ä»¥æŒ‡å®šåªå­˜å‚¨åœ¨æŸä¸ªworkspaceä¸­ã€‚ Build Settingsä¸€ä¸ªbuild settingæ˜¯ä¸€ä¸ªæŒ‡ç¤ºäº§å“æŸä¸ªæ–¹é¢æ„å»ºæ–¹å¼çš„å˜é‡ï¼Œæ¯”å¦‚å†³å®šxcodeä¼ ç»™ç¼–è¯‘å™¨çš„å‚æ•°é€‰é¡¹æ˜¯æ€æ ·ã€‚å…¶æ˜¯ä¸€ä¸ªå¸¸é‡æˆ–è€…ä¸€ä¸ªå…¬å¼ä¾›ç»™xcodeåœ¨æ„å»ºçš„æ—¶å€™è®¡ç®—build settingã€‚ build setting ä¸­åŒ…å«äº† product ç”Ÿæˆè¿‡ç¨‹ä¸­æ‰€éœ€çš„å‚æ•°ä¿¡æ¯ã€‚ä½ å¯ä»¥åœ¨ project-level å’Œ target-level å±‚æŒ‡å®š build settingsã€‚project-level çš„ build settings é€‚ç”¨äº project ä¸­çš„æ‰€æœ‰targetsï¼Œä½†æ˜¯å½“ target-level çš„ build settings é‡å†™äº† project-level çš„ build settingsï¼Œä»¥ target-level ä¸­çš„ build settings ä¸­çš„å€¼ä¸ºå‡† ä¸€ä¸ª build configaration æŒ‡å®šäº†ä¸€å¥— build settings ç”¨äºç”ŸæˆæŸä¸€ target çš„ productï¼Œä¾‹å¦‚ï¼Œåœ¨ Xcode åˆ›å»ºé¡¹ç›®æ—¶é»˜è®¤å°±æœ‰ä¸¤å¥—ç‹¬ç«‹çš„ build configarations, åˆ†åˆ«ç”¨äºç”Ÿæˆ debug å’Œ release æ¨¡å¼ä¸‹çš„ productã€‚ é™¤äº†åˆ›å»ºå·¥ç¨‹æ—¶ç”Ÿæˆçš„é»˜è®¤ build settingsï¼Œä½ ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ project-level æˆ–è€… target-level çš„ build settings.å…³äºç»§æ‰¿å…³ç³»ï¼ŒThe Unofficial Guide to xcconfig filesè¿™é‡Œä¹Ÿæœ‰è¯¦ç»†çš„è¯´æ˜ï¼Œå¼ºçƒˆå»ºè®®é˜…è¯»ã€‚åŠ¨æ€ç¯å¢ƒé…ç½®å°±æ˜¯ä½¿ç”¨è‡ªå®šä¹‰çš„ build settings æ¥å®ç°çš„. å‚è€ƒèµ„æ–™: Xcodeä½¿ç”¨xcconfigæ–‡ä»¶é…ç½®ç¯å¢ƒ Appleå®˜æ–¹æ–‡æ¡£ Xcodeä¸­çš„Schemeå’ŒBuild Configuration Xcode workSpace å¤šä¸ªprojectè”ç¼–","path":"2017/05/11/iOSé¡¹ç›®å·¥ç¨‹æ¦‚å¿µ/","date":"05-11","excerpt":""},{"title":"Instrumentsä½¿ç”¨","text":"Instruments æ˜¯ Xcode æä¾›æˆ‘ä»¬è°ƒè¯•Appæ€§èƒ½çš„åˆ†æå·¥å…· æ‰“å¼€Xcode, é€‰æ‹©Xcode -&gt; Open Developer Toolæ‰“å¼€å¦‚ä¸‹ç•Œé¢ Core AnimationCore Animationä¸»è¦ç”¨æ¥è¯„ä¼°å±å¹•æ¸²æŸ“æ—¶çš„å¸§ç‡, å¸§ç‡ä¸€èˆ¬æ¥è¯´è¶Šæ¥è¿‘60å°±è¶Šæµç•…, å½“ä½äº40æ—¶, å°±ä¼šæ„Ÿè§‰åˆ°æ˜æ˜¾çš„å¡é¡¿. Color Blended Layersï¼Œè¿™ä¸ªé€‰é¡¹é€‰é¡¹åŸºäºæ¸²æŸ“ç¨‹åº¦å¯¹å±å¹•ä¸­çš„æ··åˆåŒºåŸŸè¿›è¡Œç»¿åˆ°çº¢çš„é«˜äº®æ˜¾ç¤ºï¼Œè¶Šçº¢è¡¨ç¤ºæ€§èƒ½è¶Šå·®ï¼Œä¼šå¯¹å¸§ç‡ç­‰æŒ‡æ ‡é€ æˆè¾ƒå¤§çš„å½±å“ã€‚çº¢è‰²é€šå¸¸æ˜¯ç”±äºå¤šä¸ªåŠé€æ˜å›¾å±‚å åŠ å¼•èµ·ã€‚ Color Hits Green and Misses Redï¼Œå½“ UIView.layer.shouldRasterize = YES æ—¶ï¼Œè€—æ—¶çš„å›¾ç‰‡ç»˜åˆ¶ä¼šè¢«ç¼“å­˜ï¼Œå¹¶å½“åšä¸€ä¸ªç®€å•çš„æ‰å¹³å›¾ç‰‡æ¥å‘ˆç°ã€‚è¿™æ—¶å€™ï¼Œå¦‚æœé¡µé¢çš„å…¶ä»–åŒºå—(æ¯”å¦‚ UITableViewCell çš„å¤ç”¨)ä½¿ç”¨ç¼“å­˜ç›´æ¥å‘½ä¸­ï¼Œå°±æ˜¾ç¤ºç»¿è‰²ï¼Œåä¹‹ï¼Œå¦‚æœä¸å‘½ä¸­ï¼Œè¿™æ—¶å°±æ˜¾ç¤ºçº¢è‰²ã€‚çº¢è‰²è¶Šå¤šï¼Œæ€§èƒ½è¶Šå·®ã€‚å› ä¸ºæ …æ ¼åŒ–ç”Ÿæˆç¼“å­˜çš„è¿‡ç¨‹æ˜¯æœ‰å¼€é”€çš„ï¼Œå¦‚æœç¼“å­˜èƒ½è¢«å¤§é‡å‘½ä¸­å’Œæœ‰æ•ˆä½¿ç”¨ï¼Œåˆ™æ€»ä½“ä¸Šä¼šé™ä½å¼€é”€ï¼Œåä¹‹åˆ™æ„å‘³ç€è¦é¢‘ç¹ç”Ÿæˆæ–°çš„ç¼“å­˜ï¼Œè¿™ä¼šè®©æ€§èƒ½é—®é¢˜é›ªä¸ŠåŠ éœœã€‚ Color Copied Imagesï¼Œå¯¹äº GPU ä¸æ”¯æŒçš„è‰²å½©æ ¼å¼çš„å›¾ç‰‡åªèƒ½ç”± CPU æ¥å¤„ç†ï¼ŒæŠŠè¿™æ ·çš„å›¾ç‰‡æ ‡ä¸ºè“è‰²ã€‚è“è‰²è¶Šå¤šï¼Œæ€§èƒ½è¶Šå·®ã€‚å› ä¸ºï¼Œæˆ‘ä»¬ä¸å¸Œæœ›åœ¨æ»šåŠ¨è§†å›¾çš„æ—¶å€™ï¼Œç”± CPU æ¥å¤„ç†å›¾ç‰‡ï¼Œè¿™æ ·å¯èƒ½ä¼šå¯¹ä¸»çº¿ç¨‹é€ æˆé˜»å¡ã€‚ Color Non-Standard Surface Formats, ä¸æ ‡å‡†çš„è¡¨é¢é¢œè‰²æ ¼å¼. Color Immediatelyï¼Œé€šå¸¸ Core Animation Instruments ä»¥æ¯æ¯«ç§’ 10 æ¬¡çš„é¢‘ç‡æ›´æ–°å›¾å±‚è°ƒè¯•é¢œè‰²ã€‚å¯¹æŸäº›æ•ˆæœæ¥è¯´ï¼Œè¿™æ˜¾ç„¶å¤ªæ…¢äº†ã€‚è¿™ä¸ªé€‰é¡¹å°±å¯ä»¥ç”¨æ¥è®¾ç½®æ¯å¸§éƒ½æ›´æ–°ï¼ˆå¯èƒ½ä¼šå½±å“åˆ°æ¸²æŸ“æ€§èƒ½ï¼Œè€Œä¸”ä¼šå¯¼è‡´å¸§ç‡æµ‹é‡ä¸å‡†ï¼Œæ‰€ä»¥ä¸è¦ä¸€ç›´éƒ½è®¾ç½®å®ƒï¼‰ã€‚ Color Misaligned Imagesï¼Œè¿™ä¸ªé€‰é¡¹æ£€æŸ¥äº†å›¾ç‰‡æ˜¯å¦è¢«ç¼©æ”¾ï¼Œä»¥åŠåƒç´ æ˜¯å¦å¯¹é½ã€‚è¢«æ”¾ç¼©çš„å›¾ç‰‡ä¼šè¢«æ ‡è®°ä¸ºé»„è‰²ï¼Œåƒç´ ä¸å¯¹é½åˆ™ä¼šæ ‡æ³¨ä¸ºç´«è‰²ã€‚é»„è‰²ã€ç´«è‰²è¶Šå¤šï¼Œæ€§èƒ½è¶Šå·®ã€‚ Color Offscreen-Rendered Yellowï¼Œè¿™ä¸ªé€‰é¡¹ä¼šæŠŠé‚£äº›ç¦»å±æ¸²æŸ“çš„å›¾å±‚æ˜¾ç¤ºä¸ºé»„è‰²ã€‚é»„è‰²è¶Šå¤šï¼Œæ€§èƒ½è¶Šå·®ã€‚è¿™äº›æ˜¾ç¤ºä¸ºé»„è‰²çš„å›¾å±‚å¾ˆå¯èƒ½éœ€è¦ç”¨ shadowPath æˆ–è€… shouldRasterize æ¥ä¼˜åŒ–ã€‚ Color Compositing Fast Path Blueï¼Œè¿™ä¸ªé€‰é¡¹ä¼šæŠŠä»»ä½•ç›´æ¥ä½¿ç”¨ OpenGL ç»˜åˆ¶çš„å›¾å±‚æ˜¾ç¤ºä¸ºè“è‰²ã€‚è“è‰²è¶Šå¤šï¼Œæ€§èƒ½è¶Šå¥½ã€‚å¦‚æœä»…ä»…ä½¿ç”¨ UIKit æˆ–è€… Core Animation çš„ APIï¼Œé‚£ä¹ˆä¸ä¼šæœ‰ä»»ä½•æ•ˆæœã€‚å¦‚æœä½¿ç”¨ GLKView æˆ–è€… CAEAGLLayerï¼Œé‚£å¦‚æœä¸æ˜¾ç¤ºè“è‰²å—çš„è¯å°±æ„å‘³ç€ä½ æ­£åœ¨å¼ºåˆ¶ CPU æ¸²æŸ“é¢å¤–çš„çº¹ç†ï¼Œè€Œä¸æ˜¯ç»˜åˆ¶åˆ°å±å¹•ã€‚ Flash Updated Regionsï¼Œè¿™ä¸ªé€‰é¡¹ä¼šæŠŠé‡ç»˜çš„å†…å®¹æ˜¾ç¤ºä¸ºé»„è‰²ã€‚ä¸è¯¥å‡ºç°çš„é»„è‰²è¶Šå¤šï¼Œæ€§èƒ½è¶Šå·®ã€‚é€šå¸¸æˆ‘ä»¬å¸Œæœ›åªæ˜¯æ›´æ–°çš„éƒ¨åˆ†è¢«æ ‡è®°å®Œé»„è‰²ã€‚ Leakså…³äºå†…å­˜æ–¹é¢çš„ç›‘æ§, æœ‰Leaksç”¨æ¥æ£€æµ‹å†…å­˜æ³„æ¼, Zombiesç”¨æ¥æ£€æµ‹åƒµå°¸å¯¹è±¡. å…³äºå†…å­˜æ³„æ¼å¸¸è§çš„å‡ ç§æƒ…å†µ, å¯ä»¥å‚è€ƒè¿™é‡Œ Time Profilerè¿™ä¸ªä¸»è¦æ˜¯ç”¨æ¥ç»Ÿè®¡å„ä¸ªæ–¹æ³•æ¶ˆè€—çš„æ—¶é—´.å¦‚å›¾æ‰€ç¤º, å±•ç¤ºå„ä¸ªæ–¹æ³•å æ¯”å’Œæ¶ˆè€—çš„æ—¶é—´, ä»¥msä¸ºå•ä½. å³ä¾§èœå•æ ä¸€èˆ¬ä¼šæ˜¾ç¤ºæœ€è€—æ—¶çš„ä¸€äº›æ“ä½œ, å¦‚æœä¸€èˆ¬å‰é¢çš„å°å›¾ç‰‡æ˜¯é»‘è‰²çš„è¯, é‚£å°±è¯´æ˜è¿™éƒ¨åˆ†ä»£ç , å ç”¨äº†å¤§é‡çš„ç³»ç»Ÿæ—¶é—´, æ˜¯éœ€è¦è¿«åˆ‡ä¼˜åŒ–çš„. Separate byt Threadï¼ˆå»ºè®®é€‰æ‹©ï¼‰ï¼šé€šè¿‡çº¿ç¨‹åˆ†ç±»æ¥æŸ¥çœ‹é‚£äº›çº¯ç§å ç”¨CPUæœ€å¤šã€‚ Invert Call Treeï¼ˆä¸å»ºè®®é€‰æ‹©ï¼‰ï¼šè°ƒç”¨æ ‘å€’è¿”è¿‡æ¥ï¼Œå°†ä¹ æƒ¯æ€§çš„ä»æ ¹å‘ä¸‹ä¸€çº§ä¸€çº§çš„æ˜¾ç¤ºï¼Œå¦‚é€‰ä¸Šå°±ä¼šè¿”è¿‡æ¥ä»æœ€åº•å±‚è°ƒç”¨å‘ä¸€çº§ä¸€çº§çš„æ˜¾ç¤ºã€‚å¦‚æœæƒ³è¦æŸ¥çœ‹é‚£ä¸ªæ–¹æ³•è°ƒç”¨ä¸ºæœ€æ·±æ—¶ä½¿ç”¨ä¼šæ›´æ–¹ä¾¿äº›ã€‚ Hide Missing Symbolsï¼ˆå»ºè®®é€‰æ‹©ï¼‰ï¼šéšè—ä¸¢å¤±çš„ç¬¦å·ï¼Œæ¯”å¦‚åº”ç”¨æˆ–è€…ç³»ç»Ÿçš„dSYMæ–‡ä»¶æ‰¾ä¸åˆ°çš„è¯ï¼Œåœ¨è¯¦æƒ…é¢æ¿ä¸Šæ˜¯çœ‹ä¸åˆ°æ–¹æ³•åçš„ï¼Œåªèƒ½çœ‹ä¸€äº›è¯»ä¸æ˜çš„åå…­è¿›å€¼ï¼Œæ‰€ä»¥å¯¹æˆ‘ä»¬æ¥è¯´æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå»æ‰äº†ä¼šä½¿é˜…è¯»æ›´æ¸…æ¥šäº›ã€‚ Hide System Librariesï¼ˆå»ºè®®é€‰æ‹©ï¼‰ï¼šé€‰ä¸Šå®ƒåªä¼šå±•ç¤ºä¸åº”ç”¨æœ‰å…³çš„ç¬¦å·ä¿¡æ¯ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬åªå…³å¿ƒè‡ªå·±å†™çš„ä»£ç æ‰€éœ€çš„è€—æ—¶ï¼Œè€Œä¸å…³å¿ƒç³»ç»Ÿåº“çš„CPUè€—æ—¶ã€‚ Flatten Recursionï¼ˆä¸€èˆ¬ä¸é€‰ï¼‰ï¼šé€‰ä¸Šå®ƒä¼šå°†è°ƒç”¨æ ˆé‡Œé€’å½’å‡½æ•°ä½œä¸ºä¸€ä¸ªå…¥å£ã€‚ Top Functionsï¼ˆå¯é€‰ï¼‰ï¼šé€‰ä¸Šå®ƒä¼šå°†æœ€è€—æ—¶çš„å‡½æ•°é™åºæ’åˆ—ï¼Œè€Œè¿™ç§è€—æ—¶æ˜¯ç´¯åŠ çš„ï¼Œæ¯”å¦‚Aè°ƒç”¨äº†Bï¼Œé‚£ä¹ˆAçš„è€—æ—¶æ•°æ˜¯ä¼šåŒ…å«Bçš„è€—æ—¶æ•°ã€‚ Time Profileræ— æ³•å®šä½åˆ°ä»£ç  Project-&gt;Build Settings-&gt;Debug Information Format é€‰æ‹©DWARF with dSYM File Profileè¦åœ¨debugæ¨¡å¼ä¸‹è¿è¡Œ, BuildConfigurationè¦é€‰æ‹©debug. å‚è€ƒèµ„æ–™ iOS æ€§èƒ½ä¼˜åŒ–ï¼šInstruments å·¥å…·çš„æ•‘å‘½ä¸‰æ‹› Instrumentsæ€§èƒ½ä¼˜åŒ–-Core Animation ä½¿ç”¨ Instruments åš iOS ç¨‹åºæ€§èƒ½è°ƒè¯• å…³äºå†…å­˜æ³„æ¼ï¼Œè¿˜æœ‰å“ªäº›æ˜¯ä½ ä¸çŸ¥é“çš„ï¼Ÿ ä½¿ç”¨Instrumentså®šä½iOSåº”ç”¨çš„Memory Leaks instrument Time Profileræ€»ç»“","path":"2017/04/28/Instrumentsä½¿ç”¨/","date":"04-28","excerpt":""},{"title":"iOSå†…å­˜åˆ†é…","text":"è®¡ç®—æœºç³»ç»Ÿä¸­ï¼Œåº”ç”¨ç¨‹åºçš„æ•°æ®éƒ½ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œä¸åŒçš„æ•°æ®ç±»å‹ä¿å­˜çš„åŒºåŸŸä¹Ÿä¸åŒã€‚ RAMå’ŒROM RAMï¼šè¿è¡Œæ—¶å†…å­˜ï¼Œç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­çš„ä½¿ç”¨çš„å†…å­˜ï¼Œä¸èƒ½æ‰ç”µå­˜å‚¨ ROMï¼šå­˜å‚¨å½¢å†…å­˜ï¼ˆå†…å­˜å¡ï¼‰ï¼ŒRAMçš„é€Ÿåº¦å’Œä»·æ ¼éƒ½é«˜äºROM Appç¨‹åºå¯åŠ¨ï¼Œç³»ç»Ÿä¼šæŠŠå­˜å‚¨åœ¨ROMä¸­çš„ç¨‹åºæ‹·è´åˆ°RAMä¸­ï¼Œç„¶åä»å†…å­˜é‡Œé¢æ‰§è¡Œä»£ç  å†…å­˜åˆ†åŒºå †åŒºï¼šHeapå †åŒºç”±ç¨‹åºå‘˜æ¥åˆ†é…(oc: alloc swift: init)å’Œé‡Šæ”¾ ARCä¸‹çš„å†…å­˜ç®¡ç†ç”±ç¼–è¯‘å™¨è‡ªåŠ¨æ·»åŠ retain, release, autoreleaseç­‰å…³é”®å­— å †åŒºçš„åœ°å€ç”±ä½åˆ°é«˜åˆ†é… ä¸åŒå †åˆ†é…çš„å†…å­˜æ— æ³•äº’ç›¸äº’æ“ä½œ(ä¸åŒAppä¹‹é—´å†…å­˜æ— æ³•ç›¸äº’ç®¡ç†) å †ç©ºé—´çš„åˆ†é…æ€»æ˜¯åŠ¨æ€çš„ éœ€è¦ç¨‹åºçŒ¿è¿›è¡Œåˆ†é…å’Œé‡Šæ”¾ æ ˆåŒº Stackæ ˆåŒºæ˜¯ç”±ç¼–è¯‘å™¨è‡ªåŠ¨åˆ†é…å’Œé‡Šæ”¾çš„ï¼Œç”¨æ¥å­˜æ”¾å±€éƒ¨å˜é‡ï¼Œå‡½æ•°çš„å‚æ•°å€¼ï¼Œå‡½æ•°è·³è½¬åœ°å€ç­‰iPhoneæ ˆåŒºå¤§å°æ˜¯512K ä¸éœ€è¦æˆ‘ä»¬ç®¡ç†æ ˆåŒºå˜é‡çš„å†…å­˜ æ ˆåŒºåœ°å€ä»é«˜åˆ°ä½åˆ†é… å…ˆè¿›åå‡ºæ ˆç©ºé—´æœ‰é™æ€åˆ†é…å’ŒåŠ¨æ€åˆ†é…ä¸¤ç§ é™æ€åˆ†é…æ˜¯ç”±ç¼–è¯‘å™¨å®Œæˆï¼Œæ¯”å¦‚è‡ªåŠ¨å˜é‡autoçš„åˆ†é…. åŠ¨æ€åˆ†é…ç”±allocaå‡½æ•°å®Œæˆ. æ ˆçš„åŠ¨æ€åˆ†é…æ— éœ€é‡Šæ”¾, ç³»ç»Ÿä¼šè‡ªåŠ¨é‡Šæ”¾, æ²¡æœ‰é‡Šæ”¾å‡½æ•°. ç³»ç»Ÿä¸é¼“åŠ±æ ˆçš„åŠ¨æ€åˆ†é…. å…¨å±€åŒº staticå…¨å±€åŒºä¹Ÿå«åšé™æ€åŒºï¼Œå…¨å±€å˜é‡å’Œé™æ€å˜é‡åœ¨å†…å­˜ä¸­æ˜¯å­˜æ”¾åœ¨ä¸€èµ·çš„ï¼Œåˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡æ”¾åœ¨ä¸€å—åŒºåŸŸï¼Œæœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡æ”¾åœ¨ç›¸é‚»çš„å®ä¸€å—åŒºåŸŸï¼Œç¨‹åºç»“æŸåç”±ç³»ç»Ÿé‡Šæ”¾ å¸¸é‡åŒºå­˜æ”¾å­—ç¬¦ä¸²å¸¸é‡ï¼Œç¨‹åºç»“æŸåç”±ç³»ç»Ÿè‡ªå·±é‡Šæ”¾ ä»£ç åŒºä»£ç åŒºç”¨äºå­˜æ”¾å‡½æ•°çš„äºŒè¿›åˆ¶ä»£ç ï¼ŒAppçš„ä»£ç ï¼Œç¨‹åºç»“æŸåç”±ç³»ç»Ÿé‡Šæ”¾ å†…å­˜åˆ†åŒºåœ°å€å¦‚å›¾æ‰€ç¤ºï¼šä»£ç åŒºçš„åœ°å€æœ€ä½ï¼Œæ ˆåŒºæœ€é«˜ï¼Œä½†åŒºä¸åŒºä¹‹é—´çš„åœ°å€ä¸è¿ç»­ æ ˆï¼šç”±ç³»ç»Ÿè‡ªåŠ¨åˆ†é…, é€Ÿåº¦è¾ƒå¿«, ä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡. å †ï¼šæ˜¯ç”±allocåˆ†é…çš„å†…å­˜, é€Ÿåº¦æ¯”è¾ƒæ…¢, è€Œä¸”å®¹æ˜“äº§ç”Ÿå†…å­˜ç¢ç‰‡, ä¸è¿‡ç”¨èµ·æ¥æœ€æ–¹ä¾¿. ç³»ç»Ÿä½¿ç”¨ä¸€ä¸ªé“¾è¡¨æ¥ç»´æŠ¤å·²åˆ†é…çš„å†…å­˜ç©ºé—´(ä»…ä»…è®°å½•, ä¸ç®¡ç†å…·ä½“çš„å†…å®¹). å˜é‡ä½¿ç”¨ç»“æŸå, éœ€è¦é‡Šæ”¾å†…å­˜, OCä¸­æ˜¯å½“å¼•ç”¨è®¡æ•°==0, å°±è¯´æ˜æ²¡æœ‰ä»»ä½•å˜é‡ä½¿ç”¨è¿™å—ç©ºé—´, ç³»ç»Ÿå°†ç›´æ¥æ”¶å›. å½“ä¸€ä¸ªappå¯åŠ¨æ—¶, ä»£ç åŒº, å¸¸é‡åŒº, å…¨å±€åŒºçš„å¤§å°å®é™…å·²ç»å›ºå®š, å› æ­¤æŒ‡å‘è¿™äº›åŒºåŸŸçš„å†…å­˜ä¸ä¼šäº§ç”Ÿå´©æºƒæ€§é”™è¯¯. å †åŒºå’Œæ ˆåŒºçš„å†…å­˜æ˜¯æ—¶åˆ»å˜åŒ–çš„, ä½¿ç”¨ä¸€ä¸ªå·²ç»è¢«é‡Šæ”¾çš„å†…å­˜, å¾ˆå®¹æ˜“äº§ç”Ÿé‡æŒ‡é’ˆå´©æºƒ. ç”³è¯·å†…å­˜åç³»ç»Ÿçš„å“åº” æ ˆ: æ ˆæ˜¯å‘ä½å†…å­˜æ‰©å±•çš„æ•°æ®ç»“æ„, æ˜¯ä¸€å—è¿ç»­çš„å†…å­˜, æ ˆé¡¶åœ°å€å’Œæ ˆçš„æœ€å¤§å®¹é‡æ˜¯äº‹å…ˆè§„å®šå¥½çš„, å¦‚æœç”³è¯·çš„ç©ºé—´è¶…è¿‡æ ˆçš„å‰©ä½™ç©ºé—´, å°†ä¼šæç¤ºoverflow.æ ˆæ˜¯å‘ä½åœ°å€æ‰©å±•çš„æ•°æ®ç»“æ„, æ˜¯ä¸€å—å„¿è¿ç»­çš„å†…å­˜åŒºåŸŸ. æ ˆé¡¶çš„åœ°å€å’Œæ ˆçš„æœ€å¤§å®¹é‡æ˜¯ç³»ç»Ÿé¢„å…ˆè§„å®šå¥½çš„, æ ˆçš„å¤§å°æ˜¯2M(ä¹Ÿæœ‰çš„è¯´æ˜¯1M, æ€»ä¹‹æ˜¯ä¸€ä¸ªç¼–è¯‘æ—¶å°±ç¡®å®šçš„å¸¸æ•°), å¦‚æœç”³è¯·çš„ç©ºé—´è¶…è¿‡æ ˆçš„å‰©ä½™ç©ºé—´æ—¶, å°†æç¤ºoverflow. å› æ­¤, èƒ½ä»æ ˆè·å¾—çš„ç©ºé—´è¾ƒå°. å †: æ“ä½œç³»ç»Ÿæœ‰ä¸€ä¸ªè®°å½•ç©ºé—²å†…å­˜åœ°å€çš„é“¾è¡¨. å½“ç³»ç»Ÿæ”¶åˆ°ç”³è¯·æ—¶, ä¼šéå†è¯¥é“¾è¡¨, å¯»æ‰¾ç¬¬ä¸€ä¸ªç©ºé—´å¤§äºæ‰€ç”³è¯·ç©ºé—´çš„å †ç»“ç‚¹, ç„¶åå°†è¯¥ç»“ç‚¹ä»é“¾è¡¨ä¸­åˆ é™¤, å¹¶å°†è¯¥ç»“ç‚¹çš„ç©ºé—´åˆ†é…ç»™ç¨‹åº. ç”±äºæ‰¾åˆ°çš„å †ç»“ç‚¹ä¸ä¸€å®šå’Œç”³è¯·çš„å¤§å°åˆšå¥½ä¸€è‡´, ç³»ç»Ÿä¼šå°†å¤šä½™çš„é‚£ä¸€éƒ¨åˆ†é‡æ–°æ”¾å›åˆ°é“¾è¡¨ä¸­å». å †æ˜¯å‘é«˜åœ°å€æ‰©å±•çš„æ•°æ®ç»“æ„, æ˜¯ä¸è¿ç»­çš„å†…å­˜åŒºåŸŸ. è¿™æ˜¯ç”±äºç³»ç»Ÿæ˜¯ç”¨é“¾è¡¨æ¥å­˜å‚¨çš„ç©ºé—²å†…å­˜åœ°å€, è‡ªç„¶æ˜¯ä¸è¿ç»­çš„, è€Œé“¾è¡¨çš„éå†æ–¹å‘æ˜¯ç”±ä½åœ°å€å‘é«˜åœ°å€. å †çš„å¤§å°å—é™äºè®¡ç®—æœºç³»ç»Ÿä¸­æœ‰æ•ˆçš„è™šæ‹Ÿå†…å­˜.å †è·å¾—çš„ç©ºé—´æ¯”è¾ƒçµæ´», ä¹Ÿæ¯”è¾ƒå¤§.","path":"2017/04/14/iOSå†…å­˜åˆ†é…/","date":"04-14","excerpt":""},{"title":"gitå·¥ä½œæµ","text":"å¤§è¯ Git å·¥ä½œæµ,è¿™ç¯‡æ–‡ç« éå¸¸æœ‰æ„æ€ï¼Œç”¨æ•…äº‹çš„æ–¹æ³•æè¿°äº†å‡ ç§å¸¸ç”¨çš„gitå·¥ä½œæµç¨‹. å› ä¸ºæˆ‘ä»¬å›¢é˜Ÿäººæ•°ä¸å¤š,æ‰€ä»¥æˆ‘ä»¬çš„åšæ³•æ˜¯è¿™æ ·çš„ï¼Œå»ºç«‹masterå’Œdeveloperåˆ†æ”¯ã€‚ç„¶åæ¯ä¸ªå¼€å‘äººå‘˜ä»developeråˆ†æ”¯ä¸Šæ‹‰ä¸€ä¸ªå±äºè‡ªå·±çš„è¿œç¨‹åˆ†æ”¯ï¼Œåˆ«äººä¸ä¼šåŠ¨ä½ çš„è¿œç¨‹åˆ†æ”¯ï¼Œæ¯æ¬¡æäº¤ä»£ç éƒ½æäº¤åˆ°è‡ªå·±çš„è¿œç¨‹åˆ†æ”¯ã€‚è¿™æ ·åœ¨æ¯ä¸ªäººçš„è§’åº¦ä¾¿ä¸ä¼šäº§ç”Ÿconflictã€‚å…¶å®ï¼Œå¤šäººåä½œå¼€å‘ï¼Œå†²çªæ˜¯ä¸€ä¸ªä¸å¯é¿å…çš„é—®é¢˜ã€‚é‚£ä¹ˆï¼Œä¸€å¤©å·¥ä½œç»“æŸçš„æ—¶å€™ï¼Œæˆ‘ä»¬å†å»è§£å†³å†²çªã€‚remote1 pull remote2ï¼Œåœ¨remote1ä¸­è§£å†³å†²çªï¼Œç„¶åå†pushåˆ°developeråˆ†æ”¯ï¼Œç¬¬äºŒå¤©ä¸Šç­çš„æ—¶å€™ï¼Œæ¯ä¸ªäººå†ä»developerä¸­pullæœ€æ–°çš„ä»£ç åˆ°æœ¬åœ°ã€‚æ€»çš„æ¥è¯´ï¼Œåˆ†æ”¯æ¨¡å¼ï¼Œæœ‰åˆ©äºå¯¹å†²çªçš„æŠŠæ§ï¼Œä¸ä¼šå½±å“åˆ°æ¯ä¸€ä¸ªäººè‡ªå·±çš„ä»£ç ã€‚å‘å¸ƒçš„æ—¶å€™developeråˆ†æ”¯åˆå¹¶åˆ°masteråˆ†æ”¯ä¸Šå¹¶æ‰“ä¸Štag.","path":"2016/12/29/gitå·¥ä½œæµ/","date":"12-29","excerpt":""},{"title":"iOSç½‘ç»œç¼–ç¨‹","text":"HTTPè¯·æ±‚ä¸­çš„GETå’ŒPOSTGETæŠŠå‚æ•°åŒ…å«åœ¨URLä¸­, POSTé€šè¿‡request bodyä¼ é€’å‚æ•°.GETæ¯”POSTæ›´ä¸å®‰å…¨, å› ä¸ºå‚æ•°ç›´æ¥æš´éœ²åœ¨URLä¸Š, æ‰€ä»¥ä¸èƒ½ç”¨æ¥ä¼ é€’æ•æ„Ÿä¿¡æ¯.GET/POSTéƒ½æ˜¯TCPé“¾æ¥ TCPä¸UDPTCPé¢å‘è¿æ¥ï¼ˆå¦‚æ‰“ç”µè¯è¦å…ˆæ‹¨å·å»ºç«‹è¿æ¥); UDPæ˜¯æ— è¿æ¥çš„, å³å‘é€æ•°æ®ä¹‹å‰ä¸éœ€è¦å»ºç«‹è¿æ¥.TCPæä¾›å¯é çš„æœåŠ¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé€šè¿‡TCPè¿æ¥ä¼ é€çš„æ•°æ®ï¼Œæ— å·®é”™ï¼Œä¸ä¸¢å¤±ï¼Œä¸é‡å¤ï¼Œä¸”æŒ‰åºåˆ°è¾¾;UDPå°½æœ€å¤§åŠªåŠ›äº¤ä»˜ï¼Œå³ä¸ä¿è¯å¯é äº¤ä»˜. TCP: é¢å‘è¿æ¥, ä¼ è¾“å¯é (ä¿è¯æ•°æ®æ­£ç¡®æ€§, ä¿è¯æ•°æ®é¡ºåº), ç”¨äºä¼ è¾“å¤§é‡æ•°æ®(æµæ¨¡å¼), é€Ÿåº¦æ…¢, å»ºç«‹è¿æ¥éœ€è¦å¼€é”€è¾ƒå¤š(æ—¶é—´, ç³»ç»Ÿèµ„æº).UDP: é¢å‘éè¿æ¥, ä¼ è¾“ä¸å¯é , ç”¨äºä¼ è¾“å°‘é‡æ•°æ®(æ•°æ®åŒ…æ¨¡å¼), é€Ÿåº¦å¿«. ä¸‰æ¬¡æ¡æ‰‹ç¬¬ä¸€æ¬¡æ¡æ‰‹: å»ºç«‹è¿æ¥, å®¢æˆ·ç«¯å‘é€è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µ, å°†SYNä½ç½®ä¸º1, Sequence Numberç½®ä¸ºx; ç„¶å, å®¢æˆ·ç«¯è¿›å…¥SYN_SENDçŠ¶æ€, ç­‰å¾…æœåŠ¡å™¨ç¡®è®¤.ç¬¬äºŒæ¬¡æ¡æ‰‹: æœåŠ¡å™¨æ”¶åˆ°SYNæŠ¥æ–‡æ®µ, æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„SYNæŠ¥æ–‡æ®µ, éœ€è¦å¯¹è¿™ä¸ªæŠ¥æ–‡æ®µç¡®è®¤, è®¾ç½®Acknowledgment Numberä¸ºx+1(Sequence Number+1); åŒæ—¶, è‡ªå·±è¿˜è¦å‘é€SYNè¯·æ±‚ä¿¡æ¯, å°†SYNä½ç½®ä¸º1, Sequence Numberä¸ºy; æœåŠ¡å™¨ç«¯å°†ä¸Šè¿°æ‰€æœ‰ä¿¡æ¯æ”¾åˆ°ä¸€ä¸ªæŠ¥æ–‡æ®µï¼ˆå³SYN+ACKæŠ¥æ–‡æ®µï¼‰ä¸­, ä¸€å¹¶å‘é€ç»™å®¢æˆ·ç«¯, æ­¤æ—¶æœåŠ¡å™¨è¿›å…¥SYN_RECVçŠ¶æ€.ç¬¬ä¸‰æ¬¡æ¡æ‰‹: å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„SYN+ACKæŠ¥æ–‡æ®µ, ç„¶åå°†Acknowledgment Numberè®¾ç½®ä¸ºy+1, å‘æœåŠ¡å™¨å‘é€ACKæŠ¥æ–‡æ®µ, è¿™ä¸ªæŠ¥æ–‡æ®µå‘é€å®Œæ¯•ä»¥å, å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯éƒ½è¿›å…¥ESTABLISHEDçŠ¶æ€, å®ŒæˆTCPä¸‰æ¬¡æ¡æ‰‹. å®Œæˆäº†ä¸‰æ¬¡æ¡æ‰‹, å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯å°±å¯ä»¥å¼€å§‹ä¼ é€æ•°æ®. å››æ¬¡æŒ¥æ‰‹ç¬¬ä¸€æ¬¡æŒ¥æ‰‹: ä¸»æœº1(å¯ä»¥ä½¿å®¢æˆ·ç«¯, ä¹Ÿå¯ä»¥æ˜¯æœåŠ¡ç«¯), è®¾ç½®Sequence Numberå’ŒAcknowledgment Number, å‘ä¸»æœº2å‘é€ä¸€ä¸ªFINæŠ¥æ–‡æ®µ; æ­¤æ—¶ï¼Œä¸»æœº1è¿›å…¥FIN_WAIT_1çŠ¶æ€; è¿™è¡¨ç¤ºä¸»æœº1æ²¡æœ‰æ•°æ®è¦å‘é€ç»™ä¸»æœº2äº†.ç¬¬äºŒæ¬¡æŒ¥æ‰‹: ä¸»æœº2æ”¶åˆ°äº†ä¸»æœº1å‘é€çš„FINæŠ¥æ–‡æ®µ, å‘ä¸»æœº1å›ä¸€ä¸ªACKæŠ¥æ–‡æ®µ, Acknowledgment Numberä¸ºSequence NumberåŠ 1; ä¸»æœº1è¿›å…¥FIN_WAIT_2çŠ¶æ€; ä¸»æœº2å‘Šè¯‰ä¸»æœº1, æˆ‘â€åŒæ„â€ä½ çš„å…³é—­è¯·æ±‚.ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹: ä¸»æœº2å‘ä¸»æœº1å‘é€FINæŠ¥æ–‡æ®µ, è¯·æ±‚å…³é—­è¿æ¥, åŒæ—¶ä¸»æœº2è¿›å…¥LAST_ACKçŠ¶æ€.ç¬¬å››æ¬¡æŒ¥æ‰‹: ä¸»æœº1æ”¶åˆ°ä¸»æœº2å‘é€çš„FINæŠ¥æ–‡æ®µ, å‘ä¸»æœº2å‘é€ACKæŠ¥æ–‡æ®µ, ç„¶åä¸»æœº1è¿›å…¥TIME_WAITçŠ¶æ€; ä¸»æœº2æ”¶åˆ°ä¸»æœº1çš„ACKæŠ¥æ–‡æ®µä»¥å, å°±å…³é—­è¿æ¥; æ­¤æ—¶, ä¸»æœº1å‘ç­‰å¾…2MSLåä¾ç„¶æ²¡æœ‰æ”¶åˆ°å›å¤, åˆ™è¯æ˜ä¸»æœº2å·²ç»æ­£å¸¸å…³é—­, é‚£ä¹ˆä¸»æœº1ä¹Ÿå°±æ­¤å…³é—­. HTTPä¸HTTPSHTTPSçš„ä¸»è¦æ€æƒ³æ˜¯åœ¨ä¸å®‰å…¨çš„ç½‘ç»œä¸Šåˆ›å»ºä¸€å®‰å…¨ä¿¡é“, å¹¶å¯åœ¨ä½¿ç”¨é€‚å½“çš„åŠ å¯†åŒ…å’ŒæœåŠ¡å™¨è¯ä¹¦å¯è¢«éªŒè¯ä¸”å¯è¢«ä¿¡ä»»æ—¶, å¯¹çªƒå¬å’Œä¸­é—´äººæ”»å‡»æä¾›åˆç†çš„é˜²æŠ¤. HTTPSçš„ä¿¡ä»»ç»§æ‰¿åŸºäºé¢„å…ˆå®‰è£…åœ¨æµè§ˆå™¨ä¸­çš„è¯ä¹¦é¢å‘æœºæ„.HTTPSä¸­çš„SæŒ‡çš„å°±æ˜¯TLS(SSL), ç›¸å½“äºæ˜¯HTTP over SSL. ä½¿ç”¨SSL/TLSåè®®è¿›è¡ŒåŠ è§£å¯†, ä¸‹é¢æˆ‘ä»¬æ¥è¯¦ç»†è¯´ä¸€ä¸‹æ˜¯å¦‚ä½•åŠ å¯†çš„. HTTPé»˜è®¤ç«¯å£æ˜¯80, HTTPSé»˜è®¤ç«¯å£æ˜¯443. å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘å‡ºåŠ å¯†è¯·æ±‚, æœåŠ¡ç«¯ç”¨è‡ªå·±çš„ç§é’¥åŠ å¯†å, è¿åŒæ•°å­—è¯ä¹¦ä¸€èµ·å‘é€ç»™å®¢æˆ·ç«¯. å®¢æˆ·ç«¯(æµè§ˆå™¨)ä¸­å†…ç½®æœ‰è¯ä¹¦ç®¡ç†å™¨, æœ‰â€å—ä¿¡ä»»çš„æ ¹è¯ä¹¦é¢å‘æœºæ„â€åˆ—è¡¨. å®¢æˆ·ç«¯ä¼šæ ¹æ®è¿™å¼ è¡¨æŸ¥çœ‹è§£å¼€æ•°å­—è¯ä¹¦çš„å…¬é’¥æ˜¯å¦åœ¨åˆ—è¡¨å†…. å¦‚æœæ•°å­—è¯ä¹¦è®°è½½çš„ç½‘å€ä¸æµè§ˆçš„ä¸ä¸€è‡´, å°±è¯´æ˜è¿™å¼ è¯ä¹¦è¢«å†’ç”¨, æµè§ˆå™¨ä¼šå‘å‡ºè­¦å‘Š. å¦‚æœè¿™å¼ æ•°å­—è¯ä¹¦ä¸æ˜¯ç”±å—ä¿¡ä»»çš„æœºæ„é¢å‘çš„, æµè§ˆå™¨ä¼šå‘å‡ºå¦ä¸€ç§è­¦å‘Š(12306)å°±æ˜¯ç¬¬äºŒç§è­¦å‘Š. å¦‚æœæ•°å­—è¯ä¹¦æ˜¯å¯é çš„, å®¢æˆ·ç«¯å°±å¯ä»¥ä½¿ç”¨è¯ä¹¦ä¸­çš„æœåŠ¡å™¨å…¬é’¥, å¯¹ä¿¡æ¯è¿›è¡ŒåŠ å¯†, ç„¶åä¸æœåŠ¡å™¨äº¤æ¢åŠ å¯†ä¿¡æ¯.","path":"2016/10/20/iOSç½‘ç»œç¼–ç¨‹/","date":"10-20","excerpt":""},{"title":"iOSäº‹ä»¶å“åº”é“¾","text":"æµç¨‹ è§¦æ‘¸å±äº§ç”Ÿè§¦æ‘¸äº‹ä»¶åï¼Œè§¦æ‘¸äº‹ä»¶ä¼šè¢«æ·»åŠ åˆ°ç”±UIApplicationç®¡ç†çš„äº‹ä»¶é˜Ÿåˆ—ä¸­å». UIApplicationä¼šä»äº‹ä»¶é˜Ÿåˆ—ä¸­å–å‡ºæœ€å‰é¢çš„äº‹ä»¶ï¼ŒæŠŠäº‹ä»¶ä¼ é€’ç»™åº”ç”¨ç¨‹åºçš„ä¸»çª—å£ï¼ˆkeywindowï¼‰ ä¸»çª—å£ä¼šåœ¨è§†å›¾å±‚çº§ç»“æ„ä¸­æ‰¾åˆ°ä¸€ä¸ªæœ€åˆé€‚çš„Viewæ¥å¤„ç†è§¦æ‘¸äº‹ä»¶ æœ€åˆé€‚çš„Viewè°ƒç”¨è‡ªå·±çš„touchesæ–¹æ³•å¤„ç†äº‹ä»¶ æŠŠäº‹ä»¶æ²¿ç€å“åº”è€…é“¾å‘ä¸ŠæŠ› æ³¨ï¼šäº‹ä»¶çš„ä¼ é€’æ˜¯ä»ä¸Šåˆ°ä¸‹ï¼ˆçˆ¶æ§ä»¶åˆ°å­æ§ä»¶ï¼‰,äº‹ä»¶å“åº”æ˜¯ä»ä¸‹åˆ°ä¸Šï¼ˆå­æ§ä»¶åˆ°çˆ¶æ§ä»¶ï¼‰ å¦‚ä½•æ‰¾åˆ°æœ€åˆé€‚çš„ViewhitTest:withEventåªè¦äº‹ä»¶ä¸€ä¼ é€’ç»™ä¸€ä¸ªæ§ä»¶, è¿™ä¸ªæ§ä»¶å°±ä¼šè°ƒç”¨ä»–è‡ªå·±çš„hitTest:withEvent:æ–¹æ³•. ä»–çš„ä½œç”¨å°±æ˜¯å¯»æ‰¾å¹¶è¿”å›æœ€åˆé€‚çš„view(èƒ½å¤Ÿå“åº”äº‹ä»¶çš„é‚£ä¸ªæœ€åˆé€‚çš„view). ä¸ç®¡è¿™ä¸ªæ§ä»¶èƒ½ä¸èƒ½å¤„ç†äº‹ä»¶, ä¹Ÿä¸ç®¡è§¦æ‘¸ç‚¹åœ¨ä¸åœ¨è¿™ä¸ªæ§ä»¶ä¸Š, äº‹ä»¶éƒ½ä¼šå…ˆä¼ é€’ç»™è¿™ä¸ªæ§ä»¶, éšåå†è°ƒç”¨ hitTest:withEvent:æ–¹æ³•. 12345678910111213141516171819- (UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event &#123; // 1.åˆ¤æ–­å½“å‰æ§ä»¶èƒ½å¦æ¥æ”¶äº‹ä»¶ if (self.userInteractionEnabled == NO || self.hidden == YES || self.alpha &lt;= 0.01) return nil; // 2. åˆ¤æ–­ç‚¹åœ¨ä¸åœ¨å½“å‰æ§ä»¶ if ([self pointInside:point withEvent:event] == NO) return nil; // 3.ä»åå¾€å‰éå†è‡ªå·±çš„å­æ§ä»¶ NSInteger count = self.subviews.count; for (NSInteger i = count - 1; i &gt;= 0; i--) &#123; UIView *childView = self.subviews[i]; // æŠŠå½“å‰æ§ä»¶ä¸Šçš„åæ ‡ç³»è½¬æ¢æˆå­æ§ä»¶ä¸Šçš„åæ ‡ç³» CGPoint childP = [self convertPoint:point toView:childView]; UIView *fitView = [childView hitTest:childP withEvent:event]; if (fitView) &#123; // å¯»æ‰¾åˆ°æœ€åˆé€‚çš„view return fitView; &#125; &#125; // å¾ªç¯ç»“æŸ,è¡¨ç¤ºæ²¡æœ‰æ¯”è‡ªå·±æ›´åˆé€‚çš„view return self;&#125; pointInside:withEvent:pointInside:withEvent:æ–¹æ³•åˆ¤æ–­ç‚¹åœ¨ä¸åœ¨å½“å‰viewä¸Š(æ–¹æ³•è°ƒç”¨è€…çš„åæ ‡ç³»ä¸Š)å¦‚æœè¿”å›YES, ä»£è¡¨ç‚¹åœ¨æ–¹æ³•è°ƒç”¨è€…çš„åæ ‡ç³»ä¸Š; è¿”å›NOä»£è¡¨ç‚¹ä¸åœ¨æ–¹æ³•è°ƒç”¨è€…çš„åæ ‡ç³»ä¸Š, é‚£ä¹ˆæ–¹æ³•è°ƒç”¨è€…ä¹Ÿå°±ä¸èƒ½å¤„ç†äº‹ä»¶. æ·±å…¥æµ…å‡ºiOSäº‹ä»¶æœºåˆ¶ iOSä¹‹äº‹ä»¶çš„ä¼ é€’å’Œå“åº”æœºåˆ¶-åŸç†ç¯‡","path":"2016/08/27/iOSäº‹ä»¶å“åº”é“¾/","date":"08-27","excerpt":""}]}